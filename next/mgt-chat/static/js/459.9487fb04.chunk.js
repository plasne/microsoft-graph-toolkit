"use strict";(self.webpackChunkreact_contoso=self.webpackChunkreact_contoso||[]).push([[459],{15459:function(e,t,n){n.r(t),n.d(t,{default:function(){return Dr}});var r=n(96234),a=n(33028),i=n(30969),s=n(90505),o=n(71166),c=n(17744),l=n(47780),u=n(94220),d=n(40016),p=n(14468),h=n(38675),f=n(84493),v=n(52895),g=n(15504),m=n(99657),b=n(9408),y=["Chat.ReadWrite"],x=["Chat.ReadWrite"],k=["Chat.ReadWrite"],C=["Chat.ReadWrite"],w=["Chat.ReadWrite"],Z=["Chat.ReadWrite"],S=["ChatMember.ReadWrite"],I=["ChatMember.ReadWrite"],M=["Chat.ReadWrite"],E=(Array.from([["User.Read"]].concat([["ChatMember.ReadWrite","Chat.ReadWrite"]]).concat(Object.values({loadPresence:["Presence.Read.All"],searchUsers:["User.ReadBasic.All"],searchPeople:["People.Read"]})).concat([(0,b._)()]).reduce((function(e,t){return t.forEach((function(t){return e.add(t)})),e}),new Set)),n(41361)),_=n(32723),T=n(34795),P=n(9249),A=n(87371),D=n(56666),U=n(72742),N=n(48970),R=n(19155),F=n(34629),L=n(61849),O=n(13106),z=function(){function e(){(0,P.Z)(this,e)}return(0,A.Z)(e,null,[{key:"graphEndpoint",get:function(){return e.useCanary?"https://canary.graph.microsoft.com":"https://graph.microsoft.com"}},{key:"baseCanaryUrl",get:function(){return"".concat(e.graphEndpoint,"/").concat(this.canarySubscriptionVersion)}},{key:"subscriptionEndpoint",get:function(){return e.useCanary?"".concat(e.baseCanaryUrl,"/subscriptions"):"/subscriptions"}},{key:"adjustNotificationUrl",value:function(t){return e.useCanary&&t&&(t=(t=t.replace("https://graph.microsoft.com/1.0",e.baseCanaryUrl)).replace("https://graph.microsoft.com/beta",e.baseCanaryUrl)),t.replace(e.webSocketsPrefix,"")}}]),e}();(0,D.Z)(z,"ackAsString",!1),(0,D.Z)(z,"useCanary",!1),(0,D.Z)(z,"version","v1.0"),(0,D.Z)(z,"canarySubscriptionVersion","testprodv1.0e2ewebsockets"),(0,D.Z)(z,"webSocketsPrefix","websockets:");var q,H=n(72097),B=n(46222),j=function(){return B.Q.config.conversation.isEnabled&&B.Q.config.isEnabled};!function(e){e.User="user",e.Chat="chat"}(q||(q={}));var V,W=function(e,t){return"".concat(e,":").concat(t)},G=function(){function e(){(0,P.Z)(this,e)}return(0,A.Z)(e,[{key:"cache",get:function(){var e=H.O.conversation;return B.Q.getCache(e,e.stores.subscriptions)}},{key:"loadSubscriptions",value:function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t,n){var r,a;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!j()){e.next=5;break}return r=W(t,n),e.next=4,this.cache.transaction(function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t){return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.get(r);case 2:if(!(a=e.sent)){e.next=7;break}return a.lastAccessDateTime=(new Date).toISOString(),e.next=7,t.put(a,r);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 4:return e.abrupt("return",a||void 0);case 5:return e.abrupt("return",void 0);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"cacheSubscription",value:function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t,n,r,a){return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cache.transaction(function(){var e=(0,T.Z)((0,_.Z)().mark((function e(i){var s,o,c;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,N.cM)("cacheSubscription",a),s=W(t,r),e.next=4,i.get(s);case 4:return(o=e.sent)&&o.componentEntityId===t?-1!==(c=o.subscriptions.findIndex((function(e){return e.resource===a.resource})))?o.subscriptions[c]=a:o.subscriptions.push(a):o={componentEntityId:t,componentType:n,sessionId:r,subscriptions:[a],lastAccessDateTime:""},o.lastAccessDateTime=(new Date).toISOString(),e.next=9,i.put(o,s);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"deleteCachedSubscriptions",value:function(e,t){return this.cache.delete(W(e,t))}},{key:"loadInactiveSubscriptions",value:function(e,t){return this.cache.queryDb("lastAccessDateTime",IDBKeyRange.upperBound(e)).then((function(e){return e.filter((function(e){return e.componentType===t}))})).catch((function(e){throw e}))}}]),e}(),Q=n(9744),J=function(){function e(){var t=this;(0,P.Z)(this,e),(0,D.Z)(this,"worker",void 0),(0,D.Z)(this,"work",new Map),(0,D.Z)(this,"onMessage",(function(e){var n=e.data;if(n&&"runCallback"===n.type)if(t.work.has(n.id)){var r=t.work.get(n.id);null===r||void 0===r||r()}})),this.worker=new SharedWorker(new URL(n.p+n.u(485),n.b)),this.worker.port.onmessage=this.onMessage}return(0,A.Z)(e,[{key:"setTimeout",value:function(e,t){var n={type:"setTimeout",id:(0,Q.Z)(),delay:t};return this.work.set(n.id,e),this.worker.port.postMessage(n),n.id}},{key:"clearTimeout",value:function(e){if(this.work.has(e)){var t={type:"clearTimeout",id:e};this.worker.port.postMessage(t),this.work.delete(e)}}},{key:"setInterval",value:function(e,t){var n={type:"setInterval",id:(0,Q.Z)(),delay:t};return this.work.set(n.id,e),this.worker.port.postMessage(n),n.id}},{key:"clearInterval",value:function(e){if(this.work.has(e)){var t={type:"clearInterval",id:e};this.worker.port.postMessage(t),this.work.delete(e)}}},{key:"close",value:function(){this.worker.port.close()}}]),e}(),$=10,Y=75,K=20,X=60,ee=60,te=(z.useCanary,function(){function e(t,n){var r=this;(0,P.Z)(this,e),(0,D.Z)(this,"emitter",void 0),(0,D.Z)(this,"_graph",void 0),(0,D.Z)(this,"connection",void 0),(0,D.Z)(this,"renewalTimeout",void 0),(0,D.Z)(this,"cleanupTimeout",void 0),(0,D.Z)(this,"renewalCount",0),(0,D.Z)(this,"chatId",""),(0,D.Z)(this,"sessionId",""),(0,D.Z)(this,"subscriptionCache",new G),(0,D.Z)(this,"timer",new J),(0,D.Z)(this,"getToken",(0,T.Z)((0,_.Z)().mark((function e(){var t;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U.C.globalProvider.getAccessToken();case 2:if(t=e.sent){e.next=5;break}throw new Error("Could not retrieve token for user");case 5:return e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})))),(0,D.Z)(this,"onReconnect",(function(e){(0,N.cM)("Reconnected. ConnectionId: ".concat(e||"undefined"))})),(0,D.Z)(this,"receiveNotificationMessage",(function(e){if("string"!==typeof e)throw new Error("Expected string from receivenotificationmessageasync");var t=JSON.parse(e);(0,N.cM)("received notification message",t);var n=r.emitter;if(!t.resourceData)throw new Error("Message did not contain resourceData");t.resource.includes("/messages(")?r.processMessageNotification(t,n):!function(e){return e.resource.includes("/members")}(t)?r.processChatPropertiesNotification(t,n):r.processMembershipNotification(t,n);var a={StatusCode:"200"};return z.ackAsString?JSON.stringify(a):a})),(0,D.Z)(this,"cacheSubscription",function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t){return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,N.cM)(t),e.next=3,r.subscriptionCache.cacheSubscription(r.chatId,q.Chat,r.sessionId,t);case 3:void 0===r.renewalTimeout&&r.startRenewalTimer();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,D.Z)(this,"startRenewalTimer",(function(){r.renewalTimeout&&r.timer.clearTimeout(r.renewalTimeout),r.renewalTimeout=r.timer.setTimeout(r.syncRenewalTimerWrapper,1e3*K),(0,N.cM)("Start renewal timer . Id: ".concat(r.renewalTimeout))})),(0,D.Z)(this,"syncRenewalTimerWrapper",(function(){r.renewalTimer()})),(0,D.Z)(this,"renewalTimer",(0,T.Z)((0,_.Z)().mark((function e(){var t,n,a,i,s,o,c;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,N.cM)("running subscription renewal timer for chatId: ".concat(r.chatId," sessionId: ").concat(r.sessionId)),e.next=3,r.subscriptionCache.loadSubscriptions(r.chatId,r.sessionId);case 3:if(e.t2=t=e.sent,e.t1=null===e.t2,e.t1){e.next=7;break}e.t1=void 0===t;case 7:if(!e.t1){e.next=11;break}e.t3=void 0,e.next=12;break;case 11:e.t3=t.subscriptions;case 12:if(e.t0=e.t3,e.t0){e.next=15;break}e.t0=[];case 15:if(0!==(n=e.t0).length){e.next=20;break}return(0,N.cM)("No subscriptions found in session state. Stop renewal timer ".concat(r.renewalTimeout,".")),r.renewalTimeout&&r.timer.clearTimeout(r.renewalTimeout),e.abrupt("return");case 20:a=(0,E.Z)(n),e.prev=21,a.s();case 23:if((i=a.n()).done){e.next=40;break}if((s=i.value).expirationDateTime){e.next=27;break}return e.abrupt("continue",38);case 27:if(o=new Date(s.expirationDateTime),c=new Date,!(Math.round((o.getTime()-c.getTime())/1e3)<=Y)){e.next=38;break}return r.renewalCount++,(0,N.cM)("Renewing Graph subscription. RenewalCount: ".concat(r.renewalCount)),r.renewalTimeout&&r.timer.clearTimeout(r.renewalTimeout),r.renewalTimeout=void 0,e.next=37,r.renewChatSubscriptions();case 37:return e.abrupt("break",40);case 38:e.next=23;break;case 40:e.next=45;break;case 42:e.prev=42,e.t4=e.catch(21),a.e(e.t4);case 45:return e.prev=45,a.f(),e.finish(45);case 48:r.renewalTimeout=r.timer.setTimeout(r.syncRenewalTimerWrapper,1e3*K);case 49:case"end":return e.stop()}}),e,null,[[21,42,45,48]])})))),(0,D.Z)(this,"renewChatSubscriptions",(0,T.Z)((0,_.Z)().mark((function e(){var t,n,a,i,s,o;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Date((new Date).getTime()+60*$*1e3),e.next=3,r.subscriptionCache.loadSubscriptions(r.chatId,r.sessionId);case 3:n=e.sent,a=[],i=(0,E.Z)((null===n||void 0===n?void 0:n.subscriptions)||[]),e.prev=6,i.s();case 8:if((s=i.n()).done){e.next=16;break}if((o=s.value).id){e.next=12;break}return e.abrupt("continue",14);case 12:a.push(r.renewSubscription(o.id,t.toISOString())),(0,N.cM)("Invoked RenewSubscription ".concat(o.id));case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(6),i.e(e.t0);case 21:return e.prev=21,i.f(),e.finish(21);case 24:return e.next=26,Promise.all(a);case 26:r.renewalTimeout||(r.renewalTimeout=r.timer.setTimeout(r.syncRenewalTimerWrapper,1e3*K));case 27:case"end":return e.stop()}}),e,null,[[6,18,21,24]])})))),(0,D.Z)(this,"renewSubscription",function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t,n){var a;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.graph.api("".concat(z.subscriptionEndpoint,"/").concat(t)).patch({expirationDateTime:n});case 2:return a=e.sent,e.abrupt("return",r.cacheSubscription(a));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),(0,D.Z)(this,"cleanupTimerSync",(function(){r.cleanupTimer()})),(0,D.Z)(this,"cleanupTimer",(0,T.Z)((0,_.Z)().mark((function e(){var t,n,a,i,s,o,c,l,u,d;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,N.cM)("running cleanup timer"),t=Math.min(1e3*X,60*$*1e3),n=new Date((new Date).getTime()-t).toISOString(),e.next=5,r.subscriptionCache.loadInactiveSubscriptions(n,q.Chat);case 5:a=e.sent,i=[],s=(0,E.Z)(a);try{for(s.s();!(o=s.n()).done;)c=o.value,i.push(r.removeSubscriptions(c.subscriptions))}catch(p){s.e(p)}finally{s.f()}return e.next=11,Promise.all(i);case 11:i=[],l=(0,E.Z)(a);try{for(l.s();!(u=l.n()).done;)d=u.value,i.push(r.subscriptionCache.deleteCachedSubscriptions(d.componentEntityId,d.sessionId))}catch(p){l.e(p)}finally{l.f()}r.startCleanupTimer();case 15:case"end":return e.stop()}}),e)})))),this.emitter=t,this._graph=n,this.startCleanupTimer()}return(0,A.Z)(e,[{key:"graph",get:function(){return this._graph}},{key:"beta",get:function(){return R.g.fromGraph(this._graph)}},{key:"subscriptionGraph",get:function(){return z.useCanary?(0,F.G)(U.C.globalProvider,z.canarySubscriptionVersion,"mgt-chat"):this.beta}},{key:"tearDown",value:function(){var e=(0,T.Z)((0,_.Z)().mark((function e(){return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,N.cM)("cleaning up graph notification resources"),this.cleanupTimeout&&this.timer.clearTimeout(this.cleanupTimeout),this.renewalTimeout&&this.timer.clearTimeout(this.renewalTimeout),this.timer.close(),e.next=6,this.unsubscribeFromChatNotifications(this.chatId,this.sessionId);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"processMessageNotification",value:function(e,t){var n=e.resourceData;switch(e.changeType){case"created":return void(null===t||void 0===t||t.chatMessageReceived(n));case"updated":return void(null===t||void 0===t||t.chatMessageEdited(n));case"deleted":return void(null===t||void 0===t||t.chatMessageDeleted(n));default:throw new Error("Unknown change type")}}},{key:"processMembershipNotification",value:function(e,t){var n=e.resourceData;switch(e.changeType){case"created":return void(null===t||void 0===t||t.participantAdded(n));case"deleted":return void(null===t||void 0===t||t.participantRemoved(n));default:throw new Error("Unknown change type")}}},{key:"processChatPropertiesNotification",value:function(e,t){var n=e.resourceData;switch(e.changeType){case"updated":return void(null===t||void 0===t||t.chatThreadPropertiesUpdated(n));case"deleted":return void(null===t||void 0===t||t.chatThreadDeleted(n));default:throw new Error("Unknown change type")}}},{key:"subscribeToResource",value:function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t,n){var r,a,i,s,o;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Date((new Date).getTime()+60*$*1e3).toISOString(),a={changeType:n.join(","),notificationUrl:"".concat(z.webSocketsPrefix,"?groupId=").concat(this.chatId,"&sessionId=").concat(this.sessionId),resource:t,expirationDateTime:r,includeResourceData:!0,clientState:"wsssecret"},(0,N.cM)("subscribing to changes for "+t),i=z.subscriptionEndpoint,e.next=6,this.subscriptionGraph.api(i).post(a);case 6:if(null!==(s=e.sent)&&void 0!==s&&s.notificationUrl){e.next=9;break}throw new Error("Subscription not created");case 9:return(0,N.cM)(s),(o=[]).push(this.cacheSubscription(s)),this.connection||o.push(this.createSignalRConnection(s.notificationUrl)),(0,N.cM)("Invoked CreateSubscription"),e.abrupt("return",Promise.all(o));case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createSignalRConnection",value:function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t){var n,r;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={accessTokenFactory:this.getToken,withCredentials:!1},(r=(new L.s).withUrl(z.adjustNotificationUrl(t),n).withAutomaticReconnect().configureLogging(O.i.Information).build()).onreconnected(this.onReconnect),r.on("receivenotificationmessageasync",this.receiveNotificationMessage),r.on("EchoMessage",N.cM),this.connection=r,e.prev=6,e.next=9,r.start();case 9:(0,N.cM)(r),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(6),(0,N.vU)("An error occurred connecting to the notification web socket",e.t0);case 15:case"end":return e.stop()}}),e,this,[[6,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteSubscription",value:function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t){return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.graph.api("".concat(z.subscriptionEndpoint,"/").concat(t)).delete();case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),(0,N.vU)(e.t0);case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()},{key:"removeSubscriptions",value:function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t){var n,r,a,i;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=(0,E.Z)(t),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=11;break}if((i=a.value).id&&!(i.expirationDateTime&&new Date(i.expirationDateTime)<=new Date)){e.next=8;break}return e.abrupt("continue",9);case 8:n.push(this.deleteSubscription(i.id));case 9:e.next=4;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),r.e(e.t0);case 16:return e.prev=16,r.f(),e.finish(16);case 19:return e.abrupt("return",Promise.all(n));case 20:case"end":return e.stop()}}),e,this,[[2,13,16,19]])})));return function(t){return e.apply(this,arguments)}}()},{key:"startCleanupTimer",value:function(){this.cleanupTimeout=this.timer.setTimeout(this.cleanupTimerSync,1e3*ee)}},{key:"closeSignalRConnection",value:function(){var e=(0,T.Z)((0,_.Z)().mark((function e(){var t;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=this.connection)||void 0===t?void 0:t.stop();case 2:this.connection=void 0;case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"unsubscribeFromChatNotifications",value:function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t,n){var r;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.closeSignalRConnection();case 2:return e.next=4,this.subscriptionCache.loadSubscriptions(t,n);case 4:if(!(r=e.sent)){e.next=8;break}return e.next=8,Promise.all([this.removeSubscriptions(r.subscriptions),this.subscriptionCache.deleteCachedSubscriptions(t,n)]);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"subscribeToChatNotifications",value:function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t,n){var r,a,i,s,o;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.chatId||!this.sessionId||t===this.chatId){e.next=3;break}return e.next=3,this.unsubscribeFromChatNotifications(this.chatId,this.sessionId);case 3:return this.chatId=t,this.sessionId=n,e.next=7,this.subscriptionCache.loadSubscriptions(t,n);case 7:if(!(r=e.sent)){e.next=24;break}if(i=r.subscriptions.some((function(e){return e.expirationDateTime&&new Date(e.expirationDateTime)<=new Date})),s=null===(a=r.subscriptions.find((function(e){return e.notificationUrl})))||void 0===a?void 0:a.notificationUrl,!i){e.next=16;break}return e.next=14,this.removeSubscriptions(r.subscriptions);case 14:e.next=22;break;case 16:if(!s){e.next=22;break}return e.next=19,this.createSignalRConnection(s);case 19:return e.next=21,this.renewChatSubscriptions();case 21:return e.abrupt("return");case 22:return e.next=24,this.subscriptionCache.deleteCachedSubscriptions(t,n);case 24:return(o=[]).push(this.subscribeToResource("/chats/".concat(t,"/messages"),["created","updated","deleted"])),o.push(this.subscribeToResource("/chats/".concat(t,"/members"),["created","deleted"])),o.push(this.subscribeToResource("/chats/".concat(t),["updated","deleted"])),e.next=30,Promise.all(o);case 30:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}()),ne=n(32425),re=n(61607),ae=n(61167),ie=n(27338),se=n(89200),oe=n(78428),ce=n(30494),le=n(68467),ue=n(2476),de=n(25607),pe=n(38667),he=n(68079),fe=n(64612),ve=n(41667),ge=n(65854),me=n(49698),be=n(42292),ye=n(69),xe=n(27597),ke=function(){var e,t;return U.C.globalProvider.state===be.Aw.SignedIn?null===(e=(t=U.C.globalProvider).getActiveAccount)||void 0===e?void 0:e.call(t):void 0},Ce=function(){var e;return(null===(e=ke())||void 0===e?void 0:e.id.split(".")[0])||""},we=function(e,t){if(!e)throw new Error("Component name is required");return U.C.globalProvider.graph.forComponent(e,t)},Ze=function(e){return e.timeCached&&(B.Q.config.conversation.invalidationPeriod||B.Q.config.defaultInvalidationPeriod)>Date.now()-e.timeCached},Se=function(){function e(){(0,P.Z)(this,e)}return(0,A.Z)(e,[{key:"cache",get:function(){var e=H.O.conversation;return B.Q.getCache(e,e.stores.chats)}},{key:"loadMessages",value:function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t){var n;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!j()){e.next=6;break}return e.next=3,this.cache.getValue(t);case 3:if(!(n=e.sent)||!Ze(n)){e.next=6;break}return e.abrupt("return",n);case 6:return e.abrupt("return",void 0);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"cacheMessages",value:function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t,n){var r,a,i,s,o,c=this,l=arguments;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.length>2&&void 0!==l[2]&&l[2],a=l.length>3?l[3]:void 0,e.next=4,this.cache.getValue(t);case 4:if(i=e.sent){e.next=13;break}return s=n.reduce((function(e,t){return t.lastModifiedDateTime&&t.lastModifiedDateTime>e&&(e=t.lastModifiedDateTime),e}),""),o={chatId:t,value:n,lastModifiedDateTime:s,nextLink:a},e.next=10,this.cache.putValue(t,o);case 10:return e.abrupt("return",o);case 13:return n.forEach((function(e){return c.addMessageToCacheData(e,i)})),r&&(i.nextLink=a),e.next=17,this.cache.putValue(t,i);case 17:return e.abrupt("return",i);case 18:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"cacheMessage",value:function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t,n){var r;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cache.getValue(t);case 2:if(r=e.sent){e.next=8;break}return e.next=6,this.cache.putValue(t,{chatId:t,value:[n],lastModifiedDateTime:n.lastModifiedDateTime||""});case 6:e.next=11;break;case 8:return this.addMessageToCacheData(n,r),e.next=11,this.cache.putValue(t,r);case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"addMessageToCacheData",value:function(e,t){var n,r=t.value.findIndex((function(t){return t.id===e.id}));-1!==r?t.value.splice(r,1,e):t.value.push(e),e.lastModifiedDateTime&&e.lastModifiedDateTime>(null!==(n=t.lastModifiedDateTime)&&void 0!==n?n:"")&&(t.lastModifiedDateTime=e.lastModifiedDateTime)}},{key:"deleteMessage",value:function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t,n){var r,a;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cache.getValue(t);case 2:if(!(r=e.sent)){e.next=8;break}return a=r.value.findIndex((function(e){return e.id===n.id})),r.value.splice(a,1),e.next=8,this.cache.putValue(t,r);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),Ie=n(16110),Me=function(){function e(){(0,P.Z)(this,e),(0,D.Z)(this,"emitter",new Ie.EventEmitter)}return(0,A.Z)(e,[{key:"on",value:function(e,t){this.emitter.on(e,t)}},{key:"off",value:function(e,t){this.emitter.off(e,t)}},{key:"chatMessageReceived",value:function(e){this.emitter.emit("chatMessageReceived",e)}},{key:"chatMessageEdited",value:function(e){this.emitter.emit("chatMessageEdited",e)}},{key:"chatMessageDeleted",value:function(e){this.emitter.emit("chatMessageDeleted",e)}},{key:"typingIndicatorReceived",value:function(e){this.emitter.emit("typingIndicatorReceived",e)}},{key:"readReceiptReceived",value:function(e){this.emitter.emit("readReceiptReceived",e)}},{key:"chatThreadDeleted",value:function(e){this.emitter.emit("chatThreadDeleted",e)}},{key:"chatThreadPropertiesUpdated",value:function(e){this.emitter.emit("chatThreadPropertiesUpdated",e)}},{key:"participantAdded",value:function(e){this.emitter.emit("participantAdded",e)}},{key:"participantRemoved",value:function(e){this.emitter.emit("participantRemoved",e)}},{key:"notificationsSubscribedForResource",value:function(e){this.emitter.emit("notificationsSubscribedForResource",e)}},{key:"disconnected",value:function(){this.emitter.emit("disconnected")}},{key:"connected",value:function(){this.emitter.emit("connected")}},{key:"reconnected",value:function(){this.emitter.emit("reconnected")}}]),e}(),Ee=n(98556),_e=function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t,n){return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("/chats/".concat(n,"?$expand=members")).middlewareOptions(Ee.z.apply(void 0,(0,he.Z)(y))).get();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Te=function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t,n,r){var a,i;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("/chats/".concat(n,"/messages")).orderby("createdDateTime DESC").top(r).middlewareOptions(Ee.z.apply(void 0,(0,he.Z)(x))).get();case 2:return(i=e.sent).nextLink=null===(a=i["@odata.nextLink"])||void 0===a?void 0:a.split(t.version)[1],e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Pe=function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t,n,r,a){var i,s;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("/chats/".concat(n,"/messages")).filter("lastModifiedDateTime gt ".concat(r)).orderby("lastModifiedDateTime DESC").top(a).middlewareOptions(Ee.z.apply(void 0,(0,he.Z)(x))).get();case 2:return(s=e.sent).nextLink=null===(i=s["@odata.nextLink"])||void 0===i?void 0:i.split(t.version)[1],e.abrupt("return",s);case 5:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),Ae=function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t,n){var r,a;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api(n).get();case 2:return(a=e.sent).nextLink=null===(r=a["@odata.nextLink"])||void 0===r?void 0:r.split(t.version)[1],e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),De=function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t,n,r){return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("/chats/".concat(n,"/messages")).middlewareOptions(Ee.z.apply(void 0,(0,he.Z)(C))).post({body:{content:r}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Ue=function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t,n,r,a){return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("/chats/".concat(n,"/messages/").concat(r)).middlewareOptions(Ee.z.apply(void 0,(0,he.Z)(w))).patch({body:{content:a}});case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),Ne=function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t,n,r){return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("/me/chats/".concat(n,"/messages/").concat(r,"/softDelete")).middlewareOptions(Ee.z.apply(void 0,(0,he.Z)(Z))).post({});case 2:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Re=function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t,n,r){return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("/chats/".concat(n,"/members/").concat(r)).middlewareOptions(Ee.z.apply(void 0,(0,he.Z)(S))).delete();case 2:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Fe=function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t,n,r,a){var i;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={requests:r.map((function(e,t){var r={"@odata.type":"#microsoft.graph.aadUserConversationMember","user@odata.bind":"https://graph.microsoft.com/v1.0/users/".concat(e),roles:["owner"]};return a&&(r.visibleHistoryStartDateTime=a.toISOString()),{id:t,method:"POST",url:"/chats/".concat(n,"/members"),headers:{"Content-Type":"application/json"},body:r}}))},e.next=3,t.api("$batch").middlewareOptions(Ee.z.apply(void 0,(0,he.Z)(I))).post(i);case 3:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),Le=function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t,n){var r,a,i,s,o,c;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!B.Q.config.photos.isEnabled||!B.Q.config.isEnabled){e.next=7;break}return i=B.Q.getCache(H.O.photos,H.O.photos.stores.teams),e.next=4,i.getValue(n);case 4:if(r=e.sent,!(null!==(a=r)&&void 0!==a&&a.timeCached&&r.photo&&(0,ge.Kf)()>Date.now()-r.timeCached)){e.next=7;break}return e.abrupt("return",r.photo);case 7:return e.next=9,t.api(n).responseType(ye.UN.RAW).middlewareOptions(Ee.z.apply(void 0,(0,he.Z)(k))).get();case 9:if(404!==(s=e.sent).status){e.next=14;break}r={eTag:void 0,photo:void 0},e.next=16;break;case 14:if(s.ok){e.next=16;break}return e.abrupt("return",null);case 16:return o=s["@odata.mediaEtag"],e.t0=me.w8,e.next=20,s.blob();case 20:return e.t1=e.sent,e.next=23,(0,e.t0)(e.t1);case 23:return c=e.sent,r={eTag:o,photo:c},e.next=27,(0,ge.Yo)(n,H.O.photos.stores.teams,r);case 27:return e.abrupt("return",c);case 28:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Oe=function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t,n,r,a,i){var s,o;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={chatType:r||n.length>2?"group":"oneOnOne",members:n.map((function(e){return{"@odata.type":"#microsoft.graph.aadUserConversationMember",roles:["owner"],"user@odata.bind":"https://graph.microsoft.com/v1.0/users('".concat(e,"')")}}))},r&&i&&(s.topic=i),e.next=4,t.api("/chats").middlewareOptions(Ee.z.apply(void 0,(0,he.Z)(M))).post(s);case 4:if(null!==(o=e.sent)&&void 0!==o&&o.id){e.next=7;break}throw new Error("Chat id not returned from create chat thread");case 7:if(!a){e.next=10;break}return e.next=10,De(t,o.id,a);case 10:return e.abrupt("return",o);case 11:case"end":return e.stop()}}),e)})));return function(t,n,r,a,i){return e.apply(this,arguments)}}(),ze=function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t,n,r){return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("/chats/".concat(n)).middlewareOptions(Ee.z.apply(void 0,(0,he.Z)(w))).patch({topic:r});case 2:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),qe=function(e,t,n,r){var a="".concat(n,"-").concat(t),i=new RegExp("(<img[^>]+id=[\"']".concat(a,"[\"'][^>]+)src=[\"']([^\"']*)[\"']")),s='$1src="'.concat(r,'"');return e.replace(i,s)},He=function(e){return"content"in e},Be=function(e){return"undefined"!==typeof(null===e||void 0===e?void 0:e.members)},je=function(e,t){return e.createdOn.getTime()-t.createdOn.getTime()},Ve=function(e,t){return e.createdDateTime&&t.createdDateTime?e.createdDateTime===t.createdDateTime?0:e.createdDateTime>t.createdDateTime?1:-1:e.createdDateTime?1:-1},We=/(<img[^>]+)src=(["']https:\/\/graph\.microsoft\.com[^"']*["'])/,Ge=function(){function e(){var t=this;(0,P.Z)(this,e),(0,D.Z)(this,"_notificationClient",void 0),(0,D.Z)(this,"_eventEmitter",void 0),(0,D.Z)(this,"_cache",void 0),(0,D.Z)(this,"_subscribers",[]),(0,D.Z)(this,"_nextLink",void 0),(0,D.Z)(this,"_chat",void 0),(0,D.Z)(this,"_userDisplayName",""),(0,D.Z)(this,"onLoginStateChanged",(function(e){switch(e.detail){case be.Aw.SignedIn:return t.updateUserInfo(),void(t.chatId&&t.updateFollowedChat());case be.Aw.SignedOut:case be.Aw.Loading:default:return}})),(0,D.Z)(this,"onActiveAccountChanged",(function(e){var n;e.detail&&t.userId!==(null===(n=e.detail)||void 0===n?void 0:n.id)&&t.handleAccountChange()})),(0,D.Z)(this,"handleAccountChange",(0,T.Z)((0,_.Z)().mark((function e(){var n;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.clearCurrentUserMessages(),e.next=3,null===(n=t._notificationClient)||void 0===n?void 0:n.closeSignalRConnection();case 3:return t.updateUserInfo(),e.next=6,t.updateFollowedChat();case 6:case"end":return e.stop()}}),e)})))),(0,D.Z)(this,"_userId",""),(0,D.Z)(this,"_chatId",""),(0,D.Z)(this,"_sessionId",void 0),(0,D.Z)(this,"resolveIcon",(function(e){switch(e){case"#microsoft.graph.membersAddedEventMessageDetail":return"add-friend";case"#microsoft.graph.membersDeletedEventMessageDetail":return"left-chat";case"#microsoft.graph.chatRenamedEventMessageDetail":return"edit-svg";default:return"Unknown"}})),(0,D.Z)(this,"loadMoreMessages",(0,T.Z)((0,_.Z)().mark((function e(){var n;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t._nextLink){e.next=2;break}return e.abrupt("return",!0);case 2:return e.next=4,Ae(t.graph,t._nextLink);case 4:return n=e.sent,e.next=7,t._cache.cacheMessages(t._chatId,n.value,!0,n.nextLink);case 7:return e.next=9,t.writeMessagesToState(n);case 9:return e.abrupt("return",!t._nextLink);case 10:case"end":return e.stop()}}),e)})))),(0,D.Z)(this,"sendMessage",function(){var e=(0,T.Z)((0,_.Z)().mark((function e(n){var r,a;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:return r=(0,Q.Z)(),t.notifyStateChange((function(e){var a={clientMessageId:r,messageId:r,contentType:"text",messageType:"chat",content:n,senderDisplayName:t._userDisplayName,createdOn:new Date,senderId:t.userId,mine:!0,status:"sending"};e.messages.push(a)})),e.prev=4,e.next=7,De(t.graph,t.chatId,n);case 7:a=e.sent,t.notifyStateChange((function(e){var n=e.messages.findIndex((function(e){return e.messageId===r})),i=t.graphChatMessageToAcsChatMessage(a,t.userId).currentValue;i&&e.messages.splice(n,1,i)})),e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(4),t.notifyStateChange((function(e){e.messages.find((function(e){return e.messageId===r})).status="failed"})),new Error("Failed to send message");case 15:case"end":return e.stop()}}),e,null,[[4,11]])})));return function(t){return e.apply(this,arguments)}}()),(0,D.Z)(this,"setDeletedContent",(function(e){e.content="<em>This message has been deleted.</em>",e.contentType="html"})),(0,D.Z)(this,"deleteMessage",function(){var e=(0,T.Z)((0,_.Z)().mark((function e(n){var r,a;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:if(r=t._state.messages.find((function(e){return e.messageId===n})),a=t._state.messages.find((function(e){return e.clientMessageId===n})),null===r||void 0===r||!r.mine){e.next=14;break}if(e.prev=5,a){e.next=9;break}return e.next=9,Ne(t.graph,t.chatId,n);case 9:t.notifyStateChange((function(e){var r=e.messages.find((function(e){return e.messageId===n}));r.clientMessageId?e.messages.splice(e.messages.indexOf(r),1):t.setDeletedContent(r)})),e.next=14;break;case 12:e.prev=12,e.t0=e.catch(5);case 14:case"end":return e.stop()}}),e,null,[[5,12]])})));return function(t){return e.apply(this,arguments)}}()),(0,D.Z)(this,"updateMessage",function(){var e=(0,T.Z)((0,_.Z)().mark((function e(n,r){var a;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&r){e.next=2;break}return e.abrupt("return");case 2:if(null===(a=t._state.messages.find((function(e){return e.messageId===n})))||void 0===a||!a.mine||!a.content){e.next=15;break}return t.notifyStateChange((function(e){var t=e.messages.find((function(e){return e.messageId===n}));t&&(t.content=r,t.status="sending")})),e.prev=5,e.next=8,Ue(t.graph,t.chatId,n,r);case 8:t.notifyStateChange((function(e){e.messages.find((function(e){return e.messageId===n})).status="delivered"})),e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(5),t.notifyStateChange((function(e){e.messages.find((function(e){return e.messageId===n})).status="failed"})),new Error("Failed to update message");case 15:case"end":return e.stop()}}),e,null,[[5,11]])})));return function(t,n){return e.apply(this,arguments)}}()),(0,D.Z)(this,"onMessageReceived",function(){var e=(0,T.Z)((0,_.Z)().mark((function e(n){var r,a,i;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.updateMentions(n),e.next=3,t._cache.cacheMessage(t._chatId,n);case 3:if(r=t.convertChatMessage(n),a=r.currentValue,t.updateMessages(a),!r.futureValue){e.next=11;break}return e.next=9,r.futureValue;case 9:i=e.sent,t.updateMessages(i);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,D.Z)(this,"updateMentions",(function(e){e&&t.notifyStateChange((function(t){var n,r,a=null!==(n=null===e||void 0===e?void 0:e.mentions)&&void 0!==n?n:[];t.mentions=null===(r=t.mentions)||void 0===r?void 0:r.concat.apply(r,(0,he.Z)(Array.from(a)))}))})),(0,D.Z)(this,"onMessageDeleted",(function(e){t._cache.deleteMessage(t.chatId,e),t.notifyStateChange((function(n){var r=n.messages.find((function(t){return t.messageId===e.id}));r&&t.setDeletedContent(r)}))})),(0,D.Z)(this,"onMessageEdited",function(){var e=(0,T.Z)((0,_.Z)().mark((function e(n){var r,a;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._cache.cacheMessage(t._chatId,n);case 2:if(r=t.convertChatMessage(n),t.updateMessages(r.currentValue),!r.futureValue){e.next=9;break}return e.next=7,r.futureValue;case 7:a=e.sent,t.updateMessages(a);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,D.Z)(this,"checkForMissedMessages",(0,T.Z)((0,_.Z)().mark((function e(){var n,r,a,i;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Te(t.graph,t.chatId,t._messagesPerCall);case 2:if(n=e.sent,r=n.value.filter((function(e){var t,n;return(null===(t=e.body)||void 0===t?void 0:t.content)||!(null!==(n=e.body)&&void 0!==n&&n.content)&&(null===e||void 0===e?void 0:e.policyViolation)})).map((function(e){return t.convertChatMessage(e)})),a=[],r.map((function(e){return e.currentValue})).reduce((function(e,t){return t&&e.push(t),e}),a),a.forEach((function(e){return t.updateMessages(e)})),!((i=r.filter((function(e){return e.futureValue})).map((function(e){return e.futureValue}))).length>0)){e.next=12;break}return e.next=11,Promise.all(i);case 11:e.sent.forEach((function(e){t.updateMessages(e)}));case 12:n.value.some((function(e){return t._state.messages.find((function(t){return t.messageId===e.id}))})),(0,N.cM)("checked for missed messages");case 15:case"end":return e.stop()}}),e)})))),(0,D.Z)(this,"onChatNotificationsSubscribed",(function(e){e.includes("/".concat(t.chatId,"/"))&&e.includes("/messages")&&t.checkForMissedMessages()})),(0,D.Z)(this,"onChatPropertiesUpdated",(function(e){t._chat=e,t.notifyStateChange((function(t){t.chat=e}))})),(0,D.Z)(this,"onParticipantAdded",(function(e){t.notifyStateChange((function(t){t.participants.find((function(t){return t.id===e.id}))||t.participants.push(e)}))})),(0,D.Z)(this,"onParticipantRemoved",(function(e){e.id&&t.removeParticipantFromState(e.id)})),(0,D.Z)(this,"addChatMembers",function(){var e=(0,T.Z)((0,_.Z)().mark((function e(n,r){return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fe(t.graph,t.chatId,n,r);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),(0,D.Z)(this,"removeChatMember",function(){var e=(0,T.Z)((0,_.Z)().mark((function e(n){var r,a;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:if(-1!==(null!==(r=null===(a=t._chat)||void 0===a||null===(a=a.members)||void 0===a?void 0:a.findIndex((function(e){return e.id===n})))&&void 0!==r?r:-1)){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,Re(t.graph,t.chatId,n);case 7:t.removeParticipantFromState(n);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,D.Z)(this,"renameChat",function(){var e=(0,T.Z)((0,_.Z)().mark((function e(n){return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ze(t.graph,t.chatId,n);case 2:t.notifyStateChange((function(){t._chat=(0,a.Z)((0,a.Z)({},t._chat),{topic:n})}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,D.Z)(this,"_initialState",{status:"initial",userId:"",messages:[],mentions:[],participants:[],get participantCount(){var e;return(null===(e=this.participants)||void 0===e?void 0:e.length)||0},disableEditing:!1,numberOfChatMessagesToReload:this._messagesPerCall,onDeleteMessage:this.deleteMessage,onSendMessage:this.sendMessage,onUpdateMessage:this.updateMessage,onAddChatMembers:this.addChatMembers,onRemoveChatMember:this.removeChatMember,onRenameChat:this.renameChat,activeErrorMessages:[],chat:this._chat}),(0,D.Z)(this,"_state",(0,a.Z)({},this._initialState)),this.updateUserInfo(),U.C.globalProvider.onStateChanged(this.onLoginStateChanged),U.C.globalProvider.onActiveAccountChanged(this.onActiveAccountChanged),this._eventEmitter=new Me,this.registerEventListeners(),this._cache=new Se,this._notificationClient=new te(this._eventEmitter,we("mgt-chat",z.version))}return(0,A.Z)(e,[{key:"_messagesPerCall",get:function(){return 5}},{key:"tearDown",value:function(){var e=(0,T.Z)((0,_.Z)().mark((function e(){return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._notificationClient.tearDown();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onStateChange",value:function(e){this._subscribers.includes(e)||this._subscribers.push(e)}},{key:"offStateChange",value:function(e){var t=this._subscribers.indexOf(e);-1!==t&&(this._subscribers=this._subscribers.splice(t,1))}},{key:"notifyStateChange",value:function(e){var t=this;this._state=(0,xe.Uy)(this._state,e),this._subscribers.forEach((function(e){return e(t._state)}))}},{key:"getState",value:function(){return this._state}},{key:"clearCurrentUserMessages",value:function(){this.notifyStateChange((function(e){e.messages=[],e.participants=[],e.chat=void 0,e.status="initial"}))}},{key:"updateUserInfo",value:function(){this.updateCurrentUserId(),this.updateCurrentUserName()}},{key:"updateCurrentUserName",value:function(){this._userDisplayName=function(){var e;return(null===(e=ke())||void 0===e?void 0:e.name)||""}()}},{key:"updateCurrentUserId",value:function(){this.userId=Ce()}},{key:"userId",get:function(){return this._userId},set:function(e){this._userId!==e&&(this._userId=e,this.notifyStateChange((function(t){t.userId=e})))}},{key:"chatId",get:function(){return this._chatId},set:function(e){e&&this._chatId===e||(this._chatId=e,this._chatId&&this._sessionId&&this.updateFollowedChat())}},{key:"subscribeToChat",value:function(e,t){e&&t&&(this._sessionId=t,this.chatId=e)}},{key:"updateFollowedChat",value:function(){var e=(0,T.Z)((0,_.Z)().mark((function e(){var t;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.chatId||!this._sessionId){e.next=16;break}return this.notifyStateChange((function(e){e.status="initial",e.messages=[],e.mentions=[],e.chat=void 0,e.participants=[]})),this.notifyStateChange((function(e){e.status="creating server connections"})),e.prev=3,(t=[this.loadChatData()]).push(this._notificationClient.subscribeToChatNotifications(this._chatId,this._sessionId)),e.next=8,Promise.all(t);case 8:e.next=14;break;case 10:e.prev=10,e.t0=e.catch(3),console.error("Failed to load chat data or subscribe to notications: ",e.t0),e.t0 instanceof ye.yh&&this.notifyStateChange((function(e){e.status="no messages"}));case 14:e.next=17;break;case 16:this.notifyStateChange((function(e){e.status="no chat id"}));case 17:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadChatData",value:function(){var e=(0,T.Z)((0,_.Z)().mark((function e(){var t,n,r,a;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.notifyStateChange((function(e){e.status="loading messages"})),e.prev=1,e.next=4,_e(this.graph,this.chatId);case 4:this._chat=e.sent,e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",Promise.reject(e.t0));case 10:return e.next=12,this._cache.loadMessages(this._chatId);case 12:if(!(t=e.sent)){e.next=27;break}return e.next=16,this.writeMessagesToState(t);case 16:return e.next=18,this.loadDeltaData(this._chatId,t.lastModifiedDateTime);case 18:return n=e.sent,e.next=21,this._cache.cacheMessages(this._chatId,n);case 21:return(r=e.sent).value=n,e.next=25,this.writeMessagesToState(r);case 25:e.next=34;break;case 27:return e.next=29,Te(this.graph,this._chatId,this._messagesPerCall);case 29:return a=e.sent,e.next=32,this._cache.cacheMessages(this._chatId,a.value,!0,a.nextLink);case 32:return e.next=34,this.writeMessagesToState(a);case 34:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadDeltaData",value:function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t,n){var r,a;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],e.next=3,Pe(this.graph,t,n,this._messagesPerCall);case 3:a=e.sent,r.push.apply(r,(0,he.Z)(a.value));case 5:if(!a.nextLink){e.next=12;break}return e.next=8,Ae(this.graph,a.nextLink);case 8:a=e.sent,r.push.apply(r,(0,he.Z)(a.value)),e.next=5;break;case 12:return e.abrupt("return",r.sort(Ve));case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"writeMessagesToState",value:function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t){var n,r,a,i=this;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._nextLink=t.nextLink,n=t.value.filter((function(e){var t;return null===(t=e.body)||void 0===t?void 0:t.content})).map((function(e){return i.convertChatMessage(e)})),r=t.value.map((function(e){return e.mentions})).filter((function(e){return null===e||void 0===e?void 0:e.length})),this.notifyStateChange((function(e){var t,a;e.participants=(null===(t=i._chat)||void 0===t?void 0:t.members)||[],e.participantCount=e.participants.length;e.messages=e.messages.concat(n.map((function(e){return e.currentValue})).reduce((function(e,t){return t&&e.push(t),e}),[])).sort(je),e.onLoadPreviousChatMessages=i._nextLink?i.loadMoreMessages:void 0,e.status=i._nextLink?"loading messages":"ready",e.chat=i._chat,e.mentions=null===(a=e.mentions)||void 0===a?void 0:a.concat.apply(a,(0,he.Z)(Array.from(r)))})),!((a=n.filter((function(e){return e.futureValue})).map((function(e){return e.futureValue}))).length>0)){e.next=9;break}return e.next=8,Promise.all(a);case 8:e.sent.forEach((function(e){i.updateMessages(e)}));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"convertChatMessage",value:function(e){var t;switch(e.messageType){case"message":return this.graphChatMessageToAcsChatMessage(e,this.userId);case"systemEventMessage":case"unknownFutureValue":return{futureValue:this.buildSystemContentMessage(e)};default:throw new Error("Unknown message type ".concat((null===(t=e.messageType)||void 0===t?void 0:t.toString())||"undefined"))}}},{key:"buildSystemContentMessage",value:function(){var e=(0,T.Z)((0,_.Z)().mark((function e(t){var n,r,a,i,s,o,c,l,u,d,p,h,f,v,g=this;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.eventDetail,a="",i=[],!(s=null===(n=r.initiator)||void 0===n||null===(n=n.user)||void 0===n?void 0:n.id)){e.next=24;break}for(i.push((0,ve.h)(this.graph,s)),o=[],Be(r)&&(null===(c=r.members)||void 0===c||c.reduce((function(e,t){return"string"===typeof t.id&&e.push(t.id),e}),o)),l=0,u=null!==o&&void 0!==o?o:[];l<u.length;l++)d=u[l],i.push((0,ve.h)(this.graph,d));return e.next=11,Promise.all(i);case 11:p=e.sent,h=null===o||void 0===o?void 0:o.filter((function(e){return e!==s})).map((function(e){return g.getUserName(e,p)})).join(", "),f=this.getUserName(s,p),e.t0=r["@odata.type"],e.next="#microsoft.graph.membersAddedEventMessageDetail"===e.t0?17:"#microsoft.graph.membersDeletedEventMessageDetail"===e.t0?19:"#microsoft.graph.chatRenamedEventMessageDetail"===e.t0?21:23;break;case 17:return a="".concat(f," added ").concat(h),e.abrupt("break",24);case 19:return a="".concat(f," removed ").concat(h),e.abrupt("break",24);case 21:return a=r.chatDisplayName?"".concat(f," renamed the chat to ").concat(r.chatDisplayName):"".concat(f," removed the group name for this conversation"),e.abrupt("break",24);case 23:(0,N.ZK)("Unknown system message type ".concat(r["@odata.type"],"\n\ndetail: ").concat(JSON.stringify(r)));case 24:return v={createdOn:t.createdDateTime?new Date(t.createdDateTime):new Date,messageId:t.id||"",systemMessageType:"content",messageType:"system",iconName:this.resolveIcon(r["@odata.type"]),content:a},e.abrupt("return",v);case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUserName",value:function(e,t){var n;return(null===(n=t.find((function(t){return t.id===e})))||void 0===n?void 0:n.displayName)||"unknown user"}},{key:"updateMessages",value:function(e){e&&this.notifyStateChange((function(t){var n=t.messages.findIndex((function(t){return t.messageId===e.messageId}));-1===n?t.messages=t.messages.concat(e).sort(je):t.messages.splice(n,1,e)}))}},{key:"removeParticipantFromState",value:function(e){this.notifyStateChange((function(t){var n=t.participants.findIndex((function(t){return t.id===e}));-1!==n&&t.participants.splice(n,1)}))}},{key:"graphImageMatch",value:function(e){return e.match(We)}},{key:"processMessageContent",value:function(e,t){for(var n,i,s,o={},c={},l=null!==(n=null===(i=e.body)||void 0===i?void 0:i.content)&&void 0!==n?n:"",u=null!==(s=e.id)&&void 0!==s?s:"",d=0,p=this.graphImageMatch(l);p;){l=l.replace(We,'$1id="'.concat(u,"-").concat(d,'" src="').concat("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAMSURBVBhXY7h58yYABRoCjB9qX5UAAAAASUVORK5CYII=",'"'));var h=p[2].replace(/["']/g,"");c[d]=Le(this.graph,h),d++,p=this.graphImageMatch(l)}var f=this.buildAcsMessage(e,t,u,l);o.currentValue=f;var v=function(){var e=(0,T.Z)((0,_.Z)().mark((function e(){var t,n,i,s,o,l,d;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(Object.values(c));case 2:t=0,n=Object.entries(c);case 3:if(!(t<n.length)){e.next=12;break}return i=(0,r.Z)(n[t],2),s=i[0],o=i[1],e.next=7,o;case 7:(l=e.sent)&&He(f)&&(f=(0,a.Z)((0,a.Z)({},f),{content:qe(null!==(d=f.content)&&void 0!==d?d:"",s,u,l)}));case 9:t++,e.next=3;break;case 12:return e.abrupt("return",f);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return o.futureValue=v(),o}},{key:"graphChatMessageToAcsChatMessage",value:function(e,t){var n,r,a,i,s=null!==(n=null===e||void 0===e?void 0:e.id)&&void 0!==n?n:"";if(!s)throw new Error("Cannot convert graph message to ACS message. No ID found on graph message");var o=null!==(r=null===(a=e.body)||void 0===a?void 0:a.content)&&void 0!==r?r:"undefined",c={};return o=function(e){var t,n=(new DOMParser).parseFromString(e,"text/html"),r=n.querySelectorAll("emoji"),a=r.length,i=a>1||function(e,t){var n;if("P"===(null===(n=e.body.firstChild)||void 0===n?void 0:n.nodeName)){var r,a=null===(r=e.body.firstChild)||void 0===r?void 0:r.childNodes;return(null===a||void 0===a?void 0:a.length)!==t}return!1}(n,a)?20:50,s=(0,E.Z)(r);try{for(s.s();!(t=s.n()).done;){var o,c,l,u=t.value,d=null!==(o=u.getAttribute("id"))&&void 0!==o?o:"",p=null!==(c=u.getAttribute("alt"))&&void 0!==c?c:"",h=null!==(l=u.getAttribute("title"))&&void 0!==l?l:"",f=document.createElement("span");f.setAttribute("contentEditable","false"),f.setAttribute("title",h),f.setAttribute("type","(".concat(d,")")),f.setAttribute("class","animated-emoticon-".concat(i,"-cool"));var v=document.createElement("img");v.setAttribute("itemscope",""),v.setAttribute("itemtype","http://schema.skype.com/Emoji"),v.setAttribute("itemid",d),v.setAttribute("src","https://statics.teams.cdn.office.net/evergreen-assets/personal-expressions/v2/assets/emoticons/".concat(d,"/default/").concat(i,"_f.png")),v.setAttribute("title",h),v.setAttribute("alt",p),v.setAttribute("style","width:".concat(i,"px;height:").concat(i,"px;")),f.appendChild(v),u.replaceWith(f)}}catch(g){s.e(g)}finally{s.f()}return n.body.innerHTML}(o),o=this.updateMentionsContent(o),this.graphImageMatch(null!==(i=o)&&void 0!==i?i:"")?c=this.processMessageContent(e,t):c.currentValue=this.buildAcsMessage(e,t,s,o),c}},{key:"updateMentionsContent",value:function(e){return e=e.replace(/&nbsp;<at/gim,"<at").replace(/at>&nbsp;/gim,"at>").replace(/<at\sid="(\d+)">([a-z0-9_.-\s]+)<\/at>/gim,'<msft-mention id="$1">$2</msft-mention>')}},{key:"hasUnsupportedContent",value:function(e,t){var n=["application/vnd.microsoft.card.codesnippet","application/vnd.microsoft.card.fluid","application/vnd.microsoft.card.fluidEmbedCard","reference"],r=[];if(t.length){var a,i=(0,E.Z)(t);try{for(i.s();!(a=i.n()).done;){var s,o=a.value,c=null!==(s=null===o||void 0===o?void 0:o.contentType)&&void 0!==s?s:"";r.push(n.includes(c))}}catch(u){i.e(u)}finally{i.f()}}else{var l=Boolean(e)&&/<\/?attachment>/gim.test(e);r.push(l)}return r.every((function(e){return!0===e}))}},{key:"buildAcsMessage",value:function(e,t,n,r){var a,i,s,o,c,l,u,d,p,h=(null===(a=e.from)||void 0===a||null===(a=a.user)||void 0===a?void 0:a.id)||void 0,f=null!==(i=null===e||void 0===e?void 0:e.chatId)&&void 0!==i?i:"",v=null!==(s=null===e||void 0===e?void 0:e.id)&&void 0!==s?s:"",g="https://teams.microsoft.com/l/message/".concat(f,"/").concat(v,'?context={"contextType":"chat"}'),m=null!==(o=null===e||void 0===e?void 0:e.attachments)&&void 0!==o?o:[],b={messageId:n,contentType:null!==(c=null===(l=e.body)||void 0===l?void 0:l.contentType)&&void 0!==c?c:"text",messageType:"chat",content:r,senderDisplayName:null!==(u=null===(d=e.from)||void 0===d||null===(d=d.user)||void 0===d?void 0:d.displayName)&&void 0!==u?u:void 0,createdOn:new Date(null!==(p=e.createdDateTime)&&void 0!==p?p:Date.now()),editedOn:e.lastEditedDateTime?new Date(e.lastEditedDateTime):void 0,senderId:h,mine:h===t,status:"seen",attached:"top",hasUnsupportedContent:this.hasUnsupportedContent(r,m),rawChatUrl:g};return null!==e&&void 0!==e&&e.policyViolation&&(b=Object.assign(b,{messageType:"blocked",link:"https://go.microsoft.com/fwlink/?LinkId=2132837"})),b}},{key:"registerEventListeners",value:function(){var e=this;this._eventEmitter.on("chatMessageReceived",(function(t){e.onMessageReceived(t)})),this._eventEmitter.on("chatMessageDeleted",this.onMessageDeleted),this._eventEmitter.on("chatMessageEdited",(function(t){e.onMessageEdited(t)})),this._eventEmitter.on("notificationsSubscribedForResource",this.onChatNotificationsSubscribed),this._eventEmitter.on("chatThreadPropertiesUpdated",this.onChatPropertiesUpdated),this._eventEmitter.on("participantAdded",this.onParticipantAdded),this._eventEmitter.on("participantRemoved",this.onParticipantRemoved)}},{key:"graph",get:function(){return we("mgt-chat")}}]),e}(),Qe="mgt-chat-session-id",Je=function(){var e=sessionStorage.getItem(Qe);if(e)return e;var t=(0,Q.Z)();return sessionStorage.setItem(Qe,t),t},$e=function(e){var t=function(){var e=(0,i.useState)(Je);return(0,r.Z)(e,1)[0]}(),n=(0,i.useState)((function(){return new Ge})),a=(0,r.Z)(n,1)[0];return(0,i.useEffect)((function(){e&&t&&a.subscribeToChat(e,t)}),[e,t,a]),(0,i.useEffect)((function(){return function(){(0,N.cM)("invoked clean up effect"),a.tearDown()}}),[a]),a},Ye=n(60154),Ke=n(5649),Xe=(0,l.Z)({container:(0,a.Z)((0,a.Z)((0,a.Z)((0,a.Z)((0,a.Z)({backgroundColor:"#ebebeb",display:"flex",boxShadow:"0px 4px 8px 0px rgba(0, 0, 0, 0.14), 0px 0px 2px 0px rgba(0, 0, 0, 0.12)",textDecorationLine:"none",color:"#424242"},u.q5.margin("18px","0px","8px","0px")),u.q5.borderRadius("6px")),u.q5.padding("16px")),u.q5.gap("6px")),{},{":hover":{backgroundColor:"#fafafa"},":visited":{color:"#424242"}}),cta:{fontFamily:"Segoe UI",fontSize:"12px",fontStyle:"normal",fontWeight:"400",lineHeight:"16px",textDecorationLine:"none"}}),et=function(e){var t=Xe();return i.createElement("a",{className:t.container,target:"blank",href:e.targetUrl},i.createElement(Ke.CoD,null),i.createElement("p",{className:t.cta},"View this message in Microsoft Teams."))},tt=function(e,t){var n,r,a=null===(n=e)||void 0===n?void 0:n.message;if("content"in(r=a)&&"hasUnsupportedContent"in r&&"rawChatUrl"in r&&null!==a&&void 0!==a&&a.hasUnsupportedContent){var s=i.createElement(et,{targetUrl:a.rawChatUrl});e=(0,xe.ZP)(e,(function(e){He(e.message)&&(e.message.content=(0,Ye.renderToString)(s))}))}return t?t(e):i.createElement(i.Fragment,null)},nt=n(24593),rt=function(e){var t=e.messageBarType,n=e.message;return i.createElement(nt.c,{messageBarType:t}," ",n)},at=function(e){return function(t,n){var r,a,s=n(t),o=(null!==(r=null===e||void 0===e?void 0:e.mentions)&&void 0!==r?r:[]).flat().find((function(e){var n;return(null===(n=e.id)||void 0===n?void 0:n.toString())===(null===t||void 0===t?void 0:t.id)&&e.mentionText===(null===t||void 0===t?void 0:t.displayText)})),c=null===o||void 0===o||null===(a=o.mentioned)||void 0===a?void 0:a.user;if(c){var l=(null===c||void 0===c?void 0:c.id)===e.userId?function(e){return n(t)}:function(){return i.createElement("p",{className:"otherMention"},t.displayText)};s=i.createElement(ue.F,{userId:null===c||void 0===c?void 0:c.id,personCardInteraction:fe.cC.hover},i.createElement(l,null))}return s}},it=n(14506),st=n(51690),ot="button-icon",ct="icon",lt="icon-filled",ut="icon-unfilled",dt=((0,st.y0)({width:"18px",height:"18px"}),"#616161"),pt="#5b5fc7",ht=(0,st.ZC)({button:[ot,{}],icon:[ct,(0,D.Z)({fill:dt},".".concat(ot,":hover &"),{fill:pt,color:pt})],iconFilled:[lt,(0,D.Z)({display:"none"},".".concat(ot,":hover &"),{display:"block"})],iconUnfilled:[ut,(0,D.Z)({display:"block"},".".concat(ot,":hover &"),{display:"none"})]}),ft=n(73583),vt=(0,l.Z)({row:{paddingInlineStart:"20px"}}),gt=n(72292),mt=(0,l.Z)({person:{"--person-avatar-size":"32px","--person-alignment":"center"}}),bt=function(e){var t=e.chat,n=e.currentUserId,r=mt(),a=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return null===e||void 0===e||null===(t=e.members)||void 0===t||null===(t=t.find((function(e){return e.userId!==n})))||void 0===t?void 0:t.userId}(t,n);return a?i.createElement(ue.F,{className:r.person,userId:a,view:gt.b.oneline,avatarSize:"small",personCardInteraction:de.c.hover,showPresence:!0}):null},yt=n(64519),xt=n(20729),kt=n(29591),Ct=n(46694),wt=n(40868),Zt=n(92078),St=n(75558),It=n(57862),Mt=n(97875),Et=n(29267),_t=(0,l.Z)({container:(0,a.Z)((0,a.Z)((0,a.Z)({},u.q5.border("1px solid var(--colorBrandBackground2)")),u.q5.overflow("hidden")),u.q5.borderRadius("50%")),background:{display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"var(--colorBrandBackground2)"}}),Tt=function(e){var t=e.height,n=e.width,r=e.children,a=_t(),s={height:null!==t&&void 0!==t?t:"32px",width:null!==n&&void 0!==n?n:"32px"};return i.createElement("span",{className:a.container,style:s},i.createElement("span",{className:a.background,style:s},r))},Pt=(0,yt.Z)(Mt.mLZ,Mt.mLZ),At=(0,yt.Z)(Et.rqh,Et.rqh),Dt=function(e){var t=e.chatType;if(!t)return null;var n="var(--colorBrandForeground2)";switch(t){case"group":return i.createElement(Tt,null,i.createElement(At,{color:n}));case"meeting":return i.createElement(Tt,null,i.createElement(Pt,{color:n}));default:return(0,N.vU)("Attempted to render an icon for chat of type: ".concat(t)),null}},Ut=(0,yt.Z)(xt.An,xt.S1J),Nt=(0,l.Z)({chatTitle:{marginInlineStart:"10px"},container:{display:"flex",flexDirection:"column",gridRowGap:"16px",minWidth:"300px",backgroundColor:kt.T.colorNeutralBackground1},formButtons:{display:"flex",flexDirection:"row",justifyContent:"flex-end",gridColumnGap:"8px"}}),Rt=function(e){var t=e.chat,n=e.currentUserId,s=e.onRenameChat,o=Nt(),c=(0,i.useState)(!1),l=(0,r.Z)(c,2),u=l[0],d=l[1],p=(0,i.useCallback)((function(e,t){return d(t.open||!1)}),[]),h=(0,i.useCallback)((function(){return d(!1)}),[]),v=(0,i.useState)(null===t||void 0===t?void 0:t.topic),g=(0,r.Z)(v,2),m=g[0],b=g[1],y=(0,i.useCallback)((function(e,t){b(t.value)}),[]),x=(0,i.useCallback)((function(){s(m||null)}),[m,s]),k=null!==t&&void 0!==t&&t.topic?t.topic:function(){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).filter((function(t){return t.userId!==e})).map((function(e){var t;return null!==(t=e.displayName)&&void 0!==t&&t.includes(" ")?e.displayName.split(" ")[0]:e.displayName||e.email||e.id})).join(", ")}(null===t||void 0===t?void 0:t.members,n),C={trapFocus:true,inertTrapFocus:true,inline:!0,positioning:"below-start",open:u,onOpenChange:p};return i.createElement(i.Fragment,null,i.createElement(Dt,{chatType:null===t||void 0===t?void 0:t.chatType}),i.createElement("span",{className:o.chatTitle},k),i.createElement(Ct.J,(0,a.Z)({},C),i.createElement(wt.x,null,i.createElement(f.z,{appearance:"transparent",icon:i.createElement(Ut,null),"aria-label":"Name group chat"})),i.createElement(Zt.o,null,i.createElement("div",{className:o.container},i.createElement(St.g,{label:"Group name"},i.createElement(It.I,{placeholder:"Enter group name",onChange:y,value:m||""})),i.createElement("div",{className:o.formButtons},i.createElement(f.z,{appearance:"secondary",onClick:h},"Cancel"),i.createElement(f.z,{appearance:"primary",disabled:m===(null===t||void 0===t?void 0:t.topic),onClick:x},"Send"))))))},Ft=(0,l.Z)({chatHeader:{display:"flex",alignItems:"center",columnGap:"0",lineHeight:"32px",fontSize:"18px",fontWeight:700,marginBlockStart:"11px",marginBlockEnd:"7px",zIndex:3}}),Lt=(0,i.memo)((function(e){var t=e.chat,n=e.currentUserId,r=e.onRenameChat,a=Ft(),s=vt();return i.createElement("div",{className:(0,d.z)(a.chatHeader,s.row)},"oneOnOne"!==(null===t||void 0===t?void 0:t.chatType)?i.createElement(Rt,{chat:t,currentUserId:n,onRenameChat:r}):i.createElement(bt,{chat:t,currentUserId:n,onRenameChat:r}))})),Ot=n(23141),zt=n(34902),qt=n(86423),Ht=n(71171),Bt=n(93069),jt=n(95058),Vt=n(45754),Wt=n(86906),Gt=n(73836),Qt=n(84761),Jt=n(51687),$t=function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function s(e){try{c(r.next(e))}catch(t){i(t)}}function o(e){try{c(r.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}c((r=r.apply(e,t||[])).next())}))};!function(e){e[e.any=0]="any",e[e.unified=1]="unified",e[e.security=2]="security",e[e.mailenabledsecurity=4]="mailenabledsecurity",e[e.distribution=8]="distribution"}(V||(V={}));var Yt,Kt,Xt,en,tn,nn,rn,an,sn,on,cn,ln,un,dn,pn=function(){return B.Q.config.groups.invalidationPeriod||B.Q.config.defaultInvalidationPeriod},hn=function(){return B.Q.config.groups.isEnabled&&B.Q.config.isEnabled},fn=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:V.any,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return $t(void 0,void 0,void 0,(0,_.Z)().mark((function i(){var s,o,c,l,u,d,p,h,f,v,g,m,b,y,x,k,C,w,Z,S,I,M,T;return(0,_.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(s="Group.Read.All",c="".concat(t||"*","*").concat(r,"*").concat(a,":").concat(n),!hn()){i.next=10;break}return o=B.Q.getCache(H.O.groups,H.O.groups.stores.groupsQuery),i.next=6,o.getValue(c);case 6:if(!((l=i.sent)&&pn()>Date.now()-l.timeCached)){i.next=10;break}if(!(l.top>=n)){i.next=10;break}return i.abrupt("return",l.groups.map((function(e){return JSON.parse(e)})).slice(0,n+1));case 10:if(u="",p=[],""!==t&&(u="(startswith(displayName,'".concat(t,"') or startswith(mailNickname,'").concat(t,"') or startswith(mail,'").concat(t,"'))")),a&&(u+="".concat(t?" and ":"").concat(a)),r===V.any){i.next=68;break}for(h=e.createBatch(),f=[],V.unified===(r&V.unified)&&f.push("groupTypes/any(c:c+eq+'Unified')"),V.security===(r&V.security)&&f.push("(mailEnabled eq false and securityEnabled eq true)"),V.mailenabledsecurity===(r&V.mailenabledsecurity)&&f.push("(mailEnabled eq true and securityEnabled eq true)"),V.distribution===(r&V.distribution)&&f.push("(mailEnabled eq true and securityEnabled eq false)"),u=u?"".concat(u," and "):"",v=0,g=f;v<g.length;v++)m=g[v],h.get(m,"/groups?$filter=".concat(u+m),["Group.Read.All"]);return i.prev=23,i.next=26,h.executeAll();case 26:d=i.sent,b=0,y=f;case 28:if(!(b<y.length)){i.next=50;break}if(x=y[b],!d.get(x).content.value){i.next=47;break}k=(0,E.Z)(d.get(x).content.value),i.prev=32,w=(0,_.Z)().mark((function e(){var t;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=C.value,p.find((function(e){return e.id===t.id}))||p.push(t);case 3:case"end":return e.stop()}}),e)})),k.s();case 35:if((C=k.n()).done){i.next=39;break}return i.delegateYield(w(),"t0",37);case 37:i.next=35;break;case 39:i.next=44;break;case 41:i.prev=41,i.t1=i.catch(32),k.e(i.t1);case 44:return i.prev=44,k.f(),i.finish(44);case 47:b++,i.next=28;break;case 50:i.next=66;break;case 52:i.prev=52,i.t2=i.catch(23),i.prev=54,Z=[],S=(0,E.Z)(f);try{for(S.s();!(I=S.n()).done;)M=I.value,Z.push(e.api("groups").filter("".concat(u," and ").concat(M)).top(n).count(!0).header("ConsistencyLevel","eventual").middlewareOptions((0,Ee.z)(s)).get())}catch(P){S.e(P)}finally{S.f()}return i.next=60,Promise.all(Z);case 60:return i.abrupt("return",i.sent.map((function(e){return e.value})).reduce((function(e,t){return e.concat(t)}),[]));case 63:return i.prev=63,i.t3=i.catch(54),i.abrupt("return",[]);case 66:i.next=76;break;case 68:if(0!==p.length){i.next=76;break}return i.next=71,e.api("groups").filter(u).top(n).count(!0).header("ConsistencyLevel","eventual").middlewareOptions((0,Ee.z)(s)).get();case 71:if(T=i.sent,!hn()||!T){i.next=75;break}return i.next=75,o.putValue(c,{groups:T.value.map((function(e){return JSON.stringify(e)})),top:n});case 75:return i.abrupt("return",T?T.value:null);case 76:return i.abrupt("return",p);case 77:case"end":return i.stop()}}),i,null,[[23,52],[32,41,44,47],[54,63]])})))},vn=function(e,t,n){return $t(void 0,void 0,void 0,(0,_.Z)().mark((function r(){var a,i,s,o,c,l,u;return(0,_.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a="Group.Read.All",!hn()){r.next=11;break}return i=B.Q.getCache(H.O.groups,H.O.groups.stores.groups),r.next=5,i.getValue(t);case 5:if(!((s=r.sent)&&pn()>Date.now()-s.timeCached)){r.next=11;break}if(o=s.group?JSON.parse(s.group):null,(c=n&&o?n.filter((function(e){return!Object.keys(o).includes(e)})):null)&&!(c.length<=1)){r.next=11;break}return r.abrupt("return",o);case 11:return l="/groups/".concat(t),n&&(l=l+"?$select="+n.toString()),r.next=15,e.api(l).middlewareOptions((0,Ee.z)(a)).get();case 15:if(u=r.sent,!hn()){r.next=19;break}return r.next=19,i.putValue(t,{group:JSON.stringify(u)});case 19:return r.abrupt("return",u);case 20:case"end":return r.stop()}}),r)})))},gn=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return $t(void 0,void 0,void 0,(0,_.Z)().mark((function r(){var a,i,s,o,c,l,u,d,p,h,f,v,g,m;return(0,_.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t&&0!==t.length){r.next=2;break}return r.abrupt("return",[]);case 2:a=e.createBatch(),i={},s=[],hn()&&(o=B.Q.getCache(H.O.groups,H.O.groups.stores.groups)),c=(0,E.Z)(t),r.prev=7,c.s();case 9:if((l=c.n()).done){r.next=20;break}if(u=l.value,i[u]=null,d=void 0,!hn()){r.next=17;break}return r.next=16,o.getValue(u);case 16:d=r.sent;case 17:d&&pn()>Date.now()-d.timeCached?i[u]=d.group?JSON.parse(d.group):null:""!==u&&(p="/groups/".concat(u),n&&(p="".concat(p,"?$filters=").concat(n)),a.get(u,p,["Group.Read.All"]),s.push(u));case 18:r.next=9;break;case 20:r.next=25;break;case 22:r.prev=22,r.t0=r.catch(7),c.e(r.t0);case 25:return r.prev=25,c.f(),r.finish(25);case 28:return r.prev=28,r.next=31,a.executeAll();case 31:h=r.sent,f=(0,E.Z)(t),r.prev=33,f.s();case 35:if((v=f.n()).done){r.next=45;break}if(g=v.value,!(null===(m=h.get(g))||void 0===m?void 0:m.content)){r.next=43;break}if(i[g]=m.content,!hn()){r.next=43;break}return r.next=43,o.putValue(g,{group:JSON.stringify(m.content)});case 43:r.next=35;break;case 45:r.next=50;break;case 47:r.prev=47,r.t1=r.catch(33),f.e(r.t1);case 50:return r.prev=50,f.f(),r.finish(50);case 53:return r.abrupt("return",Promise.all(Object.values(i)));case 56:if(r.prev=56,r.t2=r.catch(28),r.prev=58,t.filter((function(e){return s.includes(e)})).forEach((function(t){i[t]=vn(e,t)})),!hn()){r.next=63;break}return r.next=63,Promise.all(t.filter((function(e){return s.includes(e)})).map((function(e){return $t(void 0,void 0,void 0,(0,_.Z)().mark((function t(){return(0,_.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=o,t.t1=e,t.t2=JSON,t.next=5,i[e];case 5:return t.t3=t.sent,t.t4=t.t2.stringify.call(t.t2,t.t3),t.t5={group:t.t4},t.next=10,t.t0.putValue.call(t.t0,t.t1,t.t5);case 10:return t.abrupt("return",t.sent);case 11:case"end":return t.stop()}}),t)})))})));case 63:return r.abrupt("return",Promise.all(Object.values(i)));case 66:return r.prev=66,r.t3=r.catch(58),r.abrupt("return",[]);case 69:case"end":return r.stop()}}),r,null,[[7,22,25,28],[28,56],[33,47,50,53],[58,66]])})))},mn=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:V.any,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";return $t(void 0,void 0,void 0,(0,_.Z)().mark((function s(){var o,c,l,u,d;return(0,_.Z)().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return o=[],s.next=3,fn(e,t,r,a,i);case 3:if(c=s.sent){l=(0,E.Z)(c);try{for(l.s();!(u=l.n()).done;)(d=u.value).id&&n.includes(d.id)&&o.push(d)}catch(p){l.e(p)}finally{l.f()}}return s.abrupt("return",o);case 6:case"end":return s.stop()}}),s)})))},bn=n(94545),yn=n(7236),xn=n(78402),kn=n(33022),Cn=n(66429),wn=n(58276),Zn=n(81168),Sn=[(0,Gt.iv)(Yt||(Yt=(0,Ht.Z)(['\n:host([hidden]){display:none}:host{display:block;font-family:var(--default-font-family, "Segoe UI", "Segoe UI Web (West European)", "Segoe UI", -apple-system, "BlinkMacSystemFont", "Roboto", "Helvetica Neue", sans-serif);font-size:var(--default-font-size,14px);--theme-primary-color:#0078d7;--theme-dark-color:#005a9e}:focus-visible{outline-color:var(--focus-ring-color,Highlight);outline-color:var(--focus-ring-color,-webkit-focus-ring-color);outline-style:var(--focus-ring-style,auto)}.ms-icon{display:inline-block;font-family:FabricMDL2Icons;font-style:normal;font-weight:400;font-size:16px;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;margin:4px 0}.error{background-color:#fde7e9;padding-block:8px;padding-inline:8px 12px}.ms-icon-chevron-down::before{content:"\\e70d"}.ms-icon-chevron-up::before{content:"\\e70e"}.ms-icon-contact::before{content:"\\e77b"}.ms-icon-add-friend::before{content:"\\e8fa"}.ms-icon-outlook-logo-inverser::before{content:"\\eb6d"}:host{--person-details-wrapper-width:0;width:auto}:host fluent-text-field{width:100%}:host fluent-text-field::part(root){display:flex;flex-wrap:wrap;height:auto;background:padding-box linear-gradient(var(--people-picker-input-background,var(--neutral-fill-input-rest)),var(--people-picker-input-background,var(--neutral-fill-input-rest))),border-box var(--people-picker-input-border-color,var(--neutral-stroke-input-rest))}:host fluent-text-field::part(root):hover{background:padding-box linear-gradient(var(--people-picker-input-hover-background,var(--neutral-fill-input-hover)),var(--people-picker-input-hover-background,var(--neutral-fill-input-hover))),border-box var(--people-picker-input-hover-border-color,var(--neutral-stroke-input-hover))}:host fluent-text-field::part(root):focus,:host fluent-text-field::part(root):focus-within{background:padding-box linear-gradient(var(--people-picker-input-focus-background,var(--neutral-fill-input-focus)),var(--people-picker-input-focus-background,var(--neutral-fill-input-focus))),border-box var(--people-picker-input-focus-border-color,var(--neutral-stroke-input-focus))}:host fluent-text-field::part(start){margin:unset}:host fluent-text-field::part(control){width:min-content;height:calc((var(--base-height-multiplier) + var(--density)) * var(--design-unit) * 1px);word-spacing:inherit;text-indent:inherit;letter-spacing:inherit}:host fluent-text-field::part(control)::placeholder{color:var(--people-picker-input-placeholder-text-color,var(--input-placeholder-rest))}:host fluent-text-field::part(control):hover::placeholder{color:var(--people-picker-input-placeholder-hover-text-color,var(--input-placeholder-hover))}:host fluent-text-field::part(control):focus-within::placeholder,:host fluent-text-field::part(control):focus::placeholder{color:var(--people-picker-input-placeholder-focus-text-color,var(--input-placeholder-filled))}:host fluent-text-field .search-icon{display:flex;padding-top:10px;padding-inline-start:10px}:host fluent-text-field .search-icon svg path{fill:var(--people-picker-search-icon-color,currentColor)}:host .selected-list{display:flex;flex-wrap:wrap;column-gap:5px;padding:unset;margin:0 5px}:host .selected-list-item{display:flex;column-gap:5px;border-radius:100px;margin-top:3px;background-color:var(--people-picker-selected-option-background-color,var(--person-background-color,var(--neutral-layer-3)))}:host .selected-list-item.highlighted{background-color:var(--people-picker-selected-option-highlight-background-color,var(--accent-fill-rest))}:host .selected-list-item-close-icon{display:flex;justify-content:center;align-items:center;padding-inline-end:8px;cursor:pointer}:host .selected-list-item-close-icon svg path{fill:var(--people-picker-remove-selected-close-icon-color,currentColor)}:host .selected-list-item-person{width:max-content}:host fluent-card{margin-top:4px;background-color:var(--people-picker-dropdown-background-color,var(--neutral-layer-card-container))}:host .searched-people-list{list-style:none;padding:4px;margin:auto}:host .searched-people-list-result{padding:4px;border-radius:4px;background:var(--people-picker-dropdown-result-background-color,var(--person-background-color,transparent))}:host .searched-people-list-result:hover{background:var(--people-picker-dropdown-result-hover-background-color,var(--person-background-color,var(--neutral-fill-rest)))}:host .searched-people-list-result:focus,:host .searched-people-list-result:focus-within{background:var(--people-picker-dropdown-result-focus-background-color,var(--person-background-color,var(--neutral-fill-rest)))}:host .message-parent{display:flex;place-content:center;flex-direction:row;padding:10px 15px;column-gap:5px}:host .message-parent .loading-text,:host .message-parent .search-error-text{font-style:normal;font-weight:600;font-size:14px;line-height:19px;text-align:center;color:var(--people-picker-no-results-text-color,var(--neutral-foreground-hint))}\n'],['\n:host([hidden]){display:none}:host{display:block;font-family:var(--default-font-family, "Segoe UI", "Segoe UI Web (West European)", "Segoe UI", -apple-system, "BlinkMacSystemFont", "Roboto", "Helvetica Neue", sans-serif);font-size:var(--default-font-size,14px);--theme-primary-color:#0078d7;--theme-dark-color:#005a9e}:focus-visible{outline-color:var(--focus-ring-color,Highlight);outline-color:var(--focus-ring-color,-webkit-focus-ring-color);outline-style:var(--focus-ring-style,auto)}.ms-icon{display:inline-block;font-family:FabricMDL2Icons;font-style:normal;font-weight:400;font-size:16px;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;margin:4px 0}.error{background-color:#fde7e9;padding-block:8px;padding-inline:8px 12px}.ms-icon-chevron-down::before{content:"\\\\\\e70d"}.ms-icon-chevron-up::before{content:"\\\\\\e70e"}.ms-icon-contact::before{content:"\\\\\\e77b"}.ms-icon-add-friend::before{content:"\\\\\\e8fa"}.ms-icon-outlook-logo-inverser::before{content:"\\\\\\eb6d"}:host{--person-details-wrapper-width:0;width:auto}:host fluent-text-field{width:100%}:host fluent-text-field::part(root){display:flex;flex-wrap:wrap;height:auto;background:padding-box linear-gradient(var(--people-picker-input-background,var(--neutral-fill-input-rest)),var(--people-picker-input-background,var(--neutral-fill-input-rest))),border-box var(--people-picker-input-border-color,var(--neutral-stroke-input-rest))}:host fluent-text-field::part(root):hover{background:padding-box linear-gradient(var(--people-picker-input-hover-background,var(--neutral-fill-input-hover)),var(--people-picker-input-hover-background,var(--neutral-fill-input-hover))),border-box var(--people-picker-input-hover-border-color,var(--neutral-stroke-input-hover))}:host fluent-text-field::part(root):focus,:host fluent-text-field::part(root):focus-within{background:padding-box linear-gradient(var(--people-picker-input-focus-background,var(--neutral-fill-input-focus)),var(--people-picker-input-focus-background,var(--neutral-fill-input-focus))),border-box var(--people-picker-input-focus-border-color,var(--neutral-stroke-input-focus))}:host fluent-text-field::part(start){margin:unset}:host fluent-text-field::part(control){width:min-content;height:calc((var(--base-height-multiplier) + var(--density)) * var(--design-unit) * 1px);word-spacing:inherit;text-indent:inherit;letter-spacing:inherit}:host fluent-text-field::part(control)::placeholder{color:var(--people-picker-input-placeholder-text-color,var(--input-placeholder-rest))}:host fluent-text-field::part(control):hover::placeholder{color:var(--people-picker-input-placeholder-hover-text-color,var(--input-placeholder-hover))}:host fluent-text-field::part(control):focus-within::placeholder,:host fluent-text-field::part(control):focus::placeholder{color:var(--people-picker-input-placeholder-focus-text-color,var(--input-placeholder-filled))}:host fluent-text-field .search-icon{display:flex;padding-top:10px;padding-inline-start:10px}:host fluent-text-field .search-icon svg path{fill:var(--people-picker-search-icon-color,currentColor)}:host .selected-list{display:flex;flex-wrap:wrap;column-gap:5px;padding:unset;margin:0 5px}:host .selected-list-item{display:flex;column-gap:5px;border-radius:100px;margin-top:3px;background-color:var(--people-picker-selected-option-background-color,var(--person-background-color,var(--neutral-layer-3)))}:host .selected-list-item.highlighted{background-color:var(--people-picker-selected-option-highlight-background-color,var(--accent-fill-rest))}:host .selected-list-item-close-icon{display:flex;justify-content:center;align-items:center;padding-inline-end:8px;cursor:pointer}:host .selected-list-item-close-icon svg path{fill:var(--people-picker-remove-selected-close-icon-color,currentColor)}:host .selected-list-item-person{width:max-content}:host fluent-card{margin-top:4px;background-color:var(--people-picker-dropdown-background-color,var(--neutral-layer-card-container))}:host .searched-people-list{list-style:none;padding:4px;margin:auto}:host .searched-people-list-result{padding:4px;border-radius:4px;background:var(--people-picker-dropdown-result-background-color,var(--person-background-color,transparent))}:host .searched-people-list-result:hover{background:var(--people-picker-dropdown-result-hover-background-color,var(--person-background-color,var(--neutral-fill-rest)))}:host .searched-people-list-result:focus,:host .searched-people-list-result:focus-within{background:var(--people-picker-dropdown-result-focus-background-color,var(--person-background-color,var(--neutral-fill-rest)))}:host .message-parent{display:flex;place-content:center;flex-direction:row;padding:10px 15px;column-gap:5px}:host .message-parent .loading-text,:host .message-parent .search-error-text{font-style:normal;font-weight:600;font-size:14px;line-height:19px;text-align:center;color:var(--people-picker-no-results-text-color,var(--neutral-foreground-hint))}\n'])))],In=n(34223),Mn=n(39586),En=n(12572),_n=n(66552),Tn={inputPlaceholderText:"Search for a name",maxSelectionsPlaceHolder:"Max contacts added",maxSelectionsAriaLabel:"Maximum contact selections reached",noResultsFound:"We didn't find any matches.",loadingMessage:"Loading...",selected:"selected",removeSelectedUser:"Remove ",selectContact:"select a contact",suggestionsTitle:"Suggested contacts"},Pn=n(58097),An=n(91734),Dn=n(93475),Un=function(e,t,n,r){var a,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(i<3?a(s):i>3?a(t,n,s):a(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Nn=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},Rn=function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function s(e){try{c(r.next(e))}catch(t){i(t)}}function o(e){try{c(r.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}c((r=r.apply(e,t||[])).next())}))},Fn=function(e){(0,Vt.Z)(n,e);var t=(0,Wt.Z)(n);function n(){var e;return(0,P.Z)(this,n),(e=t.call(this))._type=bn.bz.person,e._groupType=V.any,e._userType=bn.FW.any,e._selectedPeople=[],e._arrowSelectionCount=-1,e.defaultSelectedUsers=[],e.defaultSelectedGroups=[],e._highlightedUsers=[],e._currentHighlightedUserPos=0,e._isFocused=!1,e._setAnyEmail=!1,e.handleSelectionChanged=function(){0!==e.selectedPeople.length||e.disabled||e.enableTextInput()},e.handleInputClick=function(){e.flyout.isOpen||e.handleUserSearch()},e.gainedFocus=function(){e.clearHighlighted(),e._isFocused=!0,e.loadState(),e.showFlyout()},e.lostFocus=function(){e._isFocused=!1,e.input&&e.input.setAttribute("aria-activedescendant","");var t=e.renderRoot.querySelector(".people-list");if(t){var n,r=(0,E.Z)(t.children);try{for(r.s();!(n=r.n()).done;){var a=n.value;a.classList.remove("focused"),a.setAttribute("aria-selected","false")}}catch(i){r.e(i)}finally{r.f()}}e.requestUpdate()},e.onUserKeyUp=function(t){var n=t.key,r=t.getModifierState("Control")||t.getModifierState("Meta"),a=r&&"v"===n,i=["ArrowDown","ArrowRight","ArrowUp","ArrowLeft"].includes(n);return!a&&r||i?((r||["ArrowLeft","ArrowRight"].includes(n))&&e.hideFlyout(),void("ArrowDown"===n&&!e.flyout.isOpen&&e._isFocused&&e.handleUserSearch())):["Tab","Enter","Shift"].includes(n)?void 0:"Escape"===n?(e.clearInput(),e._foundPeople=[],void(e._arrowSelectionCount=-1)):"Backspace"===n&&0===e.userInput.length&&e.selectedPeople.length>0?(e.clearHighlighted(),e.selectedPeople=e.selectedPeople.splice(0,e.selectedPeople.length-1),e.loadState(),void e.hideFlyout()):void([";",","].includes(n)&&e.allowAnyEmail&&(e._setAnyEmail=!0,t.preventDefault(),t.stopPropagation()))},e.onUserInput=function(t){var n=t.target;(e.userInput=n.value,e.userInput)&&((0,me.vV)(e.userInput)&&e.allowAnyEmail?e._setAnyEmail&&e.handleAnyEmail():e.handleUserSearch(),e._setAnyEmail=!1)},e.onUserKeyDown=function(t){var n=t.key,r=e.renderRoot.querySelector(".selected-list"),a=t.getModifierState("Control")||t.getModifierState("Meta");if(a&&r){var i=r.querySelectorAll("mgt-person.selected-list-item-person");if(e.hideFlyout(),a&&"ArrowLeft"===n)e._currentHighlightedUserPos=(e._currentHighlightedUserPos-1+i.length)%i.length,e._currentHighlightedUserPos>=0&&!Number.isNaN(e._currentHighlightedUserPos)?e._highlightedUsers.push(i[e._currentHighlightedUserPos]):e._currentHighlightedUserPos=0;else if(a&&"ArrowRight"===n){var s=e._highlightedUsers.pop();if(s){var o=s.parentElement;o&&(e.clearHighlighted(o),e._currentHighlightedUserPos++)}}else a&&"a"===n&&(e._highlightedUsers=[],i.forEach((function(t){return e._highlightedUsers.push(t)})));e._highlightedUsers&&e.highlightSelectedPeople(e._highlightedUsers)}else if(e.clearHighlighted(),e.flyout.isOpen){if("ArrowUp"!==n&&"ArrowDown"!==n||(e.handleArrowSelection(t),t.preventDefault()),"Enter"===n)if(!t.shiftKey&&e._foundPeople){t.preventDefault(),t.stopPropagation();var c=e._foundPeople[e._arrowSelectionCount];c&&(e.addPerson(c),e.hideFlyout(),e.input.value="",e.hasMaxSelections&&e.disableTextInput())}else e.allowAnyEmail?e.handleAnyEmail():e.showFlyout();"Escape"===n&&t.stopPropagation(),"Tab"===n&&e.hideFlyout(),[";",","].includes(n)&&e.allowAnyEmail&&(t.preventDefault(),t.stopPropagation(),e.userInput=e.input.value,e.handleAnyEmail())}},e.handleCut=function(){e.writeHighlightedText().then((function(){e.removeHighlightedOnCut()}),(function(){}))},e.handleCopy=function(){e.writeHighlightedText()},e.handlePaste=function(){navigator.clipboard.readText().then((function(t){if(t)try{var n=JSON.parse(t);if(n&&n.length>0){var r,a=(0,E.Z)(n);try{for(a.s();!(r=a.n()).done;){var i=r.value;e.addPerson(i)}}catch(u){a.e(u)}finally{a.f()}}}catch(d){if(d instanceof SyntaxError){var s;try{for(var o=0,c=[",",";"];o<c.length;o++){var l=c[o];if((s=t.split(l)).length>1){e.hideFlyout(),e.selectUsersById(s);break}}}catch(p){}}}}),(function(e){}))},e.clearState(),e._showLoading=!0,e.showMax=6,e.disableImages=!1,e.disabled=!1,e.allowAnyEmail=!1,e.addEventListener("copy",e.handleCopy),e.addEventListener("cut",e.handleCut),e.addEventListener("paste",e.handlePaste),e.addEventListener("selectionChanged",e.handleSelectionChanged),e}return(0,A.Z)(n,[{key:"strings",get:function(){return Tn}},{key:"flyout",get:function(){return this.renderRoot.querySelector(".flyout")}},{key:"input",get:function(){return this.renderRoot.querySelector("fluent-text-field")}},{key:"groupId",get:function(){return this._groupId},set:function(e){this._groupId!==e&&(this._groupId=e,this.requestStateUpdate(!0))}},{key:"groupIds",get:function(){return this._groupIds},set:function(e){(0,xn.s)(this._groupIds,e)||(this._groupIds=e,this.requestStateUpdate(!0))}},{key:"type",get:function(){return this._type},set:function(e){this._type!==e&&(this._type=e,this.requestStateUpdate(!0))}},{key:"groupType",get:function(){return this._groupType},set:function(e){this._groupType!==e&&(this._groupType=e,this.requestStateUpdate(!0))}},{key:"userType",get:function(){return this._userType},set:function(e){this._userType!==e&&(this._userType=e,this.requestStateUpdate(!0))}},{key:"transitiveSearch",get:function(){return this._transitiveSearch},set:function(e){this.transitiveSearch!==e&&(this._transitiveSearch=e,this.requestStateUpdate(!0))}},{key:"people",get:function(){return this._people},set:function(e){(0,xn.s)(this._people,e)||(this._people=e,this.requestStateUpdate(!0))}},{key:"showMax",get:function(){return this._showMax},set:function(e){e!==this._showMax&&(this._showMax=e,this.requestStateUpdate(!0))}},{key:"selectedPeople",get:function(){return this._selectedPeople},set:function(e){e||(e=[]),(0,xn.s)(this._selectedPeople,e)||(this._selectedPeople=e,this.fireCustomEvent("selectionChanged",this._selectedPeople),this.requestUpdate())}},{key:"defaultSelectedUserIds",get:function(){return this._defaultSelectedUserIds},set:function(e){(0,xn.s)(this._defaultSelectedUserIds,e)||(this._defaultSelectedUserIds=e,this.requestStateUpdate(!0))}},{key:"defaultSelectedGroupIds",get:function(){return this._defaultSelectedGroupIds},set:function(e){(0,xn.s)(this._defaultSelectedGroupIds,e)||(this._defaultSelectedGroupIds=e,this.requestStateUpdate(!0))}},{key:"userIds",get:function(){return this._userIds},set:function(e){(0,xn.s)(this._userIds,e)||(this._userIds=e,this.requestStateUpdate(!0))}},{key:"userFilters",get:function(){return this._userFilters},set:function(e){this._userFilters=e,this.requestStateUpdate(!0)}},{key:"peopleFilters",get:function(){return this._peopleFilters},set:function(e){this._peopleFilters=e,this.requestStateUpdate(!0)}},{key:"groupFilters",get:function(){return this._groupFilters},set:function(e){this._groupFilters=e,this.requestStateUpdate(!0)}},{key:"disableTextInput",value:function(){var e=this.input.shadowRoot.querySelector("input");e&&(e.setAttribute("disabled","true"),e.value="")}},{key:"enableTextInput",value:function(){var e=this.input.shadowRoot.querySelector("input");e&&(e.removeAttribute("disabled"),e.focus())}},{key:"hasMaxSelections",get:function(){return"single"===this.selectionMode&&this.selectedPeople.length>=1}},{key:"focus",value:function(e){this.input&&(this.input.focus(e),this.input.select())}},{key:"selectUsersById",value:function(e){var t;return Rn(this,void 0,void 0,(0,_.Z)().mark((function n(){var r,a,i,s,o,c;return(0,_.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=U.C.globalProvider,a=U.C.globalProvider.graph,!r||r.state!==be.Aw.SignedIn){n.next=19;break}n.t0=(0,_.Z)().keys(e);case 4:if((n.t1=n.t0()).done){n.next=19;break}return i=n.t1.value,s=e[i],n.prev=7,n.next=10,(0,yn.PR)(a,s,wn.se);case 10:o=n.sent,this.addPerson(o),n.next=17;break;case 14:n.prev=14,n.t2=n.catch(7),(0,Dn.y)(n.t2)&&(null===(t=n.t2.message)||void 0===t?void 0:t.includes("does not exist"))&&this.allowAnyEmail&&(0,me.vV)(s)&&(c={mail:s,displayName:s},this.addPerson(c));case 17:n.next=4;break;case 19:case"end":return n.stop()}}),n,this,[[7,14]])})))}},{key:"selectGroupsById",value:function(e){return Rn(this,void 0,void 0,(0,_.Z)().mark((function t(){var n,r,a,i;return(0,_.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=U.C.globalProvider,r=U.C.globalProvider.graph,!n||n.state!==be.Aw.SignedIn){t.next=17;break}t.t0=(0,_.Z)().keys(e);case 4:if((t.t1=t.t0()).done){t.next=17;break}return a=t.t1.value,t.prev=6,t.next=9,vn(r,e[a]);case 9:i=t.sent,this.addPerson(i),t.next=15;break;case 13:t.prev=13,t.t2=t.catch(6);case 15:t.next=4;break;case 17:case"end":return t.stop()}}),t,this,[[6,13]])})))}},{key:"render",value:function(){var e=this.renderTemplate("default",{people:this._foundPeople});if(e)return e;var t=this.renderSelectedPeople(this.selectedPeople),n=this.renderInput(t),r=this.renderFlyout(n);return(0,Gt.dy)(Kt||(Kt=(0,Ht.Z)(["\n      <div>\n        ","\n      </div>\n    "])),r)}},{key:"clearState",value:function(){this.selectedPeople=[],this.userInput="",this._highlightedUsers=[],this._currentHighlightedUserPos=0}},{key:"requestStateUpdate",value:function(e){return e&&(this._groupPeople=null,this._foundPeople=null,this.selectedPeople=[],this.defaultPeople=null),(0,Bt.Z)((0,jt.Z)(n.prototype),"requestStateUpdate",this).call(this,e)}},{key:"renderInput",value:function(e){var t,n,r,a=this.disabled?"":this.placeholder||this.strings.inputPlaceholderText,i=this.hasMaxSelections?this.strings.maxSelectionsAriaLabel:"",s=(0,Gt.dy)(Xt||(Xt=(0,Ht.Z)(['<span class="search-icon">',"</span>"])),(0,In.d)(In.l.Search)),o=(null===(t=this.selectedPeople)||void 0===t?void 0:t.length)>0?e:s;return(0,Gt.dy)(en||(en=(0,Ht.Z)(['\n      <fluent-text-field\n        autocomplete="off"\n        appearance="outline"\n        slot="anchor"\n        id="people-picker-input"\n        role="combobox"\n        placeholder=',"\n        aria-label=","\n        aria-expanded=",'\n        @click="','"\n        @focus="','"\n        @keydown="','"\n        @input="','"\n        @blur="','"\n        ?disabled=','\n      >\n        <span slot="start">',"</span>\n      </fluent-text-field>\n    "])),this.hasMaxSelections?this.strings.maxSelectionsPlaceHolder:a,this.ariaLabel||i||a||this.strings.selectContact,null!==(r=null===(n=this.flyout)||void 0===n?void 0:n.isOpen)&&void 0!==r&&r,this.hasMaxSelections?void 0:this.handleInputClick,this.hasMaxSelections?void 0:this.gainedFocus,this.hasMaxSelections?void 0:this.onUserKeyDown,this.hasMaxSelections?void 0:this.onUserInput,this.lostFocus,this.disabled,o)}},{key:"renderSelectedPeople",value:function(e){var t=this;return(null===e||void 0===e?void 0:e.length)?(0,Gt.dy)(nn||(nn=(0,Ht.Z)(['\n       <ul\n        id="selected-list"\n        aria-label="','"\n        class="selected-list">\n          ',"\n      </ul>"])),this.strings.selected,(0,Jt.r)(e,(function(e){return null===e||void 0===e?void 0:e.id}),(function(e){var n;return(0,Gt.dy)(rn||(rn=(0,Ht.Z)(['\n            <li class="selected-list-item">\n              ','\n\n              <div\n                role="button"\n                tabindex="0"\n                class="selected-list-item-close-icon"\n                aria-label="',"",'"\n                @click="','"\n                @keydown="','">\n                  ',"\n              </div>\n          </li>"])),t.renderTemplate("selected-person",{person:e},"selected-".concat((null===e||void 0===e?void 0:e.id)?e.id:e.displayName))||t.renderSelectedPerson(e),t.strings.removeSelectedUser,null!==(n=null===e||void 0===e?void 0:e.displayName)&&void 0!==n?n:"",(function(n){return t.removePerson(e,n)}),(function(n){return t.handleRemovePersonKeyDown(e,n)}),(0,In.d)(In.l.Close))}))):(0,Gt.dy)(tn||(tn=(0,Ht.Z)([""])))}},{key:"renderFlyout",value:function(e){var t=this;return(0,kn.b)(an||(an=(0,Ht.Z)(['\n       <mgt-flyout light-dismiss class="flyout">\n         ','\n         <fluent-card\n          tabindex="0"\n          slot="flyout"\n          class="flyout-root"\n          @wheel=',"\n          @keydown=",'\n          class="custom">\n           ',"\n         </fluent-card>\n       </mgt-flyout>\n     "])),e,(function(e){return t.handleSectionScroll(e)}),(function(e){return t.onUserKeyDown(e)}),this.renderFlyoutContent())}},{key:"renderFlyoutContent",value:function(){if(this.isLoadingState||this._showLoading)return this.renderLoading();var e=this._foundPeople;return e&&0!==e.length&&0!==this.showMax?this.renderSearchResults(e):this.renderNoData()}},{key:"renderLoading",value:function(){return this.renderTemplate("loading",null)||(0,kn.b)(sn||(sn=(0,Ht.Z)(['\n         <div class="message-parent">\n           <mgt-spinner></mgt-spinner>\n           <div aria-label="','" class="loading-text">\n             ',"\n           </div>\n         </div>\n       "])),this.strings.loadingMessage,this.strings.loadingMessage)}},{key:"renderNoData",value:function(){if(this._isFocused)return this.renderTemplate("error",null)||this.renderTemplate("no-data",null)||(0,Gt.dy)(on||(on=(0,Ht.Z)(['\n         <div class="message-parent">\n           <div aria-label=',' class="search-error-text">\n             ',"\n           </div>\n         </div>\n       "])),this.strings.noResultsFound,this.strings.noResultsFound)}},{key:"renderSearchResults",value:function(e){var t=this,n=e.filter((function(e){return e.id}));return(0,Gt.dy)(cn||(cn=(0,Ht.Z)(['\n      <ul\n        id="suggestions-list"\n        class="searched-people-list"\n        role="listbox"\n        aria-live="polite"\n        title=',"\n      >\n         ","\n       </ul>\n     "])),this.strings.suggestionsTitle,(0,Jt.r)(n,(function(e){return e.id}),(function(e){return(0,Gt.dy)(ln||(ln=(0,Ht.Z)(['\n            <li\n              id="','"\n              class="searched-people-list-result"\n              role="option"\n              @click="','">\n                ',"\n            </li>\n          "])),e.id,(function(){return t.handleSuggestionClick(e)}),t.renderPersonResult(e))})))}},{key:"renderPersonResult",value:function(e){return this.renderTemplate("person",{person:e},e.id)||(0,kn.b)(un||(un=(0,Ht.Z)(['\n         <mgt-person\n          class="person"\n          ?show-presence=','\n          view="twoLines"\n          line2-property="jobTitle,mail"\n          .personDetails=',"\n          .fetchImage=",">\n          .personCardInteraction=","\n        </mgt-person>"])),this.showPresence,e,!this.disableImages,de.c.none)}},{key:"renderSelectedPerson",value:function(e){return(0,kn.b)(dn||(dn=(0,Ht.Z)(['\n       <mgt-person\n         tabindex="-1"\n         class="selected-list-item-person"\n         .personDetails=',"\n         .fetchImage=","\n         .view=","\n         .personCardInteraction=",">\n        </mgt-person>\n     "])),e,!this.disableImages,gt.b.oneline,de.c.none)}},{key:"loadState",value:function(){var e,t,n,r;return Rn(this,void 0,void 0,(0,_.Z)().mark((function a(){var i,s,o,c,l,u,d,p,h,f,v,g,m,b;return(0,_.Z)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i=this.people,s=this.userInput.toLowerCase(),o=U.C.globalProvider,!i){a.next=8;break}s&&(c=i.filter((function(e){return null===e||void 0===e?void 0:e.displayName.toLowerCase().includes(s)})),i=c),this._showLoading=!1,a.next=205;break;case 8:if(i||!o||o.state!==be.Aw.SignedIn){a.next=205;break}if(l=o.graph.forComponent(this),s.length){a.next=102;break}if(!this.defaultPeople){a.next=15;break}i=this.defaultPeople,a.next=101;break;case 15:if(!this.groupId&&!this.groupIds){a.next=61;break}if(null!==this._groupPeople){a.next=58;break}if(!this.groupId){a.next=35;break}if(a.prev=18,this.type!==bn.bz.group){a.next=25;break}return a.next=22,(0,yn.V0)(l,null,this.groupId,this.showMax,this.type,this.transitiveSearch);case 22:this._groupPeople=a.sent,a.next=28;break;case 25:return a.next=27,(0,yn.V0)(l,null,this.groupId,this.showMax,this.type,this.transitiveSearch,this.userFilters,this.peopleFilters);case 27:this._groupPeople=a.sent;case 28:a.next=33;break;case 30:a.prev=30,a.t0=a.catch(18),this._groupPeople=[];case 33:a.next=58;break;case 35:if(!this.groupIds){a.next=58;break}if(this.type!==bn.bz.group){a.next=48;break}return a.prev=37,a.next=40,gn(l,this.groupIds,this.groupFilters);case 40:this._groupPeople=a.sent,a.next=46;break;case 43:a.prev=43,a.t1=a.catch(37),this._groupPeople=[];case 46:a.next=58;break;case 48:return a.prev=48,a.next=51,(0,yn.Br)(l,"",this.groupIds,this.showMax,this.type,this.transitiveSearch,this.userFilters);case 51:u=a.sent,this._groupPeople=u,a.next=58;break;case 55:a.prev=55,a.t2=a.catch(48),this._groupPeople=[];case 58:i=this._groupPeople||[],a.next=100;break;case 61:if(this.type!==bn.bz.person&&this.type!==bn.bz.any){a.next=80;break}if(!this.userIds){a.next=68;break}return a.next=65,(0,yn.Qi)(l,this.userIds,"",this.userFilters);case 65:i=a.sent,a.next=78;break;case 68:if(d=this.userType===bn.FW.user||this.userType===bn.FW.contact,!this._userFilters||!d){a.next=75;break}return a.next=72,(0,yn.Rf)(l,this._userFilters,this.showMax);case 72:i=a.sent,a.next=78;break;case 75:return a.next=77,(0,bn.kH)(l,this.userType,this._peopleFilters,this.showMax);case 77:i=a.sent;case 78:a.next=100;break;case 80:if(this.type!==bn.bz.group){a.next=100;break}if(!this.groupIds){a.next=92;break}return a.prev=82,a.next=85,this.getGroupsForGroupIds(l,i);case 85:i=a.sent,a.next=90;break;case 88:a.prev=88,a.t3=a.catch(82);case 90:a.next=100;break;case 92:return a.next=94,fn(l,"",this.showMax,this.groupType,this._groupFilters);case 94:if(a.t4=a.sent,a.t4){a.next=97;break}a.t4=[];case 97:(p=a.t4).length>0&&p[0].value&&(p=p[0].value),i=p;case 100:this.defaultPeople=i;case 101:this._isFocused&&(this._showLoading=!1);case 102:if(!((null===(e=this.defaultSelectedUserIds)||void 0===e?void 0:e.length)>0||(null===(t=this.defaultSelectedGroupIds)||void 0===t?void 0:t.length)>0)||this.selectedPeople.length||this.defaultSelectedUsers.length||this.defaultSelectedGroups.length){a.next=113;break}return a.next=105,(0,yn.Qi)(l,this.defaultSelectedUserIds,"",this.userFilters);case 105:return this.defaultSelectedUsers=a.sent,a.next=108,gn(l,this.defaultSelectedGroupIds,this.peopleFilters);case 108:this.defaultSelectedGroups=a.sent,this.defaultSelectedGroups=this.defaultSelectedGroups.filter((function(e){return null!==e})),this.defaultSelectedUsers=this.defaultSelectedUsers.filter((function(e){return null!==e})),this.selectedPeople=[].concat((0,he.Z)(this.defaultSelectedUsers),(0,he.Z)(this.defaultSelectedGroups)),this.requestUpdate();case 113:if(!s){a.next=205;break}if(i=[],!this.groupId){a.next=124;break}return a.next=118,(0,yn.V0)(l,s,this.groupId,this.showMax,this.type,this.transitiveSearch,this.userFilters,this.peopleFilters);case 118:if(a.t5=a.sent,a.t5){a.next=121;break}a.t5=[];case 121:i=a.t5,a.next=205;break;case 124:if(this.type!==bn.bz.person&&this.type!==bn.bz.any){a.next=180;break}if(a.prev=125,this.userType!==bn.FW.contact&&this.userType!==bn.FW.user){a.next=138;break}if(!(null===(n=this.userIds)||void 0===n?void 0:n.length)){a.next=133;break}return a.next=130,(0,yn.Qi)(l,this.userIds,s,this._userFilters);case 130:i=a.sent,a.next=136;break;case 133:return a.next=135,(0,yn.pX)(l,s,this.showMax,this._userFilters);case 135:i=a.sent;case 136:a.next=161;break;case 138:if(this.groupIds){a.next=153;break}if(!(null===(r=this.userIds)||void 0===r?void 0:r.length)){a.next=145;break}return a.next=142,(0,yn.Qi)(l,this.userIds,s,this._userFilters);case 142:i=a.sent,a.next=151;break;case 145:return a.next=147,(0,bn.JU)(l,s,this.showMax,this.userType,this._peopleFilters);case 147:if(a.t6=a.sent,a.t6){a.next=150;break}a.t6=[];case 150:i=a.t6;case 151:a.next=161;break;case 153:return a.prev=153,a.next=156,(0,yn.Br)(l,s,this.groupIds,this.showMax,this.type,this.transitiveSearch,this.userFilters);case 156:i=a.sent,a.next=161;break;case 159:a.prev=159,a.t7=a.catch(153);case 161:a.next=165;break;case 163:a.prev=163,a.t8=a.catch(125);case 165:if(!(i&&i.length<this.showMax&&this.userType!==bn.FW.contact&&this.type!==bn.bz.person)){a.next=180;break}return a.prev=166,a.next=169,(0,yn.pX)(l,s,this.showMax,this._userFilters);case 169:if(a.t9=a.sent,a.t9){a.next=172;break}a.t9=[];case 172:h=a.t9,f=new Set(i.map((function(e){return e.id}))),v=(0,E.Z)(h);try{for(v.s();!(g=v.n()).done;)m=g.value,f.has(m.id)||i.push(m)}catch(y){v.e(y)}finally{v.f()}a.next=180;break;case 178:a.prev=178,a.t10=a.catch(166);case 180:if(this.type!==bn.bz.group&&this.type!==bn.bz.any||!(i.length<this.showMax)){a.next=205;break}if(!this.groupIds){a.next=192;break}return a.prev=182,a.next=185,mn(l,s,this.groupIds,this.showMax,this.groupType,this.userFilters);case 185:i=a.sent,a.next=190;break;case 188:a.prev=188,a.t11=a.catch(182);case 190:a.next=205;break;case 192:return b=[],a.prev=193,a.next=196,fn(l,s,this.showMax,this.groupType,this._groupFilters);case 196:if(a.t12=a.sent,a.t12){a.next=199;break}a.t12=[];case 199:b=a.t12,i=i.concat(b),a.next=205;break;case 203:a.prev=203,a.t13=a.catch(193);case 205:this._foundPeople=this.filterPeople(i);case 206:case"end":return a.stop()}}),a,this,[[18,30],[37,43],[48,55],[82,88],[125,163],[153,159],[166,178],[182,188],[193,203]])})))}},{key:"getGroupsForGroupIds",value:function(e,t){return Rn(this,void 0,void 0,(0,_.Z)().mark((function n(){var r,a,i,s;return(0,_.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,gn(e,this.groupIds,this.groupFilters);case 2:r=n.sent,a=(0,E.Z)(r);try{for(a.s();!(i=a.n()).done;)s=i.value,t=t.concat(s)}catch(o){a.e(o)}finally{a.f()}return t=t.filter((function(e){return e})),n.abrupt("return",t);case 7:case"end":return n.stop()}}),n,this)})))}},{key:"hideFlyout",value:function(){var e=this.flyout;e&&e.close(),this.input&&this.input.setAttribute("aria-activedescendant",""),this._arrowSelectionCount=-1}},{key:"showFlyout",value:function(){var e=this.flyout;e&&e.open(),this._arrowSelectionCount=-1}},{key:"removePerson",value:function(e,t){t.stopPropagation();var n=this.selectedPeople.filter((function(t){return!e.id&&t.displayName?t.displayName!==e.displayName:t.id!==e.id}));this.hasMaxSelections&&this.enableTextInput(),this.selectedPeople=n,this.loadState()}},{key:"handleRemovePersonKeyDown",value:function(e,t){"Enter"===t.key&&this.removePerson(e,t)}},{key:"addPerson",value:function(e){var t=this;e&&(setTimeout((function(){t.clearInput()}),50),0===this.selectedPeople.filter((function(t){return!e.id&&t.displayName?t.displayName===e.displayName:t.id===e.id})).length&&(this.selectedPeople=[].concat((0,he.Z)(this.selectedPeople),[e]),this.loadState(),this._foundPeople=[],this._arrowSelectionCount=-1))}},{key:"clearInput",value:function(){this.clearHighlighted(),"single"!==this.selectionMode&&(this.input.value=""),this.userInput=""}},{key:"handleAnyEmail",value:function(){if(this._showLoading=!1,this._arrowSelectionCount=-1,(0,me.vV)(this.userInput)){var e={mail:this.userInput,displayName:this.userInput};this.addPerson(e)}this.hideFlyout(),this.input&&(this.input.focus(),this._isFocused=!0)}},{key:"handleSuggestionClick",value:function(e){this.addPerson(e),this.hasMaxSelections&&(this.disableTextInput(),this.input.value=""),this.hideFlyout()}},{key:"handleUserSearch",value:function(){var e=this;this._debouncedSearch||(this._debouncedSearch=(0,me.Ds)((function(){return Rn(e,void 0,void 0,(0,_.Z)().mark((function e(){var t,n=this;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=setTimeout((function(){n._showLoading=!0}),50),e.next=3,this.loadState();case 3:clearTimeout(t),this._showLoading=!1,this._arrowSelectionCount=-1,this.showFlyout();case 7:case"end":return e.stop()}}),e,this)})))}),400)),this._debouncedSearch()}},{key:"writeHighlightedText",value:function(){return Rn(this,void 0,void 0,(0,_.Z)().mark((function e(){var t,n,r,a,i,s,o,c,l,u,d,p;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=(0,E.Z)(this._highlightedUsers);try{for(n.s();!(r=n.n()).done;)a=r.value,i=a._personDetails,s=i.id,o=i.displayName,c=i.mail,l=i.userPrincipalName,u=i.scoredEmailAddresses,d=void 0,d=u&&u.length>0?u.pop().address:l||c,t.push({id:s,displayName:o,email:d})}catch(h){n.e(h)}finally{n.f()}return p="",t.length>0&&(p=JSON.stringify(t)),e.next=7,navigator.clipboard.writeText(p);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"removeHighlightedOnCut",value:function(){this.selectedPeople=this.selectedPeople.splice(0,this.selectedPeople.length-this._highlightedUsers.length),this._highlightedUsers=[],this._currentHighlightedUserPos=0,this.loadState(),this.hideFlyout()}},{key:"highlightSelectedPeople",value:function(e){var t,n=(0,E.Z)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;(null===r||void 0===r?void 0:r.parentElement).classList.add("highlighted")}}catch(a){n.e(a)}finally{n.f()}}},{key:"clearHighlighted",value:function(e){if(e)e.classList.remove("highlighted");else{var t,n=(0,E.Z)(this._highlightedUsers);try{for(n.s();!(t=n.n()).done;){var r=t.value.parentElement;r&&r.classList.remove("highlighted")}}catch(a){n.e(a)}finally{n.f()}this._highlightedUsers=[],this._currentHighlightedUserPos=0}}},{key:"handleArrowSelection",value:function(e){var t,n,r=this.renderRoot.querySelector(".searched-people-list");if(null===(t=null===r||void 0===r?void 0:r.children)||void 0===t?void 0:t.length){e&&("ArrowUp"===e.key&&(-1===this._arrowSelectionCount?this._arrowSelectionCount=0:this._arrowSelectionCount=(this._arrowSelectionCount-1+r.children.length)%r.children.length),"ArrowDown"===e.key&&(-1===this._arrowSelectionCount?this._arrowSelectionCount=0:this._arrowSelectionCount=(this._arrowSelectionCount+1+r.children.length)%r.children.length));var a,i=(0,E.Z)(null!==(n=null===r||void 0===r?void 0:r.children)&&void 0!==n?n:[]);try{for(i.s();!(a=i.n()).done;){var s=a.value;s.setAttribute("aria-selected","false"),s.blur(),s.removeAttribute("tabindex")}}catch(c){i.e(c)}finally{i.f()}var o=r.children[this._arrowSelectionCount];o&&(o.setAttribute("tabindex","0"),o.focus(),o.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"}),o.setAttribute("aria-selected","true"),this.input.setAttribute("aria-activedescendant",null===o||void 0===o?void 0:o.id))}}},{key:"filterPeople",value:function(e){var t=[];if(e&&e.length>0){e=e.filter((function(e){return e}));var n,r=this.selectedPeople.map((function(e){return e.id?e.id:e.displayName})),a=e.filter((function(e){return(null===e||void 0===e?void 0:e.id)?-1===r.indexOf(e.id):-1===r.indexOf(null===e||void 0===e?void 0:e.displayName)})),i=new Set,s=(0,E.Z)(a);try{for(s.s();!(n=s.n()).done;){var o=n.value,c=JSON.stringify(o);i.add(c)}}catch(l){s.e(l)}finally{s.f()}i.forEach((function(e){var n=JSON.parse(e);t.push(n)}))}return t}},{key:"handleSectionScroll",value:function(e){var t=this.renderRoot.querySelector(".flyout-root");t&&(e.deltaY<0&&0===t.scrollTop||e.deltaY>0&&t.clientHeight+t.scrollTop>=t.scrollHeight-1||e.stopPropagation())}}],[{key:"styles",get:function(){return Sn}},{key:"requiredScopes",get:function(){return(0,he.Z)(new Set(["user.read.all","people.read","group.read.all","user.readbasic.all"].concat((0,he.Z)(wn.yI.requiredScopes))))}}]),n}(Cn.h);Un([(0,Qt.Cb)({attribute:"group-id",converter:function(e){return e.trim()}}),Nn("design:type",String),Nn("design:paramtypes",[Object])],Fn.prototype,"groupId",null),Un([(0,Qt.Cb)({attribute:"group-ids",converter:function(e){return e.split(",").map((function(e){return e.trim()}))}}),Nn("design:type",Array),Nn("design:paramtypes",[Object])],Fn.prototype,"groupIds",null),Un([(0,Qt.Cb)({attribute:"type",converter:function(e){return(e=e.toLowerCase())&&0!==e.length?"undefined"===typeof bn.bz[e]?bn.bz.any:bn.bz[e]:bn.bz.any}}),Nn("design:type",Object),Nn("design:paramtypes",[Object])],Fn.prototype,"type",null),Un([(0,Qt.Cb)({attribute:"group-type",converter:function(e){if(!e||0===e.length)return V.any;var t,n=e.split(","),r=[],a=(0,E.Z)(n);try{for(a.s();!(t=a.n()).done;){var i=t.value;i=i.trim(),"undefined"!==typeof V[i]&&r.push(V[i])}}catch(s){a.e(s)}finally{a.f()}return 0===r.length?V.any:r.reduce((function(e,t){return e|t}))}}),Nn("design:type",Number),Nn("design:paramtypes",[Object])],Fn.prototype,"groupType",null),Un([(0,Qt.Cb)({attribute:"user-type",converter:function(e){return(e=e.toLowerCase())&&"undefined"!==typeof bn.FW[e]?bn.FW[e]:bn.FW.any}}),Nn("design:type",String),Nn("design:paramtypes",[Object])],Fn.prototype,"userType",null),Un([(0,Qt.Cb)({attribute:"transitive-search",type:Boolean}),Nn("design:type",Boolean),Nn("design:paramtypes",[Boolean])],Fn.prototype,"transitiveSearch",null),Un([(0,Qt.Cb)({attribute:"people",type:Object}),Nn("design:type",Array),Nn("design:paramtypes",[Array])],Fn.prototype,"people",null),Un([(0,Qt.Cb)({attribute:"show-max",type:Number}),Nn("design:type",Number),Nn("design:paramtypes",[Number])],Fn.prototype,"showMax",null),Un([(0,Qt.Cb)({attribute:"disable-images",type:Boolean}),Nn("design:type",Boolean)],Fn.prototype,"disableImages",void 0),Un([(0,Qt.Cb)({attribute:"show-presence",type:Boolean}),Nn("design:type",Boolean)],Fn.prototype,"showPresence",void 0),Un([(0,Qt.Cb)({attribute:"selected-people",type:Array}),Nn("design:type",Array),Nn("design:paramtypes",[Array])],Fn.prototype,"selectedPeople",null),Un([(0,Qt.Cb)({attribute:"default-selected-user-ids",converter:function(e){return e.split(",").map((function(e){return e.trim()}))},type:String}),Nn("design:type",Array),Nn("design:paramtypes",[Object])],Fn.prototype,"defaultSelectedUserIds",null),Un([(0,Qt.Cb)({attribute:"default-selected-group-ids",converter:function(e){return e.split(",").map((function(e){return e.trim()}))},type:String}),Nn("design:type",Array),Nn("design:paramtypes",[Object])],Fn.prototype,"defaultSelectedGroupIds",null),Un([(0,Qt.Cb)({attribute:"placeholder",type:String}),Nn("design:type",String)],Fn.prototype,"placeholder",void 0),Un([(0,Qt.Cb)({attribute:"disabled",type:Boolean}),Nn("design:type",Boolean)],Fn.prototype,"disabled",void 0),Un([(0,Qt.Cb)({attribute:"allow-any-email",type:Boolean}),Nn("design:type",Boolean)],Fn.prototype,"allowAnyEmail",void 0),Un([(0,Qt.Cb)({attribute:"selection-mode",type:String}),Nn("design:type",String)],Fn.prototype,"selectionMode",void 0),Un([(0,Qt.Cb)({attribute:"user-ids",converter:function(e){return e.split(",").map((function(e){return e.trim()}))},type:String}),Nn("design:type",Array),Nn("design:paramtypes",[Array])],Fn.prototype,"userIds",null),Un([(0,Qt.Cb)({attribute:"user-filters"}),Nn("design:type",String),Nn("design:paramtypes",[String])],Fn.prototype,"userFilters",null),Un([(0,Qt.Cb)({attribute:"people-filters"}),Nn("design:type",String),Nn("design:paramtypes",[String])],Fn.prototype,"peopleFilters",null),Un([(0,Qt.Cb)({attribute:"group-filters"}),Nn("design:type",String),Nn("design:paramtypes",[String])],Fn.prototype,"groupFilters",null),Un([(0,Qt.Cb)({attribute:"aria-label",type:String}),Nn("design:type",String)],Fn.prototype,"ariaLabel",void 0),Un([(0,Qt.SB)(),Nn("design:type",Boolean)],Fn.prototype,"_showLoading",void 0),Un([(0,Qt.SB)(),Nn("design:type",Object)],Fn.prototype,"_arrowSelectionCount",void 0),Un([(0,Qt.SB)(),Nn("design:type",Array)],Fn.prototype,"_highlightedUsers",void 0),Un([(0,Qt.SB)(),Nn("design:type",Object)],Fn.prototype,"_isFocused",void 0),Un([(0,Qt.SB)(),Nn("design:type",Object)],Fn.prototype,"_setAnyEmail",void 0),Un([(0,Qt.SB)(),Nn("design:type",Array)],Fn.prototype,"_foundPeople",void 0);var Ln,On,zn=(0,n(17908).$)("people-picker",(function(){(0,_n.J)(Mn.i0,En.ay),(0,Zn.p)(),(0,wn.yQ)(),(0,An.Y)(),(0,Pn.R)("people-picker",Fn)})),qn=(0,l.Z)({addMembers:(0,a.Z)({display:"flex",flexDirection:"column",paddingBlockEnd:"18px"},u.q5.paddingInline("20px")),buttonRow:{display:"flex",columnGap:"8px",flexDirection:"row",justifyContent:"flex-end",paddingBlockStart:"18px"},dialogHeading:{paddingInlineStart:"4px",marginBlockStart:"18px",marginBlockEnd:"10px"},historyInput:{width:"48px"},option:{display:"flex",alignItems:"center",columnGap:"4px"},radio:{marginBlockStart:"8px",paddingInlineStart:"2px"}}),Hn=function(e){var t=e.addChatMembers,n=e.closeDialog,a=qn(),s=(0,i.useState)(1),o=(0,r.Z)(s,2),c=o[0],l=o[1],u=(0,i.useCallback)((function(e,t){if(t.value){var n=parseInt(t.value,10);l(n)}}),[l]),d=(0,i.useState)("none"),p=(0,r.Z)(d,2),h=p[0],v=p[1],g=i.useCallback((function(e,t){t&&v(t.key)}),[v]),m=(0,i.useState)([]),b=(0,r.Z)(m,2),y=b[0],x=b[1],k=(0,i.useCallback)((function(e){x(e.detail)}),[x]),C=(0,i.useCallback)((function(){var e;"days"===h?e=new Date((new Date).getTime()-24*c*60*60*1e3):"all"===h&&(e=new Date("0001-01-01T00:00:00Z")),t(y.map((function(e){return e.id})),e).then(n)}),[y,h,c,t,n]),w=[{key:"none",text:"Don't include chat history"},{key:"days",text:"Include history from the past number of days: ",onRenderField:function(e,t){return t?i.createElement("div",{className:a.option},t(e),i.createElement(It.I,{type:"number",value:c.toString(),onChange:u,min:1,className:a.historyInput})):null}},{key:"all",text:"Include all chat history"}];return i.createElement("div",{className:a.addMembers},i.createElement("h3",{className:a.dialogHeading},"Add"),i.createElement(zn,{selectedPeople:y,selectionChanged:k,disabled:y.length>=20}),i.createElement(qt.F,{className:a.radio,options:w,selectedKey:h,onChange:g}),i.createElement("div",{className:a.buttonRow},i.createElement(f.z,{onClick:n,appearance:"secondary"},"Cancel"),i.createElement(f.z,{onClick:C,appearance:"primary",disabled:y.length<1},"Add")))},Bn=n(72531),jn=n(84994),Vn=n(13895),Wn=n(5875),Gn=n(28487),Qn=(0,yt.Z)(Wn.zW1,(function(){return i.createElement(i.Fragment,null)})),Jn=(0,l.Z)({iconPlaceholder:{display:"flex",width:"24px"},listItem:{listStyleType:"none",width:"100%",":focus-visible":(Ln={},(0,D.Z)(Ln,"& .".concat(Gn.f),{display:"inline",color:"var(--colorNeutralForeground2BrandHover)"}),(0,D.Z)(Ln,"& .".concat(Gn.a),{display:"none"}),Ln)},memberList:(0,a.Z)((0,a.Z)({fontWeight:800,gridGap:"8px"},u.q5.marginBlock("0")),u.q5.padding("0")),personRow:(0,a.Z)((0,a.Z)((0,a.Z)({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},u.q5.paddingBlock("5px")),u.q5.paddingInline("16px")),{},{cursor:"pointer",":hover":(On={backgroundColor:"var(--colorSubtleBackgroundHover)"},(0,D.Z)(On,"& .".concat(Gn.f),{display:"inline",color:"var(--colorNeutralForeground2BrandHover)"}),(0,D.Z)(On,"& .".concat(Gn.a),{display:"none"}),On)}),fullWidth:{width:"100%"}}),$n=function(e){var t=e.members,n=e.currentUserId,a=e.removeChatMember,s=e.closeParentPopover,o=Jn(),c=(0,i.useState)(!1),l=(0,r.Z)(c,2),u=l[0],h=l[1],b=(0,i.useState)(void 0),y=(0,r.Z)(b,2),x=y[0],k=y[1],C=(0,i.useCallback)((function(e){e&&(k(e),h(!0))}),[]),w=(0,i.useCallback)((function(){k(void 0),h(!1),s()}),[s]),Z=(0,i.useCallback)((function(){null!==x&&void 0!==x&&x.id?a(x.id).then(w):w()}),[x,a,w]);return i.createElement(i.Fragment,null,i.createElement(p.V,{open:u,onOpenChange:function(e,t){return h(t.open)}},i.createElement(v.c,null,i.createElement(g.a,null,i.createElement(m.$,null,"Remove ",(null===x||void 0===x?void 0:x.displayName)||""," from the conversation?"),i.createElement(Ot.c,null,"They'll still have access to the chat history."),i.createElement(zt.k,null,i.createElement(f.z,{appearance:"secondary",onClick:w},"Close"),i.createElement(f.z,{appearance:"primary",onClick:Z},"Remove"))))),i.createElement(Bn.a,{navigable:!0,className:o.memberList},t.map((function(e,t){var r=n===e.userId;return null!==e&&void 0!==e&&e.userId?i.createElement(jn.HC,{key:e.userId,className:o.listItem,index:t,content:i.createElement("div",{className:(0,d.z)(o.personRow,o.fullWidth)},i.createElement(ue.F,{className:o.fullWidth,tabIndex:-1,userId:e.userId,view:Vn.k.oneline,showPresence:!0}),i.createElement("span",{className:o.iconPlaceholder},!r&&i.createElement(Qn,null))),onClick:function(){r?w():C(e)}}):null}))))},Yn=(0,yt.Z)(Et.PXN,Et.HqN),Kn=(0,yt.Z)(xt.zD8,xt.dCH),Xn=(0,l.Z)({button:(0,a.Z)({justifyContent:"flex-start"},u.q5.paddingInline("16px")),buttonRow:{display:"flex",flexDirection:"column"},container:(0,a.Z)({},u.q5.paddingBlock("4px")),divider:(0,a.Z)({},u.q5.marginBlock("4px")),popover:(0,a.Z)({},u.q5.padding("0 !important")),triggerButton:(0,a.Z)((0,a.Z)((0,a.Z)({},u.q5.marginInline("0px","8px")),u.q5.paddingInline("0")),{},{"--spacingHorizontalSNudge":"2px",minWidth:"unset !important",width:"max-content"})}),er=(0,i.memo)((function(e){var t=e.currentUserId,n=e.members,s=e.addChatMembers,o=e.removeChatMember,c=Xn(),l=(0,i.useState)(!1),u=(0,r.Z)(l,2),d=u[0],b=u[1],y=(0,i.useState)(!1),x=(0,r.Z)(y,2),k=x[0],C=x[1],w=(0,i.useCallback)((function(){C(!0)}),[C]),Z=(0,i.useCallback)((function(){C(!1),b(!1)}),[C]),S=(0,i.useCallback)((function(e,t){return b(t.open||!1)}),[b]),I=(0,i.useCallback)((function(){var e=n.find((function(e){return e.userId===t}));null!==e&&void 0!==e&&e.id?o(e.id).then(Z):Z()}),[o,n,t,Z]),M={trapFocus:true,inertTrapFocus:true,inline:!0,positioning:"below-start",open:d,onOpenChange:S};return i.createElement(Ct.J,(0,a.Z)({},M),i.createElement(wt.x,null,i.createElement(f.z,{className:c.triggerButton,appearance:"transparent",icon:i.createElement(Yn,null)},n.length)),i.createElement(Zt.o,{className:c.popover},k?i.createElement(Hn,{closeDialog:Z,addChatMembers:s}):i.createElement("div",{className:c.container},i.createElement($n,{members:n,removeChatMember:o,currentUserId:t,closeParentPopover:Z}),i.createElement(ft.i,{className:c.divider}),i.createElement("div",{className:c.buttonRow},i.createElement(f.z,{appearance:"subtle",icon:i.createElement(Yn,null),onClick:w,className:c.button},"Add people"),i.createElement(p.V,null,i.createElement(h.h,null,i.createElement(f.z,{appearance:"subtle",icon:i.createElement(Kn,null),className:c.button},"Leave")),i.createElement(v.c,null,i.createElement(g.a,null,i.createElement(m.$,null,"Leave the conversation?"),i.createElement(Ot.c,null,"You'll still have access to the chat history."),i.createElement(zt.k,null,i.createElement(h.h,{disableButtonEnhancement:!0},i.createElement(f.z,{appearance:"secondary",onClick:Z},"Cancel")),n.length>2&&i.createElement(f.z,{appearance:"primary",onClick:I},"Leave")))))))))})),tr=n(41606),nr=n(23062),rr=n(5980),ar=n(77847),ir=n(13898),sr=n(83812),or=(0,n(59885).Ll)({svg:function(){return i.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none"},i.createElement("path",{d:"M17.0797 8H14.1797L12.4697 8.82V12.89C12.5119 13.5868 12.8184 14.2412 13.3267 14.7197C13.8349 15.1981 14.5067 15.4645 15.2047 15.4645C15.9028 15.4645 16.5745 15.1981 17.0828 14.7197C17.5911 14.2412 17.8976 13.5868 17.9397 12.89V8.82C17.9399 8.70887 17.9174 8.59886 17.8737 8.49668C17.83 8.39449 17.766 8.30225 17.6856 8.22556C17.6052 8.14887 17.51 8.08933 17.4058 8.05055C17.3017 8.01178 17.1907 7.99458 17.0797 8Z",fill:"#115EA3"}),i.createElement("path",{d:"M16 7C17.1046 7 18 6.10457 18 5C18 3.89543 17.1046 3 16 3C14.8954 3 14 3.89543 14 5C14 6.10457 14.8954 7 16 7Z",fill:"#115EA3"}),i.createElement("path",{d:"M6.82 8H14.18C14.3975 8 14.606 8.08639 14.7598 8.24017C14.9136 8.39395 15 8.60252 15 8.82V13.5C15 14.6935 14.5259 15.8381 13.682 16.682C12.8381 17.5259 11.6935 18 10.5 18C9.30653 18 8.16193 17.5259 7.31802 16.682C6.47411 15.8381 6 14.6935 6 13.5V8.82C6 8.60252 6.08639 8.39395 6.24017 8.24017C6.39395 8.08639 6.60252 8 6.82 8Z",fill:"#B4D6FA"}),i.createElement("path",{d:"M11 8C12.6569 8 14 6.65685 14 5C14 3.34315 12.6569 2 11 2C9.34315 2 8 3.34315 8 5C8 6.65685 9.34315 8 11 8Z",fill:"#B4D6FA"}),i.createElement("path",{opacity:"0.5",d:"M6.00003 8.82V13.5C5.99696 14.3892 6.25799 15.2593 6.75003 16H10.97C11.5005 16 12.0092 15.7893 12.3842 15.4142C12.7593 15.0391 12.97 14.5304 12.97 14V8H6.75003C6.5449 8.01757 6.35389 8.11166 6.21494 8.26358C6.07599 8.4155 5.99928 8.61412 6.00003 8.82Z",fill:"#242424"}),i.createElement("path",{opacity:"0.5",d:"M11.9699 6H8.16992C8.3332 6.46135 8.60686 6.87575 8.96704 7.20706C9.32722 7.53837 9.76299 7.77654 10.2363 7.9008C10.7097 8.02505 11.2062 8.03162 11.6827 7.91993C12.1592 7.80823 12.6011 7.58167 12.9699 7.26V7C12.9699 6.73478 12.8646 6.48043 12.677 6.29289C12.4895 6.10536 12.2351 6 11.9699 6Z",fill:"#242424"}),i.createElement("path",{opacity:"0.1",d:"M6.00003 8.82V13.5C5.99696 14.3892 6.25799 15.2593 6.75003 16H10.97C11.5005 16 12.0092 15.7893 12.3842 15.4142C12.7593 15.0391 12.97 14.5304 12.97 14V8H6.75003C6.5449 8.01757 6.35389 8.11166 6.21494 8.26358C6.07599 8.4155 5.99928 8.61412 6.00003 8.82Z",fill:"white"}),i.createElement("path",{opacity:"0.1",d:"M11.9699 6H8.16992C8.3332 6.46135 8.60686 6.87575 8.96704 7.20706C9.32722 7.53837 9.76299 7.77654 10.2363 7.9008C10.7097 8.02505 11.2062 8.03162 11.6827 7.91993C12.1592 7.80823 12.6011 7.58167 12.9699 7.26V7C12.9699 6.73478 12.8646 6.48043 12.677 6.29289C12.4895 6.10536 12.2351 6 11.9699 6Z",fill:"white"}),i.createElement("path",{d:"M11 5H3C2.44772 5 2 5.44772 2 6V14C2 14.5523 2.44772 15 3 15H11C11.5523 15 12 14.5523 12 14V6C12 5.44772 11.5523 5 11 5Z",fill:"#115EA3"}),i.createElement("path",{d:"M10 8H8V13H7V8H5V7H10V8Z",fill:"white"}))},displayName:"TeamsIcon"}),cr=(0,yt.Z)(sr.f3p,sr.zpo),lr={inline:!0,hasIcons:!0,closeOnScroll:!0,positioning:"below-start"},ur=(0,l.Z)({menuPopover:{zIndex:2,"& .fui-MenuItemLink__content":{fontFamily:"Segoe UI",fontSize:"12px",fontStyle:"normal",fontWeight:"600"}}}),dr=function(e){var t=ur();return i.createElement(tr.v,(0,a.Z)({},lr),i.createElement(nr.b,{disableButtonEnhancement:!0},i.createElement(f.z,{appearance:"transparent",icon:i.createElement(cr,null)})),i.createElement(rr.Y,{className:t.menuPopover},i.createElement(ar.q,null,i.createElement(ir.A,{icon:i.createElement(or,null),target:"_blank",href:e.chatWebUrl},"Go to Microsoft Teams"))))},pr=(0,l.Z)({chatHeader:{display:"flex",flexDirection:"column",rowGap:0,zIndex:2},secondRow:{display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",height:"30px"},noGrow:{flexGrow:0}}),hr=function(e){var t,n,r,a,s=e.chatState,o=pr(),c=vt(),l=null!==(t=null===s||void 0===s||null===(n=s.chat)||void 0===n?void 0:n.webUrl)&&void 0!==t?t:"https://teams.microsoft.com/v2";return i.createElement("div",{className:o.chatHeader},i.createElement(Lt,{chat:s.chat,currentUserId:s.userId,onRenameChat:s.onRenameChat}),i.createElement(ft.i,{appearance:"subtle"}),i.createElement("div",{className:(0,d.z)(o.secondRow,c.row)},(null===(r=s.participants)||void 0===r?void 0:r.length)>0&&"group"===(null===(a=s.chat)||void 0===a?void 0:a.chatType)&&i.createElement(i.Fragment,null,i.createElement(er,{members:s.participants,removeChatMember:s.onRemoveChatMember,currentUserId:s.userId,addChatMembers:s.onAddChatMembers}),i.createElement(ft.i,{vertical:!0,appearance:"subtle",inset:!0,className:o.noGrow})),i.createElement(dr,{chatWebUrl:l})),i.createElement(ft.i,{appearance:"subtle"}))};!function(){var e=Object.assign(it.U,{"add-friend":i.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16","aria-hidden":"true",focusable:"false",className:ht.button},i.createElement("path",{className:ht.icon,d:"M6.22176 13.9567C3.55468 13.653 2 11.8026 2 10V9.5C2 8.67157 2.67157 8 3.5 8H5.59971C5.43777 8.31679 5.30564 8.65136 5.20703 9H3.5C3.22386 9 3 9.22386 3 9.5V10C3 11.1281 3.88187 12.333 5.50235 12.7996C5.69426 13.216 5.93668 13.6043 6.22176 13.9567ZM9.62596 5.06907C9.70657 4.81036 9.75 4.53525 9.75 4.25C9.75 2.73122 8.51878 1.5 7 1.5C5.48122 1.5 4.25 2.73122 4.25 4.25C4.25 5.53662 5.13357 6.61687 6.32704 6.91706C6.64202 6.55055 7.00446 6.226 7.40482 5.95294C7.27488 5.98371 7.13934 6 7 6C6.0335 6 5.25 5.2165 5.25 4.25C5.25 3.2835 6.0335 2.5 7 2.5C7.9665 2.5 8.75 3.2835 8.75 4.25C8.75 4.73141 8.55561 5.16743 8.24104 5.48382C8.67558 5.28783 9.14016 5.14664 9.62596 5.06907ZM10.5 15C12.9853 15 15 12.9853 15 10.5C15 8.01472 12.9853 6 10.5 6C8.01472 6 6 8.01472 6 10.5C6 12.9853 8.01472 15 10.5 15ZM10.5 8C10.7761 8 11 8.22386 11 8.5V10H12.5C12.7761 10 13 10.2239 13 10.5C13 10.7761 12.7761 11 12.5 11H11V12.5C11 12.7761 10.7761 13 10.5 13C10.2239 13 10 12.7761 10 12.5V11H8.5C8.22386 11 8 10.7761 8 10.5C8 10.2239 8.22386 10 8.5 10H10V8.5C10 8.22386 10.2239 8 10.5 8Z"})),"left-chat":i.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16","aria-hidden":"true",focusable:"false",className:ht.button},i.createElement("path",{className:ht.icon,d:"M6.22176 13.9567C3.55468 13.653 2 11.8026 2 10V9.5C2 8.67157 2.67157 8 3.5 8H5.59971C5.43777 8.31679 5.30564 8.65136 5.20703 9H3.5C3.22386 9 3 9.22386 3 9.5V10C3 11.1281 3.88187 12.333 5.50235 12.7996C5.69426 13.216 5.93668 13.6043 6.22176 13.9567ZM9.62596 5.06907C9.70657 4.81036 9.75 4.53525 9.75 4.25C9.75 2.73122 8.51878 1.5 7 1.5C5.48122 1.5 4.25 2.73122 4.25 4.25C4.25 5.53662 5.13357 6.61687 6.32704 6.91706C6.64202 6.55055 7.00446 6.226 7.40482 5.95294C7.27488 5.98371 7.13934 6 7 6C6.0335 6 5.25 5.2165 5.25 4.25C5.25 3.2835 6.0335 2.5 7 2.5C7.9665 2.5 8.75 3.2835 8.75 4.25C8.75 4.73141 8.55561 5.16743 8.24104 5.48382C8.67558 5.28783 9.14016 5.14664 9.62596 5.06907ZM15 10.5C15 12.9853 12.9853 15 10.5 15C8.01472 15 6 12.9853 6 10.5C6 8.01472 8.01472 6 10.5 6C12.9853 6 15 8.01472 15 10.5ZM8.14684 10.146L8.14433 10.1486C8.09744 10.196 8.06198 10.2505 8.03794 10.3086C8.01385 10.3667 8.0004 10.4303 8.00001 10.497L8 10.5L8.00001 10.503C8.0004 10.5697 8.01385 10.6333 8.03794 10.6914C8.06234 10.7504 8.09851 10.8056 8.14645 10.8536L10.1464 12.8536C10.3417 13.0488 10.6583 13.0488 10.8536 12.8536C11.0488 12.6583 11.0488 12.3417 10.8536 12.1464L9.70711 11H12.5C12.7761 11 13 10.7761 13 10.5C13 10.2239 12.7761 10 12.5 10H9.70711L10.8536 8.85355C11.0488 8.65829 11.0488 8.34171 10.8536 8.14645C10.6583 7.95118 10.3417 7.95118 10.1464 8.14645L8.14684 10.146Z"})),"edit-svg":i.createElement("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",focusable:"false",className:ht.button},i.createElement("g",{className:ht.icon},i.createElement("path",{d:"M20.9519 3.0481C19.5543 1.65058 17.2885 1.65064 15.8911 3.04825L3.94103 14.9997C3.5347 15.4061 3.2491 15.9172 3.116 16.4762L2.02041 21.0777C1.96009 21.3311 2.03552 21.5976 2.21968 21.7817C2.40385 21.9659 2.67037 22.0413 2.92373 21.981L7.52498 20.8855C8.08418 20.7523 8.59546 20.4666 9.00191 20.0601L20.952 8.10861C22.3493 6.71112 22.3493 4.4455 20.9519 3.0481ZM16.9518 4.10884C17.7634 3.29709 19.0795 3.29705 19.8912 4.10876C20.7028 4.9204 20.7029 6.23632 19.8913 7.04801L19 7.93946L16.0606 5.00012L16.9518 4.10884ZM15 6.06084L17.9394 9.00018L7.94119 18.9995C7.73104 19.2097 7.46668 19.3574 7.17755 19.4263L3.76191 20.2395L4.57521 16.8237C4.64402 16.5346 4.79168 16.2704 5.00175 16.0603L15 6.06084Z"}))),"leave-svg":i.createElement("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",className:ht.button},i.createElement("g",{className:ht.icon},i.createElement("path",{className:ht.iconUnfilled,d:"M6.25 2C5.00736 2 4 3.00736 4 4.25V19.75C4 20.9926 5.00736 22 6.25 22H12.8096C12.3832 21.5557 12.0194 21.051 11.7322 20.5H6.25C5.83579 20.5 5.5 20.1642 5.5 19.75V4.25C5.5 3.83579 5.83579 3.5 6.25 3.5H17.75C18.1642 3.5 18.5 3.83579 18.5 4.25V11.0764C19.0232 11.1572 19.5258 11.3004 20 11.4982V4.25C20 3.00736 18.9926 2 17.75 2H6.25ZM17.5 23C20.5376 23 23 20.5376 23 17.5C23 14.4624 20.5376 12 17.5 12C14.4624 12 12 14.4624 12 17.5C12 20.5376 14.4624 23 17.5 23ZM21 17.5C21 17.7761 20.7761 18 20.5 18H15.7071L17.3536 19.6464C17.5488 19.8417 17.5488 20.1583 17.3536 20.3536C17.1583 20.5488 16.8417 20.5488 16.6464 20.3536L14.1464 17.8536C13.9512 17.6583 13.9512 17.3417 14.1464 17.1464L16.6464 14.6464C16.8417 14.4512 17.1583 14.4512 17.3536 14.6464C17.5488 14.8417 17.5488 15.1583 17.3536 15.3536L15.7071 17H20.5C20.7761 17 21 17.2239 21 17.5ZM8.5 13.25C9.32843 13.25 10 12.5784 10 11.75C10 10.9216 9.32843 10.25 8.5 10.25C7.67157 10.25 7 10.9216 7 11.75C7 12.5784 7.67157 13.25 8.5 13.25Z"}),i.createElement("path",{className:ht.iconFilled,d:"M6.25 2.75C5.42157 2.75 4.75 3.42157 4.75 4.25V19.75C4.75 20.5784 5.42157 21.25 6.25 21.25H12.1902C11.4405 20.1905 11 18.8967 11 17.5C11 13.9101 13.9101 11 17.5 11C18.1063 11 18.6932 11.083 19.25 11.2383V4.25C19.25 3.42157 18.5784 2.75 17.75 2.75H6.25ZM8.5 13.25C7.67157 13.25 7 12.5784 7 11.75C7 10.9216 7.67157 10.25 8.5 10.25C9.32843 10.25 10 10.9216 10 11.75C10 12.5784 9.32843 13.25 8.5 13.25ZM17.5 23C20.5376 23 23 20.5376 23 17.5C23 14.4624 20.5376 12 17.5 12C14.4624 12 12 14.4624 12 17.5C12 20.5376 14.4624 23 17.5 23ZM21 17.5C21 17.7761 20.7761 18 20.5 18H15.7071L17.3536 19.6464C17.5488 19.8417 17.5488 20.1583 17.3536 20.3536C17.1583 20.5488 16.8417 20.5488 16.6464 20.3536L14.1464 17.8536C13.9512 17.6583 13.9512 17.3417 14.1464 17.1464L16.6464 14.6464C16.8417 14.4512 17.1583 14.4512 17.3536 14.6464C17.5488 14.8417 17.5488 15.1583 17.3536 15.3536L15.7071 17H20.5C20.7761 17 21 17.2239 21 17.5Z"}))),"people-add-svg":i.createElement("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",className:ht.button},i.createElement("g",{className:ht.icon},i.createElement("path",{className:ht.iconUnfilled,d:"M5.5 7C5.5 5.61929 6.61929 4.5 8 4.5C9.38071 4.5 10.5 5.61929 10.5 7C10.5 8.38071 9.38071 9.5 8 9.5C6.61929 9.5 5.5 8.38071 5.5 7ZM8 3C5.79086 3 4 4.79086 4 7C4 9.20914 5.79086 11 8 11C10.2091 11 12 9.20914 12 7C12 4.79086 10.2091 3 8 3ZM15.5 8C15.5 7.17157 16.1716 6.5 17 6.5C17.8284 6.5 18.5 7.17157 18.5 8C18.5 8.82843 17.8284 9.5 17 9.5C16.1716 9.5 15.5 8.82843 15.5 8ZM17 5C15.3431 5 14 6.34315 14 8C14 9.65685 15.3431 11 17 11C18.6569 11 20 9.65685 20 8C20 6.34315 18.6569 5 17 5ZM4.25 13C3.00736 13 2 14.0074 2 15.25V15.5011L2 15.5022L2.00001 15.5048L2.00007 15.5111L2.00035 15.5277C2.00064 15.5406 2.00117 15.5571 2.0021 15.5771C2.00396 15.6169 2.00745 15.6705 2.01398 15.7358C2.02701 15.8661 2.05233 16.045 2.10165 16.2564C2.19995 16.6776 2.39654 17.2404 2.79183 17.8051C3.61066 18.9749 5.17178 20 8 20C9.36897 20 10.4411 19.7598 11.2758 19.3793C11.1268 18.8851 11.035 18.366 11.0082 17.8299C10.3633 18.2108 9.41267 18.5 8 18.5C5.57822 18.5 4.51434 17.6501 4.02067 16.9449C3.75971 16.5721 3.62818 16.1974 3.56241 15.9155C3.5297 15.7753 3.514 15.6612 3.50653 15.5865C3.50281 15.5493 3.50117 15.5222 3.50047 15.5072L3.5 15.4947V15.25C3.5 14.8358 3.83579 14.5 4.25 14.5H11.7322C11.9807 14.0233 12.2865 13.5813 12.6405 13.1831C12.3674 13.0653 12.0663 13 11.75 13H4.25ZM23 17.5C23 14.4624 20.5376 12 17.5 12C14.4624 12 12 14.4624 12 17.5C12 20.5376 14.4624 23 17.5 23C20.5376 23 23 20.5376 23 17.5ZM18.0006 18L18.0011 20.5035C18.0011 20.7797 17.7773 21.0035 17.5011 21.0035C17.225 21.0035 17.0011 20.7797 17.0011 20.5035L17.0006 18H14.4956C14.2197 18 13.9961 17.7762 13.9961 17.5C13.9961 17.2239 14.2197 17 14.4956 17H17.0005L17 14.4993C17 14.2231 17.2239 13.9993 17.5 13.9993C17.7761 13.9993 18 14.2231 18 14.4993L18.0005 17H20.4966C20.7725 17 20.9961 17.2239 20.9961 17.5C20.9961 17.7762 20.7725 18 20.4966 18H18.0006Z"}),i.createElement("path",{className:ht.iconFilled,d:"M8 11C10.2091 11 12 9.20914 12 7C12 4.79086 10.2091 3 8 3C5.79086 3 4 4.79086 4 7C4 9.20914 5.79086 11 8 11ZM17 11C18.6569 11 20 9.65685 20 8C20 6.34315 18.6569 5 17 5C15.3431 5 14 6.34315 14 8C14 9.65685 15.3431 11 17 11ZM4.25 13C3.00736 13 2 14.0074 2 15.25V15.5C2 15.5 2 20 8 20C9.38985 20 10.4578 19.7585 11.2783 19.3875C11.0973 18.7901 11 18.1564 11 17.5C11 15.8431 11.6199 14.3311 12.6405 13.1831C12.3674 13.0653 12.0663 13 11.75 13H4.25ZM23 17.5C23 14.4624 20.5376 12 17.5 12C14.4624 12 12 14.4624 12 17.5C12 20.5376 14.4624 23 17.5 23C20.5376 23 23 20.5376 23 17.5ZM18.0006 18L18.0011 20.5035C18.0011 20.7797 17.7773 21.0035 17.5011 21.0035C17.225 21.0035 17.0011 20.7797 17.0011 20.5035L17.0006 18H14.4956C14.2197 18 13.9961 17.7762 13.9961 17.5C13.9961 17.2239 14.2197 17 14.4956 17H17.0005L17 14.4993C17 14.2231 17.2239 13.9993 17.5 13.9993C17.7761 13.9993 18 14.2231 18 14.4993L18.0005 17H20.4966C20.7725 17 20.9961 17.2239 20.9961 17.5C20.9961 17.7762 20.7725 18 20.4966 18H18.0006Z"})))});(0,st.fm)({icons:e})}();var fr,vr=(0,l.Z)({chat:(0,a.Z)((0,a.Z)({display:"flex",flexDirection:"column",height:"100%"},u.q5.overflow("auto")),{},{paddingBlockEnd:"12px"}),chatMessages:(0,a.Z)((0,a.Z)((0,a.Z)({height:"auto"},u.q5.paddingInline("20px")),u.q5.overflow("auto")),{},{"& img":{maxWidth:"100%",height:"auto"},"& ul":(0,a.Z)({},u.q5.padding("unset")),"& .ui-chat__item__message":{marginLeft:"unset","& ul":(0,a.Z)({},u.q5.paddingInline("40px","0px"))}}),chatInput:(0,a.Z)((0,a.Z)({},u.q5.paddingInline("16px")),u.q5.overflow("unset")),fullHeight:{height:"100%"},spinner:{justifyContent:"center",display:"flex",alignItems:"center",height:"100%"},unsupportedContent:{color:"red"}}),gr={chatContainer:{"& .ui-box":{zIndex:"unset"},"& p":{display:"inline-flex",justifyContent:"center"}},chatMessageContainer:{"& p>mgt-person,msft-mention":(0,a.Z)({display:"inline-block"},u.q5.marginInline("0px","2px")),"& .otherMention":{color:"var(--accent-base-color)"}},myChatMessageContainer:{"& p>mgt-person,msft-mention":(0,a.Z)({display:"inline-block"},u.q5.marginInline("0px","2px")),"& .otherMention":{color:"var(--accent-base-color)"}}},mr=function(e){var t=e.chatId,n=vr(),a=$e(t),s=(0,i.useState)(a.getState()),o=(0,r.Z)(s,2),c=o[0],l=o[1];(0,i.useEffect)((function(){return a.onStateChange(l),function(){a.offStateChange(l)}}),[a]);var u=["creating server connections","subscribing to notifications","loading messages"].includes(c.status);return i.createElement(ne.$,{fluentTheme:se.x},i.createElement(ce.r,{theme:le.w,className:n.fullHeight},i.createElement("div",{className:n.chat},c.userId&&t&&c.messages.length>0?i.createElement(i.Fragment,null,i.createElement(hr,{chatState:c}),i.createElement("div",{className:n.chatMessages},i.createElement(re.z,{userId:c.userId,messages:c.messages,showMessageDate:!0,disableEditing:c.disableEditing,numberOfChatMessagesToReload:c.numberOfChatMessagesToReload,onLoadPreviousChatMessages:c.onLoadPreviousChatMessages,onDeleteMessage:c.onDeleteMessage,onSendMessage:c.onSendMessage,onUpdateMessage:c.onUpdateMessage,onRenderAvatar:function(e){return i.createElement(ue.F,{userId:e,avatarSize:"small",personCardInteraction:de.c.hover,showPresence:!0})},styles:gr,mentionOptions:{displayOptions:{onRenderMention:at(c)}},onRenderMessage:tt})),i.createElement("div",{className:n.chatInput},i.createElement(ae.S,{onSendMessage:c.onSendMessage})),i.createElement(ie.W,{activeErrorMessages:c.activeErrorMessages})):i.createElement(i.Fragment,null,u&&i.createElement("div",{className:n.spinner},i.createElement(pe.$,null)," ",i.createElement("br",null),c.status),"no messages"===c.status&&i.createElement(rt,{messageBarType:oe.f.error,message:"No messages were found for the id ".concat(t,".")}),"no chat id"===c.status&&i.createElement(rt,{messageBarType:oe.f.error,message:"A valid chat id is required."})))))},br=((0,yt.Z)(Et.oYL,Et.oYL),(0,yt.Z)(Et.wxB,Et.wxB),n(70065),(0,l.Z)({defaultProfileImage:(0,a.Z)((0,a.Z)({},u.q5.borderRadius("50%")),{},{objectFit:"cover",display:"flex",alignItems:"center",justifyContent:"center"})}),(0,l.Z)({isSelected:{backgroundColor:"#e6f7ff"},isUnSelected:{backgroundColor:"#ffffff"},isBold:{fontWeight:"bold"},isNormal:{fontWeight:"normal"},chatListItem:{display:"flex",alignItems:"center",width:"100%",paddingRight:"10px",paddingLeft:"10px"},profileImage:(0,a.Z)((0,a.Z)({},u.q5.flex(0,0,"auto")),{},{marginRight:"10px",objectFit:"cover",display:"flex",alignItems:"center",justifyContent:"center"}),defaultProfileImage:(0,a.Z)((0,a.Z)({},u.q5.borderRadius("50%")),{},{objectFit:"cover",display:"flex",alignItems:"center",justifyContent:"center"}),chatInfo:(0,a.Z)({flexGrow:1,flexShrink:1,minWidth:0},u.q5.padding("5px")),chatTitle:(0,a.Z)((0,a.Z)((0,a.Z)({textAlign:"left"},u.q5.margin("0")),{},{fontSize:"1em",color:"#333",textOverflow:"ellipsis"},u.q5.overflow("hidden")),{},{whiteSpace:"nowrap",width:"auto"}),chatMessage:(0,a.Z)((0,a.Z)((0,a.Z)({fontSize:"0.9em",color:"#666",textAlign:"left"},u.q5.margin("0")),{},{textOverflow:"ellipsis"},u.q5.overflow("hidden")),{},{whiteSpace:"nowrap",width:"auto"}),chatTimestamp:{flexShrink:0,textAlign:"right",alignSelf:"start",marginLeft:"auto",paddingLeft:"10px",fontSize:"0.8em",color:"#999",whiteSpace:"nowrap"},person:{"--person-avatar-size":"32px","--person-alignment":"center"}}),z.useCanary,(0,yt.Z)(sr.f3p,sr.zpo),(0,l.Z)({menuPopover:{zIndex:10,"& .fui-MenuItemLink__content":{fontFamily:"Segoe UI",fontSize:"12px",fontStyle:"normal",fontWeight:"600"}}}),(0,l.Z)({headerContainer:{width:"100%"},controlsContainer:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center"},buttonIcon:(0,a.Z)((0,a.Z)({flexGrow:0,flexShrink:0,flexBasis:"35px"},u.q5.borderRadius("50%")),{},{marginRight:"10px",objectFit:"cover",display:"flex",alignItems:"center",justifyContent:"center"}),button:(0,a.Z)((0,a.Z)((0,a.Z)({},u.q5.border("none")),u.q5.padding(0)),{},{minWidth:0,"&:hover":{backgroundColor:"transparent"}}),bannerClassName:{backgroundColor:"#FFE1A7",textAlign:"center",fontWeight:"bold",fontStyle:"italic",paddingTop:"5px",paddingBottom:"5px",marginBottom:"5px"}}),(0,l.Z)({headerContainer:(0,a.Z)({display:"flex",justifyContent:"center",width:"100%"},u.q5.padding("10px")),linkContainer:(0,a.Z)({display:"flex",justifyContent:"center",width:"100%"},u.q5.padding("10px")),loadMore:{textDecorationLine:"none",fontSize:"1.2em",fontWeight:"bold","&:hover":{textDecorationLine:"none"}},button:(0,a.Z)((0,a.Z)({flexDirection:"row",alignItems:"center",width:"100%"},u.q5.padding("0px")),u.q5.border("none"))}),n(71578)),yr=n(75192),xr=(0,l.Z)({title:(0,a.Z)((0,a.Z)({},br.w.subtitle2),u.q5.marginInline("32px")),form:{display:"flex",flexDirection:"column",gridRowGap:"16px",minWidth:"300px","& textarea":{fontSize:"var(--type-ramp-base-font-size)","::placeholder":{fontSize:"var(--type-ramp-base-font-size)"}}},formButtons:{display:"flex",flexDirection:"row",justifyContent:"flex-end",gridColumnGap:"8px"}}),kr=function(e){var t=e.mode,n=void 0===t?"auto":t,a=e.onChatCreated,s=e.onCancelClicked,o=xr(),c=(0,i.useState)("group"===n),l=(0,r.Z)(c,2),u=l[0],d=l[1],p=(0,i.useState)("initial"),h=(0,r.Z)(p,2),v=h[0],g=h[1],m=(0,i.useState)([]),b=(0,r.Z)(m,2),y=b[0],x=b[1],k=(0,i.useCallback)((function(e){e.detail&&(x(e.detail),"auto"===n&&d(e.detail.length>1))}),[n]),C=(0,i.useState)(""),w=(0,r.Z)(C,2),Z=w[0],S=w[1],I=(0,i.useCallback)((function(e,t){S(t.value)}),[]),M=(0,i.useState)(""),E=(0,r.Z)(M,2),_=E[0],T=E[1],P=(0,i.useCallback)((function(e,t){T(t.value)}),[]),A=(0,i.useCallback)((function(){var e=we("mgt-new-chat");g("creating chat");var t=[Ce()];y.reduce((function(e,t){return t.id&&e.push(t.id),e}),t),Oe(e,t,u,_,Z).then((function(e){g("done"),a(e)}))}),[a,y,_,Z,u]);return i.createElement(ce.r,{theme:le.w},"initial"===v?i.createElement("div",{className:o.form},i.createElement(St.g,{label:"To"},i.createElement(zn,{disabled:"oneOnOne"===n&&(null===y||void 0===y?void 0:y.length)>0||(null===y||void 0===y?void 0:y.length)>19,ariaLabel:"Select people to chat with",selectedPeople:y,selectionChanged:k})),u&&i.createElement(St.g,{label:"Group name"},i.createElement(It.I,{placeholder:"Chat name",onChange:I,value:Z})),i.createElement(yr.g,{placeholder:"Type your first message",size:"large",resize:"vertical",value:_,onChange:P}),i.createElement("div",{className:o.formButtons},i.createElement(f.z,{appearance:"secondary",onClick:s},"Cancel"),i.createElement(f.z,{appearance:"primary",onClick:A},"Send"))):i.createElement(i.Fragment,null,v,"done"!==v&&i.createElement(pe.$,null)))},Cr=n(57774),wr=n(37574),Zr=(0,l.Z)({chat:{paddingLeft:"5px",paddingRight:"5px",display:"flex",alignItems:"center",height:"50px",cursor:"pointer",":hover":{backgroundColor:"var(--colorNeutralBackground1Hover)"}},active:{backgroundColor:"var(--colorNeutralBackground1Selected)"},person:{userSelect:"none","--person-line1-font-weight":"var(--fontWeightRegular)","--person-avatar-size-small":"40px","--person-avatar-size":"40px","--person-line2-font-size":"var(--fontSizeBase200)","--person-line2-text-color":"var(--colorNeutralForeground4)","& .fui-Persona__primaryText":{fontSize:"var(--fontSizeBase300)",fontWeight:"var(--fontWeightRegular)"},"& .fui-Persona__secondaryText":(0,a.Z)({whiteSpace:"nowrap",textOverflow:"ellipsis",width:"200px",display:"inline-block",fontSize:"var(--fontSizeBase200);",color:"var(--colorNeutralForeground4)"},u.q5.overflow("hidden"))},group:{paddingTop:"5px"},messagePreview:(0,a.Z)({whiteSpace:"nowrap",textOverflow:"ellipsis",width:"200px",display:"inline-block"},u.q5.overflow("hidden"))}),Sr=function(e){var t=e.chat,n=e.userId,a=Zr(),s=(0,i.useState)(""),o=(0,r.Z)(s,2),c=o[0],l=o[1],u=(0,i.useCallback)((function(e){var t,r,a=null===(t=e.members)||void 0===t?void 0:t.find((function(e){return e.userId!==n}));return a?a.userId:1===(null===(r=e.members)||void 0===r?void 0:r.length)&&e.members[0].userId===n?n:void 0}),[n]),p=(0,i.useCallback)((function(e){var t,r,a=new Intl.ListFormat("en"),i=[];return e.topic?e.topic:(null===(t=e.members)||void 0===t||null===(r=t.filter((function(e){return e.userId!==n})))||void 0===r||r.forEach((function(e){var t;i.push(null===(t=e.displayName)||void 0===t?void 0:t.split(" ")[0])})),a.format(i))}),[n]);return i.useEffect((function(){l(function(e,t){var n,r,a,i,s,o,c,l,u,d,p,h,f,v,g="";if(null!==e&&void 0!==e&&null!==(n=e.lastMessagePreview)&&void 0!==n&&null!==(r=n.from)&&void 0!==r&&r.user&&(null===e||void 0===e||null===(a=e.lastMessagePreview)||void 0===a||null===(i=a.from)||void 0===i?void 0:i.user.id)!==t?(g+=null===e||void 0===e||null===(d=e.lastMessagePreview)||void 0===d||null===(p=d.from)||void 0===p||null===(h=p.user.displayName)||void 0===h?void 0:h.split(" ")[0],g+=": "):g+="You: ","text"===(null===e||void 0===e||null===(s=e.lastMessagePreview)||void 0===s||null===(o=s.body)||void 0===o?void 0:o.contentType))g+=null===e||void 0===e||null===(f=e.lastMessagePreview)||void 0===f||null===(v=f.body)||void 0===v?void 0:v.content;else if("html"===(null===e||void 0===e||null===(c=e.lastMessagePreview)||void 0===c||null===(l=c.body)||void 0===l?void 0:l.contentType)){var m,b,y=null===e||void 0===e||null===(m=e.lastMessagePreview)||void 0===m||null===(b=m.body)||void 0===b?void 0:b.content,x=(new DOMParser).parseFromString(y,"text/html"),k=x.querySelectorAll("img"),C=x.querySelector("attachment"),w=x.querySelector("span[itemId]");if(x.querySelector("systemEventMessage")||w)return;g+=x.body.textContent||x.body.innerText||"",k&&(Array.from(k.values()).find((function(e){return e.src.includes(".gif")}))?g+=" \ud83d\udcf7 GIF":g+=" Sent an image"),C&&(g="Sent a card")}return null===(u=g)||void 0===u?void 0:u.trim().replace(/[\n\t\r]/g,"").replace(/\s+/g," ")}(t,n))}),[t,n]),(0,wr.jsx)(wr.Fragment,{children:n&&(0,wr.jsxs)("div",{className:a.chat,children:["oneOnOne"===t.chatType&&(0,wr.jsx)(ue.F,{userId:u(t),view:c?gt.b.twolines:gt.b.oneline,avatarSize:"auto",showPresence:!0,className:a.person,children:c&&(0,wr.jsx)(Ir,{template:"line2",chat:t,userId:n,messagePreview:c})}),"group"===t.chatType&&(0,wr.jsxs)("div",{children:[(0,wr.jsx)(Cr.I,{textAlignment:"center",size:"extra-large",name:p(t),secondaryText:c,avatar:{icon:(0,wr.jsx)(Et.rqh,{}),initials:null},className:(0,d.z)(a.person,a.group)}),(0,wr.jsx)("span",{})]}),"meeting"===t.chatType&&(0,wr.jsx)("div",{children:(0,wr.jsx)(Cr.I,{textAlignment:"center",size:"extra-large",className:(0,d.z)(a.person,a.group),avatar:{icon:(0,wr.jsx)(Mt.mLZ,{}),initials:null},name:p(t),secondaryText:c})})]})})},Ir=function(e){var t=Zr();return(0,wr.jsx)(wr.Fragment,{children:e.messagePreview&&(0,wr.jsx)("span",{className:t.messagePreview,children:e.messagePreview})})},Mr=i.memo(Sr),Er=(0,l.Z)({listItem:{listStyleType:"none",width:"100%",":focus-visible":(fr={},(0,D.Z)(fr,"& .".concat(Gn.f),{display:"inline",color:"var(--colorNeutralForeground2BrandHover)"}),(0,D.Z)(fr,"& .".concat(Gn.a),{display:"none"}),fr)},selected:{backgroundColor:"var(--colorNeutralBackground1Selected)"},list:(0,a.Z)((0,a.Z)({fontWeight:800,gridGap:"8px"},u.q5.marginBlock("0")),u.q5.padding("0"))}),_r=function(e){var t=Er(),n=e.dataContext.value,a=(0,i.useState)(n.filter((function(e){var t;return(null===(t=e.members)||void 0===t?void 0:t.length)>1}))),s=(0,r.Z)(a,1)[0],o=(0,i.useState)(),c=(0,r.Z)(o,2),l=c[0],u=c[1],d=(0,i.useState)(s.length>0?s[0]:void 0),p=(0,r.Z)(d,2),h=p[0],f=p[1];i.useEffect((function(){h&&e.onChatSelected(h)}),[e,h]),i.useEffect((function(){var e=function(){var e=(0,T.Z)((0,_.Z)().mark((function e(){var t;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U.C.me();case 2:t=e.sent,u(t.id);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();l||e()}));return(0,wr.jsx)(Bn.a,{navigable:!0,className:t.list,children:s.map((function(e,n){return(0,wr.jsx)(jn.HC,{index:n,className:t.listItem,content:(0,wr.jsx)("div",{className:!h&&0===n||(r=e,h&&h&&r.id===(null===h||void 0===h?void 0:h.id))?t.selected:"",children:(0,wr.jsx)(Mr,{chat:e,userId:l},e.id)}),onClick:function(){f(e)}},e.id);var r}))})},Tr=(0,l.Z)({container:{display:"flex",flexDirection:"row"},panels:(0,a.Z)({},u.q5.padding("10px")),main:(0,a.Z)((0,a.Z)({display:"flex",flexDirection:"column",flexWrap:"nowrap",width:"300px",minWidth:"300px"},u.q5.overflow("auto")),{},{maxHeight:"80vh",borderRightColor:"var(--neutral-stroke-rest)",borderRightStyle:"solid",borderRightWidth:"1px"}),side:(0,a.Z)((0,a.Z)({display:"flex",flexDirection:"column",flexWrap:"nowrap",width:"80%"},u.q5.overflow("auto")),{},{maxHeight:"80vh",height:"100%"}),newChat:{paddingBottom:"10px",marginRight:"0px",marginLeft:"auto"},dialog:{display:"block"},dialogSurface:{contain:"unset"}}),Pr=function(){return"me/chats?$expand=members,lastMessagePreview&$orderBy=lastMessagePreview/createdDateTime desc&$filter=viewpoint/lastMessageReadDateTime ge ".concat(function(e){var t=new Date;return t.setMonth(t.getMonth()-e),t.toISOString()}(9))},Ar=i.memo((function(e){return(0,wr.jsxs)(o.d,{resource:e.resourceUrl,scopes:["chat.read"],children:[(0,wr.jsx)(_r,{template:"default",onChatSelected:e.onChatSelected}),(0,wr.jsx)(c.g,{template:"loading",message:"Loading your chats..."})]})})),Dr=function(){var e=Tr(),t=i.useState(Pr),n=(0,r.Z)(t,2),a=n[0],o=n[1],c=i.useState(),l=(0,r.Z)(c,2),u=l[0],b=l[1],y=i.useState(!1),x=(0,r.Z)(y,2),k=x[0],C=x[1];return(0,wr.jsxs)(wr.Fragment,{children:[(0,wr.jsx)(s.m,{title:"Chats",description:"Stay in touch with your teammates and navigate your chats"}),(0,wr.jsxs)("div",{className:e.container,children:[(0,wr.jsxs)("div",{className:(0,d.z)(e.panels,e.main),children:[(0,wr.jsx)("div",{className:e.newChat,children:(0,wr.jsxs)(p.V,{open:k,children:[(0,wr.jsx)(h.h,{disableButtonEnhancement:!0,children:(0,wr.jsx)(f.z,{appearance:"primary",onClick:function(){return C(!0)},children:"New Chat"})}),(0,wr.jsx)(v.c,{className:e.dialogSurface,children:(0,wr.jsxs)(g.a,{className:e.dialog,children:[(0,wr.jsx)(m.$,{children:"New Chat"}),(0,wr.jsx)(kr,{onChatCreated:function(e){e.id!==(null===u||void 0===u?void 0:u.id)&&k&&(C(!1),o(Pr)),b(e)},onCancelClicked:function(){C(!1)}})]})})]})}),(0,wr.jsx)(Ar,{onChatSelected:b,resourceUrl:a})]}),(0,wr.jsx)("div",{className:e.side,children:u&&(0,wr.jsx)(mr,{chatId:u.id})})]})]})}},9408:function(e,t,n){n.d(t,{_:function(){return i}});var r=n(68079),a=n(42278),i=function(){var e=[];return a.i.sections.files&&e.push("Sites.Read.All"),a.i.sections.mailMessages&&(e.push("Mail.Read"),e.push("Mail.ReadBasic")),a.i.sections.organization&&(e.push("User.Read.All"),a.i.sections.organization.showWorksWith&&e.push("People.Read.All")),a.i.sections.profile&&e.push("User.Read.All"),a.i.useContactApis&&e.push("Contacts.Read"),e.indexOf("User.Read.All")<0&&(e.push("User.ReadBasic.All"),e.push("User.Read")),e.indexOf("People.Read.All")<0&&e.push("People.Read"),a.i.isSendMessageVisible&&e.push("Chat.ReadWrite"),(0,r.Z)(new Set(e))}},19155:function(e,t,n){n.d(t,{g:function(){return c}});var r=n(9249),a=n(87371),i=n(45754),s=n(86906),o=n(34629),c=function(e){(0,i.Z)(n,e);var t=(0,s.Z)(n);function n(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"beta";return(0,r.Z)(this,n),t.call(this,e,a)}return(0,a.Z)(n,[{key:"forComponent",value:function(e){var t=new n(this.client);return this.setComponent(e),t}}],[{key:"fromGraph",value:function(e){var t=new n(e.client);return t.setComponent(e.componentName),t}}]),n}(o.k)}}]);
//# sourceMappingURL=459.9487fb04.chunk.js.map