"use strict";(self.webpackChunkreact_contoso=self.webpackChunkreact_contoso||[]).push([[588],{64092:function(e,t,n){n.d(t,{u:function(){return s}});n(59192);var a=n(32580),r=n(63920),i=n(9e4),c=(0,a.a)({divider:{alignItems:"self-start",paddingTop:"20px",marginBottom:"20px"}}),s=function(e){var t=c();return(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{children:e.title}),(0,i.jsx)("div",{children:e.description}),(0,i.jsx)(r.c,{className:t.divider})]})}},34588:function(e,t,n){n.r(t),n.d(t,{ChatAddIcon:function(){return Ua},default:function(){return za}});var a=n(51428),r=n(64412),i=n(59192),c=n(64092),s=n(32580),o=n(75528),u=n(1284),l=n(23922),d=n(40028),h=n(37408),p=n(4480),f=["ChatMember.ReadWrite","Chat.ReadWrite","TeamsAppInstallation.ReadForChat","AppCatalog.Read.All"],m=["Chat.ReadBasic","Chat.Read","Chat.ReadWrite"],v=["Chat.Read","Chat.ReadWrite"],g=["ChannelMessage.Read.All","Chat.Read","Chat.ReadWrite","Group.Read.All","Group.ReadWrite.All"],C=["ChatMessage.Send","ChatMessage.Send","Chat.ReadWrite","Group.ReadWrite.All"],b=["ChannelMessage.ReadWrite","Chat.ReadWrite","Group.ReadWrite.All"],x=["ChannelMessage.ReadWrite","Chat.ReadWrite"],w=["ChatMember.ReadWrite"],y=["ChatMember.ReadWrite","Chat.ReadWrite"],k=["Chat.Create","Chat.ReadWrite"],S=["TeamsAppInstallation.ReadForChat","TeamsAppInstallation.ReadWriteSelfForChat","TeamsAppInstallation.ReadWriteForChat"],E=["AppCatalog.Read.All","AppCatalog.ReadWrite.All","AppCatalog.Submit"],M={loadPresence:["Presence.Read.All"],searchUsers:["User.ReadBasic.All"],searchPeople:["People.Read"]},I=(Array.from([["User.Read"]].concat([f]).concat(Object.values(M)).concat([(0,p.Y)()]).reduce((function(e,t){return t.forEach((function(t){return e.add(t)})),e}),new Set)),Array.from([["User.Read","TeamsAppInstallation.ReadForChat"]].concat([f]).concat(Object.values(M)).concat([(0,p.Y)()]).reduce((function(e,t){return t.forEach((function(t){return e.add(t)})),e}),new Set)),n(33236)),T=n(21620),D=n(88944),R=n(41640),A=n(60664),P=n(77392),N=n(38656),_=n(51611),L=n(20284),U=n(89516),O=n(21640),F=n(52096),z=function(){function e(){(0,R.c)(this,e)}return(0,A.c)(e,null,[{key:"graphEndpoint",get:function(){return e.useCanary?"https://canary.graph.microsoft.com":"https://graph.microsoft.com"}},{key:"baseCanaryUrl",get:function(){return"".concat(e.graphEndpoint,"/").concat(this.canarySubscriptionVersion)}},{key:"subscriptionEndpoint",get:function(){return e.useCanary?"".concat(e.baseCanaryUrl,"/subscriptions"):"/subscriptions"}},{key:"adjustNotificationUrl",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";return e.useCanary&&t&&(t=(t=t.replace("https://graph.microsoft.com/1.0",e.baseCanaryUrl)).replace("https://graph.microsoft.com/beta",e.baseCanaryUrl)),t=function(e,t){var n=/([?&]{1})sessionid=[^&]*/;if(e.match(n))e=e.replace(n,"$1sessionid=".concat(t));else{var a=e.indexOf("?")>-1?"&":"?";e="".concat(e).concat(a,"sessionid=").concat(t)}return e}(t=t.replace(e.webSocketsPrefix,""),n),t}}]),e}();(0,P.c)(z,"ackAsString",!1),(0,P.c)(z,"useCanary",!1),(0,P.c)(z,"version","v1.0"),(0,P.c)(z,"canarySubscriptionVersion","testprodv1.0e2ewebsockets"),(0,P.c)(z,"webSocketsPrefix","websockets:");var B,V=n(67248),Y=n(62512),W=function(){return Y.m.config.conversation.isEnabled&&Y.m.config.isEnabled};!function(e){e.User="user",e.Chat="chat"}(B||(B={}));var j=function(){function e(){(0,R.c)(this,e)}return(0,A.c)(e,[{key:"cache",get:function(){var e=V.I.conversation;return Y.m.getCache(e,e.stores.subscriptions)}},{key:"loadSubscriptions",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t){var n;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!W()){e.next=4;break}return e.next=3,this.cache.transaction(function(){var e=(0,D.c)((0,T.c)().mark((function e(a){return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.get(t);case 2:if(!(n=e.sent)){e.next=7;break}return n.lastAccessDateTime=(new Date).toISOString(),e.next=7,a.put(n,t);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:return e.abrupt("return",n||void 0);case 4:return e.abrupt("return",void 0);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"cacheSubscription",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n,a){return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cache.transaction(function(){var e=(0,D.c)((0,T.c)().mark((function e(r){var i,c;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,_.Yz)("cacheSubscription",a),e.next=3,r.get(t);case 3:return(i=e.sent)&&i.chatId===t?-1!==(c=i.subscriptions.findIndex((function(e){return e.resource===a.resource})))?i.subscriptions[c]=a:i.subscriptions.push(a):i={chatId:t,subscriptions:[a],lastAccessDateTime:"",componentType:n},i.lastAccessDateTime=(new Date).toISOString(),e.next=8,r.put(i,t);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"deleteCachedSubscriptions",value:function(e){return this.cache.delete(e)}},{key:"loadInactiveSubscriptions",value:function(e,t){return this.cache.queryDb("lastAccessDateTime",IDBKeyRange.upperBound(e)).then((function(e){return e.filter((function(e){return e.componentType===t}))})).catch((function(e){throw e}))}}]),e}(),H=function(){function e(){var t=this;(0,R.c)(this,e),(0,P.c)(this,"worker",void 0),(0,P.c)(this,"work",new Map),(0,P.c)(this,"onMessage",(function(e){var n=e.data;if(n&&"runCallback"===n.type)if(t.work.has(n.id)){var a=t.work.get(n.id);null===a||void 0===a||a()}})),this.worker=new SharedWorker(new URL(n.p+n.u(512),n.b)),this.worker.port.onmessage=this.onMessage}return(0,A.c)(e,[{key:"setTimeout",value:function(e,t,n){var a={type:"setTimeout",id:e,delay:n};return this.work.set(a.id,t),this.worker.port.postMessage(a),a.id}},{key:"clearTimeout",value:function(e){if(this.work.has(e)){var t={type:"clearTimeout",id:e};this.worker.port.postMessage(t),this.work.delete(e)}}},{key:"close",value:function(){this.worker.port.close()}}]),e}(),Z=n(39544),G=function(e){var t="".concat("mgt-chat-group-id","::").concat(e),n=localStorage.getItem(t);if(n)return n;var a=(0,Z.c)();return localStorage.setItem(t,a),a},q=10,$=75,K=20,Q=60,J=60,X=(z.useCanary,function(){function e(t,n){var a=this;(0,R.c)(this,e),(0,P.c)(this,"emitter",void 0),(0,P.c)(this,"_graph",void 0),(0,P.c)(this,"instanceId",(0,Z.c)()),(0,P.c)(this,"connection",void 0),(0,P.c)(this,"renewalTimeout",void 0),(0,P.c)(this,"cleanupTimeout",void 0),(0,P.c)(this,"renewalCount",0),(0,P.c)(this,"chatId",""),(0,P.c)(this,"sessionId",""),(0,P.c)(this,"subscriptionCache",new j),(0,P.c)(this,"timer",new H),(0,P.c)(this,"getToken",(0,D.c)((0,T.c)().mark((function e(){var t;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.M.globalProvider.getAccessToken();case 2:if(t=e.sent){e.next=5;break}throw new Error("Could not retrieve token for user");case 5:return e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})))),(0,P.c)(this,"onReconnect",(function(e){(0,_.Yz)("Reconnected. ConnectionId: ".concat(e||"undefined"))})),(0,P.c)(this,"receiveNotificationMessage",(function(e){if("string"!==typeof e)throw new Error("Expected string from receivenotificationmessageasync");var t=JSON.parse(e);(0,_.Yz)("received notification message",t);var n=a.emitter;if(!t.resourceData)throw new Error("Message did not contain resourceData");t.resource.includes("/messages(")?a.processMessageNotification(t,n):!function(e){return e.resource.includes("/members")}(t)?a.processChatPropertiesNotification(t,n):a.processMembershipNotification(t,n);var r={StatusCode:"200"};return z.ackAsString?JSON.stringify(r):r})),(0,P.c)(this,"cacheSubscription",function(){var e=(0,D.c)((0,T.c)().mark((function e(t){return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,_.Yz)(t),e.next=3,a.subscriptionCache.cacheSubscription(a.chatId,B.Chat,t);case 3:void 0===a.renewalTimeout&&a.startRenewalTimer();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,P.c)(this,"startRenewalTimer",(function(){a.renewalTimeout&&a.timer.clearTimeout(a.renewalTimeout),a.renewalTimeout=a.timer.setTimeout("renewal:"+a.instanceId,a.syncRenewalTimerWrapper,1e3*K),(0,_.Yz)("Start renewal timer . Id: ".concat(a.renewalTimeout))})),(0,P.c)(this,"syncRenewalTimerWrapper",(function(){a.renewalTimer()})),(0,P.c)(this,"renewalTimer",(0,D.c)((0,T.c)().mark((function e(){var t,n,r,i,c,s,o;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(0,_.Yz)("running subscription renewal timer for chatId: ".concat(a.chatId," sessionId: ").concat(a.sessionId)),e.next=4,a.subscriptionCache.loadSubscriptions(a.chatId);case 4:if(e.t2=t=e.sent,e.t1=null===e.t2,e.t1){e.next=8;break}e.t1=void 0===t;case 8:if(!e.t1){e.next=12;break}e.t3=void 0,e.next=13;break;case 12:e.t3=t.subscriptions;case 13:if(e.t0=e.t3,e.t0){e.next=16;break}e.t0=[];case 16:if(0!==(n=e.t0).length){e.next=21;break}return(0,_.Yz)("No subscriptions found in session state. Stop renewal timer ".concat(a.renewalTimeout,".")),a.renewalTimeout&&a.timer.clearTimeout(a.renewalTimeout),e.abrupt("return");case 21:r=(0,I.c)(n),e.prev=22,r.s();case 24:if((i=r.n()).done){e.next=41;break}if((c=i.value).expirationDateTime){e.next=28;break}return e.abrupt("continue",39);case 28:if(s=new Date(c.expirationDateTime),o=new Date,!(Math.round((s.getTime()-o.getTime())/1e3)<=$)){e.next=39;break}return a.renewalCount++,(0,_.Yz)("Renewing Graph subscription. RenewalCount: ".concat(a.renewalCount)),a.renewalTimeout&&a.timer.clearTimeout(a.renewalTimeout),a.renewalTimeout=void 0,e.next=38,a.renewChatSubscriptions();case 38:return e.abrupt("break",41);case 39:e.next=24;break;case 41:e.next=46;break;case 43:e.prev=43,e.t4=e.catch(22),r.e(e.t4);case 46:return e.prev=46,r.f(),e.finish(46);case 49:e.next=54;break;case 51:e.prev=51,e.t5=e.catch(0),(0,_.e5)(e.t5);case 54:a.renewalTimeout=a.timer.setTimeout("renewal:"+a.instanceId,a.syncRenewalTimerWrapper,1e3*K);case 55:case"end":return e.stop()}}),e,null,[[0,51],[22,43,46,49]])})))),(0,P.c)(this,"renewChatSubscriptions",(0,D.c)((0,T.c)().mark((function e(){var t,n,r,i,c,s;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Date((new Date).getTime()+60*q*1e3),e.next=3,a.subscriptionCache.loadSubscriptions(a.chatId);case 3:n=e.sent,r=[],i=(0,I.c)((null===n||void 0===n?void 0:n.subscriptions)||[]),e.prev=6,i.s();case 8:if((c=i.n()).done){e.next=16;break}if((s=c.value).id){e.next=12;break}return e.abrupt("continue",14);case 12:r.push(a.renewSubscription(s.id,t.toISOString())),(0,_.Yz)("Invoked RenewSubscription ".concat(s.id));case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(6),i.e(e.t0);case 21:return e.prev=21,i.f(),e.finish(21);case 24:return e.next=26,Promise.all(r);case 26:a.renewalTimeout||(a.renewalTimeout=a.timer.setTimeout("renewal:"+a.instanceId,a.syncRenewalTimerWrapper,1e3*K));case 27:case"end":return e.stop()}}),e,null,[[6,18,21,24]])})))),(0,P.c)(this,"renewSubscription",function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n){var r,i;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(r=a.graph)||void 0===r?void 0:r.api("".concat(z.subscriptionEndpoint,"/").concat(t)).patch({expirationDateTime:n});case 3:if(!(i=e.sent)){e.next=6;break}return e.abrupt("return",a.cacheSubscription(i));case 6:e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",Promise.reject(e.t0));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}()),(0,P.c)(this,"cleanupTimerSync",(function(){a.cleanupTimer()})),(0,P.c)(this,"cleanupTimer",(0,D.c)((0,T.c)().mark((function e(){var t,n,r,i,c,s,o,u,l,d;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(0,_.Yz)("running cleanup timer"),e.next=4,N.M.getCacheId();case 4:if(e.sent){e.next=7;break}return e.abrupt("return");case 7:return t=Math.min(1e3*Q,60*q*1e3),n=new Date((new Date).getTime()-t).toISOString(),e.next=11,a.subscriptionCache.loadInactiveSubscriptions(n,B.Chat);case 11:r=e.sent,i=[],c=(0,I.c)(r);try{for(c.s();!(s=c.n()).done;)o=s.value,i.push(a.removeSubscriptions(o.subscriptions))}catch(h){c.e(h)}finally{c.f()}return e.next=17,Promise.all(i);case 17:i=[],u=(0,I.c)(r);try{for(u.s();!(l=u.n()).done;)d=l.value,i.push(a.subscriptionCache.deleteCachedSubscriptions(d.chatId))}catch(h){u.e(h)}finally{u.f()}e.next=25;break;case 22:e.prev=22,e.t0=e.catch(0),(0,_.e5)(e.t0);case 25:return e.prev=25,a.startCleanupTimer(),e.finish(25);case 28:case"end":return e.stop()}}),e,null,[[0,22,25,28]])})))),this.emitter=t,this._graph=n,this.startCleanupTimer()}return(0,A.c)(e,[{key:"graph",get:function(){return this._graph}},{key:"beta",get:function(){return this._graph?L.U.fromGraph(this._graph):void 0}},{key:"subscriptionGraph",get:function(){return z.useCanary?(0,U.Y)(N.M.globalProvider,z.canarySubscriptionVersion,"mgt-chat"):this.beta}},{key:"tearDown",value:function(){(0,_.Yz)("cleaning up graph notification resources"),this.cleanupTimeout&&this.timer.clearTimeout(this.cleanupTimeout),this.renewalTimeout&&this.timer.clearTimeout(this.renewalTimeout),this.timer.close()}},{key:"processMessageNotification",value:function(e,t){var n=e.resourceData;switch(e.changeType){case"created":return void(null===t||void 0===t||t.chatMessageReceived(n));case"updated":return void(null===t||void 0===t||t.chatMessageEdited(n));case"deleted":return void(null===t||void 0===t||t.chatMessageDeleted(n));default:throw new Error("Unknown change type")}}},{key:"processMembershipNotification",value:function(e,t){var n=e.resourceData;switch(e.changeType){case"created":return void(null===t||void 0===t||t.participantAdded(n));case"deleted":return void(null===t||void 0===t||t.participantRemoved(n));default:throw new Error("Unknown change type")}}},{key:"processChatPropertiesNotification",value:function(e,t){var n=e.resourceData;switch(e.changeType){case"updated":return void(null===t||void 0===t||t.chatThreadPropertiesUpdated(n));case"deleted":return void(null===t||void 0===t||t.chatThreadDeleted(n));default:throw new Error("Unknown change type")}}},{key:"subscribeToResource",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n){var a,r,i,c,s,o;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=new Date((new Date).getTime()+60*q*1e3).toISOString(),r={changeType:n.join(","),notificationUrl:"".concat(z.webSocketsPrefix,"?groupId=").concat(G(this.chatId)),resource:t,expirationDateTime:a,includeResourceData:!0,clientState:"wsssecret"},(0,_.Yz)("subscribing to changes for "+t),i=z.subscriptionEndpoint,c=this.subscriptionGraph){e.next=8;break}return e.abrupt("return");case 8:return e.next=10,c.api(i).post(r);case 10:if(null!==(s=e.sent)&&void 0!==s&&s.notificationUrl){e.next=13;break}throw new Error("Subscription not created");case 13:return(0,_.Yz)(s),(o=[]).push(this.cacheSubscription(s)),this.connection||o.push(this.createSignalRConnection(s.notificationUrl)),(0,_.Yz)("Invoked CreateSubscription"),e.abrupt("return",Promise.all(o));case 21:return e.prev=21,e.t0=e.catch(0),e.abrupt("return",Promise.reject(e.t0));case 24:case"end":return e.stop()}}),e,this,[[0,21]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createSignalRConnection",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t){var n,a;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={accessTokenFactory:this.getToken,withCredentials:!1},(a=(new O.O).withUrl(z.adjustNotificationUrl(t,this.sessionId),n).withAutomaticReconnect().configureLogging(F.G.Information).build()).onreconnected(this.onReconnect),a.on("receivenotificationmessageasync",this.receiveNotificationMessage),a.on("EchoMessage",_.Yz),this.connection=a,e.prev=6,e.next=9,a.start();case 9:(0,_.Yz)(a),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(6),(0,_.e5)("An error occurred connecting to the notification web socket",e.t0);case 15:case"end":return e.stop()}}),e,this,[[6,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteSubscription",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t){var n;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(n=this.graph)||void 0===n?void 0:n.api("".concat(z.subscriptionEndpoint,"/").concat(t)).delete();case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),(0,_.e5)(e.t0);case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()},{key:"removeSubscriptions",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t){var n,a,r,i;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],a=(0,I.c)(t),e.prev=2,a.s();case 4:if((r=a.n()).done){e.next=11;break}if((i=r.value).id&&!(i.expirationDateTime&&new Date(i.expirationDateTime)<=new Date)){e.next=8;break}return e.abrupt("continue",9);case 8:n.push(this.deleteSubscription(i.id));case 9:e.next=4;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),a.e(e.t0);case 16:return e.prev=16,a.f(),e.finish(16);case 19:return e.abrupt("return",Promise.all(n));case 20:case"end":return e.stop()}}),e,this,[[2,13,16,19]])})));return function(t){return e.apply(this,arguments)}}()},{key:"startCleanupTimer",value:function(){this.cleanupTimeout=this.timer.setTimeout("cleanup:"+this.instanceId,this.cleanupTimerSync,1e3*J)}},{key:"closeSignalRConnection",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(){var t;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=this.connection)||void 0===t?void 0:t.stop();case 2:this.connection=void 0;case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"subscribeToChatNotifications",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n){var a,r,i,c,s,o=this;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.chatId=t,this.sessionId=n,e.next=4,this.subscriptionCache.loadSubscriptions(t);case 4:if(!(a=e.sent)){e.next=21;break}if(i=a.subscriptions.some((function(e){return e.expirationDateTime&&new Date(e.expirationDateTime)<=new Date})),c=null===(r=a.subscriptions.find((function(e){return e.notificationUrl})))||void 0===r?void 0:r.notificationUrl,i||!c){e.next=16;break}return e.next=11,this.createSignalRConnection(c);case 11:return e.next=13,this.renewChatSubscriptions();case 13:return e.abrupt("return");case 16:if(!i){e.next=19;break}return e.next=19,this.removeSubscriptions(a.subscriptions);case 19:return e.next=21,this.subscriptionCache.deleteCachedSubscriptions(t);case 21:return(s=[]).push(this.subscribeToResource("/chats/".concat(t,"/messages"),["created","updated","deleted"])),s.push(this.subscribeToResource("/chats/".concat(t,"/members"),["created","deleted"])),s.push(this.subscribeToResource("/chats/".concat(t),["updated","deleted"])),e.next=27,Promise.all(s).catch((function(e){null===o||void 0===o||o.emitter.graphNotificationClientError(e)}));case 27:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}()),ee=n(95864),te=n(7228),ne=n(98368),ae=n(95512),re=n(45516),ie=n(66064),ce=n(83516),se=n(71952),oe=n(95348),ue=n(53840),le=n(51624),de=n(61752),he=function(){var e,t;return N.M.globalProvider.state===de.i4.SignedIn?null===(e=(t=N.M.globalProvider).getActiveAccount)||void 0===e?void 0:e.call(t):void 0},pe=function(){var e;return(null===(e=he())||void 0===e?void 0:e.id.split(".")[0])||""},fe=function(e,t){var n;if(!e)throw new Error("Component name is required");return null===(n=N.M.globalProvider)||void 0===n?void 0:n.graph.forComponent(e,t)},me=function(e){return e.timeCached&&(Y.m.config.conversation.invalidationPeriod||Y.m.config.defaultInvalidationPeriod)>Date.now()-e.timeCached},ve=function(){function e(){(0,R.c)(this,e)}return(0,A.c)(e,[{key:"cache",get:function(){var e=V.I.conversation;return Y.m.getCache(e,e.stores.chats)}},{key:"loadMessages",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t){var n;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!W()){e.next=6;break}return e.next=3,this.cache.getValue(t);case 3:if(!(n=e.sent)||!me(n)){e.next=6;break}return e.abrupt("return",n);case 6:return e.abrupt("return",void 0);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"cacheMessages",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n){var a,r,i,c,s,o=this,u=arguments;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=u.length>2&&void 0!==u[2]&&u[2],r=u.length>3?u[3]:void 0,e.next=4,this.cache.getValue(t);case 4:if(i=e.sent){e.next=13;break}return c=n.reduce((function(e,t){return t.lastModifiedDateTime&&t.lastModifiedDateTime>e&&(e=t.lastModifiedDateTime),e}),""),s={chatId:t,value:n,lastModifiedDateTime:c,nextLink:r},e.next=10,this.cache.putValue(t,s);case 10:return e.abrupt("return",s);case 13:return n.forEach((function(e){return o.addMessageToCacheData(e,i)})),a&&(i.nextLink=r),e.next=17,this.cache.putValue(t,i);case 17:return e.abrupt("return",i);case 18:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"cacheMessage",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n){var a;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cache.getValue(t);case 2:if(a=e.sent){e.next=8;break}return e.next=6,this.cache.putValue(t,{chatId:t,value:[n],lastModifiedDateTime:n.lastModifiedDateTime||""});case 6:e.next=11;break;case 8:return this.addMessageToCacheData(n,a),e.next=11,this.cache.putValue(t,a);case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"addMessageToCacheData",value:function(e,t){var n,a=t.value.findIndex((function(t){return t.id===e.id}));-1!==a?t.value.splice(a,1,e):t.value.push(e),e.lastModifiedDateTime&&e.lastModifiedDateTime>(null!==(n=t.lastModifiedDateTime)&&void 0!==n?n:"")&&(t.lastModifiedDateTime=e.lastModifiedDateTime)}},{key:"deleteMessage",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n){var a,r;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cache.getValue(t);case 2:if(!(a=e.sent)){e.next=8;break}return r=a.value.findIndex((function(e){return e.id===n.id})),a.value.splice(r,1),e.next=8,this.cache.putValue(t,a);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),ge=n(65736),Ce=function(){function e(){(0,R.c)(this,e),(0,P.c)(this,"emitter",new ge.EventEmitter)}return(0,A.c)(e,[{key:"on",value:function(e,t){this.emitter.on(e,t)}},{key:"off",value:function(e,t){this.emitter.off(e,t)}},{key:"chatMessageReceived",value:function(e){this.emitter.emit("chatMessageReceived",e)}},{key:"chatMessageEdited",value:function(e){this.emitter.emit("chatMessageEdited",e)}},{key:"chatMessageDeleted",value:function(e){this.emitter.emit("chatMessageDeleted",e)}},{key:"typingIndicatorReceived",value:function(e){this.emitter.emit("typingIndicatorReceived",e)}},{key:"readReceiptReceived",value:function(e){this.emitter.emit("readReceiptReceived",e)}},{key:"chatThreadDeleted",value:function(e){this.emitter.emit("chatThreadDeleted",e)}},{key:"chatThreadPropertiesUpdated",value:function(e){this.emitter.emit("chatThreadPropertiesUpdated",e)}},{key:"participantAdded",value:function(e){this.emitter.emit("participantAdded",e)}},{key:"participantRemoved",value:function(e){this.emitter.emit("participantRemoved",e)}},{key:"notificationsSubscribedForResource",value:function(e){this.emitter.emit("notificationsSubscribedForResource",e)}},{key:"disconnected",value:function(){this.emitter.emit("disconnected")}},{key:"connected",value:function(){this.emitter.emit("connected")}},{key:"graphNotificationClientError",value:function(e){this.emitter.emit("graphNotificationClientError",e)}}]),e}(),be=n(85512),xe=n(62456),we=function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n){return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("/chats/".concat(n,"?$expand=members")).middlewareOptions((0,be.O)(m)).get();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ye=function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n){return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("/chats/".concat(n,"?$expand=members,lastMessagePreview")).middlewareOptions((0,be.O)(m)).get();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ke=function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n,a){var r,i;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("/chats/".concat(n,"/messages")).orderby("createdDateTime DESC").top(a).middlewareOptions((0,be.O)(v)).get();case 2:return(i=e.sent).nextLink=null===(r=i["@odata.nextLink"])||void 0===r?void 0:r.split(t.version)[1],e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),Se=function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n,a){var r;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("/chats/".concat(n,"/installedApps")).expand("teamsApp,teamsAppDefinition($expand=bot,colorIcon)").filter("teamsAppDefinition/bot/id+eq+'".concat(a,"'")).middlewareOptions((0,be.O)(S)).get();case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),Ee=function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n){var a;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("store"!==(null===(a=n.teamsApp)||void 0===a?void 0:a.distributionMethod)){e.next=2;break}return e.abrupt("return",Ie(n));case 2:return e.abrupt("return",Me(t,n));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Me=function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n){var a,r,i,c,s;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(a=n.teamsApp)||void 0===a||!a.id||null===(r=n.teamsAppDefinition)||void 0===r||!r.id){e.next=13;break}return i=n.teamsApp.id,c=n.teamsAppDefinition.id,e.next=5,t.api("/appCatalogs/teamsApps/".concat(i,"/appDefinitions/").concat(c,"/colorIcon/hostedContent/$value")).responseType(xe.Se.RAW).middlewareOptions((0,be.O)(E)).get();case 5:return s=e.sent,e.t0=le._K,e.next=9,s.blob();case 9:return e.t1=e.sent,e.next=12,(0,e.t0)(e.t1);case 12:return e.abrupt("return",e.sent);case 13:return e.abrupt("return","");case 14:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Ie=function(){var e=(0,D.c)((0,T.c)().mark((function e(t){var n,a;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(n=t.teamsAppDefinition)&&void 0!==n&&null!==(n=n.colorIcon)&&void 0!==n&&n.webUrl){e.next=2;break}return e.abrupt("return","");case 2:return e.next=4,fetch(t.teamsAppDefinition.colorIcon.webUrl);case 4:return a=e.sent,e.t0=le._K,e.next=8,a.blob();case 8:return e.t1=e.sent,e.next=11,(0,e.t0)(e.t1);case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Te=function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n,a,r){var i,c;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("/chats/".concat(n,"/messages")).filter("lastModifiedDateTime gt ".concat(a)).orderby("lastModifiedDateTime DESC").top(r).middlewareOptions((0,be.O)(v)).get();case 2:return(c=e.sent).nextLink=null===(i=c["@odata.nextLink"])||void 0===i?void 0:i.split(t.version)[1],e.abrupt("return",c);case 5:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),De=function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n){var a,r;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api(n).get();case 2:return(r=e.sent).nextLink=null===(a=r["@odata.nextLink"])||void 0===a?void 0:a.split(t.version)[1],e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Re=function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n){var a;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("/chats/".concat(n,"/installedApps")).filter("teamsAppDefinition/bot/id ne null").expand("teamsAppDefinition($expand=bot)").middlewareOptions((0,be.O)(S)).get();case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Ae=function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n,a){return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("/chats/".concat(n,"/messages")).middlewareOptions((0,be.O)(C)).post({body:{content:a}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),Pe=function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n,a,r){return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("/chats/".concat(n,"/messages/").concat(a)).middlewareOptions((0,be.O)(b)).patch({body:{content:r}});case 2:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),Ne=function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n,a){return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("/me/chats/".concat(n,"/messages/").concat(a,"/softDelete")).middlewareOptions((0,be.O)(x)).post({});case 2:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),_e=function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n,a){return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("/chats/".concat(n,"/members/").concat(a)).middlewareOptions((0,be.O)(w)).delete();case 2:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),Le=function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n,a,r){var i;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={requests:a.map((function(e,t){var a={"@odata.type":"#microsoft.graph.aadUserConversationMember","user@odata.bind":"https://graph.microsoft.com/v1.0/users/".concat(e),roles:["owner"]};return r&&(a.visibleHistoryStartDateTime=r.toISOString()),{id:t,method:"POST",url:"/chats/".concat(n,"/members"),headers:{"Content-Type":"application/json"},body:a}}))},e.next=3,t.api("$batch").middlewareOptions((0,be.O)(y)).post(i);case 3:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),Ue=function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n){var a,r,i,c,s,o;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Y.m.config.photos.isEnabled||!Y.m.config.isEnabled){e.next=7;break}return i=Y.m.getCache(le.Iv.photos,le.Iv.photos.stores.teams),e.next=4,i.getValue(n);case 4:if(a=e.sent,!(null!==(r=a)&&void 0!==r&&r.timeCached&&a.photo&&(0,le.sV)()>Date.now()-a.timeCached)){e.next=7;break}return e.abrupt("return",a.photo);case 7:return e.next=9,t.api(n).responseType(xe.Se.RAW).middlewareOptions((0,be.O)(g)).get();case 9:if(404!==(c=e.sent).status){e.next=14;break}a={eTag:void 0,photo:void 0},e.next=16;break;case 14:if(c.ok){e.next=16;break}return e.abrupt("return",null);case 16:return s=c["@odata.mediaEtag"],e.t0=le._K,e.next=20,c.blob();case 20:return e.t1=e.sent,e.next=23,(0,e.t0)(e.t1);case 23:return o=e.sent,a={eTag:s,photo:o},e.next=27,(0,le.eA)(n,le.Iv.photos.stores.teams,a);case 27:return e.abrupt("return",o);case 28:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Oe=function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n,a,r,i){var c,s;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c={chatType:a||n.length>2?"group":"oneOnOne",members:n.map((function(e){return{"@odata.type":"#microsoft.graph.aadUserConversationMember",roles:["owner"],"user@odata.bind":"https://graph.microsoft.com/v1.0/users('".concat(e,"')")}}))},a&&i&&(c.topic=i),e.next=4,t.api("/chats").middlewareOptions((0,be.O)(k)).post(c);case 4:if(null!==(s=e.sent)&&void 0!==s&&s.id){e.next=7;break}throw new Error("Chat id not returned from create chat thread");case 7:if(!r){e.next=10;break}return e.next=10,Ae(t,s.id,r);case 10:return e.abrupt("return",s);case 11:case"end":return e.stop()}}),e)})));return function(t,n,a,r,i){return e.apply(this,arguments)}}(),Fe=function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n,a){return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("/chats/".concat(n)).middlewareOptions((0,be.O)(b)).patch({topic:a});case 2:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),ze=function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n){return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("me/chats?$top=".concat(n,"&$expand=members,lastMessagePreview&orderby=lastMessagePreview/createdDateTime desc")).middlewareOptions((0,be.O)(m)).get();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Be=function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n){return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("me/chats?".concat(n)).middlewareOptions((0,be.O)(m)).get();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Ve=function(e,t,n,a){var r="".concat(n,"-").concat(t),i=new RegExp("(<img[^>]+id=[\"']".concat(r,"[\"'][^>]+)src=[\"']([^\"']*)[\"']")),c='$1src="'.concat(a,'"');return e.replace(i,c)},Ye=function(e){return"content"in e},We=/(<emoji[^>]+)alt=["'](\w*[^"']*)["'](.[^>]+)><\/emoji>/,je=function(e){return e.match(We)},He=function(e){return je(e)?function(e){for(var t=e,n=je(t);n;)t=t.replace(We,"$2"),n=je(t);return t}(e):e},Ze="botId::",Ge=n(20936),qe=function(){function e(){(0,R.c)(this,e),(0,P.c)(this,"_graph",void 0),(0,P.c)(this,"_subscribers",[])}return(0,A.c)(e,[{key:"graph",get:function(){var e;return this._graph||null!==(e=N.M.globalProvider)&&void 0!==e&&e.graph&&(this._graph=fe("mgt-chat",z.version)),this._graph},set:function(e){this._graph=e}},{key:"betaGraph",get:function(){var e=this.graph;if(e)return L.U.fromGraph(e)}},{key:"onStateChange",value:function(e){this._subscribers.includes(e)||this._subscribers.push(e)}},{key:"offStateChange",value:function(e){var t=this._subscribers.indexOf(e);-1!==t&&(this._subscribers=this._subscribers.splice(t,1))}},{key:"notifyStateChange",value:function(e){var t=this;this.state=(0,Ge.Ut)(this.state,e),this._subscribers.forEach((function(e){return e(t.state)}))}},{key:"getState",value:function(){return this.state}}]),e}(),$e=function(e,t){var n=["application/vnd.microsoft.card.codesnippet","application/vnd.microsoft.card.fluid","application/vnd.microsoft.card.fluidEmbedCard","reference"],a=[];if(t.length){var r,i=(0,I.c)(t);try{for(i.s();!(r=i.n()).done;){var c,s=r.value,o=null!==(c=null===s||void 0===s?void 0:s.contentType)&&void 0!==c?c:"";a.push(n.includes(o))}}catch(l){i.e(l)}finally{i.f()}}else{var u=Boolean(e)&&/<\/?attachment>/gim.test(e);a.push(u)}return a.every((function(e){return!0===e}))},Ke=function(e,t,n,a){var r,i,c,s,o,u,l,d,h,p,f,m,v,g,C,b=null!==(r=null!==(i=null===(c=e.from)||void 0===c||null===(c=c.user)||void 0===c?void 0:c.id)&&void 0!==i?i:null!==(C=null===(s=e.from)||void 0===s?void 0:s.application)&&void 0!==C&&C.id?"".concat(Ze).concat(C.id):void 0)&&void 0!==r?r:void 0,x=null!==(o=null===e||void 0===e?void 0:e.chatId)&&void 0!==o?o:"",w=null!==(u=null===e||void 0===e?void 0:e.id)&&void 0!==u?u:"",y="https://teams.microsoft.com/l/message/".concat(x,"/").concat(w,'?context={"contextType":"chat"}'),k=null!==(l=null===e||void 0===e?void 0:e.attachments)&&void 0!==l?l:[],S={messageId:n,contentType:null!==(d=null===(h=e.body)||void 0===h?void 0:h.contentType)&&void 0!==d?d:"text",messageType:"chat",content:a,senderDisplayName:null!==(p=null!==(f=null===(m=e.from)||void 0===m||null===(m=m.user)||void 0===m?void 0:m.displayName)&&void 0!==f?f:null===(v=e.from)||void 0===v||null===(v=v.application)||void 0===v?void 0:v.displayName)&&void 0!==p?p:void 0,createdOn:new Date(null!==(g=e.createdDateTime)&&void 0!==g?g:Date.now()),editedOn:e.lastEditedDateTime?new Date(e.lastEditedDateTime):void 0,senderId:b,mine:b===t,status:"seen",attached:"top",hasUnsupportedContent:$e(a,k),rawChatUrl:y};return null!==e&&void 0!==e&&e.policyViolation&&(S=Object.assign(S,{messageType:"blocked",link:"https://go.microsoft.com/fwlink/?LinkId=2132837"})),S},Qe=function(e){return"undefined"!==typeof(null===e||void 0===e?void 0:e.members)},Je=function(e,t){return e.createdOn.getTime()-t.createdOn.getTime()},Xe=function(e,t){return e.createdDateTime&&t.createdDateTime?e.createdDateTime===t.createdDateTime?0:e.createdDateTime>t.createdDateTime?1:-1:e.createdDateTime?1:-1},et=/(<img[^>]+)src=(["']https:\/\/graph\.microsoft\.com[^"']*["'])/,tt=function(e){function t(){var e;return(0,R.c)(this,t),e=(0,se.c)(this,t),(0,P.c)((0,oe.c)(e),"_eventEmitter",void 0),(0,P.c)((0,oe.c)(e),"_cache",void 0),(0,P.c)((0,oe.c)(e),"_notificationClient",void 0),(0,P.c)((0,oe.c)(e),"_nextLink",void 0),(0,P.c)((0,oe.c)(e),"_chat",void 0),(0,P.c)((0,oe.c)(e),"_userDisplayName",""),(0,P.c)((0,oe.c)(e),"onLoginStateChanged",(function(t){switch(t.detail){case de.i4.SignedIn:return e.updateUserInfo(),e.tryCreateGraphNotificationClient(),void(e.chatId&&e.updateFollowedChat());case de.i4.SignedOut:case de.i4.Loading:default:return}})),(0,P.c)((0,oe.c)(e),"onActiveAccountChanged",(function(t){var n;t.detail&&e.userId!==(null===(n=t.detail)||void 0===n?void 0:n.id)&&e.handleAccountChange()})),(0,P.c)((0,oe.c)(e),"handleAccountChange",(0,D.c)((0,T.c)().mark((function t(){var n;return(0,T.c)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.clearCurrentUserMessages(),t.next=3,null===(n=e._notificationClient)||void 0===n?void 0:n.closeSignalRConnection();case 3:return e.updateUserInfo(),t.next=6,e.updateFollowedChat();case 6:case"end":return t.stop()}}),t)})))),(0,P.c)((0,oe.c)(e),"_userId",""),(0,P.c)((0,oe.c)(e),"_chatId",""),(0,P.c)((0,oe.c)(e),"_sessionId",void 0),(0,P.c)((0,oe.c)(e),"resolveIcon",(function(e){switch(e){case"#microsoft.graph.membersAddedEventMessageDetail":return"add-friend";case"#microsoft.graph.membersDeletedEventMessageDetail":return"left-chat";case"#microsoft.graph.chatRenamedEventMessageDetail":return"edit-svg";default:return"Unknown"}})),(0,P.c)((0,oe.c)(e),"loadMoreMessages",(0,D.c)((0,T.c)().mark((function t(){var n;return(0,T.c)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e._nextLink){t.next=2;break}return t.abrupt("return",!0);case 2:if(e.graph){t.next=5;break}throw e.notifyStateChange((function(e){e.status="error",e.activeErrorMessages.push(new Error("Graph client not available"))})),new Error("Graph client not available");case 5:return t.next=7,De(e.graph,e._nextLink);case 7:return n=t.sent,t.next=10,e._cache.cacheMessages(e._chatId,n.value,!0,n.nextLink);case 10:return t.next=12,e.writeMessagesToState(n);case 12:return t.abrupt("return",!e._nextLink);case 13:case"end":return t.stop()}}),t)})))),(0,P.c)((0,oe.c)(e),"sendMessage",function(){var t=(0,D.c)((0,T.c)().mark((function t(n){var a,r;return(0,T.c)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return");case 2:if(e.graph){t.next=5;break}return e.notifyStateChange((function(e){e.status="error",e.activeErrorMessages.push(new Error("Graph client not available"))})),t.abrupt("return");case 5:return a=(0,Z.c)(),e.notifyStateChange((function(t){var r={clientMessageId:a,messageId:a,contentType:"text",messageType:"chat",content:n,senderDisplayName:e._userDisplayName,createdOn:new Date,senderId:e.userId,mine:!0,status:"sending"};t.messages.push(r)})),t.prev=7,t.next=10,Ae(e.graph,e.chatId,n);case 10:r=t.sent,e.notifyStateChange((function(t){var n=t.messages.findIndex((function(e){return e.messageId===a})),i=e.graphChatMessageToAcsChatMessage(r,e.userId).currentValue;i&&t.messages.splice(n,1,i)})),t.next=18;break;case 14:throw t.prev=14,t.t0=t.catch(7),e.notifyStateChange((function(e){e.messages.find((function(e){return e.messageId===a})).status="failed"})),new Error("Failed to send message");case 18:case"end":return t.stop()}}),t,null,[[7,14]])})));return function(e){return t.apply(this,arguments)}}()),(0,P.c)((0,oe.c)(e),"setDeletedContent",(function(e){e.content="<em>This message has been deleted.</em>",e.contentType="html"})),(0,P.c)((0,oe.c)(e),"deleteMessage",function(){var t=(0,D.c)((0,T.c)().mark((function t(n){var a,r;return(0,T.c)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return");case 2:if(e.graph){t.next=5;break}return e.notifyStateChange((function(e){e.status="error",e.activeErrorMessages.push(new Error("Graph client not available"))})),t.abrupt("return");case 5:if(a=e.state.messages.find((function(e){return e.messageId===n})),r=e.state.messages.find((function(e){return e.clientMessageId===n})),null===a||void 0===a||!a.mine){t.next=17;break}if(t.prev=8,r){t.next=12;break}return t.next=12,Ne(e.graph,e.chatId,n);case 12:e.notifyStateChange((function(t){var a=t.messages.find((function(e){return e.messageId===n}));a.clientMessageId?t.messages.splice(t.messages.indexOf(a),1):e.setDeletedContent(a)})),t.next=17;break;case 15:t.prev=15,t.t0=t.catch(8);case 17:case"end":return t.stop()}}),t,null,[[8,15]])})));return function(e){return t.apply(this,arguments)}}()),(0,P.c)((0,oe.c)(e),"updateMessage",function(){var t=(0,D.c)((0,T.c)().mark((function t(n,a){var r;return(0,T.c)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n&&a){t.next=2;break}return t.abrupt("return");case 2:if(e.graph){t.next=5;break}return e.notifyStateChange((function(e){e.status="error",e.activeErrorMessages.push(new Error("Graph client not available"))})),t.abrupt("return");case 5:if(null===(r=e.state.messages.find((function(e){return e.messageId===n})))||void 0===r||!r.mine||!r.content){t.next=18;break}return e.notifyStateChange((function(e){var t=e.messages.find((function(e){return e.messageId===n}));t&&(t.content=a,t.status="sending")})),t.prev=8,t.next=11,Pe(e.graph,e.chatId,n,a);case 11:e.notifyStateChange((function(e){e.messages.find((function(e){return e.messageId===n})).status="delivered"})),t.next=18;break;case 14:throw t.prev=14,t.t0=t.catch(8),e.notifyStateChange((function(e){e.messages.find((function(e){return e.messageId===n})).status="failed"})),new Error("Failed to update message");case 18:case"end":return t.stop()}}),t,null,[[8,14]])})));return function(e,n){return t.apply(this,arguments)}}()),(0,P.c)((0,oe.c)(e),"onMessageReceived",function(){var t=(0,D.c)((0,T.c)().mark((function t(n){var a,r,i;return(0,T.c)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.updateMentions(n),t.next=3,e._cache.cacheMessage(e._chatId,n);case 3:if(a=e.convertChatMessage(n),r=a.currentValue,e.updateMessages(r),!a.futureValue){t.next=11;break}return t.next=9,a.futureValue;case 9:i=t.sent,e.updateMessages(i);case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),(0,P.c)((0,oe.c)(e),"updateMentions",(function(t){t&&e.notifyStateChange((function(e){var n,a,r=null!==(n=null===t||void 0===t?void 0:t.mentions)&&void 0!==n?n:[];e.mentions=null===(a=e.mentions)||void 0===a?void 0:a.concat.apply(a,(0,ce.c)(Array.from(r)))}))})),(0,P.c)((0,oe.c)(e),"onMessageDeleted",(function(t){e._cache.deleteMessage(e.chatId,t),e.notifyStateChange((function(n){var a=n.messages.find((function(e){return e.messageId===t.id}));a&&e.setDeletedContent(a)}))})),(0,P.c)((0,oe.c)(e),"onMessageEdited",function(){var t=(0,D.c)((0,T.c)().mark((function t(n){var a,r;return(0,T.c)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._cache.cacheMessage(e._chatId,n);case 2:if(a=e.convertChatMessage(n),e.updateMessages(a.currentValue),!a.futureValue){t.next=9;break}return t.next=7,a.futureValue;case 7:r=t.sent,e.updateMessages(r);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),(0,P.c)((0,oe.c)(e),"checkForMissedMessages",(0,D.c)((0,T.c)().mark((function t(){var n,a,r,i;return(0,T.c)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.graph){t.next=3;break}return e.notifyStateChange((function(e){e.status="error",e.activeErrorMessages.push(new Error("Graph client not available"))})),t.abrupt("return");case 3:return t.next=5,ke(e.graph,e.chatId,e._messagesPerCall);case 5:if(n=t.sent,a=n.value.filter((function(e){var t,n;return(null===(t=e.body)||void 0===t?void 0:t.content)||!(null!==(n=e.body)&&void 0!==n&&n.content)&&(null===e||void 0===e?void 0:e.policyViolation)})).map((function(t){return e.convertChatMessage(t)})),r=[],a.map((function(e){return e.currentValue})).reduce((function(e,t){return t&&e.push(t),e}),r),r.forEach((function(t){return e.updateMessages(t)})),!((i=a.filter((function(e){return e.futureValue})).map((function(e){return e.futureValue}))).length>0)){t.next=15;break}return t.next=14,Promise.all(i);case 14:t.sent.forEach((function(t){e.updateMessages(t)}));case 15:n.value.some((function(t){return e.state.messages.find((function(e){return e.messageId===t.id}))})),(0,_.Yz)("checked for missed messages");case 18:case"end":return t.stop()}}),t)})))),(0,P.c)((0,oe.c)(e),"onChatNotificationsSubscribed",(function(t){t.includes("/".concat(e.chatId,"/"))&&t.includes("/messages")&&e.checkForMissedMessages()})),(0,P.c)((0,oe.c)(e),"onChatPropertiesUpdated",(function(t){e._chat=t,e.notifyStateChange((function(e){e.chat=t}))})),(0,P.c)((0,oe.c)(e),"onParticipantAdded",(function(t){e.notifyStateChange((function(e){e.participants.find((function(e){return e.id===t.id}))||e.participants.push(t)}))})),(0,P.c)((0,oe.c)(e),"onParticipantRemoved",(function(t){t.id&&e.removeParticipantFromState(t.id)})),(0,P.c)((0,oe.c)(e),"addChatMembers",function(){var t=(0,D.c)((0,T.c)().mark((function t(n,a){return(0,T.c)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.graph){t.next=3;break}return e.notifyStateChange((function(e){e.status="error",e.activeErrorMessages.push(new Error("Graph client not available"))})),t.abrupt("return");case 3:return t.next=5,Le(e.graph,e.chatId,n,a);case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()),(0,P.c)((0,oe.c)(e),"removeChatMember",function(){var t=(0,D.c)((0,T.c)().mark((function t(n){var a,r;return(0,T.c)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return");case 2:if(e.graph){t.next=5;break}return e.notifyStateChange((function(e){e.status="error",e.activeErrorMessages.push(new Error("Graph client not available"))})),t.abrupt("return");case 5:if(-1!==(null!==(a=null===(r=e._chat)||void 0===r||null===(r=r.members)||void 0===r?void 0:r.findIndex((function(e){return e.id===n})))&&void 0!==a?a:-1)){t.next=8;break}return t.abrupt("return");case 8:return t.next=10,_e(e.graph,e.chatId,n);case 10:e.removeParticipantFromState(n);case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),(0,P.c)((0,oe.c)(e),"renameChat",function(){var t=(0,D.c)((0,T.c)().mark((function t(n){return(0,T.c)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.graph){t.next=3;break}return e.notifyStateChange((function(e){e.status="error",e.activeErrorMessages.push(new Error("Graph client not available"))})),t.abrupt("return");case 3:return t.next=5,Fe(e.graph,e.chatId,n);case 5:e.notifyStateChange((function(){e._chat=(0,r.c)((0,r.c)({},e._chat),{topic:n})}));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),(0,P.c)((0,oe.c)(e),"onGraphNotificationClientError",(function(t){e.updateErrorState(t)})),(0,P.c)((0,oe.c)(e),"updateErrorState",(function(t){null!==t&&void 0!==t&&t.message?(0,_.e5)(null===t||void 0===t?void 0:t.message):(0,_.e5)("an unknown error occurred",t),e.notifyStateChange((function(e){e.status="error",e.activeErrorMessages=[t],e.chat={topic:"Unknown"}}))})),(0,P.c)((0,oe.c)(e),"_initialState",{status:"initial",userId:"",messages:[],mentions:[],participants:[],get participantCount(){var e;return(null===(e=this.participants)||void 0===e?void 0:e.length)||0},disableEditing:!1,numberOfChatMessagesToReload:e._messagesPerCall,onDeleteMessage:e.deleteMessage,onSendMessage:e.sendMessage,onUpdateMessage:e.updateMessage,onAddChatMembers:e.addChatMembers,onRemoveChatMember:e.removeChatMember,onRenameChat:e.renameChat,activeErrorMessages:[],chat:e._chat}),(0,P.c)((0,oe.c)(e),"state",(0,r.c)({},e._initialState)),e.updateUserInfo(),N.M.globalProvider.onStateChanged(e.onLoginStateChanged),N.M.globalProvider.onActiveAccountChanged(e.onActiveAccountChanged),e._eventEmitter=new Ce,e.registerEventListeners(),e._cache=new ve,e.tryCreateGraphNotificationClient(),e}return(0,ue.c)(t,e),(0,A.c)(t,[{key:"_messagesPerCall",get:function(){return 5}},{key:"tryCreateGraphNotificationClient",value:function(){try{if(this.graph&&this._notificationClient)return;if(this.graph=fe("mgt-chat",z.version),!this.graph)return;this._notificationClient=new X(this._eventEmitter,this.graph)}catch(e){}}},{key:"tearDown",value:function(){var e;null===(e=this._notificationClient)||void 0===e||e.tearDown()}},{key:"clearCurrentUserMessages",value:function(){this.notifyStateChange((function(e){e.messages=[],e.participants=[],e.chat=void 0,e.status="initial"}))}},{key:"updateUserInfo",value:function(){this.updateCurrentUserId(),this.updateCurrentUserName()}},{key:"updateCurrentUserName",value:function(){this._userDisplayName=function(){var e;return(null===(e=he())||void 0===e?void 0:e.name)||""}()}},{key:"updateCurrentUserId",value:function(){this.userId=pe()}},{key:"userId",get:function(){return this._userId},set:function(e){this._userId!==e&&(this._userId=e,this.notifyStateChange((function(t){t.userId=e})))}},{key:"chatId",get:function(){return this._chatId},set:function(e){e&&this._chatId===e||(this._chatId=e,this._chatId&&this._sessionId&&this.updateFollowedChat())}},{key:"subscribeToChat",value:function(e,t){e&&t&&(this._sessionId=t,this.chatId=e)}},{key:"setStatus",value:function(e){this.notifyStateChange((function(t){t.status=e,t.chat={topic:"Unknown"}}))}},{key:"updateFollowedChat",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(){var t;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.chatId||!this._sessionId){e.next=16;break}if(this.notifyStateChange((function(e){e.status="initial",e.messages=[],e.mentions=[],e.chat=void 0,e.participants=[],e.activeErrorMessages=[]})),this.notifyStateChange((function(e){e.status="creating server connections"})),e.prev=3,t=[this.loadChatData()],!this._notificationClient){e.next=9;break}return t.push(this._notificationClient.subscribeToChatNotifications(this._chatId,this._sessionId)),e.next=9,Promise.all(t);case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),this.updateErrorState(e.t0);case 14:e.next=17;break;case 16:this.notifyStateChange((function(e){e.status="no chat id",e.chat={topic:"Unknown"}}));case 17:case"end":return e.stop()}}),e,this,[[3,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadChatData",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(){var t,n,a,r;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.graph){e.next=3;break}return this.notifyStateChange((function(e){e.status="error",e.activeErrorMessages.push(new Error("Graph client not available"))})),e.abrupt("return");case 3:return this.notifyStateChange((function(e){e.status="loading messages"})),e.prev=4,e.next=7,we(this.graph,this.chatId);case 7:this._chat=e.sent,e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(4),e.abrupt("return",Promise.reject(e.t0));case 13:return e.next=15,this._cache.loadMessages(this._chatId);case 15:if(!(t=e.sent)){e.next=30;break}return e.next=19,this.writeMessagesToState(t);case 19:return e.next=21,this.loadDeltaData(this._chatId,t.lastModifiedDateTime);case 21:return n=e.sent,e.next=24,this._cache.cacheMessages(this._chatId,n);case 24:return(a=e.sent).value=n,e.next=28,this.writeMessagesToState(a);case 28:e.next=37;break;case 30:return e.next=32,ke(this.graph,this._chatId,this._messagesPerCall);case 32:return r=e.sent,e.next=35,this._cache.cacheMessages(this._chatId,r.value,!0,r.nextLink);case 35:return e.next=37,this.writeMessagesToState(r);case 37:case"end":return e.stop()}}),e,this,[[4,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadDeltaData",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n){var a,r;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.graph){e.next=3;break}throw this.notifyStateChange((function(e){e.status="error",e.activeErrorMessages.push(new Error("Graph client not available"))})),new Error("Graph client not available");case 3:return a=[],e.next=6,Te(this.graph,t,n,this._messagesPerCall);case 6:r=e.sent,a.push.apply(a,(0,ce.c)(r.value));case 8:if(!r.nextLink){e.next=15;break}return e.next=11,De(this.graph,r.nextLink);case 11:r=e.sent,a.push.apply(a,(0,ce.c)(r.value)),e.next=8;break;case 15:return e.abrupt("return",a.sort(Xe));case 16:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"writeMessagesToState",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t){var n,a,r,i=this;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._nextLink=t.nextLink,n=t.value.filter((function(e){var t;return null===(t=e.body)||void 0===t?void 0:t.content})).map((function(e){return i.convertChatMessage(e)})),a=t.value.map((function(e){return e.mentions})).filter((function(e){return null===e||void 0===e?void 0:e.length})),this.notifyStateChange((function(e){var t,r;e.participants=(null===(t=i._chat)||void 0===t?void 0:t.members)||[],e.participantCount=e.participants.length;e.messages=e.messages.concat(n.map((function(e){return e.currentValue})).reduce((function(e,t){return t&&e.push(t),e}),[])).sort(Je),e.onLoadPreviousChatMessages=i._nextLink?i.loadMoreMessages:void 0,e.status=i._nextLink?"loading messages":e.messages.length?"ready":"no messages",e.chat=i._chat,e.mentions=null===(r=e.mentions)||void 0===r?void 0:r.concat.apply(r,(0,ce.c)(Array.from(a)))})),!((r=n.filter((function(e){return e.futureValue})).map((function(e){return e.futureValue}))).length>0)){e.next=9;break}return e.next=8,Promise.all(r);case 8:e.sent.forEach((function(e){i.updateMessages(e)}));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"convertChatMessage",value:function(e){var t;switch(e.messageType){case"message":return this.graphChatMessageToAcsChatMessage(e,this.userId);case"systemEventMessage":case"unknownFutureValue":return{futureValue:this.buildSystemContentMessage(e)};default:throw new Error("Unknown message type ".concat((null===(t=e.messageType)||void 0===t?void 0:t.toString())||"undefined"))}}},{key:"buildSystemContentMessage",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t){var n,a,r,i,c,s,o,u,l,d,h,p,f,m,v=this;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.graph){e.next=3;break}throw this.notifyStateChange((function(e){e.status="error",e.activeErrorMessages.push(new Error("Graph client not available"))})),new Error("Graph client not available");case 3:if(a=t.eventDetail,r="",i=[],!(c=null===(n=a.initiator)||void 0===n||null===(n=n.user)||void 0===n?void 0:n.id)){e.next=27;break}for(i.push((0,le.CC)(this.graph,c)),s=[],Qe(a)&&(null===(o=a.members)||void 0===o||o.reduce((function(e,t){return"string"===typeof t.id&&e.push(t.id),e}),s)),u=0,l=null!==s&&void 0!==s?s:[];u<l.length;u++)d=l[u],i.push((0,le.CC)(this.graph,d));return e.next=14,Promise.all(i);case 14:h=e.sent,p=null===s||void 0===s?void 0:s.filter((function(e){return e!==c})).map((function(e){return v.getUserName(e,h)})).join(", "),f=this.getUserName(c,h),e.t0=a["@odata.type"],e.next="#microsoft.graph.membersAddedEventMessageDetail"===e.t0?20:"#microsoft.graph.membersDeletedEventMessageDetail"===e.t0?22:"#microsoft.graph.chatRenamedEventMessageDetail"===e.t0?24:26;break;case 20:return r="".concat(f," added ").concat(p),e.abrupt("break",27);case 22:return r="".concat(f," removed ").concat(p),e.abrupt("break",27);case 24:return r=a.chatDisplayName?"".concat(f," renamed the chat to ").concat(a.chatDisplayName):"".concat(f," removed the group name for this conversation"),e.abrupt("break",27);case 26:(0,_.mo)("Unknown system message type ".concat(a["@odata.type"],"\n\ndetail: ").concat(JSON.stringify(a)));case 27:return m={createdOn:t.createdDateTime?new Date(t.createdDateTime):new Date,messageId:t.id||"",systemMessageType:"content",messageType:"system",iconName:this.resolveIcon(a["@odata.type"]),content:r},e.abrupt("return",m);case 29:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUserName",value:function(e,t){var n;return(null===(n=t.find((function(t){return t.id===e})))||void 0===n?void 0:n.displayName)||"unknown user"}},{key:"updateMessages",value:function(e){e&&this.notifyStateChange((function(t){var n=t.messages.findIndex((function(t){return t.messageId===e.messageId}));-1===n?t.messages=t.messages.concat(e).sort(Je):t.messages.splice(n,1,e)}))}},{key:"removeParticipantFromState",value:function(e){this.notifyStateChange((function(t){var n=t.participants.findIndex((function(t){return t.id===e}));-1!==n&&t.participants.splice(n,1)}))}},{key:"graphImageMatch",value:function(e){return e.match(et)}},{key:"processMessageContent",value:function(e,t){var n,i,c;if(!this.graph)throw this.notifyStateChange((function(e){e.status="error",e.activeErrorMessages.push(new Error("Graph client not available"))})),new Error("Graph client not available");for(var s={},o={},u=null!==(n=null===(i=e.body)||void 0===i?void 0:i.content)&&void 0!==n?n:"",l=null!==(c=e.id)&&void 0!==c?c:"",d=0,h=this.graphImageMatch(u);h;){u=u.replace(et,'$1id="'.concat(l,"-").concat(d,'" src="').concat("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAMSURBVBhXY7h58yYABRoCjB9qX5UAAAAASUVORK5CYII=",'"'));var p=h[2].replace(/["']/g,"");o[d]=Ue(this.graph,p),d++,h=this.graphImageMatch(u)}var f=Ke(e,t,l,u);s.currentValue=f;var m=function(){var e=(0,D.c)((0,T.c)().mark((function e(){var t,n,i,c,s,u,d;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(Object.values(o));case 2:t=0,n=Object.entries(o);case 3:if(!(t<n.length)){e.next=12;break}return i=(0,a.c)(n[t],2),c=i[0],s=i[1],e.next=7,s;case 7:(u=e.sent)&&Ye(f)&&(f=(0,r.c)((0,r.c)({},f),{content:Ve(null!==(d=f.content)&&void 0!==d?d:"",c,l,u)}));case 9:t++,e.next=3;break;case 12:return e.abrupt("return",f);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return s.futureValue=m(),s}},{key:"graphChatMessageToAcsChatMessage",value:function(e,t){var n,a,r,i,c=null!==(n=null===e||void 0===e?void 0:e.id)&&void 0!==n?n:"";if(!c)throw new Error("Cannot convert graph message to ACS message. No ID found on graph message");var s=null!==(a=null===(r=e.body)||void 0===r?void 0:r.content)&&void 0!==a?a:"undefined",o={};return s=function(e){return e.replace(/&nbsp;<at/gim,"<at").replace(/at>&nbsp;/gim,"at>").replace(/<at\sid="(\d+)">([a-z0-9_.-\s]+)<\/at>/gim,'<msft-mention id="$1">$2</msft-mention>')}(s=function(e){var t,n=(new DOMParser).parseFromString(e,"text/html"),a=n.querySelectorAll("emoji"),r=a.length,i=r>1||function(e,t){var n;if("P"===(null===(n=e.body.firstChild)||void 0===n?void 0:n.nodeName)){var a,r=null===(a=e.body.firstChild)||void 0===a?void 0:a.childNodes;return(null===r||void 0===r?void 0:r.length)!==t}return!1}(n,r)?20:50,c=(0,I.c)(a);try{for(c.s();!(t=c.n()).done;){var s,o,u,l=t.value,d=null!==(s=l.getAttribute("id"))&&void 0!==s?s:"",h=null!==(o=l.getAttribute("alt"))&&void 0!==o?o:"",p=null!==(u=l.getAttribute("title"))&&void 0!==u?u:"",f=document.createElement("span");f.setAttribute("title",p),f.setAttribute("type","(".concat(d,")")),f.setAttribute("class","animated-emoticon-".concat(i,"-cool"));var m=document.createElement("img");m.setAttribute("itemscope",""),m.setAttribute("itemtype","http://schema.skype.com/Emoji"),m.setAttribute("itemid",d),m.setAttribute("src","https://statics.teams.cdn.office.net/evergreen-assets/personal-expressions/v2/assets/emoticons/".concat(d,"/default/").concat(i,"_f.png")),m.setAttribute("title",p),m.setAttribute("alt",h),m.setAttribute("style","width:".concat(i,"px;height:").concat(i,"px;")),f.appendChild(m),l.replaceWith(f)}}catch(v){c.e(v)}finally{c.f()}return n.body.innerHTML}(s)),this.graphImageMatch(null!==(i=s)&&void 0!==i?i:"")?o=this.processMessageContent(e,t):o.currentValue=Ke(e,t,c,s),o}},{key:"registerEventListeners",value:function(){var e=this;this._eventEmitter.on("chatMessageReceived",(function(t){e.onMessageReceived(t)})),this._eventEmitter.on("chatMessageDeleted",this.onMessageDeleted),this._eventEmitter.on("chatMessageEdited",(function(t){e.onMessageEdited(t)})),this._eventEmitter.on("notificationsSubscribedForResource",this.onChatNotificationsSubscribed),this._eventEmitter.on("chatThreadPropertiesUpdated",this.onChatPropertiesUpdated),this._eventEmitter.on("participantAdded",this.onParticipantAdded),this._eventEmitter.on("participantRemoved",this.onParticipantRemoved),this._eventEmitter.on("graphNotificationClientError",this.onGraphNotificationClientError)}}]),t}(qe),nt=n(95600),at=n(81408),rt=(0,s.a)({container:(0,r.c)((0,r.c)((0,r.c)((0,r.c)((0,r.c)({backgroundColor:"#ebebeb",display:"flex",boxShadow:"0px 4px 8px 0px rgba(0, 0, 0, 0.14), 0px 0px 2px 0px rgba(0, 0, 0, 0.12)",textDecorationLine:"none",color:"#424242"},o.uS.margin("18px","0px","8px","0px")),o.uS.borderRadius("6px")),o.uS.padding("16px")),o.uS.gap("6px")),{},{":hover":{backgroundColor:"#fafafa"},":visited":{color:"#424242"}}),cta:{fontFamily:"Segoe UI",fontSize:"12px",fontStyle:"normal",fontWeight:"400",lineHeight:"16px",textDecorationLine:"none"}}),it=function(e){var t=rt();return i.createElement("a",{className:t.container,target:"blank",href:e.targetUrl},i.createElement(at.WqB,null),i.createElement("p",{className:t.cta},"View this message in Microsoft Teams."))},ct=function(e,t){var n,a,r=null===(n=e)||void 0===n?void 0:n.message;if("content"in(a=r)&&"hasUnsupportedContent"in a&&"rawChatUrl"in a&&null!==r&&void 0!==r&&r.hasUnsupportedContent){var c=i.createElement(it,{targetUrl:r.rawChatUrl});e=(0,Ge.cp)(e,(function(e){Ye(e.message)&&(e.message.content=(0,nt.renderToString)(c))}))}return t?t(e):i.createElement(i.Fragment,null)},st=n(37992),ot=function(e){return"".concat(null===e||void 0===e?void 0:e.id,"-").concat(null===e||void 0===e?void 0:e.displayText)},ut=function(e){return function(t,n){var a,r,c=n(t),s=(null!==(a=null===e||void 0===e?void 0:e.mentions)&&void 0!==a?a:[]).flat().find((function(e){var n;return(null===(n=e.id)||void 0===n?void 0:n.toString())===(null===t||void 0===t?void 0:t.id)&&e.mentionText===(null===t||void 0===t?void 0:t.displayText)})),o=null===s||void 0===s||null===(r=s.mentioned)||void 0===r?void 0:r.user;if(o){var u=(null===o||void 0===o?void 0:o.id)===e.userId?function(e){return n(t)}:function(){return i.createElement("p",{className:"otherMention"},t.displayText)};c=i.createElement(st.u,{className:"mgt-person-mention",userId:null===o||void 0===o?void 0:o.id,personCardInteraction:"hover"},i.createElement(u,null))}return c=i.createElement("span",{key:ot(t)},c,"\xa0")}},lt=n(42216),dt=n(57496),ht="button-icon",pt="icon",ft="icon-filled",mt="icon-unfilled",vt=((0,dt.gR)({width:"18px",height:"18px"}),"#616161"),gt="#5b5fc7",Ct=(0,dt.s$)({button:[ht,{}],icon:[pt,(0,P.c)({fill:vt},".".concat(ht,":hover &"),{fill:gt,color:gt})],iconFilled:[ft,(0,P.c)({display:"none"},".".concat(ht,":hover &"),{display:"block"})],iconUnfilled:[mt,(0,P.c)({display:"block"},".".concat(ht,":hover &"),{display:"none"})]}),bt=n(56096),xt=(0,i.createContext)(void 0),wt=function(){var e=(0,i.useContext)(xt),t=(0,i.useState)((function(){return null===e||void 0===e?void 0:e.getState()})),n=(0,a.c)(t,2),r=n[0],c=n[1];return(0,i.useEffect)((function(){if(e)return e.onStateChange(c),function(){return e.offStateChange(c)}}),[e]),r},yt=function(e){var t,n=e.chatId,a=e.avatarId,r=e.view,c=void 0===r?"image":r,s=wt();return(0,i.useEffect)((function(){!n||!a||null!==s&&void 0!==s&&s.botInfo.has(a)||null===s||void 0===s||s.loadBotInfo(n,a)}),[n,a,s]),i.createElement("div",null,i.createElement(st.u,{personDetails:{id:a,displayName:null!==s&&void 0!==s&&s.botInfo.has(a)?null===(t=s.botInfo.get(a))||void 0===t||null===(t=t.teamsAppDefinition)||void 0===t?void 0:t.displayName:"",personImage:null!==s&&void 0!==s&&s.botIcons.has(a)?s.botIcons.get(a):""},avatarSize:"small",personCardInteraction:"none",view:c,showPresence:!1}))},kt=(0,i.memo)((function(e){var t=e.chatId,n=e.avatarId;return n.startsWith(Ze)?i.createElement(yt,{chatId:t,avatarId:n.replace(Ze,"")}):i.createElement(st.u,{userId:n,avatarSize:"small",personCardInteraction:"hover",showPresence:!0})})),St=n(63920),Et=n(44600),Mt=(0,s.a)({row:{paddingInlineStart:"20px"}}),It=(0,s.a)({person:{"--person-avatar-size":"32px","--person-alignment":"center"}}),Tt=function(e){var t=e.chat,n=e.currentUserId,a=wt(),r=It(),c=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return null===e||void 0===e||null===(t=e.members)||void 0===t||null===(t=t.find((function(e){return e.userId!==n})))||void 0===t?void 0:t.userId}(t,n);return null!==t&&void 0!==t&&t.id?c?i.createElement(st.u,{className:r.person,userId:c,view:"oneline",avatarSize:"small",personCardInteraction:"hover",showPresence:!0}):null!==a&&void 0!==a&&a.chatBots.has(t.id)?i.createElement(i.Fragment,null,Array.from(a.chatBots.get(t.id)).map((function(e){var n;return null!==(n=e.teamsAppDefinition)&&void 0!==n&&null!==(n=n.bot)&&void 0!==n&&n.id?i.createElement(yt,{key:e.teamsAppDefinition.bot.id,chatId:t.id,avatarId:e.teamsAppDefinition.bot.id,view:"oneline"}):null}))):null:null},Dt=n(18556),Rt=n(27880),At=n(54912),Pt=n(41156),Nt=n(38424),_t=n(92636),Lt=n(15360),Ut=n(92984),Ot=n(15628),Ft=n(60068),zt=n(78072),Bt=(0,s.a)({container:(0,r.c)((0,r.c)((0,r.c)({},o.uS.border("1px solid var(--colorBrandBackground2)")),o.uS.overflow("hidden")),o.uS.borderRadius("50%")),background:{display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"var(--colorBrandBackground2)"}}),Vt=function(e){var t=e.height,n=e.width,a=e.children,r=Bt(),c={height:null!==t&&void 0!==t?t:"32px",width:null!==n&&void 0!==n?n:"32px"};return i.createElement("span",{className:r.container,style:c},i.createElement("span",{className:r.background,style:c},a))},Yt=(0,Dt.c)(Ft.e3p,Ft.e3p),Wt=(0,Dt.c)(zt.WBj,zt.WBj),jt=(0,Dt.c)(zt.It9,zt.I5e),Ht=function(e){var t="var(--colorBrandForeground2)";switch(e.chatType){case"group":return i.createElement(Vt,null,i.createElement(Wt,{color:t}));case"meeting":return i.createElement(Vt,null,i.createElement(Yt,{color:t}));default:return i.createElement(Vt,null,i.createElement(jt,{color:t}))}},Zt=(0,Dt.c)(Rt.KE1,Rt.IX1),Gt=(0,s.a)({chatTitle:{marginInlineStart:"10px"},container:{display:"flex",flexDirection:"column",gridRowGap:"16px",minWidth:"300px",backgroundColor:At.C.colorNeutralBackground1},formButtons:{display:"flex",flexDirection:"row",justifyContent:"flex-end",gridColumnGap:"8px"}}),qt=function(e){var t=e.chat,n=e.currentUserId,c=e.onRenameChat,s=Gt(),o=(0,i.useState)(!1),u=(0,a.c)(o,2),l=u[0],d=u[1],h=(0,i.useCallback)((function(e,t){return d(t.open||!1)}),[]),p=(0,i.useCallback)((function(){return d(!1)}),[]),f=(0,i.useState)(null===t||void 0===t?void 0:t.topic),m=(0,a.c)(f,2),v=m[0],g=m[1],C=(0,i.useCallback)((function(e,t){g(t.value)}),[]),b=(0,i.useCallback)((function(){c(v||null)}),[v,c]),x=null!==t&&void 0!==t&&t.topic?t.topic:function(){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).filter((function(t){return t.userId!==e})).map((function(e){var t;return null!==(t=e.displayName)&&void 0!==t&&t.includes(" ")?e.displayName.split(" ")[0]:e.displayName||e.email||e.id})).join(", ")}(null===t||void 0===t?void 0:t.members,n),w={trapFocus:true,inertTrapFocus:true,inline:!0,positioning:"below-start",open:l,onOpenChange:h};return i.createElement(i.Fragment,null,i.createElement(Ht,{chatType:null===t||void 0===t?void 0:t.chatType}),i.createElement("span",{className:s.chatTitle},x),(null===t||void 0===t?void 0:t.id)&&i.createElement(Pt._,(0,r.c)({},w),i.createElement(Nt.O,null,i.createElement(_t.q,{appearance:"transparent",icon:i.createElement(Zt,null),"aria-label":"Name group chat"})),i.createElement(Lt.L,null,i.createElement("div",{className:s.container},i.createElement(Ut.I,{label:"Group name"},i.createElement(Ot.E,{placeholder:"Enter group name",onChange:C,value:v||""})),i.createElement("div",{className:s.formButtons},i.createElement(_t.q,{appearance:"secondary",onClick:p},"Cancel"),i.createElement(_t.q,{appearance:"primary",disabled:v===(null===t||void 0===t?void 0:t.topic),onClick:b},"Send"))))))},$t=(0,s.a)({chatHeader:{display:"flex",alignItems:"center",columnGap:"0",lineHeight:"32px",fontSize:"18px",fontWeight:700,marginBlockStart:"11px",marginBlockEnd:"7px",zIndex:3}}),Kt=(0,i.memo)((function(e){var t=e.chat,n=e.currentUserId,a=e.onRenameChat,r=$t(),c=Mt();return i.createElement("div",{className:(0,Et.Y)(r.chatHeader,c.row)},"oneOnOne"!==(null===t||void 0===t?void 0:t.chatType)?i.createElement(qt,{chat:t,currentUserId:n,onRenameChat:a}):i.createElement(Tt,{chat:t,currentUserId:n,onRenameChat:a}))})),Qt=n(47820),Jt=n(60736),Xt=n(22488),en=n(42056),tn=(0,n(70051).e)("people-picker",le.m8),nn=(0,s.a)({addMembers:(0,r.c)({display:"flex",flexDirection:"column",paddingBlockEnd:"18px"},o.uS.paddingInline("20px")),buttonRow:{display:"flex",columnGap:"8px",flexDirection:"row",justifyContent:"flex-end",paddingBlockStart:"18px"},dialogHeading:{paddingInlineStart:"4px",marginBlockStart:"18px",marginBlockEnd:"10px"},historyInput:{width:"48px"},option:{display:"flex",alignItems:"center",columnGap:"4px"},radio:{marginBlockStart:"8px",paddingInlineStart:"2px"}}),an=function(e){var t=e.addChatMembers,n=e.closeDialog,r=nn(),c=(0,i.useState)(1),s=(0,a.c)(c,2),o=s[0],u=s[1],l=(0,i.useCallback)((function(e,t){if(t.value){var n=parseInt(t.value,10);u(n)}}),[u]),d=(0,i.useState)("none"),h=(0,a.c)(d,2),p=h[0],f=h[1],m=i.useCallback((function(e,t){t&&f(t.key)}),[f]),v=(0,i.useState)([]),g=(0,a.c)(v,2),C=g[0],b=g[1],x=(0,i.useCallback)((function(e){b(e.detail)}),[b]),w=(0,i.useCallback)((function(){var e;"days"===p?e=new Date((new Date).getTime()-24*o*60*60*1e3):"all"===p&&(e=new Date("0001-01-01T00:00:00Z")),t(C.map((function(e){return e.id})),e).then(n)}),[C,p,o,t,n]),y=[{key:"none",text:"Don't include chat history"},{key:"days",text:"Include history from the past number of days: ",onRenderField:function(e,t){return t?i.createElement("div",{className:r.option},t(e),i.createElement(Ot.E,{type:"number",value:o.toString(),onChange:l,min:1,className:r.historyInput})):null}},{key:"all",text:"Include all chat history"}];return i.createElement("div",{className:r.addMembers},i.createElement("h3",{className:r.dialogHeading},"Add"),i.createElement(tn,{selectedPeople:C,selectionChanged:x,disabled:C.length>=20}),i.createElement(en.O,{className:r.radio,options:y,selectedKey:p,onChange:m}),i.createElement("div",{className:r.buttonRow},i.createElement(_t.q,{onClick:n,appearance:"secondary"},"Cancel"),i.createElement(_t.q,{onClick:w,appearance:"primary",disabled:C.length<1},"Add")))},rn=n(49384),cn=n(31740),sn=n(24692),on=n(58876),un=(0,Dt.c)(sn.Wu5,(function(){return i.createElement(i.Fragment,null)})),ln=(0,s.a)({iconPlaceholder:{display:"flex",width:"24px"},listItem:{listStyleType:"none",width:"100%",":focus-visible":(0,P.c)((0,P.c)({},"& .".concat(on.c),{display:"inline",color:"var(--colorNeutralForeground2BrandHover)"}),"& .".concat(on.k),{display:"none"})},memberList:(0,r.c)((0,r.c)({fontWeight:800,gridGap:"8px"},o.uS.marginBlock("0")),o.uS.padding("0")),personRow:(0,r.c)((0,r.c)((0,r.c)({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},o.uS.paddingBlock("5px")),o.uS.paddingInline("16px")),{},{cursor:"pointer",":hover":(0,P.c)((0,P.c)({backgroundColor:"var(--colorSubtleBackgroundHover)"},"& .".concat(on.c),{display:"inline",color:"var(--colorNeutralForeground2BrandHover)"}),"& .".concat(on.k),{display:"none"})}),fullWidth:{width:"100%"}}),dn=function(e){var t=e.members,n=e.currentUserId,r=e.removeChatMember,c=e.closeParentPopover,s=ln(),o=(0,i.useState)(!1),p=(0,a.c)(o,2),f=p[0],m=p[1],v=(0,i.useState)(void 0),g=(0,a.c)(v,2),C=g[0],b=g[1],x=(0,i.useCallback)((function(e){e&&(b(e),m(!0))}),[]),w=(0,i.useCallback)((function(){b(void 0),m(!1),c()}),[c]),y=(0,i.useCallback)((function(){null!==C&&void 0!==C&&C.id?r(C.id).then(w):w()}),[C,r,w]);return i.createElement(i.Fragment,null,i.createElement(u.C,{open:f,onOpenChange:function(e,t){return m(t.open)}},i.createElement(l.i,null,i.createElement(d.a,null,i.createElement(h.y,null,"Remove ",(null===C||void 0===C?void 0:C.displayName)||""," from the conversation?"),i.createElement(Jt.A,null,"They'll still have access to the chat history."),i.createElement(Xt.w,null,i.createElement(_t.q,{appearance:"secondary",onClick:w},"Close"),i.createElement(_t.q,{appearance:"primary",onClick:y},"Remove"))))),i.createElement(rn._,{navigable:!0,className:s.memberList},t.map((function(e){var t=n===e.userId;return null!==e&&void 0!==e&&e.userId?i.createElement(cn._,{key:e.userId,className:s.listItem,onClick:function(){t?w():x(e)}},i.createElement("div",{className:(0,Et.Y)(s.personRow,s.fullWidth)},i.createElement(st.u,{className:s.fullWidth,tabIndex:-1,userId:e.userId,view:"oneline",showPresence:!0}),i.createElement("span",{className:s.iconPlaceholder},!t&&i.createElement(un,null)))):null}))))},hn=(0,Dt.c)(zt.Cae,zt.QHU),pn=(0,Dt.c)(Rt.ysZ,Rt.kr_),fn=(0,s.a)({button:(0,r.c)({justifyContent:"flex-start"},o.uS.paddingInline("16px")),buttonRow:{display:"flex",flexDirection:"column"},container:(0,r.c)({},o.uS.paddingBlock("4px")),divider:(0,r.c)({},o.uS.marginBlock("4px")),popover:(0,r.c)({},o.uS.padding("0 !important")),triggerButton:(0,r.c)((0,r.c)((0,r.c)({},o.uS.marginInline("0px","8px")),o.uS.paddingInline("0")),{},{"--spacingHorizontalSNudge":"2px",minWidth:"unset !important",width:"max-content"})}),mn=(0,i.memo)((function(e){var t=e.currentUserId,n=e.members,c=e.addChatMembers,s=e.removeChatMember,o=fn(),p=(0,i.useState)(!1),f=(0,a.c)(p,2),m=f[0],v=f[1],g=(0,i.useState)(!1),C=(0,a.c)(g,2),b=C[0],x=C[1],w=(0,i.useCallback)((function(){x(!0)}),[x]),y=(0,i.useCallback)((function(){x(!1),v(!1)}),[x]),k=(0,i.useCallback)((function(e,t){return v(t.open||!1)}),[v]),S=(0,i.useCallback)((function(){var e=n.find((function(e){return e.userId===t}));null!==e&&void 0!==e&&e.id?s(e.id).then(y):y()}),[s,n,t,y]),E={trapFocus:true,inertTrapFocus:true,inline:!0,positioning:"below-start",open:m,onOpenChange:k};return i.createElement(Pt._,(0,r.c)({},E),i.createElement(Nt.O,null,i.createElement(_t.q,{className:o.triggerButton,appearance:"transparent",icon:i.createElement(hn,null)},n.length)),i.createElement(Lt.L,{className:o.popover},b?i.createElement(an,{closeDialog:y,addChatMembers:c}):i.createElement("div",{className:o.container},i.createElement(dn,{members:n,removeChatMember:s,currentUserId:t,closeParentPopover:y}),i.createElement(St.c,{className:o.divider}),i.createElement("div",{className:o.buttonRow},i.createElement(_t.q,{appearance:"subtle",icon:i.createElement(hn,null),onClick:w,className:o.button},"Add people"),i.createElement(u.C,null,i.createElement(Qt.e,null,i.createElement(_t.q,{appearance:"subtle",icon:i.createElement(pn,null),className:o.button},"Leave")),i.createElement(l.i,null,i.createElement(d.a,null,i.createElement(h.y,null,"Leave the conversation?"),i.createElement(Jt.A,null,"You'll still have access to the chat history."),i.createElement(Xt.w,null,i.createElement(Qt.e,{disableButtonEnhancement:!0},i.createElement(_t.q,{appearance:"secondary",onClick:y},"Cancel")),n.length>2&&i.createElement(_t.q,{appearance:"primary",onClick:S},"Leave")))))))))})),vn=n(49600),gn=n(96386),Cn=n(26644),bn=n(63500),xn=n(79946),wn=n(88616),yn=(0,n(40744).qN)({svg:function(){return i.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none"},i.createElement("path",{d:"M17.0797 8H14.1797L12.4697 8.82V12.89C12.5119 13.5868 12.8184 14.2412 13.3267 14.7197C13.8349 15.1981 14.5067 15.4645 15.2047 15.4645C15.9028 15.4645 16.5745 15.1981 17.0828 14.7197C17.5911 14.2412 17.8976 13.5868 17.9397 12.89V8.82C17.9399 8.70887 17.9174 8.59886 17.8737 8.49668C17.83 8.39449 17.766 8.30225 17.6856 8.22556C17.6052 8.14887 17.51 8.08933 17.4058 8.05055C17.3017 8.01178 17.1907 7.99458 17.0797 8Z",fill:"#115EA3"}),i.createElement("path",{d:"M16 7C17.1046 7 18 6.10457 18 5C18 3.89543 17.1046 3 16 3C14.8954 3 14 3.89543 14 5C14 6.10457 14.8954 7 16 7Z",fill:"#115EA3"}),i.createElement("path",{d:"M6.82 8H14.18C14.3975 8 14.606 8.08639 14.7598 8.24017C14.9136 8.39395 15 8.60252 15 8.82V13.5C15 14.6935 14.5259 15.8381 13.682 16.682C12.8381 17.5259 11.6935 18 10.5 18C9.30653 18 8.16193 17.5259 7.31802 16.682C6.47411 15.8381 6 14.6935 6 13.5V8.82C6 8.60252 6.08639 8.39395 6.24017 8.24017C6.39395 8.08639 6.60252 8 6.82 8Z",fill:"#B4D6FA"}),i.createElement("path",{d:"M11 8C12.6569 8 14 6.65685 14 5C14 3.34315 12.6569 2 11 2C9.34315 2 8 3.34315 8 5C8 6.65685 9.34315 8 11 8Z",fill:"#B4D6FA"}),i.createElement("path",{opacity:"0.5",d:"M6.00003 8.82V13.5C5.99696 14.3892 6.25799 15.2593 6.75003 16H10.97C11.5005 16 12.0092 15.7893 12.3842 15.4142C12.7593 15.0391 12.97 14.5304 12.97 14V8H6.75003C6.5449 8.01757 6.35389 8.11166 6.21494 8.26358C6.07599 8.4155 5.99928 8.61412 6.00003 8.82Z",fill:"#242424"}),i.createElement("path",{opacity:"0.5",d:"M11.9699 6H8.16992C8.3332 6.46135 8.60686 6.87575 8.96704 7.20706C9.32722 7.53837 9.76299 7.77654 10.2363 7.9008C10.7097 8.02505 11.2062 8.03162 11.6827 7.91993C12.1592 7.80823 12.6011 7.58167 12.9699 7.26V7C12.9699 6.73478 12.8646 6.48043 12.677 6.29289C12.4895 6.10536 12.2351 6 11.9699 6Z",fill:"#242424"}),i.createElement("path",{opacity:"0.1",d:"M6.00003 8.82V13.5C5.99696 14.3892 6.25799 15.2593 6.75003 16H10.97C11.5005 16 12.0092 15.7893 12.3842 15.4142C12.7593 15.0391 12.97 14.5304 12.97 14V8H6.75003C6.5449 8.01757 6.35389 8.11166 6.21494 8.26358C6.07599 8.4155 5.99928 8.61412 6.00003 8.82Z",fill:"white"}),i.createElement("path",{opacity:"0.1",d:"M11.9699 6H8.16992C8.3332 6.46135 8.60686 6.87575 8.96704 7.20706C9.32722 7.53837 9.76299 7.77654 10.2363 7.9008C10.7097 8.02505 11.2062 8.03162 11.6827 7.91993C12.1592 7.80823 12.6011 7.58167 12.9699 7.26V7C12.9699 6.73478 12.8646 6.48043 12.677 6.29289C12.4895 6.10536 12.2351 6 11.9699 6Z",fill:"white"}),i.createElement("path",{d:"M11 5H3C2.44772 5 2 5.44772 2 6V14C2 14.5523 2.44772 15 3 15H11C11.5523 15 12 14.5523 12 14V6C12 5.44772 11.5523 5 11 5Z",fill:"#115EA3"}),i.createElement("path",{d:"M10 8H8V13H7V8H5V7H10V8Z",fill:"white"}))},displayName:"TeamsIcon"}),kn=(0,Dt.c)(wn.YPN,wn.yeo),Sn={inline:!0,hasIcons:!0,closeOnScroll:!0,positioning:"below-start"},En=(0,s.a)({menuPopover:{zIndex:2,"& .fui-MenuItemLink__content":{fontFamily:"Segoe UI",fontSize:"12px",fontStyle:"normal",fontWeight:"600"}}}),Mn=function(e){var t=En();return i.createElement(vn.i,(0,r.c)({},Sn),i.createElement(gn.E,{disableButtonEnhancement:!0},i.createElement(_t.q,{appearance:"transparent",icon:i.createElement(kn,null)})),i.createElement(Cn.s,{className:t.menuPopover},i.createElement(bn._,null,i.createElement(xn.B,{icon:i.createElement(yn,null),target:"_blank",href:e.chatWebUrl},"Go to Microsoft Teams"))))},In=(0,s.a)({chatHeader:{display:"flex",flexDirection:"column",rowGap:0,zIndex:4},secondRow:{display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",height:"30px"},noGrow:{flexGrow:0}}),Tn=function(e){var t,n,a,r,c=e.chatState,s=In(),o=Mt(),u=null!==(t=null===c||void 0===c||null===(n=c.chat)||void 0===n?void 0:n.webUrl)&&void 0!==t?t:"https://teams.microsoft.com/v2";return i.createElement("div",{className:s.chatHeader},i.createElement(Kt,{chat:c.chat,currentUserId:c.userId,onRenameChat:c.onRenameChat}),i.createElement(St.c,{appearance:"subtle"}),i.createElement("div",{className:(0,Et.Y)(s.secondRow,o.row)},(null===(a=c.participants)||void 0===a?void 0:a.length)>0&&"group"===(null===(r=c.chat)||void 0===r?void 0:r.chatType)&&i.createElement(i.Fragment,null,i.createElement(mn,{members:c.participants,removeChatMember:c.onRemoveChatMember,currentUserId:c.userId,addChatMembers:c.onAddChatMembers}),i.createElement(St.c,{vertical:!0,appearance:"subtle",inset:!0,className:s.noGrow})),i.createElement(Mn,{chatWebUrl:u})),i.createElement(St.c,{appearance:"subtle"}))},Dn=function(){return i.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"68",height:"68",viewBox:"0 0 68 68",fill:"none"},i.createElement("path",{d:"M58.0129 27.6675L43.4354 42.3725C42.5854 43.2225 42.9679 44.71 44.1579 45.0075L64.1754 50.32C65.3654 50.6175 66.4279 49.555 66.1304 48.365L60.6904 28.39C60.3079 27.2 58.8629 26.775 58.0129 27.6675Z",fill:"url(#paint0_linear_11292_9370)"}),i.createElement("path",{d:"M15.5978 11.0075L6.92782 29.835C6.41782 30.94 7.31032 32.1725 8.50032 32.0875L29.1128 30.175C30.3453 30.0475 30.9828 28.6875 30.2603 27.6675L18.3178 10.7525C17.5953 9.73251 16.1078 9.90251 15.5978 11.0075Z",fill:"url(#paint1_linear_11292_9370)"}),i.createElement("path",{d:"M32.0877 13.6423L7.05516 50.7448C5.56766 52.9123 7.01266 55.8873 9.64766 56.0998L54.3152 59.2448C56.9502 59.4148 58.7777 56.6948 57.6302 54.3148L37.9952 14.0673C36.8477 11.6873 33.5752 11.4748 32.0877 13.6423Z",fill:"#FFD590"}),i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M58.8201 35.5298C58.5651 36.4223 59.0751 37.3998 59.9676 37.6548C60.8601 37.9523 61.7951 37.4423 62.0501 36.5498L65.7476 24.3098C66.0026 23.4173 65.4926 22.4398 64.6001 22.1848C63.7076 21.9298 62.7301 22.4398 62.4751 23.3323L58.8201 35.5298ZM60.6902 41.5648C60.6902 42.621 59.834 43.4773 58.7777 43.4773C57.7215 43.4773 56.8652 42.621 56.8652 41.5648C56.8652 40.5085 57.7215 39.6523 58.7777 39.6523C59.834 39.6523 60.6902 40.5085 60.6902 41.5648Z",fill:"#3E8EED"}),i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M31.3668 41.9901C31.2818 42.9251 32.0043 43.7326 32.9393 43.8176C33.8743 43.8601 34.6818 43.1801 34.7668 42.2451L35.9993 24.8626C36.0843 23.9276 35.3618 23.1201 34.4268 23.0351C33.4918 22.9501 32.6843 23.6726 32.5993 24.6076L31.3668 41.9901ZM34.5965 47.8551C34.5965 48.9114 33.7402 49.7676 32.684 49.7676C31.6277 49.7676 30.7715 48.9114 30.7715 47.8551C30.7715 46.7989 31.6277 45.9426 32.684 45.9426C33.7402 45.9426 34.5965 46.7989 34.5965 47.8551Z",fill:"white"}),i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.3473 21.6326C11.6023 22.5676 12.5373 23.0776 13.4298 22.8226C14.3223 22.5676 14.8323 21.6326 14.6198 20.7401L11.1348 8.45757C10.8798 7.52257 9.94479 7.01257 9.05229 7.26757C8.11729 7.52257 7.60729 8.45757 7.86229 9.35007L11.3473 21.6326ZM16.4472 26.7327C16.4472 27.7889 15.5909 28.6452 14.5347 28.6452C13.4784 28.6452 12.6222 27.7889 12.6222 26.7327C12.6222 25.6764 13.4784 24.8202 14.5347 24.8202C15.5909 24.8202 16.4472 25.6764 16.4472 26.7327Z",fill:"#28C2D1"}),i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M34.3818 8.75509C34.2118 8.58509 34.1268 8.37259 34.0843 8.16009L33.6593 5.44009C33.5743 4.84509 33.9993 4.33509 34.5518 4.25009C34.8493 4.20759 35.1468 4.29259 35.3593 4.46259C35.5718 4.63259 35.6993 4.88759 35.7418 5.14259L36.1243 7.86259C36.2093 8.45759 35.7843 8.96759 35.2318 9.05259C34.9343 9.09509 34.5943 8.96759 34.3818 8.75509ZM39.2694 9.09522C39.0144 9.52022 39.0994 10.0302 39.4394 10.3702C39.4819 10.4127 39.5669 10.4977 39.6519 10.4977C40.1619 10.7952 40.7994 10.6252 41.0544 10.1577L42.3719 7.94772C42.4994 7.69272 42.5419 7.43772 42.4994 7.14022C42.4569 6.92772 42.3294 6.71522 42.1594 6.58772C42.1382 6.56647 42.1169 6.55584 42.0957 6.54522C42.0744 6.53459 42.0532 6.52397 42.0319 6.50272C41.5219 6.20522 40.8844 6.37522 40.6294 6.84272L39.2694 9.09522ZM43.3069 13.8126C43.3494 13.8976 43.4344 14.0251 43.5194 14.1101C43.8594 14.4076 44.3269 14.4926 44.7094 14.2801L46.9194 13.1751C47.1744 13.0476 47.3444 12.8351 47.4294 12.5801C47.5144 12.3251 47.5144 12.0276 47.3869 11.7726L47.3869 11.7726C47.3019 11.6451 47.2169 11.5176 47.0894 11.4326C47.0244 11.3677 46.9347 11.3276 46.8581 11.2933L46.858 11.2933C46.8344 11.2827 46.8119 11.2727 46.7919 11.2626C46.5369 11.1776 46.2394 11.1776 45.9844 11.3051L43.7744 12.4101C43.5194 12.5376 43.3494 12.7501 43.2644 13.0051C43.1794 13.3026 43.1794 13.5576 43.3069 13.8126Z",fill:"#E1DFDD"}),i.createElement("defs",null,i.createElement("linearGradient",{id:"paint0_linear_11292_9370",x1:"42.1229",y1:"42.8716",x2:"57.8851",y2:"39.5913",gradientUnits:"userSpaceOnUse"},i.createElement("stop",{offset:"0.000984252",stopColor:"#72ACF1"}),i.createElement("stop",{offset:"1",stopColor:"#A7CBF6"})),i.createElement("linearGradient",{id:"paint1_linear_11292_9370",x1:"28.8553",y1:"30.7359",x2:"17.0695",y2:"23.6816",gradientUnits:"userSpaceOnUse"},i.createElement("stop",{offset:"0.000984252",stopColor:"#7BDDEF"}),i.createElement("stop",{offset:"1",stopColor:"#C3F2F4"}))))},Rn=(0,s.a)({container:(0,r.c)((0,r.c)({backgroundColor:"var(--Neutral-Background-2-Rest, #FAFAFA)",display:"flex",flexWrap:"wrap",flexDirection:"column",alignContent:"center",justifyContent:"center",width:"100%",height:"100%",fontFamily:"Segoe UI"},o.uS.paddingInline("0 16px")),o.uS.gap("24px")),icon:{display:"flex",flexWrap:"wrap",justifyContent:"center",alignContent:"center"},messageContainer:{},message:{color:"var(--Neutral-Foreground-1-Rest, #242424)",textAlign:"center",fontSize:"16px",fontStyle:"normal",fontWeight:"600",lineHeight:"22px"},subheading:{color:"var(--Neutral-Foreground-2-Rest, #424242)",textAlign:"center",fontSize:"14px",fontStyle:"normal",fontWeight:"400",lineHeight:"20px"}}),An=function(){return i.createElement("p",null)},Pn=function(e){var t=e.icon,n=void 0===t?Dn:t,a=e.message,r=e.subheading,c=Rn(),s=n,o=r||An;return i.createElement("div",{className:c.container},i.createElement("div",{className:c.icon},i.createElement(s,null)),i.createElement("div",{className:c.messageContainer},i.createElement("div",{className:c.message},a),r&&i.createElement("div",{className:c.subheading},i.createElement(o,null))))},Nn=function(){return i.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"91",height:"57",viewBox:"0 0 91 57",fill:"none"},i.createElement("path",{d:"M8.94601 17.9535C13.4725 17.9535 17.142 14.2841 17.142 9.75753C17.142 5.231 13.4725 1.56152 8.94601 1.56152C4.41948 1.56152 0.75 5.231 0.75 9.75753C0.75 14.2841 4.41948 17.9535 8.94601 17.9535Z",fill:"#CCE4F6"}),i.createElement("path",{d:"M13.3704 16.8063C13.2065 16.6424 13.0425 16.4785 12.8786 16.4785C12.3869 16.1506 11.8951 15.8228 11.5673 15.6589C11.5673 15.6589 11.4034 15.6589 11.4034 15.4949C10.9116 15.331 10.7477 15.1671 10.5838 15.0032C10.5838 15.0032 10.4198 14.6753 10.4198 14.3475V13.2001C10.7477 13.0361 10.9116 12.8722 11.0755 12.7083C11.0755 12.7083 11.4034 12.3805 11.7312 11.7248C11.8951 11.5609 11.8951 11.233 11.8951 11.233C12.3869 11.233 12.8786 10.7412 12.8786 10.2495C12.8786 10.0856 12.8786 9.92164 12.7147 9.75772C12.8786 9.26596 13.0426 8.61028 13.0426 8.11852C13.0426 6.47932 12.7147 5.00404 11.4034 4.34836C10.5838 2.87308 8.28887 2.54523 6.81359 3.20091C5.3383 3.85659 4.51871 5.33189 4.02695 4.18444C4.02695 4.18444 2.87951 5.33188 3.20735 6.80717C3.37127 7.79069 4.19088 8.28245 5.01048 8.28245C5.01048 8.77421 5.17439 9.26596 5.33831 9.75772C5.33831 9.92164 5.17438 10.0856 5.17438 10.0856C5.17438 10.5773 5.66615 11.0691 6.15792 11.0691C6.15792 11.3969 6.64968 12.3804 7.79712 13.0361V14.1836C7.79712 14.3475 7.79711 14.6753 7.63319 14.8393C7.46927 15.0032 7.30536 15.0032 6.97752 15.331C6.64968 15.4949 6.64967 15.4949 6.48575 15.4949C6.48575 15.4949 6.15791 15.6589 5.66615 15.9867C5.33831 16.1506 5.17439 16.4785 4.84655 16.6424C6.15791 17.2981 7.46928 17.7898 9.10848 17.7898C10.5838 17.9537 12.059 17.6259 13.3704 16.8063Z",fill:"#66AEE5"}),i.createElement("path",{d:"M82.4579 52.7043C86.8939 52.7043 90.49 49.1082 90.49 44.6722C90.49 40.2362 86.8939 36.6401 82.4579 36.6401C78.0219 36.6401 74.4258 40.2362 74.4258 44.6722C74.4258 49.1082 78.0219 52.7043 82.4579 52.7043Z",fill:"#E7DFF3"}),i.createElement("path",{d:"M86.0634 48.2778L86.2273 47.9499C86.8829 47.1303 87.2108 45.9829 87.2108 44.8354C87.2108 42.0488 85.0798 39.7539 82.621 39.7539C80.1622 39.7539 78.0312 42.0488 78.0312 44.8354C78.0312 45.819 78.1952 46.6386 78.6869 47.4582C78.8509 47.6221 78.8509 47.786 79.0148 47.9499L79.1787 48.2778C79.8344 49.2613 79.5065 50.5726 78.6869 51.2283L78.3591 51.3922C78.3591 51.3922 80.1622 52.7036 82.785 52.7036C85.4077 52.7036 87.2108 51.3922 87.2108 51.3922L86.883 51.2283C85.5716 50.5726 85.4077 49.2613 86.0634 48.2778Z",fill:"#CFC0E8"}),i.createElement("path",{d:"M68.6889 53.8517H31.3151C30.4955 53.8517 29.8398 53.196 29.8398 52.3764V38.6071C29.8398 37.7875 30.4955 37.1318 31.3151 37.1318H68.6889C69.5085 37.1318 70.1642 37.7875 70.1642 38.6071V52.3764C70.1642 53.196 69.5085 53.8517 68.6889 53.8517Z",fill:"#B6A0DC"}),i.createElement("path",{d:"M62.9519 56.3109C63.2798 56.6387 63.7715 56.4748 64.0994 56.3109L67.3778 53.8521H59.3457L62.9519 56.3109Z",fill:"#B6A0DC"}),i.createElement("path",{d:"M22.5586 17.7895H57.4219C58.1543 17.7895 58.7402 17.1338 58.7402 16.3142V1.72528C58.7402 0.905683 58.1543 0.25 57.4219 0.25H22.5586C21.8262 0.25 21.2402 0.905683 21.2402 1.72528V16.3142C21.3867 17.1338 21.9726 17.7895 22.5586 17.7895Z",fill:"#0078D4"}),i.createElement("path",{d:"M28.9452 20.4118C28.6174 20.7396 28.1256 20.7396 27.7978 20.4118L24.3555 17.7891H32.7154L28.9452 20.4118Z",fill:"#0078D4"}),i.createElement("path",{d:"M59.6739 47.9504C60.8508 47.9504 61.8049 46.9963 61.8049 45.8194C61.8049 44.6425 60.8508 43.6885 59.6739 43.6885C58.497 43.6885 57.543 44.6425 57.543 45.8194C57.543 46.9963 58.497 47.9504 59.6739 47.9504Z",fill:"#654994"}),i.createElement("path",{d:"M50.4942 47.9504C51.6711 47.9504 52.6252 46.9963 52.6252 45.8194C52.6252 44.6425 51.6711 43.6885 50.4942 43.6885C49.3174 43.6885 48.3633 44.6425 48.3633 45.8194C48.3633 46.9963 49.3174 47.9504 50.4942 47.9504Z",fill:"#654994"}),i.createElement("path",{d:"M41.3146 47.9509C42.4915 47.9509 43.4455 46.9968 43.4455 45.8199C43.4455 44.643 42.4915 43.689 41.3146 43.689C40.1377 43.689 39.1836 44.643 39.1836 45.8199C39.1836 46.9968 40.1377 47.9509 41.3146 47.9509Z",fill:"#654994"}))},_n=n(76192),Ln=function(e){return i.createElement(_n.c,(0,r.c)({href:"https://teams.microsoft.com"},e),"open the Teams app")},Un=function(){return i.createElement("p",null,"If the problem continues, ",i.createElement(Ln,null)," to view the issue.")},On=function(){return i.createElement("p",null,"A valid chat id is required.")},Fn=function(){return i.createElement("p",null,"Type a new message and send.")},zn=function(e,t){return"".concat(e,"::").concat(t)},Bn=function(e){function t(){var e;(0,R.c)(this,t);for(var n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return e=(0,se.c)(this,t,[].concat(a)),(0,P.c)((0,oe.c)(e),"infoRequestMap",new Map),(0,P.c)((0,oe.c)(e),"loadBotInfo",function(){var t=(0,D.c)((0,T.c)().mark((function t(n,a){var r,i,c,s,o,u,l;return(0,T.c)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.betaGraph){t.next=3;break}return t.abrupt("return");case 3:if(i=zn(n,a),e.infoRequestMap.has(i)){t.next=28;break}return c=Se(r,n,a),e.infoRequestMap.set(i,c),t.next=9,c;case 9:if(!((null===(s=t.sent)||void 0===s?void 0:s.value.length)>0)){t.next=28;break}e.notifyStateChange((function(e){s.value.forEach((function(t){var a,r,i;null!==(a=t.teamsAppDefinition)&&void 0!==a&&null!==(a=a.bot)&&void 0!==a&&a.id&&(e.botInfo.set(null===(r=t.teamsAppDefinition)||void 0===r||null===(r=r.bot)||void 0===r?void 0:r.id,t),e.chatBots.has(n)||e.chatBots.set(n,new Set),null===(i=e.chatBots.get(n))||void 0===i||i.add(t))}))})),o=(0,I.c)(s.value),t.prev=13,l=(0,T.c)().mark((function t(){var n,a;return(0,T.c)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=u.value,t.next=3,Ee(r,n);case 3:a=t.sent,e.notifyStateChange((function(e){var t,r;null!==(t=n.teamsAppDefinition)&&void 0!==t&&null!==(t=t.bot)&&void 0!==t&&t.id&&e.botIcons.set(null===(r=n.teamsAppDefinition)||void 0===r||null===(r=r.bot)||void 0===r?void 0:r.id,a)}));case 5:case"end":return t.stop()}}),t)})),o.s();case 16:if((u=o.n()).done){t.next=20;break}return t.delegateYield(l(),"t0",18);case 18:t.next=16;break;case 20:t.next=25;break;case 22:t.prev=22,t.t1=t.catch(13),o.e(t.t1);case 25:return t.prev=25,o.f(),t.finish(25);case 28:case"end":return t.stop()}}),t,null,[[13,22,25,28]])})));return function(e,n){return t.apply(this,arguments)}}()),(0,P.c)((0,oe.c)(e),"state",{botInfo:new Map,chatBots:new Map,botIcons:new Map,loadBotInfo:e.loadBotInfo}),e}return(0,ue.c)(t,e),(0,A.c)(t)}(qe);!function(){var e=Object.assign(lt.c,{"add-friend":i.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16","aria-hidden":"true",focusable:"false",className:Ct.button},i.createElement("path",{className:Ct.icon,d:"M6.22176 13.9567C3.55468 13.653 2 11.8026 2 10V9.5C2 8.67157 2.67157 8 3.5 8H5.59971C5.43777 8.31679 5.30564 8.65136 5.20703 9H3.5C3.22386 9 3 9.22386 3 9.5V10C3 11.1281 3.88187 12.333 5.50235 12.7996C5.69426 13.216 5.93668 13.6043 6.22176 13.9567ZM9.62596 5.06907C9.70657 4.81036 9.75 4.53525 9.75 4.25C9.75 2.73122 8.51878 1.5 7 1.5C5.48122 1.5 4.25 2.73122 4.25 4.25C4.25 5.53662 5.13357 6.61687 6.32704 6.91706C6.64202 6.55055 7.00446 6.226 7.40482 5.95294C7.27488 5.98371 7.13934 6 7 6C6.0335 6 5.25 5.2165 5.25 4.25C5.25 3.2835 6.0335 2.5 7 2.5C7.9665 2.5 8.75 3.2835 8.75 4.25C8.75 4.73141 8.55561 5.16743 8.24104 5.48382C8.67558 5.28783 9.14016 5.14664 9.62596 5.06907ZM10.5 15C12.9853 15 15 12.9853 15 10.5C15 8.01472 12.9853 6 10.5 6C8.01472 6 6 8.01472 6 10.5C6 12.9853 8.01472 15 10.5 15ZM10.5 8C10.7761 8 11 8.22386 11 8.5V10H12.5C12.7761 10 13 10.2239 13 10.5C13 10.7761 12.7761 11 12.5 11H11V12.5C11 12.7761 10.7761 13 10.5 13C10.2239 13 10 12.7761 10 12.5V11H8.5C8.22386 11 8 10.7761 8 10.5C8 10.2239 8.22386 10 8.5 10H10V8.5C10 8.22386 10.2239 8 10.5 8Z"})),"left-chat":i.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16","aria-hidden":"true",focusable:"false",className:Ct.button},i.createElement("path",{className:Ct.icon,d:"M6.22176 13.9567C3.55468 13.653 2 11.8026 2 10V9.5C2 8.67157 2.67157 8 3.5 8H5.59971C5.43777 8.31679 5.30564 8.65136 5.20703 9H3.5C3.22386 9 3 9.22386 3 9.5V10C3 11.1281 3.88187 12.333 5.50235 12.7996C5.69426 13.216 5.93668 13.6043 6.22176 13.9567ZM9.62596 5.06907C9.70657 4.81036 9.75 4.53525 9.75 4.25C9.75 2.73122 8.51878 1.5 7 1.5C5.48122 1.5 4.25 2.73122 4.25 4.25C4.25 5.53662 5.13357 6.61687 6.32704 6.91706C6.64202 6.55055 7.00446 6.226 7.40482 5.95294C7.27488 5.98371 7.13934 6 7 6C6.0335 6 5.25 5.2165 5.25 4.25C5.25 3.2835 6.0335 2.5 7 2.5C7.9665 2.5 8.75 3.2835 8.75 4.25C8.75 4.73141 8.55561 5.16743 8.24104 5.48382C8.67558 5.28783 9.14016 5.14664 9.62596 5.06907ZM15 10.5C15 12.9853 12.9853 15 10.5 15C8.01472 15 6 12.9853 6 10.5C6 8.01472 8.01472 6 10.5 6C12.9853 6 15 8.01472 15 10.5ZM8.14684 10.146L8.14433 10.1486C8.09744 10.196 8.06198 10.2505 8.03794 10.3086C8.01385 10.3667 8.0004 10.4303 8.00001 10.497L8 10.5L8.00001 10.503C8.0004 10.5697 8.01385 10.6333 8.03794 10.6914C8.06234 10.7504 8.09851 10.8056 8.14645 10.8536L10.1464 12.8536C10.3417 13.0488 10.6583 13.0488 10.8536 12.8536C11.0488 12.6583 11.0488 12.3417 10.8536 12.1464L9.70711 11H12.5C12.7761 11 13 10.7761 13 10.5C13 10.2239 12.7761 10 12.5 10H9.70711L10.8536 8.85355C11.0488 8.65829 11.0488 8.34171 10.8536 8.14645C10.6583 7.95118 10.3417 7.95118 10.1464 8.14645L8.14684 10.146Z"})),"edit-svg":i.createElement("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",focusable:"false",className:Ct.button},i.createElement("g",{className:Ct.icon},i.createElement("path",{d:"M20.9519 3.0481C19.5543 1.65058 17.2885 1.65064 15.8911 3.04825L3.94103 14.9997C3.5347 15.4061 3.2491 15.9172 3.116 16.4762L2.02041 21.0777C1.96009 21.3311 2.03552 21.5976 2.21968 21.7817C2.40385 21.9659 2.67037 22.0413 2.92373 21.981L7.52498 20.8855C8.08418 20.7523 8.59546 20.4666 9.00191 20.0601L20.952 8.10861C22.3493 6.71112 22.3493 4.4455 20.9519 3.0481ZM16.9518 4.10884C17.7634 3.29709 19.0795 3.29705 19.8912 4.10876C20.7028 4.9204 20.7029 6.23632 19.8913 7.04801L19 7.93946L16.0606 5.00012L16.9518 4.10884ZM15 6.06084L17.9394 9.00018L7.94119 18.9995C7.73104 19.2097 7.46668 19.3574 7.17755 19.4263L3.76191 20.2395L4.57521 16.8237C4.64402 16.5346 4.79168 16.2704 5.00175 16.0603L15 6.06084Z"}))),"leave-svg":i.createElement("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",className:Ct.button},i.createElement("g",{className:Ct.icon},i.createElement("path",{className:Ct.iconUnfilled,d:"M6.25 2C5.00736 2 4 3.00736 4 4.25V19.75C4 20.9926 5.00736 22 6.25 22H12.8096C12.3832 21.5557 12.0194 21.051 11.7322 20.5H6.25C5.83579 20.5 5.5 20.1642 5.5 19.75V4.25C5.5 3.83579 5.83579 3.5 6.25 3.5H17.75C18.1642 3.5 18.5 3.83579 18.5 4.25V11.0764C19.0232 11.1572 19.5258 11.3004 20 11.4982V4.25C20 3.00736 18.9926 2 17.75 2H6.25ZM17.5 23C20.5376 23 23 20.5376 23 17.5C23 14.4624 20.5376 12 17.5 12C14.4624 12 12 14.4624 12 17.5C12 20.5376 14.4624 23 17.5 23ZM21 17.5C21 17.7761 20.7761 18 20.5 18H15.7071L17.3536 19.6464C17.5488 19.8417 17.5488 20.1583 17.3536 20.3536C17.1583 20.5488 16.8417 20.5488 16.6464 20.3536L14.1464 17.8536C13.9512 17.6583 13.9512 17.3417 14.1464 17.1464L16.6464 14.6464C16.8417 14.4512 17.1583 14.4512 17.3536 14.6464C17.5488 14.8417 17.5488 15.1583 17.3536 15.3536L15.7071 17H20.5C20.7761 17 21 17.2239 21 17.5ZM8.5 13.25C9.32843 13.25 10 12.5784 10 11.75C10 10.9216 9.32843 10.25 8.5 10.25C7.67157 10.25 7 10.9216 7 11.75C7 12.5784 7.67157 13.25 8.5 13.25Z"}),i.createElement("path",{className:Ct.iconFilled,d:"M6.25 2.75C5.42157 2.75 4.75 3.42157 4.75 4.25V19.75C4.75 20.5784 5.42157 21.25 6.25 21.25H12.1902C11.4405 20.1905 11 18.8967 11 17.5C11 13.9101 13.9101 11 17.5 11C18.1063 11 18.6932 11.083 19.25 11.2383V4.25C19.25 3.42157 18.5784 2.75 17.75 2.75H6.25ZM8.5 13.25C7.67157 13.25 7 12.5784 7 11.75C7 10.9216 7.67157 10.25 8.5 10.25C9.32843 10.25 10 10.9216 10 11.75C10 12.5784 9.32843 13.25 8.5 13.25ZM17.5 23C20.5376 23 23 20.5376 23 17.5C23 14.4624 20.5376 12 17.5 12C14.4624 12 12 14.4624 12 17.5C12 20.5376 14.4624 23 17.5 23ZM21 17.5C21 17.7761 20.7761 18 20.5 18H15.7071L17.3536 19.6464C17.5488 19.8417 17.5488 20.1583 17.3536 20.3536C17.1583 20.5488 16.8417 20.5488 16.6464 20.3536L14.1464 17.8536C13.9512 17.6583 13.9512 17.3417 14.1464 17.1464L16.6464 14.6464C16.8417 14.4512 17.1583 14.4512 17.3536 14.6464C17.5488 14.8417 17.5488 15.1583 17.3536 15.3536L15.7071 17H20.5C20.7761 17 21 17.2239 21 17.5Z"}))),"people-add-svg":i.createElement("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",className:Ct.button},i.createElement("g",{className:Ct.icon},i.createElement("path",{className:Ct.iconUnfilled,d:"M5.5 7C5.5 5.61929 6.61929 4.5 8 4.5C9.38071 4.5 10.5 5.61929 10.5 7C10.5 8.38071 9.38071 9.5 8 9.5C6.61929 9.5 5.5 8.38071 5.5 7ZM8 3C5.79086 3 4 4.79086 4 7C4 9.20914 5.79086 11 8 11C10.2091 11 12 9.20914 12 7C12 4.79086 10.2091 3 8 3ZM15.5 8C15.5 7.17157 16.1716 6.5 17 6.5C17.8284 6.5 18.5 7.17157 18.5 8C18.5 8.82843 17.8284 9.5 17 9.5C16.1716 9.5 15.5 8.82843 15.5 8ZM17 5C15.3431 5 14 6.34315 14 8C14 9.65685 15.3431 11 17 11C18.6569 11 20 9.65685 20 8C20 6.34315 18.6569 5 17 5ZM4.25 13C3.00736 13 2 14.0074 2 15.25V15.5011L2 15.5022L2.00001 15.5048L2.00007 15.5111L2.00035 15.5277C2.00064 15.5406 2.00117 15.5571 2.0021 15.5771C2.00396 15.6169 2.00745 15.6705 2.01398 15.7358C2.02701 15.8661 2.05233 16.045 2.10165 16.2564C2.19995 16.6776 2.39654 17.2404 2.79183 17.8051C3.61066 18.9749 5.17178 20 8 20C9.36897 20 10.4411 19.7598 11.2758 19.3793C11.1268 18.8851 11.035 18.366 11.0082 17.8299C10.3633 18.2108 9.41267 18.5 8 18.5C5.57822 18.5 4.51434 17.6501 4.02067 16.9449C3.75971 16.5721 3.62818 16.1974 3.56241 15.9155C3.5297 15.7753 3.514 15.6612 3.50653 15.5865C3.50281 15.5493 3.50117 15.5222 3.50047 15.5072L3.5 15.4947V15.25C3.5 14.8358 3.83579 14.5 4.25 14.5H11.7322C11.9807 14.0233 12.2865 13.5813 12.6405 13.1831C12.3674 13.0653 12.0663 13 11.75 13H4.25ZM23 17.5C23 14.4624 20.5376 12 17.5 12C14.4624 12 12 14.4624 12 17.5C12 20.5376 14.4624 23 17.5 23C20.5376 23 23 20.5376 23 17.5ZM18.0006 18L18.0011 20.5035C18.0011 20.7797 17.7773 21.0035 17.5011 21.0035C17.225 21.0035 17.0011 20.7797 17.0011 20.5035L17.0006 18H14.4956C14.2197 18 13.9961 17.7762 13.9961 17.5C13.9961 17.2239 14.2197 17 14.4956 17H17.0005L17 14.4993C17 14.2231 17.2239 13.9993 17.5 13.9993C17.7761 13.9993 18 14.2231 18 14.4993L18.0005 17H20.4966C20.7725 17 20.9961 17.2239 20.9961 17.5C20.9961 17.7762 20.7725 18 20.4966 18H18.0006Z"}),i.createElement("path",{className:Ct.iconFilled,d:"M8 11C10.2091 11 12 9.20914 12 7C12 4.79086 10.2091 3 8 3C5.79086 3 4 4.79086 4 7C4 9.20914 5.79086 11 8 11ZM17 11C18.6569 11 20 9.65685 20 8C20 6.34315 18.6569 5 17 5C15.3431 5 14 6.34315 14 8C14 9.65685 15.3431 11 17 11ZM4.25 13C3.00736 13 2 14.0074 2 15.25V15.5C2 15.5 2 20 8 20C9.38985 20 10.4578 19.7585 11.2783 19.3875C11.0973 18.7901 11 18.1564 11 17.5C11 15.8431 11.6199 14.3311 12.6405 13.1831C12.3674 13.0653 12.0663 13 11.75 13H4.25ZM23 17.5C23 14.4624 20.5376 12 17.5 12C14.4624 12 12 14.4624 12 17.5C12 20.5376 14.4624 23 17.5 23C20.5376 23 23 20.5376 23 17.5ZM18.0006 18L18.0011 20.5035C18.0011 20.7797 17.7773 21.0035 17.5011 21.0035C17.225 21.0035 17.0011 20.7797 17.0011 20.5035L17.0006 18H14.4956C14.2197 18 13.9961 17.7762 13.9961 17.5C13.9961 17.2239 14.2197 17 14.4956 17H17.0005L17 14.4993C17 14.2231 17.2239 13.9993 17.5 13.9993C17.7761 13.9993 18 14.2231 18 14.4993L18.0005 17H20.4966C20.7725 17 20.9961 17.2239 20.9961 17.5C20.9961 17.7762 20.7725 18 20.4966 18H18.0006Z"})))});(0,dt.qc)({icons:e})}();var Vn=(0,s.a)({chat:(0,r.c)((0,r.c)({display:"flex",flexDirection:"column",height:"100%"},o.uS.overflow("auto")),{},{paddingBlockEnd:"12px",backgroundColor:"var(--Neutral-Background-2-Rest, #FAFAFA)"}),chatMessages:(0,r.c)((0,r.c)((0,r.c)({height:"100%"},o.uS.paddingInline("20px")),o.uS.overflow("auto")),{},{"& img":{maxWidth:"100%",height:"auto"},"& ul":(0,r.c)({},o.uS.padding("unset")),"& .ui-chat__item__message":{marginLeft:"unset","& ul":(0,r.c)({},o.uS.paddingInline("40px","0px"))},"& .fui-Chat":{maxWidth:"unset"}}),chatInput:(0,r.c)((0,r.c)({},o.uS.paddingInline("16px")),o.uS.overflow("unset")),fullHeight:{height:"100%"},spinner:{justifyContent:"center",display:"flex",alignItems:"center",height:"100%"},unsupportedContent:{color:"red"}}),Yn={chatContainer:{"& .uiBox":{zIndex:"unset","& div[data-ui-status]":{display:"inline-flex",justifyContent:"center",flexDirection:"column"}}},chatMessageContainer:{"& p>.mgtPersonMention,msftMention":(0,r.c)({display:"inline-block"},o.uS.marginInline("0px")),"& .otherMention":(0,r.c)({color:"var(--accent-base-color)"},o.uS.margin("0px"))},myChatMessageContainer:{"& p>.mgtPersonMention,msftMention":(0,r.c)({display:"inline-block"},o.uS.marginInline("0px")),"& .otherMention":(0,r.c)({color:"var(--accent-base-color)"},o.uS.margin("0px"))}},Wn=function(e){var t=e.chatId;(0,i.useEffect)((function(){(0,Ge.wh)()}),[]);var n=Vn(),r=function(){var e=(0,i.useState)((function(){return new tt})),t=(0,a.c)(e,1)[0];return(0,i.useEffect)((function(){return function(){(0,_.Yz)("invoked clean up effect"),t.tearDown()}}),[t]),t}(),c=(0,i.useState)((function(){return new Bn})),s=(0,a.c)(c,1)[0],o=(0,i.useState)(r.getState()),u=(0,a.c)(o,2),l=u[0],d=u[1],h=function(){var e=(0,i.useState)((function(){return(0,Z.c)()}));return(0,a.c)(e,1)[0]}();(0,i.useEffect)((function(){return r.onStateChange(d),function(){r.offStateChange(d)}}),[r]),(0,i.useEffect)((function(){t&&h?r.subscribeToChat(t,h):r.setStatus("no chat id")}),[t,h,r]);var p=["initial","creating server connections","subscribing to notifications","loading messages"].includes(l.status),f=!t||!!l.activeErrorMessages.length,m=f?"You cannot send a message":"Type a message...";return i.createElement(xt.Provider,{value:s},i.createElement(ee.s,{fluentTheme:ae.g},i.createElement(re.i,{id:"fluentui",theme:ie.W,className:n.fullHeight},i.createElement("div",{className:n.chat},i.createElement(Tn,{chatState:l}),l.userId&&t&&l.messages.length>0?i.createElement(i.Fragment,null,i.createElement("div",{className:n.chatMessages},i.createElement(te.w,{userId:l.userId,messages:l.messages,showMessageDate:!0,disableEditing:l.disableEditing,numberOfChatMessagesToReload:l.numberOfChatMessagesToReload,onLoadPreviousChatMessages:l.onLoadPreviousChatMessages,onDeleteMessage:l.onDeleteMessage,onSendMessage:l.onSendMessage,onUpdateMessage:l.onUpdateMessage,onRenderAvatar:function(e){return e?i.createElement(kt,{chatId:t,avatarId:e}):i.createElement(i.Fragment,null)},styles:Yn,mentionOptions:{displayOptions:{onRenderMention:ut(l)}},onRenderMessage:ct})),i.createElement("div",{className:n.chatInput},i.createElement(ne.y,{onSendMessage:l.onSendMessage,strings:{placeholderText:m}}))):i.createElement(i.Fragment,null,p&&i.createElement("div",{className:n.spinner},i.createElement(bt.c,null)," ",i.createElement("br",null),l.status),"no messages"===l.status&&i.createElement(Pn,{icon:Nn,message:"No messages were found for this chat.",subheading:Fn}),"no chat id"===l.status&&i.createElement(Pn,{message:"No chat id has been provided.",subheading:On}),"error"===l.status&&i.createElement(Pn,{message:"We're sorry\u2014we've run into an issue.",subheading:Un}),i.createElement("div",{className:n.chatInput},i.createElement(ne.y,{disabled:f,onSendMessage:l.onSendMessage,strings:{placeholderText:m}})))))))},jn=n(37960),Hn=n(2040),Zn=(0,s.a)({defaultProfileImage:(0,r.c)((0,r.c)({},o.uS.borderRadius("50%")),{},{objectFit:"cover",display:"flex",alignItems:"center",justifyContent:"center"})}),Gn=(0,Dt.c)(zt.MVV,zt.MVV),qn=(0,Dt.c)(zt.CY8,zt.CY8),$n=(0,Dt.c)(Ft.wV6,Ft.wV6),Kn=function(e){var t=e.chatType,n=Zn();if(!t)return null;var a="var(--colorBrandForeground2)";switch(t){case"meeting":return i.createElement(Vt,null,i.createElement($n,{color:a}));case"oneOnOne":return i.createElement("div",{className:n.defaultProfileImage},i.createElement(Vt,null,i.createElement(qn,{color:a})));case"group":return i.createElement(Vt,null,i.createElement(Gn,{color:a}));default:return(0,_.e5)("Attempted to render an icon for chat of type: ".concat(t)),null}},Qn=(0,s.a)({person:{"--person-avatar-size":"32px","--person-alignment":"center"}}),Jn=function(e){var t,n,a=e.chat,r=e.userId,c=Qn(),s=(0,i.useCallback)((function(){var e;return null===(e=a.members)||void 0===e?void 0:e.find((function(e){return e.userId!==r}))}),[a,r]);return i.createElement(i.Fragment,null,"oneOnOne"===a.chatType&&i.createElement(st.u,{className:c.person,userId:null!==(t=null===(n=s())||void 0===n?void 0:n.userId)&&void 0!==t?t:void 0,avatarSize:"small",showPresence:!0,personCardInteraction:"hover"},i.createElement(Kn,{chatType:"oneOnOne",template:"no-data"})),"group"===a.chatType&&i.createElement(Kn,{chatType:"group"}),"meeting"===a.chatType&&i.createElement(Kn,{chatType:"meeting"}))},Xn=(0,s.a)({isSelected:{backgroundColor:"#e6f7ff"},isUnSelected:{backgroundColor:"#ffffff"},isBold:{fontWeight:"bold"},isNormal:{fontWeight:"normal"},chatListItem:{display:"flex",alignItems:"center",width:"100%",paddingRight:"10px",paddingLeft:"10px"},profileImage:(0,r.c)((0,r.c)({},o.uS.flex(0,0,"auto")),{},{marginRight:"10px",objectFit:"cover",display:"flex",alignItems:"center",justifyContent:"center"}),defaultProfileImage:(0,r.c)((0,r.c)({},o.uS.borderRadius("50%")),{},{objectFit:"cover",display:"flex",alignItems:"center",justifyContent:"center"}),chatInfo:(0,r.c)({flexGrow:1,flexShrink:1,minWidth:0},o.uS.padding("5px")),chatTitle:(0,r.c)((0,r.c)((0,r.c)({textAlign:"left"},o.uS.margin("0")),{},{fontSize:"1em",color:"#333",textOverflow:"ellipsis"},o.uS.overflow("hidden")),{},{whiteSpace:"nowrap",width:"auto"}),chatMessage:(0,r.c)((0,r.c)((0,r.c)({fontSize:"0.9em",color:"#666",textAlign:"left"},o.uS.margin("0")),{},{textOverflow:"ellipsis"},o.uS.overflow("hidden")),{},{whiteSpace:"nowrap",width:"auto",minHeight:"20px"}),chatTimestamp:{flexShrink:0,textAlign:"right",alignSelf:"start",marginLeft:"auto",paddingLeft:"10px",fontSize:"0.8em",color:"#999",whiteSpace:"nowrap"},person:{"--person-avatar-size":"32px","--person-alignment":"center"}}),ea=["Updates"],ta=/(<img[^>]+)/,na=/(<attachment[^>]+)/,aa=/(<systemEventMessage[^>]+)/,ra=function(e){var t=e.chat,n=e.userId,r=e.isSelected,c=e.isRead,s=Xn(),o=(0,i.useState)(),u=(0,a.c)(o,2),l=u[0],d=u[1],h=(0,i.useRef)(!1);(0,i.useEffect)((function(){d(void 0),h.current=!1}),[null===t||void 0===t?void 0:t.id]);var p=function(){var e=(0,D.c)((0,T.c)().mark((function e(t){var n,a,r;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!h.current){e.next=2;break}return e.abrupt("return");case 2:return n=N.M.globalProvider,h.current=!0,a=n.graph.forComponent("ChatListItem"),e.prev=5,e.next=8,Re(a,t);case 8:r=e.sent,d(r.value),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(5),(0,_.e5)(e.t0),d([]);case 16:case"end":return e.stop()}}),e,null,[[5,12]])})));return function(t){return e.apply(this,arguments)}}();if(!n)return i.createElement(i.Fragment,null);var f=function(e){return(null===e||void 0===e?void 0:e.displayName)||(null===e||void 0===e?void 0:e.email)||(null===e||void 0===e?void 0:e.id)||"Unknown"},m=function(e,t){if(1===(e=e.sort()).length)return e[0];if(2===e.length&&t)return e.map((function(e){return e.split(" ")[0]})).join(" and ");if(2===e.length)return e.join(" and ");if(3===e.length&&t)return e.map((function(e){return e.split(" ")[0]})).join(", ");if(3===e.length)return e.join(", ");if(e.length>3&&t){var n=e.map((function(e){return e.split(" ")[0]})).slice(0,3),a=e.length-3+1;return n.join(", ")+" +"+a}if(e.length>3){var r=e.slice(0,3),i=e.length-3+1;return r.join(", ")+" +"+i}},v=(0,Et.Y)(s.chatListItem,r?s.isSelected:s.isUnSelected,c?s.isNormal:s.isBold);return n?i.createElement("div",{className:v},i.createElement("div",{className:s.profileImage},i.createElement(Jn,{chat:t,userId:n})),i.createElement("div",{className:s.chatInfo},i.createElement("p",{className:s.chatTitle},function(e){var t;if(e.topic)return e.topic;var a=(e.members||[]).filter((function(e){return e.userId!==n}));if(0===a.length&&l){var r,i=l.filter((function(e){var t,n,a;return(null===(t=e.teamsAppDefinition)||void 0===t||null===(t=t.bot)||void 0===t?void 0:t.id)&&(null===(n=e.teamsAppDefinition)||void 0===n?void 0:n.displayName)&&-1===ea.indexOf(null===(a=e.teamsAppDefinition)||void 0===a?void 0:a.displayName)})).map((function(e){return e.teamsAppDefinition.displayName}));if(i.length>0){var c=i.filter((function(e,t){return i.indexOf(e)===t}));return m(c,!1)}var s=null===(r=e.members)||void 0===r?void 0:r.find((function(e){return e.userId===n}));return s?f(s):"Me"}var o=null===(t=e.lastMessagePreview)||void 0===t||null===(t=t.from)||void 0===t?void 0:t.application;if(0===a.length&&o)return p(e.id),o.displayName?o.displayName:o.id;if(0===a.length)return p(e.id),e.id;if(a.length>0){var u=a.map((function(e){return f(e)}));return m(u,!0)}return e.id}(t)),i.createElement("p",{className:s.chatMessage},function(e){var t,a,r,i=function(e){var t,a,r,i;if((null===(t=e.lastMessagePreview)||void 0===t||null===(t=t.from)||void 0===t||null===(t=t.user)||void 0===t?void 0:t.id)===n)return"You: ";if("oneOnOne"===e.chatType)return"";if(null!==(a=e.lastMessagePreview)&&void 0!==a&&null!==(a=a.from)&&void 0!==a&&null!==(a=a.user)&&void 0!==a&&a.displayName)return"".concat(e.lastMessagePreview.from.user.displayName,": ");if(null!==(r=e.lastMessagePreview)&&void 0!==r&&null!==(r=r.from)&&void 0!==r&&null!==(r=r.application)&&void 0!==r&&r.id&&l){var c,s=l.find((function(t){var n,a;return(null===(n=t.teamsAppDefinition)||void 0===n||null===(n=n.bot)||void 0===n?void 0:n.id)===(null===(a=e.lastMessagePreview)||void 0===a||null===(a=a.from)||void 0===a||null===(a=a.application)||void 0===a?void 0:a.id)}));if(null!==s&&void 0!==s&&null!==(c=s.teamsAppDefinition)&&void 0!==c&&c.displayName)return"".concat(s.teamsAppDefinition.displayName,": ")}return null!==(i=e.lastMessagePreview)&&void 0!==i&&null!==(i=i.from)&&void 0!==i&&null!==(i=i.application)&&void 0!==i&&i.displayName?(p(e.id),"".concat(e.lastMessagePreview.from.application.displayName,": ")):""}(e),c=null===(t=e.lastMessagePreview)||void 0===t||null===(t=t.body)||void 0===t?void 0:t.content;if(!c)return null!==(r=e.lastMessagePreview)&&void 0!==r&&r.isDeleted?"This message was deleted":e.lastMessagePreview?"".concat(i,"Sent a message"):"";if("html"===(null===(a=e.lastMessagePreview)||void 0===a||null===(a=a.body)||void 0===a?void 0:a.contentType)){var s;if(c.match(ta))return"".concat(i,"Sent an image");if(c.match(na))return"".concat(i,"Sent a file");if(c.match(aa))if("#microsoft.graph.membersAddedEventMessageDetail"===(null===(s=e.lastMessagePreview)||void 0===s||null===(s=s.eventDetail)||void 0===s?void 0:s["@odata.type"]))return"".concat(i,"User added");c=He(c),c=(0,Hn.A7)(c)}return"".concat(i).concat(c)}(t))),i.createElement("div",{className:s.chatTimestamp},function(e){if(!e)return"";var t=new Date,n=new Date(e),a=[n.getMonth(),n.getDate(),n.getFullYear()],r=a[0],i=a[1],c=a[2],s=[t.getMonth(),t.getDate(),t.getFullYear()],o=s[2];return s[1]===i&&s[0]===r&&o===c?n.toLocaleTimeString(navigator.language,{hour:"numeric",minute:"2-digit"}):o!==c?n.toLocaleDateString(navigator.language,{month:"numeric",day:"numeric",year:"numeric"}):n.toLocaleDateString(navigator.language,{month:"numeric",day:"numeric"})}(function(e){var t,n=null!==(t=e.lastMessagePreview)&&void 0!==t&&t.createdDateTime?new Date(e.lastMessagePreview.createdDateTime):null,a=e.lastUpdatedDateTime?new Date(e.lastUpdatedDateTime):null;return n&&a&&n>a?String(n):n&&a&&a>n?String(a):n?String(n):a?String(a):null}(t)))):i.createElement(i.Fragment,null)},ia=n(6004),ca=function(){function e(){(0,R.c)(this,e)}return(0,A.c)(e,[{key:"cache",get:function(){var e=V.I.conversation;return Y.m.getCache(e,e.stores.subscriptions)}},{key:"loadProxySubscriptions",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t){var n;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!W()){e.next=4;break}return e.next=3,this.cache.transaction(function(){var e=(0,D.c)((0,T.c)().mark((function e(a){return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.get(t);case 2:if(!(n=e.sent)){e.next=7;break}return n.lastAccessDateTime=(new Date).toISOString(),e.next=7,a.put(n,t);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:return e.abrupt("return",n||void 0);case 4:return e.abrupt("return",void 0);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"cacheProxySubscription",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n,a){return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cache.transaction(function(){var e=(0,D.c)((0,T.c)().mark((function e(r){var i,c;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,_.Yz)("cacheSubscription",a),e.next=3,r.get(t);case 3:return(i=e.sent)&&i.chatId===t?-1!==(c=i.proxySubscriptions.findIndex((function(e){var t,n;return(null===(t=e.subscription)||void 0===t?void 0:t.resource)===(null===(n=a.subscription)||void 0===n?void 0:n.resource)})))?i.proxySubscriptions[c]=a:i.proxySubscriptions.push(a):i={chatId:t,proxySubscriptions:[a],lastAccessDateTime:"",componentType:n},i.lastAccessDateTime=(new Date).toISOString(),e.next=8,r.put(i,t);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"deleteCachedProxySubscriptions",value:function(e){return this.cache.delete(e)}},{key:"loadInactiveProxySubscriptions",value:function(e,t){return this.cache.queryDb("lastAccessDateTime",IDBKeyRange.upperBound(e)).then((function(e){return e.filter((function(e){return e.componentType===t}))})).catch((function(e){throw e}))}}]),e}(),sa=n(30938),oa=function(){function e(){(0,R.c)(this,e)}return(0,A.c)(e,null,[{key:"PerformOperation",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n,a,r){var i,c;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,sa.c)({url:t,method:n,headers:{"Content-Type":"application/json",Authorization:"Bearer "+r},data:a});case 3:return i=e.sent,c=i.data,e.abrupt("return",c);case 8:e.prev=8,e.t0=e.catch(0),console.error("Error:",e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n,a,r){return e.apply(this,arguments)}}()}]),e}(),ua=(0,A.c)((function e(){var t=this;(0,R.c)(this,e),(0,P.c)(this,"getToken",(0,D.c)((0,T.c)().mark((function e(){var t,n,a=arguments;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]&&a[0],e.next=3,N.M.globalProvider.getAccessToken({forceTokenRefresh:t});case 3:if(n=e.sent){e.next=6;break}throw new Error("Could not retrieve token for user");case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})))),(0,P.c)(this,"proxyToken",""),(0,P.c)(this,"getProxyToken",(0,D.c)((0,T.c)().mark((function e(){return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.proxyToken){e.next=2;break}return e.abrupt("return",t.proxyToken);case 2:return e.next=4,N.M.globalProvider.getAccessTokenForScopes({scopes:[N.M.globalProvider.webProxyAPIScope],forceTokenRefresh:!0});case 4:return t.proxyToken=e.sent,e.next=7,t.getToken(!0);case 7:return e.abrupt("return",t.proxyToken);case 8:case"end":return e.stop()}}),e)}))))})),la=10,da=75,ha=3,pa=(z.useCanary,function(){function e(t,n){var a=this;(0,R.c)(this,e),(0,P.c)(this,"emitter",void 0),(0,P.c)(this,"_graph",void 0),(0,P.c)(this,"instanceId",(0,Z.c)()),(0,P.c)(this,"connection",void 0),(0,P.c)(this,"renewalTimeout",void 0),(0,P.c)(this,"renewalCount",0),(0,P.c)(this,"wasConnected",void 0),(0,P.c)(this,"userId",""),(0,P.c)(this,"lastNotificationUrl",""),(0,P.c)(this,"subscriptionId",""),(0,P.c)(this,"proxyTokenManager",new ua),(0,P.c)(this,"subscriptionCache",new j),(0,P.c)(this,"proxySubscriptionCache",new ca),(0,P.c)(this,"timer",new H),(0,P.c)(this,"getToken",(0,D.c)((0,T.c)().mark((function e(){var t;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.M.globalProvider.getAccessToken();case 2:if(t=e.sent){e.next=5;break}throw new Error("Could not retrieve token for user");case 5:return e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})))),(0,P.c)(this,"receiveNotificationMessage",(function(e){if("string"!==typeof e)throw new Error("Expected string from receivenotificationmessageasync");var t={StatusCode:"200"},n=JSON.parse(e);if(a.subscriptionId&&a.subscriptionId!==n.subscriptionId)return(0,_.Yz)("Received notification for a different subscription",n),t;(0,_.Yz)("received user notification message",n);var r=a.emitter;if(!n.resourceData)throw new Error("Message did not contain resourceData");return n.resource.includes("/messages(")?a.processMessageNotification(n,r):!function(e){return e.resource.includes("/members")}(n)?a.processChatPropertiesNotification(n,r):a.processMembershipNotification(n,r),z.ackAsString?JSON.stringify(t):t})),(0,P.c)(this,"cacheSubscription",function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n){return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,_.Yz)(n),e.next=3,a.subscriptionCache.cacheSubscription(t,B.User,n);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),(0,P.c)(this,"cacheProxySubscription",function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n){return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,_.Yz)(n),e.next=3,a.proxySubscriptionCache.cacheProxySubscription(t,B.User,n);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),(0,P.c)(this,"proxySubscription",void 0),(0,P.c)(this,"renewalSync",(function(){a.renewal()})),(0,P.c)(this,"renewal",(0,D.c)((0,T.c)().mark((function e(){var t,n,r,i,c,s,o,u,l;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=ha,e.prev=1,r=a.userId,!N.M.globalProvider.isWebProxyEnabled){e.next=10;break}return e.next=6,a.getProxySubscription(r);case 6:a.proxySubscription=e.sent,i=null===(c=a.proxySubscription)||void 0===c?void 0:c.subscription,e.next=13;break;case 10:return e.next=12,a.getSubscription(r);case 12:i=e.sent;case 13:if(!i){e.next=38;break}if(e.prev=14,s=new Date(i.expirationDateTime),!((o=Math.round((s.getTime()-(new Date).getTime())/1e3))<=0)){e.next=25;break}return(0,_.Yz)("Renewing user subscription ".concat(i.id," that has already expired...")),a.trySwitchToDisconnected(!0),e.next=22,a.renewSubscription(r,i);case 22:(0,_.Yz)("Successfully renewed user subscription ".concat(i.id,".")),e.next=30;break;case 25:if(!(o<=da)){e.next=30;break}return(0,_.Yz)("Renewing user subscription ".concat(i.id," that will expire in ").concat(o," seconds...")),e.next=29,a.renewSubscription(r,i);case 29:(0,_.Yz)("Successfully renewed user subscription ".concat(i.id,"."));case 30:e.next=38;break;case 32:return e.prev=32,e.t0=e.catch(14),(0,_.e5)("Failed to renew user subscription ".concat(i.id,"."),e.t0),e.next=37,a.deleteCachedSubscriptions(r);case 37:i=void 0;case 38:if(i){e.next=60;break}return e.prev=39,a.trySwitchToDisconnected(!0),e.next=43,a.createSubscription(r);case 43:i=e.sent,e.next=60;break;case 46:if(e.prev=46,e.t1=e.catch(39),!(403===(u=e.t1).statusCode&&u.message.indexOf("has reached its limit")>0)){e.next=54;break}throw t=3*ha,new Error("Failed to create a new subscription due to a limitation; retrying in ".concat(t," seconds: ").concat(u.message,"."));case 54:if(403!==u.statusCode&&402!==u.statusCode){e.next=59;break}return(0,_.e5)("Failed to create a new subscription due to a permanent condition; stopping renewals.",e.t1),e.abrupt("return");case 59:throw new Error("Failed to create a new subscription due to a transient condition; retrying in ".concat(t," seconds: ").concat(u.message,"."));case 60:if(i){e.next=62;break}throw new Error("Subscription not created");case 62:if((null===(n=a.connection)||void 0===n?void 0:n.state)!==ia.Q.Connected){e.next=65;break}return e.next=65,null===(l=a.connection)||void 0===l?void 0:l.send("ping");case 65:if(a.connection){e.next=74;break}return(0,_.Yz)("Creating a new SignalR connection for subscription ".concat(i.id,"...")),a.trySwitchToDisconnected(!0),a.lastNotificationUrl=i.notificationUrl,e.next=71,a.createSignalRConnection(i.notificationUrl);case 71:(0,_.Yz)("Successfully created a new SignalR connection for subscription ".concat(i.id,".")),e.next=91;break;case 74:if(a.connection.state===ia.Q.Connected){e.next=82;break}return(0,_.Yz)("Reconnecting SignalR connection for subscription ".concat(i.id,"...")),a.trySwitchToDisconnected(!0),e.next=79,a.connection.start();case 79:(0,_.Yz)("Successfully reconnected SignalR connection for subscription ".concat(i.id,".")),e.next=91;break;case 82:if(a.lastNotificationUrl===i.notificationUrl){e.next=91;break}return(0,_.Yz)("Updating SignalR connection for subscription ".concat(i.id," due to new notification URL...")),a.trySwitchToDisconnected(!0),e.next=87,a.closeSignalRConnection();case 87:return a.lastNotificationUrl=i.notificationUrl,e.next=90,a.createSignalRConnection(i.notificationUrl);case 90:(0,_.Yz)("Successfully updated SignalR connection for subscription ".concat(i.id,"."));case 91:a.trySwitchToConnected(),e.next=98;break;case 94:e.prev=94,e.t2=e.catch(1),(0,_.e5)("Error in user subscription connection process.",e.t2),a.trySwitchToDisconnected();case 98:a.renewalTimeout=a.timer.setTimeout("renewal:"+a.instanceId,a.renewalSync,1e3*t);case 99:case"end":return e.stop()}}),e,null,[[1,94],[14,32],[39,46]])})))),(0,P.c)(this,"renewSubscription",function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n){var r,i,c,s,o;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.renewalCount++,(0,_.Yz)("Renewing Graph subscription for ChatList. RenewalCount: ".concat(a.renewalCount,".")),r=new Date((new Date).getTime()+60*la*1e3),i=n.id,c=r.toISOString(),!N.M.globalProvider.isWebProxyEnabled){e.next=18;break}return e.t0=oa,e.t1="".concat(N.M.globalProvider.webProxyURL,"/subscriptions/").concat(i),e.t2={expirationDateTime:c},e.next=11,a.proxyTokenManager.getProxyToken();case 11:return e.t3=e.sent,e.next=14,e.t0.PerformOperation.call(e.t0,e.t1,"PATCH",e.t2,e.t3);case 14:return s=e.sent,e.abrupt("return",a.cacheSubscription(t,s));case 18:return e.next=20,a.graph.api("".concat(z.subscriptionEndpoint,"/").concat(i)).patch({expirationDateTime:c});case 20:return o=e.sent,e.abrupt("return",a.cacheSubscription(t,o));case 22:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),(0,P.c)(this,"getAccessTokenForSignalRConnection",(0,D.c)((0,T.c)().mark((function e(){var t,n;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!N.M.globalProvider.isWebProxyEnabled){e.next=2;break}return e.abrupt("return",null!==(t=null===(n=a.proxySubscription)||void 0===n||null===(n=n.negotiate)||void 0===n?void 0:n.accessToken)&&void 0!==t?t:"");case 2:return e.abrupt("return",a.getToken());case 3:case"end":return e.stop()}}),e)})))),this.emitter=t,this._graph=n}return(0,A.c)(e,[{key:"graph",get:function(){return this._graph}},{key:"beta",get:function(){return L.U.fromGraph(this._graph)}},{key:"subscriptionGraph",get:function(){return z.useCanary?(0,U.Y)(N.M.globalProvider,z.canarySubscriptionVersion,"mgt-chat"):this.beta}},{key:"tearDown",value:function(){(0,_.Yz)("cleaning up graph user notification resources"),this.renewalTimeout&&this.timer.clearTimeout(this.renewalTimeout),this.timer.close()}},{key:"processMessageNotification",value:function(e,t){var n=e.resourceData;switch(e.changeType){case"created":return void(null===t||void 0===t||t.chatMessageReceived(n));case"updated":return void(null===t||void 0===t||t.chatMessageEdited(n));case"deleted":return void(null===t||void 0===t||t.chatMessageDeleted(n));default:throw new Error("Unknown change type")}}},{key:"processMembershipNotification",value:function(e,t){var n=e.resourceData;switch(e.changeType){case"created":return void(null===t||void 0===t||t.participantAdded(n));case"deleted":return void(null===t||void 0===t||t.participantRemoved(n));default:throw new Error("Unknown change type")}}},{key:"processChatPropertiesNotification",value:function(e,t){var n=e.resourceData;switch(e.changeType){case"updated":return void(null===t||void 0===t||t.chatThreadPropertiesUpdated(n));case"deleted":return void(null===t||void 0===t||t.chatThreadDeleted(n));default:throw new Error("Unknown change type")}}},{key:"createSubscription",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t){var n,a,r,i,c,s,o,u,l;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=G(t),(0,_.Yz)("Creating a new subscription with group Id:",n),a="/users/".concat(t,"/chats/getAllmessages"),r=["created","updated","deleted"],i=new Date((new Date).getTime()+60*la*1e3).toISOString(),c={changeType:r.join(","),notificationUrl:"".concat(z.webSocketsPrefix,"?groupId=").concat(n),resource:a,expirationDateTime:i,includeResourceData:!0,clientState:"wsssecret"},(0,_.Yz)("subscribing to changes for "+a),!N.M.globalProvider.isWebProxyEnabled){e.next=26;break}return e.next=10,this.getProxySubscription(this.userId);case 10:if(!(u=e.sent)){e.next=15;break}this.proxySubscription=u,e.next=19;break;case 15:return e.next=17,this.createSubscriptionFromProxy(c);case 17:u=e.sent,this.proxySubscription=u;case 19:if(null===(s=this.proxySubscription)||void 0===s||!s.subscription){e.next=23;break}return this.subscriptionId=this.proxySubscription.subscription.id,e.next=23,this.cacheProxySubscription(this.userId,this.proxySubscription);case 23:return e.abrupt("return",null===(o=this.proxySubscription)||void 0===o?void 0:o.subscription);case 26:return e.next=28,this.createSubscriptionFromGraph(c);case 28:return l=e.sent,this.subscriptionId=l.id,e.next=32,this.cacheSubscription(this.userId,l);case 32:return e.abrupt("return",l);case 33:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createSubscriptionFromProxy",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t){var n,a;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.proxyTokenManager.getProxyToken();case 2:return n=e.sent,e.next=5,oa.PerformOperation(N.M.globalProvider.webProxyURL+z.subscriptionEndpoint,"POST",t,n);case 5:return a=e.sent,(0,_.Yz)("Subscription created using web proxy."),e.abrupt("return",a);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createSubscriptionFromGraph",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t){var n,a;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=z.subscriptionEndpoint,e.next=3,this.subscriptionGraph.api(n).post(t);case 3:if(null!==(a=e.sent)&&void 0!==a&&a.notificationUrl){e.next=6;break}throw new Error("Subscription not created");case 6:return(0,_.Yz)("Subscription created using graph api."),e.abrupt("return",a);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteCachedSubscriptions",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t){return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(0,_.Yz)("Removing all user subscriptions from cache..."),e.next=4,this.subscriptionCache.deleteCachedSubscriptions(t);case 4:this.subscriptionId="",(0,_.Yz)("Successfully removed all user subscriptions from cache."),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),(0,_.e5)("Failed to remove all user subscriptions from cache.",e.t0);case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteCachedProxySubscriptions",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t){return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(0,_.Yz)("Removing all user subscriptions from cache..."),e.next=4,this.proxySubscriptionCache.deleteCachedProxySubscriptions(t);case 4:this.subscriptionId="",(0,_.Yz)("Successfully removed all proxy user subscriptions from cache."),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),(0,_.e5)("Failed to remove all proxy user subscriptions from cache.",e.t0);case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"trySwitchToConnected",value:function(){var e;!0!==this.wasConnected&&((0,_.Yz)("The user will receive notifications from the user subscription."),this.wasConnected=!0,null===(e=this.emitter)||void 0===e||e.connected())}},{key:"trySwitchToDisconnected",value:function(){var e;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&void 0===this.wasConnected||!1!==this.wasConnected&&((0,_.Yz)("The user will NOT receive notifications from the user subscription."),this.wasConnected=!1,null===(e=this.emitter)||void 0===e||e.disconnected())}},{key:"getSubscription",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t){var n,a;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.subscriptionCache.loadSubscriptions(t);case 2:if(e.t2=n=e.sent,e.t1=null===e.t2,e.t1){e.next=6;break}e.t1=void 0===n;case 6:if(!e.t1){e.next=10;break}e.t3=void 0,e.next=11;break;case 10:e.t3=n.subscriptions;case 11:if(e.t0=e.t3,e.t0){e.next=14;break}e.t0=[];case 14:return a=e.t0,e.abrupt("return",a.length>0?a[0]:void 0);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getProxySubscription",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t){var n,a;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.proxySubscriptionCache.loadProxySubscriptions(t);case 2:if(e.t2=n=e.sent,e.t1=null===e.t2,e.t1){e.next=6;break}e.t1=void 0===n;case 6:if(!e.t1){e.next=10;break}e.t3=void 0,e.next=11;break;case 10:e.t3=n.proxySubscriptions;case 11:if(e.t0=e.t3,e.t0){e.next=14;break}e.t0=[];case 14:return a=e.t0,e.abrupt("return",a.length>0?a[0]:void 0);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getSessionId",value:function(){return(0,Z.c)()}},{key:"getNotificationUrlForSignalRConnection",value:function(e){var t,n;return N.M.globalProvider.isWebProxyEnabled?null!==(t=null===(n=this.proxySubscription)||void 0===n||null===(n=n.negotiate)||void 0===n?void 0:n.url)&&void 0!==t?t:"":e}},{key:"createSignalRConnection",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t){var n,a,r=this;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={accessTokenFactory:function(){return r.getAccessTokenForSignalRConnection()},withCredentials:!1},(a=(new O.O).withUrl(z.adjustNotificationUrl(this.getNotificationUrlForSignalRConnection(t),this.getSessionId()),n).configureLogging(F.G.Information).build()).on("receivenotificationmessageasync",this.receiveNotificationMessage),a.on("EchoMessage",_.Yz),this.connection=a,e.next=7,a.start();case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"closeSignalRConnection",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(){var t;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.trySwitchToDisconnected(),e.prev=1,e.next=4,null===(t=this.connection)||void 0===t?void 0:t.stop();case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),(0,_.e5)("Error closing a prior SignalR connection.",e.t0);case 9:this.connection=void 0;case 10:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"subscribeToUserNotifications",value:function(e){(0,_.Yz)("User subscription with id: ".concat(e)),this.wasConnected=void 0,this.userId=e,this.renewalTimeout=this.timer.setTimeout("renewal:"+this.instanceId,this.renewalSync,0)}}]),e}()),fa=function(){function e(){(0,R.c)(this,e)}return(0,A.c)(e,[{key:"cache",get:function(){var e=V.I.conversation,t=Y.m.getCache(e,e.stores.lastRead);return t.getDBName=(0,D.c)((0,T.c)().mark((function e(){var t;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.M.getCacheId();case 2:if(!(t=e.sent)){e.next=5;break}return e.abrupt("return","mgt-lastreadcache-".concat(t.replace(/-/g,"")));case 5:throw new Error("CacheId is not available");case 6:case"end":return e.stop()}}),e)}))),t}},{key:"loadLastReadTime",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t){var n;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!W()){e.next=6;break}return e.next=3,this.cache.getValue(t);case 3:if(!(n=e.sent)||!me(n)){e.next=6;break}return e.abrupt("return",n);case 6:return e.abrupt("return",void 0);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"cacheLastReadTime",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n){var a;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n instanceof Date&&(n=n.toISOString()),a={chatId:t,lastReadTime:n},e.next=4,this.cache.putValue(t,a);case 4:return e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),ma=function(e,t){var n,a,r;if(null!==(n=e.lastMessagePreview)&&void 0!==n&&n.createdDateTime&&null!==(a=t.lastMessagePreview)&&void 0!==a&&a.createdDateTime){var i=new Date(e.lastMessagePreview.createdDateTime),c=new Date(t.lastMessagePreview.createdDateTime);return i===c?0:c>i?1:-1}return null!==(r=t.lastMessagePreview)&&void 0!==r&&r.createdDateTime?1:-1},va=function(){function e(){var t=this;(0,R.c)(this,e),(0,P.c)(this,"_notificationClient",void 0),(0,P.c)(this,"_eventEmitter",void 0),(0,P.c)(this,"_cache",void 0),(0,P.c)(this,"_graph",void 0),(0,P.c)(this,"_stateSubscribers",[]),(0,P.c)(this,"_initialSelectedChatId",void 0),(0,P.c)(this,"_loadPromise",void 0),(0,P.c)(this,"_loadMorePromise",void 0),(0,P.c)(this,"chatThreadsPerPage",20),(0,P.c)(this,"clearSelectedChat",(function(){var e=t.getState();e.internalSelectedChat&&t.notifyStateChange((function(t){t.status="chat unselected",t.internalPrevSelectedChat=e.internalSelectedChat,t.internalSelectedChat=void 0}))})),(0,P.c)(this,"setSelectedChatId",(function(e){if(t._initialSelectedChatId){var n=t.getState();if(!n.internalSelectedChat||n.internalSelectedChat.id!==e){var a=n.chatThreads.find((function(t){return t.id===e}));a&&t.setSelectedChat(a)}}else t._initialSelectedChatId=e})),(0,P.c)(this,"setSelectedChat",(function(e){var n=t.getState();n.internalSelectedChat&&t.notifyStateChange((function(e){e.status="chat unselected",e.internalPrevSelectedChat=n.internalSelectedChat,e.internalSelectedChat=void 0})),t.notifyStateChange((function(a){a.status="chat selected",a.internalSelectedChat=(0,r.c)((0,r.c)({},e),{},{isRead:!0}),a.chatThreads=n.chatThreads.map((function(t){return t.id===e.id&&a.internalSelectedChat?a.internalSelectedChat:t})),t.updateLastReadTime(a.internalSelectedChat.id)}))})),(0,P.c)(this,"markAllChatThreadsAsRead",(function(){t.notifyStateChange((function(e){e.status="chats read",e.chatThreads=t.getState().chatThreads.map((function(e){return e.id&&!e.isRead?(0,r.c)((0,r.c)({},e),{},{isRead:!0}):e}))})),t.cacheLastReadTime("all")})),(0,P.c)(this,"cacheLastReadTime",(function(e){var n=t.getState();if("all"===e&&n.chatThreads.forEach((function(e){e.id&&t._cache.cacheLastReadTime(e.id,new Date)})),"selected"===e){var a,r=null===(a=n.internalSelectedChat)||void 0===a?void 0:a.id;t.updateLastReadTime(r)}})),(0,P.c)(this,"checkWhetherToMarkAsRead",function(){var e=(0,D.c)((0,T.c)().mark((function e(n){var a;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(n.map(function(){var e=(0,D.c)((0,T.c)().mark((function e(n){var a,i,c,s,o,u,l,d;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.userId!==(null===(a=n.lastMessagePreview)||void 0===a||null===(a=a.from)||void 0===a||null===(a=a.user)||void 0===a?void 0:a.id)){e.next=2;break}return e.abrupt("return",(0,r.c)((0,r.c)({},n),{},{isRead:!0}));case 2:return e.next=4,t._cache.loadLastReadTime(n.id);case 4:if(s=e.sent){e.next=7;break}return e.abrupt("return",n);case 7:return o=n.lastUpdatedDateTime?new Date(n.lastUpdatedDateTime):null,u=null!==(i=n.lastMessagePreview)&&void 0!==i&&i.createdDateTime?new Date(null===(c=n.lastMessagePreview)||void 0===c?void 0:c.createdDateTime):null,l=new Date(s.lastReadTime),d=!(o&&o>l||u&&u>l||!s.lastReadTime),e.abrupt("return",(0,r.c)((0,r.c)({},n),{},{isRead:d}));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,P.c)(this,"_initialState",{status:"initial",activeErrorMessages:[],userId:"",chatThreads:[],moreChatThreadsToLoad:void 0,chatMessage:void 0,internalSelectedChat:void 0,internalPrevSelectedChat:void 0,fireOnSelected:!1}),(0,P.c)(this,"_state",(0,r.c)({},this._initialState)),(0,P.c)(this,"onMessageReceived",(function(e){e.chatId&&t.notifyChatMessageEventChange({message:e,type:t.getSystemMessageType(e)})})),(0,P.c)(this,"onMessageDeleted",(function(e){e.chatId&&t.notifyChatMessageEventChange({message:e,type:"chatMessageDeleted"})})),(0,P.c)(this,"onMessageEdited",(function(e){e.chatId&&t.notifyChatMessageEventChange({message:e,type:"chatMessageEdited"})})),(0,P.c)(this,"handleChatThreads",(function(e,n){t.notifyStateChange((function(a){if(a.status=e.length>0?"chats loaded":"no chats",a.chatThreads=e,a.moreChatThreadsToLoad=Boolean(n),a.fireOnSelected=!1,t._initialSelectedChatId){var r=t._initialSelectedChatId,i=e.find((function(e){return e.id===r}));t._initialSelectedChatId="",i?(a.internalSelectedChat=i,a.fireOnSelected=!0):(0,_.Yz)("Chat with id "+r+" not found in loaded chat threads.")}}))})),(0,P.c)(this,"onActiveAccountChanged",(function(e){if(e.detail){var n=e.detail.id.split("."),r=(0,a.c)(n,1)[0];r&&t.userId!==r&&t.handleAccountChange(r)}})),(0,P.c)(this,"handleAccountChange",function(){var e=(0,D.c)((0,T.c)().mark((function e(n){var a;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.clearCurrentUserMessages(),e.next=3,null===(a=t._notificationClient)||void 0===a?void 0:a.closeSignalRConnection();case 3:t.userId=n,t.updateUserSubscription(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,P.c)(this,"_userId",""),this.userId=pe(),N.M.globalProvider.onActiveAccountChanged(this.onActiveAccountChanged),this._eventEmitter=new Ce,this.registerEventListeners(),this._cache=new fa,this._graph=fe("mgt-chat",z.version),this._notificationClient=new pa(this._eventEmitter,this._graph),this.updateUserSubscription(this.userId)}return(0,A.c)(e,[{key:"tearDown",value:function(){this._notificationClient.tearDown()}},{key:"sleep",value:function(e){return new Promise((function(t){return setTimeout(t,e)}))}},{key:"raiseFatalError",value:function(e){(0,_.e5)(e),this.notifyStateChange((function(e){e.status="fatal error",e.chatThreads=[]}))}},{key:"tryLoadMoreChatThreads",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(){var t;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!this._loadPromise&&!this._loadMorePromise){e.next=3;break}return e.abrupt("return");case 3:if((t=this.getState()).moreChatThreadsToLoad){e.next=6;break}return e.abrupt("return");case 6:return(0,_.Yz)("loading more chat threads..."),e.prev=7,this._loadMorePromise=this.loadAndAppendChatThreads("",[],t.chatThreads.length+this.chatThreadsPerPage),e.next=11,this._loadMorePromise;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(7),(0,_.e5)("Failed to load more chat threads; aborting...",e.t0);case 16:return e.prev=16,this._loadMorePromise=void 0,e.finish(16);case 19:(0,_.Yz)("successfully loaded more chat threads.");case 20:case"end":return e.stop()}}),e,this,[[0,,16,19],[7,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"tryLoadChatThreads",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(){var t,n;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._loadPromise){e.next=2;break}return e.abrupt("return");case 2:if(!this._loadMorePromise){e.next=5;break}return e.next=5,this._loadMorePromise;case 5:this.notifyStateChange((function(e){e.status="loading chats",e.chatThreads=[]})),(0,_.Yz)("loading chat threads..."),e.prev=7,t=!1,n=0;case 10:return n++,e.prev=11,this._loadPromise=this.loadAndAppendChatThreads("",[],this.chatThreadsPerPage),e.next=15,this._loadPromise;case 15:t=!0,e.next=26;break;case 18:if(e.prev=18,e.t0=e.catch(11),!(n>3)){e.next=23;break}throw(0,_.e5)("Failed to load chat threads; aborting...",e.t0),Error("Failed to load chat threads even after 3 attempts; no more attempts will be made.");case 23:return(0,_.e5)("Failed to load chat threads; retrying...",e.t0),e.next=26,this.sleep(2e3);case 26:if(!t){e.next=10;break}case 27:return e.prev=27,this._loadPromise=void 0,e.finish(27);case 30:(0,_.Yz)("successfully loaded chat threads.");case 31:case"end":return e.stop()}}),e,this,[[7,,27,30],[11,18]])})));return function(){return e.apply(this,arguments)}}()},{key:"handleChatThreadsResponse",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n,a){var r,i,c,s;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.value,e.next=3,this.checkWhetherToMarkAsRead(r);case 3:if(i=e.sent,c=new Set(i.map((function(e){return e.id}))),(n=(n=n.filter((function(e){return!c.has(e.id)}))).concat(i)).sort(ma),s=t["@odata.nextLink"],!(n.length>a)){e.next=12;break}return this.handleChatThreads(n.slice(0,a),"more"),e.abrupt("return");case 12:if(!(n.length<a&&s)){e.next=16;break}return e.next=15,this.loadAndAppendChatThreads(s,n,a);case 15:return e.abrupt("return");case 16:this.handleChatThreads(n,s);case 17:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"loadAndAppendChatThreads",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t,n,a){var r;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a<1)){e.next=3;break}return(0,_.e5)("maxItem is invalid: "+a),e.abrupt("return");case 3:if(t){e.next=9;break}return e.next=6,ze(this._graph,a>50?50:a);case 6:e.t0=e.sent,e.next=12;break;case 9:return e.next=11,Be(this._graph,t.split("?")[1]);case 11:e.t0=e.sent;case 12:return r=e.t0,e.next=15,this.handleChatThreadsResponse(r,n,a);case 15:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"updateLastReadTime",value:function(e){e&&((0,_.Yz)("caching the last-read timestamp of now to chat ID '".concat(e,"'...")),this._cache.cacheLastReadTime(e,new Date))}},{key:"onStateChange",value:function(e){this._stateSubscribers.includes(e)||this._stateSubscribers.push(e)}},{key:"offStateChange",value:function(e){var t=this._stateSubscribers.indexOf(e);-1!==t&&(this._stateSubscribers=this._stateSubscribers.splice(t,1))}},{key:"notifyStateChange",value:function(e){var t=this;this._state=(0,Ge.Ut)(this._state,e),this._stateSubscribers.forEach((function(e){return e(t._state)}))}},{key:"notifyChatMessageEventChange",value:function(e){var t=this;this.notifyStateChange((function(n){var a,r,i,c,s,o,u=n.chatThreads.findIndex((function(t){return t.id===e.message.chatId})),l=n.chatThreads[u];if(l&&e.message.lastModifiedDateTime&&null!==(a=l.lastMessagePreview)&&void 0!==a&&a.createdDateTime&&e.message.lastModifiedDateTime<l.lastMessagePreview.createdDateTime)(0,_.Yz)("message is older than last message preview, ignoring",e.message);else{var d,h,p=function(e){n.chatThreads.splice(u,1),e?n.chatThreads.unshift(e):l&&n.chatThreads.unshift(l)};if("chatRenamed"===e.type&&null!==(r=e.message)&&void 0!==r&&r.eventDetail&&l)l.topic=null!==(d=null===(h=e.message.eventDetail)||void 0===h?void 0:h.chatDisplayName)&&void 0!==d?d:l.topic;else if("memberAdded"===e.type&&l)t.loadChatDetails(l.id),p();else if("memberRemoved"===e.type&&null!==(i=e.message)&&void 0!==i&&i.eventDetail&&l){var f=e.message.eventDetail.members;if(f){var m,v=new Set(f.map((function(e){return e.id})));l.members=null===(m=l.members)||void 0===m?void 0:m.filter((function(e){var t=e;return!v.has(t.userId)}))}}else if("teamsAppInstalled"===e.type&&null!==(c=e.message)&&void 0!==c&&c.eventDetail&&l){var g=e.message.eventDetail;l.lastMessagePreview={body:{content:"".concat(g.teamsAppDisplayName||g.teamsAppId," app added"),contentType:"text"},lastModifiedDateTime:e.message.lastModifiedDateTime},p()}else if("teamsAppRemoved"===e.type&&null!==(s=e.message)&&void 0!==s&&s.eventDetail&&l);else if("chatMessageEdited"===e.type&&l)l.lastMessagePreview=e.message,l.lastUpdatedDateTime=e.message.lastModifiedDateTime;else if("chatMessageDeleted"===e.type&&l)l.lastMessagePreview={lastModifiedDateTime:e.message.lastModifiedDateTime,isDeleted:!0};else if("chatMessageReceived"===e.type&&e.message&&l){var C;n.status="chat message received",n.chatMessage=e.message,l.lastMessagePreview=e.message,l.lastUpdatedDateTime=e.message.lastModifiedDateTime,n.internalSelectedChat&&n.internalSelectedChat.id===n.chatMessage.chatId||t.userId===(null===(C=e.message.from)||void 0===C||null===(C=C.user)||void 0===C?void 0:C.id)?l.isRead=!0:l.isRead=!1,p()}else if("chatMessageReceived"===e.type&&null!==(o=e.message)&&void 0!==o&&o.chatId){var b;n.status="chat message received",n.chatMessage=e.message;var x={id:e.message.chatId,lastMessagePreview:e.message,lastUpdatedDateTime:e.message.lastModifiedDateTime,isRead:t.userId===(null===(b=e.message.from)||void 0===b||null===(b=b.user)||void 0===b?void 0:b.id)};n.chatThreads.unshift(x),t.loadChatDetails(e.message.chatId)}else(0,_.Yz)("received unrecognized event type '".concat(e.type,"' from the user subscription."))}}))}},{key:"loadChatDetails",value:function(){var e=(0,D.c)((0,T.c)().mark((function e(t){var n;return(0,T.c)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ye(this._graph,t);case 3:n=e.sent,this.notifyStateChange((function(e){var a,r;e.status="chat details loaded";var i=null!==(a=null===(r=e.chatThreads)||void 0===r?void 0:r.findIndex((function(e){return e.id===t})))&&void 0!==a?a:-1;i>-1&&(e.chatThreads[i]=Object.assign(e.chatThreads[i],n))})),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),(0,_.e5)("Failed to load chat details for chat ID ".concat(t,"."),e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getSystemMessageType",value:function(e){if("systemEventMessage"===e.messageType){var t=e.eventDetail;switch(t["@odata.type"]){case"#microsoft.graph.membersAddedEventMessageDetail":return"memberAdded";case"#microsoft.graph.membersDeletedEventMessageDetail":return"memberRemoved";case"#microsoft.graph.chatRenamedEventMessageDetail":return"chatRenamed";case"#microsoft.graph.teamsAppInstalledEventMessageDetail":return"teamsAppInstalled";case"#microsoft.graph.teamsAppRemovedEventMessageDetail":return"teamsAppRemoved";default:return t["@odata.type"]}}return"chatMessageReceived"}},{key:"getState",value:function(){return this._state}},{key:"clearCurrentUserMessages",value:function(){this.notifyStateChange((function(e){e.status="initial",e.chatThreads=[]}))}},{key:"userId",get:function(){return this._userId},set:function(e){this._userId!==e&&(this._userId=e,this.notifyStateChange((function(t){t.userId=e})))}},{key:"updateUserSubscription",value:function(e){if(e){this.notifyStateChange((function(e){e.status="initial"})),this.notifyStateChange((function(e){e.status="creating server connections"}));try{this._notificationClient.subscribeToUserNotifications(e)}catch(t){(0,_.e5)("Failed to load chat data or subscribe to notications: ",t),t instanceof xe.EZ&&this.notifyStateChange((function(e){e.status="no chats"}))}}}},{key:"registerEventListeners",value:function(){var e=this;this._eventEmitter.on("chatMessageReceived",(function(t){e.onMessageReceived(t)})),this._eventEmitter.on("chatMessageDeleted",this.onMessageDeleted),this._eventEmitter.on("chatMessageEdited",(function(t){e.onMessageEdited(t)})),this._eventEmitter.on("disconnected",(function(){e.notifyStateChange((function(e){e.status="server connection lost",e.chatThreads=[]}))})),this._eventEmitter.on("connected",(function(){e.notifyStateChange((function(e){e.status="server connection established"}))}))}}]),e}(),ga=n(75864),Ca=(0,Dt.c)(wn.YPN,wn.yeo),ba={inline:!0,hasIcons:!1,closeOnScroll:!0,positioning:"below-start"},xa=(0,s.a)({menuPopover:{zIndex:10,"& .fui-MenuItemLink__content":{fontFamily:"Segoe UI",fontSize:"12px",fontStyle:"normal",fontWeight:"600"}}}),wa=function(e){var t=xa(),n=void 0===e.menuItems?[]:e.menuItems,a=(0,i.useCallback)((function(t){t.onClick(e.actions)}),[]);return i.createElement(vn.i,(0,r.c)({},ba),i.createElement(gn.E,{disableButtonEnhancement:!0},i.createElement(_t.q,{appearance:"transparent",icon:i.createElement(Ca,null)})),i.createElement(Cn.s,{className:t.menuPopover},i.createElement(bn._,null,n.map((function(e,t){return i.createElement(ga.I,{key:t,content:e.displayText,onClick:function(){return a(e)}})})))))},ya=(0,s.a)({headerContainer:{display:"flex",width:"100%",flexDirection:"row",rowGap:0,zIndex:3,paddingTop:"8px",paddingLeft:"10px",paddingRight:"10px",paddingBlockEnd:"8px"},controlsContainer:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center"},buttonIcon:(0,r.c)((0,r.c)({flexGrow:0,flexShrink:0,flexBasis:"35px"},o.uS.borderRadius("50%")),{},{marginRight:"10px",objectFit:"cover",display:"flex",alignItems:"center",justifyContent:"center"}),button:(0,r.c)((0,r.c)((0,r.c)({},o.uS.border("none")),o.uS.padding(0)),{},{minWidth:0,"&:hover":{backgroundColor:"transparent"}})}),ka=function(e){var t,n=ya(),a=void 0===e.buttonItems?[]:e.buttonItems,r=(0,i.useCallback)((function(t){t.onClick(e.actions)}),[]);return i.createElement(i.Fragment,null,0!==a.length||void 0!==e.menuItems&&0!==(null===(t=e.menuItems)||void 0===t?void 0:t.length)?i.createElement("div",{className:n.headerContainer},i.createElement("div",{className:n.controlsContainer},i.createElement("div",null,a.map((function(e,t){return i.createElement(_t.q,{key:t,className:n.button,onClick:function(){return r(e)}},i.createElement("div",{className:n.buttonIcon},i.createElement(Vt,null,e.renderIcon())))}))),i.createElement("div",null,i.createElement(wa,{actions:e.actions,menuItems:e.menuItems})))):i.createElement(i.Fragment,null))},Sa=function(){return i.createElement("p",null,"Start a new chat to communicate.")},Ea=["lastReadTimeInterval","selectedChatId","onMessageReceived","onAllMessagesRead","onLoaded","onConnectionChanged","onSelected","onUnselected","chatThreadsPerPage"],Ma=(0,s.a)({chatList:(0,r.c)((0,r.c)({display:"flex",flexDirection:"column",height:"100%"},o.uS.overflow("hidden")),{},{paddingBlockEnd:"12px"}),chatListItems:{height:"100%",visibility:"visible",paddingRight:"2px"},scrollbox:(0,r.c)((0,r.c)({},o.uS.overflow("auto")),{},{visibility:"hidden","::-webkit-scrollbar":{width:"8px"},"::-webkit-scrollbar-track":{backgroundColor:"transparent"},"::-webkit-scrollbar-thumb":{backgroundColor:"#a0a0a0"},":hover":{visibility:"visible"},":focus":{visibility:"visible"}}),fullHeight:{height:"100%"},spinner:{justifyContent:"center",display:"flex",alignItems:"center",height:"100%"},button:(0,r.c)((0,r.c)({flexDirection:"row",alignItems:"center",width:"100%"},o.uS.padding("0px")),o.uS.border("none")),error:{display:"flex",justifyContent:"center",height:"100%"},bottomWhitespace:{height:"80%",width:"100%"}}),Ia=function(e){var t,n=e.lastReadTimeInterval,r=void 0===n?3e4:n,c=e.selectedChatId,s=e.onMessageReceived,o=e.onAllMessagesRead,u=e.onLoaded,l=e.onConnectionChanged,d=e.onSelected,h=e.onUnselected,p=e.chatThreadsPerPage,f=(0,jn.c)(e,Ea),m=Ma(),v=(0,i.useState)((function(){return new va})),g=(0,a.c)(v,1)[0],C=(0,i.useState)((function(){return{markAllChatThreadsAsRead:function(){return g.markAllChatThreadsAsRead()}}})),b=(0,a.c)(C,1)[0],x=(0,i.useState)(),w=(0,a.c)(x,2),y=w[0],k=w[1],S=(0,i.useState)(),E=(0,a.c)(S,2),M=E[0],T=E[1];(0,i.useEffect)((function(){return g.onStateChange(T),function(){g.offStateChange(T)}}),[g]),(0,i.useEffect)((function(){p<1?(0,_.e5)("chatThreadsPerPage must be greater than 0!"):g.chatThreadsPerPage=p}),[g,p]),(0,i.useEffect)((function(){c?g.setSelectedChatId(c):g.clearSelectedChat()}),[g,c]),(0,i.useEffect)((function(){if(y)(0,_.e5)("lastReadTimeInterval can only be set once.");else{if(!(r<1)){k(r);var e=setInterval((function(){g.cacheLastReadTime("selected")}),r);return function(){clearInterval(e)}}(0,_.e5)("lastReadTimeInterval must be greater than 0!")}}),[g,r]),(0,i.useEffect)((function(){if(M){var e;if("chat message received"===M.status&&s&&M.chatMessage&&s(M.chatMessage),"chat selected"===M.status&&d&&M.internalSelectedChat&&d(M.internalSelectedChat),"chat unselected"===M.status&&h&&M.internalPrevSelectedChat&&h(M.internalPrevSelectedChat),"chats read"===M.status&&o&&M.chatThreads&&o(M.chatThreads.map((function(e){return e.id}))),"chats loaded"===M.status&&u)u(null!==(e=null===M||void 0===M?void 0:M.chatThreads)&&void 0!==e?e:[]);"chats loaded"===M.status&&M.fireOnSelected&&d&&M.internalSelectedChat&&d(M.internalSelectedChat),"no chats"===M.status&&u&&u([]),"server connection established"===M.status&&l&&(l(!0),g.tryLoadChatThreads().catch((function(e){return g.raiseFatalError(e)}))),"server connection lost"===M.status&&l&&l(!1)}}),[g,M,u,s,d,h,o,l]),(0,i.useEffect)((function(){return function(){(0,_.Yz)("ChatList unmounted.",g.getState()),g.tearDown()}}),[]);var D=(0,i.useCallback)((function(e){g&&g.setSelectedChat(e)}),[g]),R=void 0===f.buttonItems?[]:f.buttonItems,A=void 0===f.menuItems?[]:f.menuItems,P=["creating server connections","subscribing to notifications","loading chats"].includes(null!==(t=null===M||void 0===M?void 0:M.status)&&void 0!==t?t:""),N=(0,i.useRef)(null);return(0,i.useEffect)((function(){var e=new IntersectionObserver((function(e){var t,n=(0,I.c)(e);try{for(n.s();!(t=n.n()).done;){t.value.isIntersecting&&g&&g.tryLoadMoreChatThreads().catch((function(e){return(0,_.e5)("Failed to load more chat threads.",e)}))}}catch(a){n.e(a)}finally{n.f()}}),{root:null,rootMargin:"0px",threshold:.03});return N.current&&e.observe(N.current),function(){return e.disconnect()}}),[g,M]),i.createElement(ee.s,{fluentTheme:ae.g},i.createElement(re.i,{theme:ie.W,className:m.fullHeight},i.createElement("div",{className:m.chatList},"server connection lost"!==(null===M||void 0===M?void 0:M.status)&&b&&i.createElement(ka,{actions:b,buttonItems:R,menuItems:A}),M&&M.chatThreads.length>0?i.createElement(i.Fragment,null,i.createElement("div",{className:m.scrollbox},i.createElement("div",{className:m.chatListItems},null===M||void 0===M?void 0:M.chatThreads.map((function(e){var t;return i.createElement(_t.q,{className:m.button,key:e.id,onClick:function(){return D(e)}},i.createElement(ra,{key:e.id,chat:e,userId:M.userId,isSelected:e.id===(null===M||void 0===M||null===(t=M.internalSelectedChat)||void 0===t?void 0:t.id),isRead:e.isRead}))})),(null===M||void 0===M?void 0:M.moreChatThreadsToLoad)&&i.createElement("div",{ref:N,className:m.bottomWhitespace},"\xa0")))):i.createElement(i.Fragment,null,i.createElement("div",{className:m.error},P&&i.createElement("div",{className:m.spinner},i.createElement(bt.c,null)," ",i.createElement("br",null),null===M||void 0===M?void 0:M.status),"no chats"===(null===M||void 0===M?void 0:M.status)&&i.createElement(Pn,{icon:Nn,message:"No threads were found for this user.",subheading:Sa}),"server connection lost"===(null===M||void 0===M?void 0:M.status)&&i.createElement(Pn,{message:"We ran into a problem. Reconnecting...",subheading:Un}),"fatal error"===(null===M||void 0===M?void 0:M.status)&&i.createElement(Pn,{message:"We're sorry\u2014we've run into an issue.",subheading:Un}))))))},Ta=n(81784),Da=n(94460),Ra=n(53768),Aa=(0,s.a)({title:(0,r.c)((0,r.c)({},Ta.s.subtitle2),o.uS.marginInline("32px")),form:{display:"flex",flexDirection:"column",gridRowGap:"16px",minWidth:"300px","& textarea":{fontSize:"var(--type-ramp-base-font-size)","::placeholder":{fontSize:"var(--type-ramp-base-font-size)"}}},formButtons:{display:"flex",flexDirection:"row",justifyContent:"space-between",gridColumnGap:"8px"},sendIconContainer:{display:"flex",alignItems:"center"},sendIcon:{color:"var(--colorBrandForeground2)",cursor:"pointer"}}),Pa=function(e){var t=e.mode,n=void 0===t?"auto":t,r=e.enableToLabel,c=e.onChatCreated,s=e.onCancelClicked,o=Aa(),u=(0,i.useState)("group"===n),l=(0,a.c)(u,2),d=l[0],h=l[1],p=(0,i.useState)("initial"),f=(0,a.c)(p,2),m=f[0],v=f[1],g=(0,i.useState)([]),C=(0,a.c)(g,2),b=C[0],x=C[1],w=(0,i.useCallback)((function(e){e.detail&&(x(e.detail),"auto"===n&&h(e.detail.length>1))}),[n]),y=(0,i.useState)(""),k=(0,a.c)(y,2),S=k[0],E=k[1],M=(0,i.useCallback)((function(e,t){E(t.value)}),[]),I=(0,i.useState)(""),T=(0,a.c)(I,2),D=T[0],R=T[1],A=(0,i.useCallback)((function(e,t){R(t.value)}),[]),P=(0,i.useCallback)((function(){var e=fe("mgt-new-chat");v("creating chat");var t=[pe()];b.reduce((function(e,t){return t.id&&e.push(t.id),e}),t),Oe(e,t,d,D,S).then((function(e){v("done"),c(e)})).catch((function(e){(0,_.e5)("Failed to create chat thread:",e),v("initial")}))}),[c,b,D,S,d]);return i.createElement(re.i,{theme:ie.W},"initial"===m?i.createElement("div",{className:o.form},i.createElement(Ut.I,{label:r?"To":""},i.createElement(tn,{disabled:"oneOnOne"===n&&(null===b||void 0===b?void 0:b.length)>0||(null===b||void 0===b?void 0:b.length)>19,ariaLabel:"Select people to chat with",selectedPeople:b,selectionChanged:w,userFilters:"not(id eq '".concat(pe(),"')"),userType:"user"})),d&&i.createElement(Ut.I,{label:"Group name"},i.createElement(Ot.E,{placeholder:"Chat name",onChange:M,value:S})),i.createElement(Da.A,{placeholder:"Type your first message",size:"large",resize:"vertical",value:D,onChange:A}),i.createElement("div",{className:o.formButtons},i.createElement(_t.q,{appearance:"secondary",onClick:s},"Cancel"),i.createElement("div",{className:o.sendIconContainer},i.createElement(Ra.i3Y,{className:o.sendIcon,onClick:P})))):i.createElement(i.Fragment,null,m,"done"!==m&&i.createElement(bt.c,null)))},Na=n(9208),_a=n(9e4),La=(0,Dt.c)(sn.WeJ,sn.ibb),Ua=function(){return(0,_a.jsx)(La,{color:"var(--colorBrandForeground2)"})},Oa=(0,s.a)({container:{display:"flex",flexDirection:"row",height:"79vh"},side:(0,r.c)((0,r.c)({display:"flex",flexDirection:"column",flexWrap:"nowrap",width:"80%"},o.uS.overflow("auto")),{},{maxHeight:"80vh",height:"100%"}),newChat:{paddingBottom:"10px",marginRight:"0px",marginLeft:"auto"},dialog:{display:"block"},dialogSurface:{contain:"unset"}}),Fa=(0,i.memo)((function(e){var t=e.onSelected,n=e.onNewChat,a=e.selectedChatId,r=[{renderIcon:function(){return(0,_a.jsx)(Ua,{})},onClick:n}],c=[{displayText:"Mark all as read",onClick:function(e){return e.markAllChatThreadsAsRead()}},{displayText:"My custom menu item",onClick:function(){return console.log("My custom menu item clicked")}}],s=(0,i.useCallback)((function(e){console.log("Number of chats marked as read: ".concat(e.length))}),[]),o=(0,i.useCallback)((function(e){console.log(e.length," total chat threads loaded.")}),[]),u=(0,i.useCallback)((function(e){console.log("SampleChatLog: Message received",e)}),[]),l=i.useCallback((function(e){console.log("Connection changed: ",e)}),[]),d=(0,i.useCallback)((function(e){console.log("Unselected: ",e.id)}),[]);return(0,_a.jsx)(Ia,{selectedChatId:a,onLoaded:o,chatThreadsPerPage:10,menuItems:c,buttonItems:r,onSelected:t,onMessageReceived:u,onAllMessagesRead:s,onConnectionChanged:l,onUnselected:d})})),za=function(){var e=Oa(),t=i.useState(""),n=(0,a.c)(t,2),r=n[0],s=n[1],o=i.useState(!1),p=(0,a.c)(o,2),f=p[0],m=p[1],v=(0,Na.G)(),g=(0,a.c)(v,1)[0],C=i.useCallback((function(e){var t;r!==e.id&&s(null!==(t=e.id)&&void 0!==t?t:"")}),[r]),b=i.useCallback((function(){m(!0)}),[]),x=i.useCallback((function(e){var t;(m(!1),r!==e.id)&&s(null!==(t=e.id)&&void 0!==t?t:"")}),[r]);return(0,_a.jsxs)(_a.Fragment,{children:[(0,_a.jsx)(c.u,{title:"Chats",description:"Stay in touch with your teammates and navigate your chats"}),(0,_a.jsxs)("div",{className:e.container,children:[(0,_a.jsx)("div",{className:e.newChat,children:(0,_a.jsx)(u.C,{open:f,children:(0,_a.jsx)(l.i,{className:e.dialogSurface,children:(0,_a.jsxs)(d.a,{className:e.dialog,children:[(0,_a.jsx)(h.y,{children:"New Chat"}),(0,_a.jsx)(Pa,{onChatCreated:x,onCancelClicked:function(){return m(!1)}})]})})})}),(0,_a.jsx)("div",{className:e.side,children:g&&(0,_a.jsx)(Fa,{selectedChatId:r,onSelected:C,onNewChat:b})}),(0,_a.jsx)("div",{className:e.side,children:(0,_a.jsx)(Wn,{chatId:r})})]})]})}},73420:function(e,t,n){n.d(t,{w:function(){return i}});var a=n(60664),r=n(41640),i=(0,a.c)((function e(){(0,r.c)(this,e)}));i.sections={files:!0,mailMessages:!0,organization:{showWorksWith:!0},profile:!0},i.useContactApis=!0,i.isSendMessageVisible=!0},4480:function(e,t,n){n.d(t,{Y:function(){return i}});var a=n(83516),r=n(73420),i=function(){var e=[];return r.w.sections.files&&e.push("Sites.Read.All"),r.w.sections.mailMessages&&(e.push("Mail.Read"),e.push("Mail.ReadBasic")),r.w.sections.organization&&(e.push("User.Read.All"),r.w.sections.organization.showWorksWith&&e.push("People.Read.All")),r.w.sections.profile&&e.push("User.Read.All"),r.w.useContactApis&&e.push("Contacts.Read"),e.indexOf("User.Read.All")<0&&(e.push("User.ReadBasic.All"),e.push("User.Read")),e.indexOf("People.Read.All")<0&&e.push("People.Read"),r.w.isSendMessageVisible&&e.push("Chat.ReadWrite"),(0,a.c)(new Set(e))}},56096:function(e,t,n){n.d(t,{c:function(){return r}});var a=n(51624),r=(0,n(70051).e)("spinner",a.eC)}}]);
//# sourceMappingURL=588.00fdd382.chunk.js.map