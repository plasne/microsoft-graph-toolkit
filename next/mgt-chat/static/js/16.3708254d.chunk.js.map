{"version":3,"file":"static/js/16.3708254d.chunk.js","mappings":"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","sources":["components/PageHeader.tsx","../../../packages/mgt-chat/src/statefulClient/chatOperationScopes.ts","../../../packages/mgt-chat/src/statefulClient/GraphConfig.ts","../../../packages/mgt-chat/src/statefulClient/replaceOrAppendSessionId.ts","../../../packages/mgt-chat/src/statefulClient/Caching/SubscriptionCache.ts","../../../packages/mgt-chat/src/statefulClient/Caching/isConversationCacheEnabled.ts","../../../packages/mgt-chat/src/utils/Timer.ts","../../../packages/mgt-chat/src/statefulClient/getOrGenerateGroupId.ts","../../../packages/mgt-chat/src/statefulClient/GraphNotificationClient.ts","../../../packages/mgt-chat/src/utils/currentUser.ts","../../../packages/mgt-chat/src/utils/graph.ts","../../../packages/mgt-chat/src/statefulClient/Caching/cacheEntryIsValid.ts","../../../packages/mgt-chat/src/statefulClient/Caching/MessageCache.ts","../../../packages/mgt-chat/src/statefulClient/ThreadEventEmitter.ts","../../../packages/mgt-chat/src/statefulClient/graph.chat.ts","../../../packages/mgt-chat/src/utils/updateMessageContentWithImage.ts","../../../packages/mgt-chat/src/utils/types.ts","../../../packages/mgt-chat/src/utils/rewriteEmojiContent.ts","../../../packages/mgt-chat/src/statefulClient/buildBotId.ts","../../../packages/mgt-chat/src/statefulClient/BaseStatefulClient.ts","../../../packages/mgt-chat/src/statefulClient/StatefulGraphChatClient.ts","../../../packages/mgt-chat/src/components/UnsupportedContent/UnsupportedContent.tsx","../../../packages/mgt-chat/src/utils/chat.tsx","../../../packages/mgt-chat/src/utils/mentions.tsx","../../../packages/mgt-chat/src/components/styles/common.styles.ts","../../../packages/mgt-chat/src/components/Context/BotInfoContext.ts","../../../packages/mgt-chat/src/statefulClient/useBotInfo.ts","../../../packages/mgt-chat/src/components/ChatAvatar/BotAvatar.tsx","../../../packages/mgt-chat/src/components/ChatAvatar/ChatAvatar.tsx","../../../packages/mgt-chat/src/components/ChatHeader/useCommonHeaderStyles.tsx","../../../packages/mgt-chat/src/components/ChatHeader/OneToOneChatHeader.tsx","../../../packages/mgt-chat/src/components/Circle/Circle.tsx","../../../packages/mgt-chat/src/components/ChatIcon/ChatIcon.tsx","../../../packages/mgt-chat/src/components/ChatHeader/GroupChatHeader.tsx","../../../packages/mgt-chat/src/components/ChatHeader/ChatTitle.tsx","../../../packages/mgt-react/src/generated/people-picker.ts","../../../packages/mgt-chat/src/components/ManageChatMembers/AddChatMembers.tsx","../../../packages/mgt-chat/src/components/ManageChatMembers/ListChatMembers.tsx","../../../packages/mgt-chat/src/components/ManageChatMembers/ManageChatMembers.tsx","../../../packages/mgt-chat/src/components/ChatHeader/EllipsisMenu.tsx","../../../packages/mgt-chat/src/components/ChatHeader/ChatHeader.tsx","../../../packages/mgt-chat/src/components/Error/GenericErrorIcon.tsx","../../../packages/mgt-chat/src/components/Error/Error.tsx","../../../packages/mgt-chat/src/components/Error/LoadingMessageErrorIcon.tsx","../../../packages/mgt-chat/src/components/Error/OpenTeams.tsx","../../../packages/mgt-chat/src/components/Error/RequireAValidChatId.tsx","../../../packages/mgt-chat/src/components/Error/TypeANewMessage.tsx","../../../packages/mgt-chat/src/statefulClient/BotInfoClient.ts","../../../packages/mgt-chat/src/components/styles/registerIcons.tsx","../../../packages/mgt-chat/src/components/Chat/Chat.tsx","../../../packages/mgt-chat/src/statefulClient/useGraphChatClient.ts","../../../packages/mgt-chat/src/components/ChatListItemIcon/ChatListItemIcon.tsx","../../../packages/mgt-chat/src/components/ChatListItem/DefaultProfileIcon.tsx","../../../packages/mgt-chat/src/components/ChatListItem/ChatListItem.tsx","../../../packages/mgt-chat/src/statefulClient/GraphNotificationUserClient.ts","../../../packages/mgt-chat/src/statefulClient/Caching/LastReadCache.ts","../../../packages/mgt-chat/src/statefulClient/StatefulGraphChatListClient.ts","../../../packages/mgt-chat/src/components/ChatListHeader/EllipsisMenu.tsx","../../../packages/mgt-chat/src/components/ChatListHeader/ChatListHeader.tsx","../../../packages/mgt-chat/src/components/Error/CreateANewChat.tsx","../../../packages/mgt-chat/src/components/ChatList/ChatList.tsx","../../../packages/mgt-chat/src/components/NewChat/NewChat.tsx","pages/ChatPage.tsx","../../../packages/mgt-components/dist/es6/components/mgt-person-card/src/components/mgt-person-card/MgtPersonCardConfig.ts","../../../packages/mgt-components/dist/es6/components/mgt-person-card/src/components/mgt-person-card/getMgtPersonCardScopes.ts","../../../packages/mgt-react/src/generated/spinner.ts"],"sourcesContent":["import * as React from 'react';\nimport { Divider, makeStyles } from '@fluentui/react-components';\n\nexport interface IPageHeaderProps {\n  title: string;\n  description: string;\n}\n\nconst useStyles = makeStyles({\n  divider: {\n    alignItems: 'self-start',\n    paddingTop: '20px',\n    marginBottom: '20px'\n  }\n});\n\nexport const PageHeader: React.FunctionComponent<IPageHeaderProps> = props => {\n  const styles = useStyles();\n  return (\n    <div>\n      <h1>{props.title}</h1>\n      <div>{props.description}</div>\n      <Divider className={styles.divider} />\n    </div>\n  );\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\nimport { getMgtPersonCardScopes } from '@microsoft/mgt-components/dist/es6/exports';\n\n/**\n * The lowest count of scopes required to perform all chat operations\n */\nexport const minimalChatScopesList = [\n  'ChatMember.ReadWrite',\n  'Chat.ReadWrite',\n  'TeamsAppInstallation.ReadForChat',\n  'AppCatalog.Read.All'\n];\n\n/**\n * Object mapping chat operations to the scopes required to perform them\n */\nexport const chatOperationScopesMin: Record<string, string[]> = {\n  loadChat: ['Chat.ReadWrite'],\n  loadChatMessages: ['Chat.ReadWrite'],\n  loadChatImage: ['Chat.ReadWrite'],\n  sendChatMessage: ['Chat.ReadWrite'],\n  updateChatMessage: ['Chat.ReadWrite'],\n  deleteChatMessage: ['Chat.ReadWrite'],\n  removeChatMember: ['ChatMember.ReadWrite'],\n  addChatMember: ['ChatMember.ReadWrite'],\n  createChat: ['Chat.ReadWrite'],\n  loadBotsInChat: ['TeamsAppInstallation.ReadForChat'],\n  loadBotIcon: ['AppCatalog.Read.All']\n};\n\n/**\n * Object mapping chat operations to the scopes required to perform them\n * This should be used when we migrate this code to use scope aware requests\n */\nexport const chatOperationScopes: Record<string, string[]> = {\n  loadChat: ['Chat.ReadBasic', 'Chat.Read', 'Chat.ReadWrite'],\n  loadChatMessages: ['Chat.Read', 'Chat.ReadWrite'],\n  loadChatImage: ['ChannelMessage.Read.All', 'Chat.Read', 'Chat.ReadWrite', 'Group.Read.All', 'Group.ReadWrite.All'],\n  sendChatMessage: ['ChatMessage.Send', 'ChatMessage.Send', 'Chat.ReadWrite', 'Group.ReadWrite.All'],\n  updateChatMessage: ['ChannelMessage.ReadWrite', 'Chat.ReadWrite', 'Group.ReadWrite.All'],\n  deleteChatMessage: ['ChannelMessage.ReadWrite', 'Chat.ReadWrite'],\n  removeChatMember: ['ChatMember.ReadWrite'],\n  addChatMember: ['ChatMember.ReadWrite', 'Chat.ReadWrite'],\n  createChat: ['Chat.Create', 'Chat.ReadWrite'],\n  loadBotsInChat: [\n    'TeamsAppInstallation.ReadForChat',\n    'TeamsAppInstallation.ReadWriteSelfForChat',\n    'TeamsAppInstallation.ReadWriteForChat'\n  ],\n  loadBotIcon: ['AppCatalog.Read.All', 'AppCatalog.ReadWrite.All', 'AppCatalog.Submit']\n};\n\n/**\n * The permission set required to use the people picker to search for users\n * as defined in docs: https://learn.microsoft.com/en-us/graph/toolkit/components/people-picker#microsoft-graph-permissions\n * N.B. presence permissions not currently documented\n */\nexport const peoplePickerScopes: Record<string, string[]> = {\n  loadPresence: ['Presence.Read.All'],\n  searchUsers: ['User.ReadBasic.All'],\n  searchPeople: ['People.Read']\n};\n\n/**\n * Provides an array of the distinct scopes required for all chat operations\n */\nexport const allChatScopes = Array.from(\n  [['User.Read']]\n    .concat([minimalChatScopesList])\n    .concat(Object.values(peoplePickerScopes))\n    .concat([getMgtPersonCardScopes()])\n    .reduce((acc, scopes) => {\n      scopes.forEach(s => acc.add(s));\n      return acc;\n    }, new Set<string>())\n);\n\n/**\n * Provides an array of the distinct scopes required for all chat operations\n */\nexport const allChatListScopes = Array.from(\n  [['User.Read', 'TeamsAppInstallation.ReadForChat']]\n    .concat([minimalChatScopesList])\n    .concat(Object.values(peoplePickerScopes))\n    .concat([getMgtPersonCardScopes()])\n    .reduce((acc, scopes) => {\n      scopes.forEach(s => acc.add(s));\n      return acc;\n    }, new Set<string>())\n);\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { GraphEndpoint } from '@microsoft/mgt-element';\nimport { replaceOrAppendSessionId } from './replaceOrAppendSessionId';\n\nexport class GraphConfig {\n  public static ackAsString = false;\n\n  public static useCanary = false;\n\n  public static version = 'v1.0';\n\n  public static canarySubscriptionVersion = 'testprodv1.0e2ewebsockets';\n\n  public static webSocketsPrefix = 'websockets:';\n\n  public static get graphEndpoint(): GraphEndpoint {\n    return GraphConfig.useCanary ? 'https://canary.graph.microsoft.com' : 'https://graph.microsoft.com';\n  }\n\n  public static get baseCanaryUrl(): string {\n    return `${GraphConfig.graphEndpoint}/${this.canarySubscriptionVersion}`;\n  }\n\n  public static get subscriptionEndpoint(): string {\n    return GraphConfig.useCanary ? `${GraphConfig.baseCanaryUrl}/subscriptions` : '/subscriptions';\n  }\n\n  public static adjustNotificationUrl(url: string, sessionId = 'default'): string {\n    if (GraphConfig.useCanary && url) {\n      url = url.replace('https://graph.microsoft.com/1.0', GraphConfig.baseCanaryUrl);\n      url = url.replace('https://graph.microsoft.com/beta', GraphConfig.baseCanaryUrl);\n    }\n    url = url.replace(GraphConfig.webSocketsPrefix, '');\n    // update or append sessionid\n    url = replaceOrAppendSessionId(url, sessionId);\n    return url;\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nexport const replaceOrAppendSessionId = (url: string, sessionId: string) => {\n  // match on any whole query parameter of sessionid and include the value\n  const sessionIdRegex = /([?&]{1})sessionid=[^&]*/;\n  if (url.match(sessionIdRegex)) {\n    url = url.replace(sessionIdRegex, `$1sessionid=${sessionId}`);\n  } else {\n    const paramSeparator = url.indexOf('?') > -1 ? '&' : '?';\n    url = `${url}${paramSeparator}sessionid=${sessionId}`;\n  }\n  return url;\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { CacheItem, CacheSchema, CacheService, CacheStore, log, schemas } from '@microsoft/mgt-react';\nimport { Subscription } from '@microsoft/microsoft-graph-types';\nimport { isConversationCacheEnabled } from './isConversationCacheEnabled';\nimport { IDBPObjectStore } from 'idb';\n\nexport enum ComponentType {\n  User = 'user',\n  Chat = 'chat'\n}\n\ntype CachedSubscriptionData = CacheItem & {\n  chatId: string;\n  subscriptions: Subscription[];\n  lastAccessDateTime: string;\n  componentType: ComponentType;\n};\n\nexport class SubscriptionsCache {\n  private get cache(): CacheStore<CachedSubscriptionData> {\n    const conversation: CacheSchema = schemas.conversation;\n    return CacheService.getCache<CachedSubscriptionData>(conversation, conversation.stores.subscriptions);\n  }\n\n  public async loadSubscriptions(chatId: string): Promise<CachedSubscriptionData | undefined> {\n    if (isConversationCacheEnabled()) {\n      let data;\n      await this.cache.transaction(async (store: IDBPObjectStore<unknown, [string], string, 'readwrite'>) => {\n        data = (await store.get(chatId)) as CachedSubscriptionData | undefined;\n        if (data) {\n          data.lastAccessDateTime = new Date().toISOString();\n          await store.put(data, chatId);\n        }\n      });\n      return data || undefined;\n    }\n    return undefined;\n  }\n\n  public async cacheSubscription(\n    chatId: string,\n    componentType: ComponentType,\n    subscriptionRecord: Subscription\n  ): Promise<void> {\n    await this.cache.transaction(async (store: IDBPObjectStore<unknown, [string], string, 'readwrite'>) => {\n      log('cacheSubscription', subscriptionRecord);\n\n      let cacheEntry = (await store.get(chatId)) as CachedSubscriptionData | undefined;\n      if (cacheEntry && cacheEntry.chatId === chatId) {\n        const subIndex = cacheEntry.subscriptions.findIndex(s => s.resource === subscriptionRecord.resource);\n        if (subIndex !== -1) {\n          cacheEntry.subscriptions[subIndex] = subscriptionRecord;\n        } else {\n          cacheEntry.subscriptions.push(subscriptionRecord);\n        }\n      } else {\n        cacheEntry = {\n          chatId,\n          subscriptions: [subscriptionRecord],\n          // we're cheating a bit here to ensure that we have a defined lastAccessDateTime\n          // but we're updating the value for all cases before storing it.\n          lastAccessDateTime: '',\n          componentType\n        };\n      }\n      cacheEntry.lastAccessDateTime = new Date().toISOString();\n\n      await store.put(cacheEntry, chatId);\n    });\n  }\n\n  public deleteCachedSubscriptions(chatId: string): Promise<void> {\n    return this.cache.delete(chatId);\n  }\n\n  public loadInactiveSubscriptions(\n    inactivityThreshold: string,\n    componentType: ComponentType\n  ): Promise<CachedSubscriptionData[]> {\n    return this.cache\n      .queryDb('lastAccessDateTime', IDBKeyRange.upperBound(inactivityThreshold))\n      .then((data: CachedSubscriptionData[]) => data.filter(d => d.componentType === componentType))\n      .catch(err => {\n        // propogate the error back to the call of this function\n        throw err;\n      });\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { CacheService } from '@microsoft/mgt-react';\n\nexport const isConversationCacheEnabled = (): boolean => {\n  const conversation = CacheService.config.conversation;\n  return conversation.isEnabled && CacheService.config.isEnabled;\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { TimerWork } from './timerWorker';\n\nexport interface Work {\n  id: string;\n  callback: () => void;\n}\n\nexport class Timer {\n  private readonly worker: SharedWorker;\n  private readonly work = new Map<string, () => void>();\n  constructor() {\n    this.worker = new SharedWorker(/* webpackChunkName: \"timer-worker\" */ new URL('./timerWorker.js', import.meta.url));\n    this.worker.port.onmessage = this.onMessage;\n  }\n\n  // NOTE: this.work was increasing in size every time there was a new timeout because id was uuid()\n  // but clearTimeout was only being called on teardown.\n  public setTimeout(id: string, callback: () => void, delay: number): string {\n    const timeoutWork: TimerWork = {\n      type: 'setTimeout',\n      id,\n      delay\n    };\n\n    this.work.set(timeoutWork.id, callback);\n\n    this.worker.port.postMessage(timeoutWork);\n\n    return timeoutWork.id;\n  }\n\n  public clearTimeout(id: string): void {\n    if (this.work.has(id)) {\n      const timeoutWork: TimerWork = {\n        type: 'clearTimeout',\n        id\n      };\n      this.worker.port.postMessage(timeoutWork);\n      this.work.delete(id);\n    }\n  }\n\n  /*\n  // NOTE: setInterval is not used in the library, but it is here for reference\n  public setInterval(callback: () => void, delay: number): string {\n    const intervalWork: TimerWork = {\n      type: 'setInterval',\n      id: uuid(),\n      delay\n    };\n\n    this.work.set(intervalWork.id, callback);\n\n    this.worker.port.postMessage(intervalWork);\n\n    return intervalWork.id;\n  }\n\n  public clearInterval(id: string): void {\n    if (this.work.has(id)) {\n      const intervalWork: TimerWork = {\n        type: 'clearInterval',\n        id\n      };\n      this.worker.port.postMessage(intervalWork);\n      this.work.delete(id);\n    }\n  }\n  */\n\n  private readonly onMessage = (event: MessageEvent<TimerWork>): void => {\n    const intervalWork = event.data;\n    if (!intervalWork) {\n      return;\n    }\n\n    switch (intervalWork.type) {\n      case 'runCallback': {\n        if (this.work.has(intervalWork.id)) {\n          const work = this.work.get(intervalWork.id);\n          work?.();\n        }\n        break;\n      }\n    }\n  };\n\n  public close() {\n    this.worker.port.close();\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { v4 as uuid } from 'uuid';\n\nconst keyPrefix = 'mgt-chat-group-id';\n\n/**\n * reads a string from session storage, or if there is no string for the keyName, generate a new uuid and place in storage\n */\nexport const getOrGenerateGroupId = (chatId: string) => {\n  const key = `${keyPrefix}::${chatId}`;\n  const value = localStorage.getItem(key);\n\n  if (value) {\n    return value;\n  } else {\n    const newValue = uuid();\n    localStorage.setItem(key, newValue);\n    return newValue;\n  }\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { BetaGraph, IGraph, Providers, createFromProvider, error, log } from '@microsoft/mgt-element';\nimport { HubConnection, HubConnectionBuilder, IHttpConnectionOptions, LogLevel } from '@microsoft/signalr';\nimport { ThreadEventEmitter } from './ThreadEventEmitter';\nimport type {\n  Entity,\n  Subscription,\n  ChatMessage,\n  Chat,\n  AadUserConversationMember\n} from '@microsoft/microsoft-graph-types';\nimport { GraphConfig } from './GraphConfig';\nimport { SubscriptionsCache, ComponentType } from './Caching/SubscriptionCache';\nimport { Timer } from '../utils/Timer';\nimport { getOrGenerateGroupId } from './getOrGenerateGroupId';\nimport { v4 as uuid } from 'uuid';\n\nexport const appSettings = {\n  defaultSubscriptionLifetimeInMinutes: 10,\n  renewalThreshold: 75, // The number of seconds before subscription expires it will be renewed\n  renewalTimerInterval: 20, // The number of seconds between executions of the renewal timer\n  removalThreshold: 1 * 60, // number of seconds after the last update of a subscription to consider in inactive\n  removalTimerInterval: 1 * 60, // the number of seconds between executions of the timer to remove inactive subscriptions\n  useCanary: GraphConfig.useCanary\n};\n\ntype ChangeTypes = 'created' | 'updated' | 'deleted';\n\ninterface Notification<T extends Entity> {\n  subscriptionId: string;\n  changeType: ChangeTypes;\n  resource: string;\n  resourceData: T & {\n    id: string;\n    '@odata.type': string;\n    '@odata.id': string;\n  };\n  EncryptedContent: string;\n}\n\ntype ReceivedNotification = Notification<Chat> | Notification<ChatMessage> | Notification<AadUserConversationMember>;\n\nconst isMessageNotification = (o: Notification<Entity>): o is Notification<ChatMessage> =>\n  o.resource.includes('/messages(');\nconst isMembershipNotification = (o: Notification<Entity>): o is Notification<AadUserConversationMember> =>\n  o.resource.includes('/members');\n\nexport class GraphNotificationClient {\n  private readonly instanceId = uuid();\n  private connection?: HubConnection = undefined;\n  private renewalTimeout?: string;\n  private cleanupTimeout?: string;\n  private renewalCount = 0;\n  private chatId = '';\n  private sessionId = '';\n  private readonly subscriptionCache: SubscriptionsCache = new SubscriptionsCache();\n  private readonly timer = new Timer();\n  private get graph() {\n    return this._graph;\n  }\n  private get beta() {\n    return this._graph ? BetaGraph.fromGraph(this._graph) : undefined;\n  }\n  private get subscriptionGraph() {\n    return GraphConfig.useCanary\n      ? createFromProvider(Providers.globalProvider, GraphConfig.canarySubscriptionVersion, 'mgt-chat')\n      : this.beta;\n  }\n\n  /**\n   *\n   */\n  constructor(\n    private readonly emitter: ThreadEventEmitter,\n    private readonly _graph: IGraph | undefined\n  ) {\n    // start the cleanup timer when we create the notification client.\n    this.startCleanupTimer();\n  }\n\n  /**\n   * Removes any active timers that may exist to prevent memory leaks and perf issues.\n   * Call this method when the component that depends an instance of this class is being removed from the DOM\n   */\n  public tearDown() {\n    log('cleaning up graph notification resources');\n    if (this.cleanupTimeout) this.timer.clearTimeout(this.cleanupTimeout);\n    if (this.renewalTimeout) this.timer.clearTimeout(this.renewalTimeout);\n    this.timer.close();\n  }\n\n  private readonly getToken = async () => {\n    const token = await Providers.globalProvider.getAccessToken();\n    if (!token) throw new Error('Could not retrieve token for user');\n    return token;\n  };\n\n  // TODO: understand if this is needed under the native model\n  private readonly onReconnect = (connectionId: string | undefined) => {\n    log(`Reconnected. ConnectionId: ${connectionId || 'undefined'}`);\n    // void this.renewChatSubscriptions();\n  };\n\n  private readonly receiveNotificationMessage = (message: string) => {\n    if (typeof message !== 'string') throw new Error('Expected string from receivenotificationmessageasync');\n\n    const notification: ReceivedNotification = JSON.parse(message) as ReceivedNotification;\n    log('received notification message', notification);\n    const emitter: ThreadEventEmitter | undefined = this.emitter;\n    if (!notification.resourceData) throw new Error('Message did not contain resourceData');\n    if (isMessageNotification(notification)) {\n      this.processMessageNotification(notification, emitter);\n    } else if (isMembershipNotification(notification)) {\n      this.processMembershipNotification(notification, emitter);\n    } else {\n      this.processChatPropertiesNotification(notification, emitter);\n    }\n    // Need to return a status code string of 200 so that graph knows the message was received and doesn't re-send the notification\n    const ackMessage: unknown = { StatusCode: '200' };\n    return GraphConfig.ackAsString ? JSON.stringify(ackMessage) : ackMessage;\n  };\n\n  private processMessageNotification(notification: Notification<ChatMessage>, emitter: ThreadEventEmitter | undefined) {\n    const message = notification.resourceData;\n\n    switch (notification.changeType) {\n      case 'created':\n        emitter?.chatMessageReceived(message);\n        return;\n      case 'updated':\n        emitter?.chatMessageEdited(message);\n        return;\n      case 'deleted':\n        emitter?.chatMessageDeleted(message);\n        return;\n      default:\n        throw new Error('Unknown change type');\n    }\n  }\n\n  private processMembershipNotification(\n    notification: Notification<AadUserConversationMember>,\n    emitter: ThreadEventEmitter | undefined\n  ) {\n    const member = notification.resourceData;\n    switch (notification.changeType) {\n      case 'created':\n        emitter?.participantAdded(member);\n        return;\n      case 'deleted':\n        emitter?.participantRemoved(member);\n        return;\n      default:\n        throw new Error('Unknown change type');\n    }\n  }\n\n  private processChatPropertiesNotification(notification: Notification<Chat>, emitter: ThreadEventEmitter | undefined) {\n    const chat = notification.resourceData;\n    switch (notification.changeType) {\n      case 'updated':\n        emitter?.chatThreadPropertiesUpdated(chat);\n        return;\n      case 'deleted':\n        emitter?.chatThreadDeleted(chat);\n        return;\n      default:\n        throw new Error('Unknown change type');\n    }\n  }\n\n  private readonly cacheSubscription = async (subscriptionRecord: Subscription): Promise<void> => {\n    log(subscriptionRecord);\n\n    await this.subscriptionCache.cacheSubscription(this.chatId, ComponentType.Chat, subscriptionRecord);\n\n    // only start timer once. undefined for renewalInterval is semaphore it has stopped.\n    if (this.renewalTimeout === undefined) this.startRenewalTimer();\n  };\n\n  private async subscribeToResource(resourcePath: string, changeTypes: ChangeTypes[]) {\n    try {\n      // build subscription request\n      const expirationDateTime = new Date(\n        new Date().getTime() + appSettings.defaultSubscriptionLifetimeInMinutes * 60 * 1000\n      ).toISOString();\n      const subscriptionDefinition: Subscription = {\n        changeType: changeTypes.join(','),\n        notificationUrl: `${GraphConfig.webSocketsPrefix}?groupId=${getOrGenerateGroupId(this.chatId)}`,\n        resource: resourcePath,\n        expirationDateTime,\n        includeResourceData: true,\n        clientState: 'wsssecret'\n      };\n\n      log('subscribing to changes for ' + resourcePath);\n      const subscriptionEndpoint = GraphConfig.subscriptionEndpoint;\n      const subscriptionGraph = this.subscriptionGraph;\n      if (!subscriptionGraph) return;\n      // send subscription POST to Graph\n      const subscription: Subscription = (await subscriptionGraph\n        .api(subscriptionEndpoint)\n        .post(subscriptionDefinition)) as Subscription;\n      if (!subscription?.notificationUrl) throw new Error('Subscription not created');\n      log(subscription);\n\n      const awaits: Promise<void>[] = [];\n      // Cache the subscription in storage for re-hydration on page refreshes\n      awaits.push(this.cacheSubscription(subscription));\n\n      // create a connection to the web socket if one does not exist\n      if (!this.connection) awaits.push(this.createSignalRConnection(subscription.notificationUrl));\n\n      log('Invoked CreateSubscription');\n      return Promise.all(awaits);\n    } catch (e) {\n      // this catches other unhandled exceptions such as when subscription.post fails\n      return Promise.reject(e);\n    }\n  }\n\n  private readonly startRenewalTimer = () => {\n    if (this.renewalTimeout) this.timer.clearTimeout(this.renewalTimeout);\n    this.renewalTimeout = this.timer.setTimeout(\n      'renewal:' + this.instanceId,\n      this.syncRenewalTimerWrapper,\n      appSettings.renewalTimerInterval * 1000\n    );\n    log(`Start renewal timer . Id: ${this.renewalTimeout}`);\n  };\n\n  private readonly syncRenewalTimerWrapper = () => void this.renewalTimer();\n\n  private readonly renewalTimer = async () => {\n    try {\n      log(`running subscription renewal timer for chatId: ${this.chatId} sessionId: ${this.sessionId}`);\n      const subscriptions = (await this.subscriptionCache.loadSubscriptions(this.chatId))?.subscriptions || [];\n      if (subscriptions.length === 0) {\n        log(`No subscriptions found in session state. Stop renewal timer ${this.renewalTimeout}.`);\n        if (this.renewalTimeout) this.timer.clearTimeout(this.renewalTimeout);\n        return;\n      }\n\n      for (const subscription of subscriptions) {\n        if (!subscription.expirationDateTime) continue;\n        const expirationTime = new Date(subscription.expirationDateTime);\n        const now = new Date();\n        const diff = Math.round((expirationTime.getTime() - now.getTime()) / 1000);\n\n        if (diff <= appSettings.renewalThreshold) {\n          this.renewalCount++;\n          log(`Renewing Graph subscription. RenewalCount: ${this.renewalCount}`);\n          // stop interval to prevent new invokes until refresh is ready.\n          if (this.renewalTimeout) this.timer.clearTimeout(this.renewalTimeout);\n          this.renewalTimeout = undefined;\n          await this.renewChatSubscriptions();\n          // There is one subscription that need expiration, all subscriptions will be renewed\n          break;\n        }\n      }\n    } catch (e) {\n      error(e);\n    }\n    this.renewalTimeout = this.timer.setTimeout(\n      'renewal:' + this.instanceId,\n      this.syncRenewalTimerWrapper,\n      appSettings.renewalTimerInterval * 1000\n    );\n  };\n\n  public renewChatSubscriptions = async () => {\n    const expirationTime = new Date(\n      new Date().getTime() + appSettings.defaultSubscriptionLifetimeInMinutes * 60 * 1000\n    );\n\n    const subscriptionCache = await this.subscriptionCache.loadSubscriptions(this.chatId);\n    const awaits: Promise<unknown>[] = [];\n    for (const subscription of subscriptionCache?.subscriptions || []) {\n      if (!subscription.id) continue;\n      // the renewSubscription method caches the updated subscription to track the new expiration time\n      awaits.push(this.renewSubscription(subscription.id, expirationTime.toISOString()));\n      log(`Invoked RenewSubscription ${subscription.id}`);\n    }\n    await Promise.all(awaits);\n    if (!this.renewalTimeout) {\n      this.renewalTimeout = this.timer.setTimeout(\n        'renewal:' + this.instanceId,\n        this.syncRenewalTimerWrapper,\n        appSettings.renewalTimerInterval * 1000\n      );\n    }\n  };\n\n  public renewSubscription = async (subscriptionId: string, expirationDateTime: string): Promise<void> => {\n    // PATCH /subscriptions/{id}\n    try {\n      const renewedSubscription = (await this.graph\n        ?.api(`${GraphConfig.subscriptionEndpoint}/${subscriptionId}`)\n        .patch({\n          expirationDateTime\n        })) as Subscription | undefined;\n      if (renewedSubscription) return this.cacheSubscription(renewedSubscription);\n    } catch (e) {\n      return Promise.reject(e);\n    }\n  };\n\n  public async createSignalRConnection(notificationUrl: string) {\n    const connectionOptions: IHttpConnectionOptions = {\n      accessTokenFactory: this.getToken,\n      withCredentials: false\n    };\n    const connection = new HubConnectionBuilder()\n      .withUrl(GraphConfig.adjustNotificationUrl(notificationUrl, this.sessionId), connectionOptions)\n      .withAutomaticReconnect()\n      .configureLogging(LogLevel.Information)\n      .build();\n\n    connection.onreconnected(this.onReconnect);\n\n    connection.on('receivenotificationmessageasync', this.receiveNotificationMessage);\n\n    connection.on('EchoMessage', log);\n\n    this.connection = connection;\n    try {\n      await connection.start();\n      log(connection);\n    } catch (e) {\n      error('An error occurred connecting to the notification web socket', e);\n    }\n  }\n\n  private async deleteSubscription(id: string) {\n    try {\n      await this.graph?.api(`${GraphConfig.subscriptionEndpoint}/${id}`).delete();\n    } catch (e) {\n      error(e);\n    }\n  }\n\n  private async removeSubscriptions(subscriptions: Subscription[]): Promise<unknown[]> {\n    const tasks: Promise<unknown>[] = [];\n    for (const s of subscriptions) {\n      // if there is no id or the subscription is expired, skip\n      if (!s.id || (s.expirationDateTime && new Date(s.expirationDateTime) <= new Date())) continue;\n      tasks.push(this.deleteSubscription(s.id));\n    }\n    return Promise.all(tasks);\n  }\n\n  private startCleanupTimer() {\n    this.cleanupTimeout = this.timer.setTimeout(\n      'cleanup:' + this.instanceId,\n      this.cleanupTimerSync,\n      appSettings.removalTimerInterval * 1000\n    );\n  }\n\n  private readonly cleanupTimerSync = () => {\n    void this.cleanupTimer();\n  };\n\n  private readonly cleanupTimer = async () => {\n    try {\n      log(`running cleanup timer`);\n\n      // ensure there is a valid user\n      const id = await Providers.getCacheId();\n      if (!id) {\n        return;\n      }\n\n      // get the inactive subs (requires a user since the db is per user)\n      const offset = Math.min(\n        appSettings.removalThreshold * 1000,\n        appSettings.defaultSubscriptionLifetimeInMinutes * 60 * 1000\n      );\n      const threshold = new Date(new Date().getTime() - offset).toISOString();\n      const inactiveSubs = await this.subscriptionCache.loadInactiveSubscriptions(threshold, ComponentType.Chat);\n\n      // remove all subscriptions\n      let tasks: Promise<unknown>[] = [];\n      for (const inactive of inactiveSubs) {\n        tasks.push(this.removeSubscriptions(inactive.subscriptions));\n      }\n      await Promise.all(tasks);\n\n      // delete the cache entries\n      tasks = [];\n      for (const inactive of inactiveSubs) {\n        tasks.push(this.subscriptionCache.deleteCachedSubscriptions(inactive.chatId));\n      }\n    } catch (e) {\n      // EXAMPLE: a user does a sign-out so `loadInactiveSubscriptions` no longer has a valid user and results\n      //    in an exception.\n      error(e);\n    } finally {\n      this.startCleanupTimer();\n    }\n  };\n\n  public async closeSignalRConnection() {\n    // stop the connection and set it to undefined so it will reconnect when next subscription is created.\n    await this.connection?.stop();\n    this.connection = undefined;\n  }\n\n  public async subscribeToChatNotifications(chatId: string, sessionId: string) {\n    this.chatId = chatId;\n    this.sessionId = sessionId;\n    // MGT uses a per-user cache, so no concerns of loading the cached data for another user.\n    const cacheData = await this.subscriptionCache.loadSubscriptions(chatId);\n    if (cacheData) {\n      // check subscription validity & renew if all still valid otherwise recreate\n      const someExpired = cacheData.subscriptions.some(\n        s => s.expirationDateTime && new Date(s.expirationDateTime) <= new Date()\n      );\n      // for a given user + app + chatId + sessionId they only get one websocket and receive all notifications via that websocket.\n      const webSocketUrl = cacheData.subscriptions.find(s => s.notificationUrl)?.notificationUrl;\n      if (!someExpired && webSocketUrl) {\n        // if we have a websocket url and all the subscriptions are valid, we can reuse the websocket and return before recreating subscriptions.\n        await this.createSignalRConnection(webSocketUrl);\n        await this.renewChatSubscriptions();\n        return;\n      } else if (someExpired) {\n        // if some are expired, remove them and continue to recreate the subscription\n        await this.removeSubscriptions(cacheData.subscriptions);\n      }\n      await this.subscriptionCache.deleteCachedSubscriptions(chatId);\n    }\n    const promises: Promise<unknown>[] = [];\n    promises.push(this.subscribeToResource(`/chats/${chatId}/messages`, ['created', 'updated', 'deleted']));\n    promises.push(this.subscribeToResource(`/chats/${chatId}/members`, ['created', 'deleted']));\n    promises.push(this.subscribeToResource(`/chats/${chatId}`, ['updated', 'deleted']));\n    await Promise.all(promises).catch((e: Error) => {\n      this?.emitter.graphNotificationClientError(e);\n    });\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { ProviderState, Providers } from '@microsoft/mgt-element';\n\nconst getCurrentUser = () =>\n  Providers.globalProvider.state === ProviderState.SignedIn ? Providers.globalProvider.getActiveAccount?.() : undefined;\nconst currentUserId = () => getCurrentUser()?.id.split('.')[0] || '';\nconst currentUserName = () => getCurrentUser()?.name || '';\n\nexport { getCurrentUser, currentUserId, currentUserName };\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { IGraph, Providers } from '@microsoft/mgt-element';\n\nexport const graph = (component: string, version?: string): IGraph => {\n  if (!component) throw new Error('Component name is required');\n  return Providers.globalProvider?.graph.forComponent(component, version);\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { CacheItem, CacheService } from '@microsoft/mgt-react';\n\n/**\n * Defines the expiration time\n */\nconst getConversationCacheInvalidationTime = (): number => {\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n  const conversation = CacheService.config.conversation;\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-return, @typescript-eslint/no-unsafe-member-access\n  return conversation.invalidationPeriod || CacheService.config.defaultInvalidationPeriod;\n};\n\nexport const cacheEntryIsValid = (cacheEntry: CacheItem) =>\n  cacheEntry.timeCached && getConversationCacheInvalidationTime() > Date.now() - cacheEntry.timeCached;\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { CacheItem, CacheSchema, CacheService, CacheStore, schemas } from '@microsoft/mgt-react';\nimport { ChatMessage } from '@microsoft/microsoft-graph-types';\nimport { GraphCollection } from '../graph.chat';\nimport { isConversationCacheEnabled } from './isConversationCacheEnabled';\nimport { cacheEntryIsValid } from './cacheEntryIsValid';\n\ninterface CachedMessageData extends CacheItem, GraphCollection<ChatMessage> {\n  chatId: string;\n  lastModifiedDateTime: string; // ISO 8601 timestamp, should be max from values in messages\n}\n\nexport class MessageCache {\n  private get cache(): CacheStore<CachedMessageData> {\n    const conversation: CacheSchema = schemas.conversation;\n    return CacheService.getCache<CachedMessageData>(conversation, conversation.stores.chats);\n  }\n\n  public async loadMessages(chatId: string): Promise<CachedMessageData | null | undefined> {\n    if (isConversationCacheEnabled()) {\n      const data = await this.cache.getValue(chatId);\n      if (data && cacheEntryIsValid(data)) return data;\n    }\n    return undefined;\n  }\n\n  public async cacheMessages(\n    chatId: string,\n    messages: ChatMessage[],\n    updateNextLink = false,\n    nextLink?: string\n  ): Promise<CachedMessageData> {\n    const cachedData = await this.cache.getValue(chatId);\n    if (!cachedData) {\n      const maxLastModifiedDateTime = messages.reduce((acc: string, curr: ChatMessage) => {\n        if (curr.lastModifiedDateTime && curr.lastModifiedDateTime > acc) acc = curr.lastModifiedDateTime;\n        return acc;\n      }, '');\n      const data = {\n        chatId,\n        value: messages,\n        lastModifiedDateTime: maxLastModifiedDateTime,\n        nextLink\n      };\n      // nothing cached, create and store.\n      await this.cache.putValue(chatId, data);\n      return data;\n    } else {\n      // need to iterate through the messages and either push or splice them into the array.\n      messages.forEach(m => this.addMessageToCacheData(m, cachedData));\n      if (updateNextLink) {\n        cachedData.nextLink = nextLink;\n      }\n      // update persisted data\n      await this.cache.putValue(chatId, cachedData);\n      return cachedData;\n    }\n  }\n\n  public async cacheMessage(chatId: string, message: ChatMessage): Promise<void> {\n    const cachedData = await this.cache.getValue(chatId);\n    if (!cachedData) {\n      // nothing cached, create and store.\n      await this.cache.putValue(chatId, {\n        chatId,\n        value: [message],\n        lastModifiedDateTime: message.lastModifiedDateTime || ''\n      });\n    } else {\n      this.addMessageToCacheData(message, cachedData);\n      // update persisted data\n      await this.cache.putValue(chatId, cachedData);\n    }\n  }\n\n  private addMessageToCacheData(message: ChatMessage, cachedData: CachedMessageData) {\n    const spliceIndex = cachedData.value.findIndex(m => m.id === message.id);\n    if (spliceIndex !== -1) {\n      cachedData.value.splice(spliceIndex, 1, message);\n    } else {\n      cachedData.value.push(message);\n    }\n    // coerce potential nullish values to an empty string to allow comparison\n    if (message.lastModifiedDateTime && message.lastModifiedDateTime > (cachedData.lastModifiedDateTime ?? ''))\n      cachedData.lastModifiedDateTime = message.lastModifiedDateTime;\n  }\n\n  public async deleteMessage(chatId: string, message: ChatMessage) {\n    const cachedData = await this.cache.getValue(chatId);\n    // for now we're ignoring the case where we didn't find anything in the cache for the given chatId as there's nothing to delete.\n    if (cachedData) {\n      const spliceIndex = cachedData.value.findIndex(m => m.id === message.id);\n      cachedData.value.splice(spliceIndex, 1);\n      await this.cache.putValue(chatId, cachedData);\n    }\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport { ReadReceiptReceivedEvent, TypingIndicatorReceivedEvent } from '@azure/communication-signaling';\nimport { AadUserConversationMember, Chat, ChatMessage } from '@microsoft/microsoft-graph-types';\nimport { EventEmitter } from 'events';\n\nexport type ChatEvent =\n  | 'chatMessageReceived'\n  | 'chatMessageEdited'\n  | 'chatMessageDeleted'\n  | 'typingIndicatorReceived'\n  | 'readReceiptReceived'\n  | 'chatThreadDeleted'\n  | 'chatThreadPropertiesUpdated'\n  | 'participantAdded'\n  | 'participantRemoved'\n  | 'disconnected'\n  | 'connected'\n  | 'reconnected'\n  | 'notificationsSubscribedForResource'\n  | 'graphNotificationClientError';\n\nexport class ThreadEventEmitter {\n  private readonly emitter: EventEmitter = new EventEmitter();\n\n  on(event: ChatEvent, listener: (...args: any[]) => void) {\n    this.emitter.on(event, listener);\n  }\n\n  off(event: ChatEvent, listener: (...args: any[]) => void) {\n    this.emitter.off(event, listener);\n  }\n\n  chatMessageReceived(e: ChatMessage) {\n    this.emitter.emit('chatMessageReceived', e);\n  }\n  chatMessageEdited(e: ChatMessage) {\n    this.emitter.emit('chatMessageEdited', e);\n  }\n  chatMessageDeleted(e: ChatMessage) {\n    this.emitter.emit('chatMessageDeleted', e);\n  }\n  typingIndicatorReceived(e: TypingIndicatorReceivedEvent) {\n    this.emitter.emit('typingIndicatorReceived', e);\n  }\n  readReceiptReceived(e: ReadReceiptReceivedEvent) {\n    this.emitter.emit('readReceiptReceived', e);\n  }\n  chatThreadDeleted(e: Chat) {\n    this.emitter.emit('chatThreadDeleted', e);\n  }\n  chatThreadPropertiesUpdated(e: Chat) {\n    this.emitter.emit('chatThreadPropertiesUpdated', e);\n  }\n  participantAdded(e: AadUserConversationMember) {\n    this.emitter.emit('participantAdded', e);\n  }\n  participantRemoved(e: AadUserConversationMember) {\n    this.emitter.emit('participantRemoved', e);\n  }\n  notificationsSubscribedForResource(resouce: string) {\n    this.emitter.emit('notificationsSubscribedForResource', resouce);\n  }\n  disconnected() {\n    this.emitter.emit('disconnected');\n  }\n  connected() {\n    this.emitter.emit('connected');\n  }\n  graphNotificationClientError(error: Error) {\n    this.emitter.emit('graphNotificationClientError', error);\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport {\n  schemas,\n  CachePhoto,\n  getPhotoInvalidationTime,\n  storePhotoInCache,\n  blobToBase64\n} from '@microsoft/mgt-components';\nimport { BetaGraph, CacheService, IGraph, prepScopes } from '@microsoft/mgt-element';\nimport { ResponseType } from '@microsoft/microsoft-graph-client';\nimport { AadUserConversationMember, Chat, ChatMessage, Chat as GraphChat } from '@microsoft/microsoft-graph-types';\nimport { chatOperationScopes } from './chatOperationScopes';\nimport { TeamsAppInstallation } from '@microsoft/microsoft-graph-types-beta';\n\n/**\n * Generic collection response from graph\n */\nexport interface GraphCollection<T = any> {\n  '@odata.nextLink'?: string;\n  nextLink?: string;\n  value: T[];\n}\n\n/**\n * Object representing a collection of chat messages\n */\nexport type MessageCollection = GraphCollection<ChatMessage>;\nexport type ChatThreadCollection = GraphCollection<GraphChat>;\nexport type AppCollection = GraphCollection<TeamsAppInstallation>;\n\n/**\n * Load the specified chat from graph with the members expanded\n *\n * @param graph authenticated graph client from mgt\n * @param chatId the id of the chat to load\n * @returns {Promise<Chat>}\n */\nexport const loadChat = async (graph: IGraph, chatId: string): Promise<Chat> =>\n  (await graph\n    .api(`/chats/${chatId}?$expand=members`)\n    .middlewareOptions(prepScopes(chatOperationScopes.loadChat))\n    .get()) as Chat;\n\n/**\n * Load the specified chat from graph with the members and last message expanded\n *\n * @param graph authenticated graph client from mgt\n * @param chatId the id of the chat to load\n * @returns {Promise<Chat>}\n */\nexport const loadChatWithPreview = async (graph: IGraph, chatId: string): Promise<Chat> =>\n  (await graph\n    .api(`/chats/${chatId}?$expand=members,lastMessagePreview`)\n    .middlewareOptions(prepScopes(chatOperationScopes.loadChat))\n    .get()) as Chat;\n\n/**\n * Load the first page of messages from the specified chat\n * Will provide a nextLink to load more messages if there are more than the specified messageCount\n *\n * @param graph authenticated graph client from mgt\n * @param chatId the id of the chat to load messages from\n * @param messageCount how many messages to load per page\n * @returns {Promise<MessageCollection>} a collection of messages and a possible nextLink to load more messages\n */\nexport const loadChatThread = async (\n  graph: IGraph,\n  chatId: string,\n  messageCount: number\n): Promise<MessageCollection> => {\n  const response = (await graph\n    .api(`/chats/${chatId}/messages`)\n    .orderby('createdDateTime DESC')\n    .top(messageCount)\n    .middlewareOptions(prepScopes(chatOperationScopes.loadChatMessages))\n    .get()) as MessageCollection;\n  // split the nextLink on version to maintain a relative path\n  response.nextLink = response['@odata.nextLink']?.split(graph.version)[1];\n  return response;\n};\n\n/**\n * Load the app information for the specified botId in a given chat\n *\n * @param graph {BetaGraph} - authenticated graph client from mgt for the beta endpoints\n * @param chatId {string} - the id of the chat to load apps for\n * @param botId {string} - the id of the bot to load apps for\n * @returns {Promise<AppCollection>} - a collection of apps installed in the chat\n */\nexport const loadBotInChat = async (graph: BetaGraph, chatId: string, botId: string): Promise<AppCollection> => {\n  const response = (await graph\n    .api(`/chats/${chatId}/installedApps`)\n    .expand('teamsApp,teamsAppDefinition($expand=bot,colorIcon)')\n    .filter(`teamsAppDefinition/bot/id+eq+'${botId}'`)\n    .middlewareOptions(prepScopes(chatOperationScopes.loadBotsInChat))\n    .get()) as AppCollection;\n  return response;\n};\n\nexport const loadBotIcon = async (graph: BetaGraph, installedApp: TeamsAppInstallation): Promise<string> => {\n  if (installedApp.teamsApp?.distributionMethod === 'store') {\n    return loadStoreBotIcon(installedApp);\n  }\n  return loadLobBotIcon(graph, installedApp);\n};\n\nconst loadLobBotIcon = async (graph: BetaGraph, installedApp: TeamsAppInstallation): Promise<string> => {\n  // GET /appCatalogs/teamsApps/{teams-app-id}/appDefinitions/{app-definition-id}/colorIcon/hostedContent/$value\n  if (installedApp.teamsApp?.id && installedApp.teamsAppDefinition?.id) {\n    const teamsAppId = installedApp.teamsApp.id;\n    const appDefinitionId = installedApp.teamsAppDefinition.id;\n    const response = (await graph\n      .api(`/appCatalogs/teamsApps/${teamsAppId}/appDefinitions/${appDefinitionId}/colorIcon/hostedContent/$value`)\n      .responseType(ResponseType.RAW)\n      .middlewareOptions(prepScopes(chatOperationScopes.loadBotIcon))\n      .get()) as Response;\n\n    return await blobToBase64(await response.blob());\n  }\n  return '';\n};\n\nconst loadStoreBotIcon = async (installedApp: TeamsAppInstallation): Promise<string> => {\n  if (!installedApp.teamsAppDefinition?.colorIcon?.webUrl) return '';\n\n  const response = await fetch(installedApp.teamsAppDefinition.colorIcon.webUrl);\n\n  return await blobToBase64(await response.blob());\n};\n\n/**\n * Load the first page of messages from the specified chat which were modified after the specified timestamp\n * Will provide a nextLink to load more messages if there are more than the specified messageCount\n *\n * @param graph authenticated graph client from mgt\n * @param chatId the id of the chat to load messages from\n * @param lastModified the ISO 8601 timestamp after which data should be loaded from.\n * @param messageCount how many messages to load per page\n * @returns {Promise<MessageCollection>} a collection of messages and a possible nextLink to load more messages\n */\nexport const loadChatThreadDelta = async (\n  graph: IGraph,\n  chatId: string,\n  lastModified: string,\n  messageCount: number\n): Promise<MessageCollection> => {\n  const response = (await graph\n    .api(`/chats/${chatId}/messages`)\n    .filter(`lastModifiedDateTime gt ${lastModified}`)\n    .orderby('lastModifiedDateTime DESC')\n    .top(messageCount)\n    .middlewareOptions(prepScopes(chatOperationScopes.loadChatMessages))\n    .get()) as MessageCollection;\n  // split the nextLink on version to maintain a relative path\n  response.nextLink = response['@odata.nextLink']?.split(graph.version)[1];\n  return response;\n};\n\n/**\n * Loads another page of messages from the specified chat\n *\n * @param graph authenticated graph client from mgt\n * @param nextLink the nextLink to load more messages from\n * @returns {Promise<MessageCollection>} a collection of messages and a possible nextLink to load more messages\n */\nexport const loadMoreChatMessages = async (graph: IGraph, nextLink: string): Promise<MessageCollection> => {\n  // not defining scopes here because this uses a nextLink and the initial request ensures the required scopes are present\n  const response = (await graph.api(nextLink).get()) as MessageCollection;\n  // split the nextLink on version to maintain a relative path\n  response.nextLink = response['@odata.nextLink']?.split(graph.version)[1];\n  return response;\n};\n\nexport const loadBotsInChat = async (graph: IGraph, chatId: string): Promise<AppCollection> => {\n  const response = (await graph\n    .api(`/chats/${chatId}/installedApps`)\n    .filter('teamsAppDefinition/bot/id ne null')\n    .expand('teamsAppDefinition($expand=bot)')\n    .middlewareOptions(prepScopes(chatOperationScopes.loadBotsInChat))\n    .get()) as AppCollection;\n  return response;\n};\n\n/**\n * Creates a new chat message via HTTP POST\n *\n * @param graph authenticated graph client from mgt\n * @param chatId id of the chat to send the message to\n * @param content content of the message to send\n * @returns {Promise<ChatMessage>} the newly created message\n */\nexport const sendChatMessage = async (graph: IGraph, chatId: string, content: string): Promise<ChatMessage> => {\n  // TODO: remove this code that lets me simulate a failure during debugging\n  // let fail = false;\n\n  // debugger;\n  // if (fail) throw new Error('fail');\n\n  return (await graph\n    .api(`/chats/${chatId}/messages`)\n    .middlewareOptions(prepScopes(chatOperationScopes.sendChatMessage))\n    .post({ body: { content } })) as ChatMessage;\n};\n\n/**\n * Updates a chat message via HTTP PATCH\n *\n * @param graph authenticated graph client from mgt\n * @param chatId the id of the chat containing the message to update\n * @param messageId the id of the message to update\n * @param content the new content of the message\n * @returns {Promise<void>}\n */\nexport const updateChatMessage = async (\n  graph: IGraph,\n  chatId: string,\n  messageId: string,\n  content: string\n): Promise<void> => {\n  // TODO: remove this code that lets me simulate a failure during debugging\n  // let fail = false;\n\n  // debugger;\n  // if (fail) throw new Error('fail');\n\n  await graph\n    .api(`/chats/${chatId}/messages/${messageId}`)\n    .middlewareOptions(prepScopes(chatOperationScopes.updateChatMessage))\n    .patch({ body: { content } });\n};\n\n/**\n * Deletes a chat message via HTTP POST to the softDelete action\n *\n * @param graph authenticated graph client from mgt\n * @param chatId the id of the chat containing the message to delete\n * @param messageId the id of the message to delete\n * @returns {Promise<void>}\n */\nexport const deleteChatMessage = async (graph: IGraph, chatId: string, messageId: string): Promise<void> => {\n  await graph\n    .api(`/me/chats/${chatId}/messages/${messageId}/softDelete`)\n    .middlewareOptions(prepScopes(chatOperationScopes.deleteChatMessage))\n    .post({});\n};\n\nexport const removeChatMember = async (graph: IGraph, chatId: string, membershipId: string): Promise<void> => {\n  await graph\n    .api(`/chats/${chatId}/members/${membershipId}`)\n    .middlewareOptions(prepScopes(chatOperationScopes.removeChatMember))\n    .delete();\n};\n\nexport const addChatMembers = async (\n  graph: IGraph,\n  chatId: string,\n  userIds: string[],\n  visibleHistoryStartDateTime?: Date\n): Promise<void> => {\n  const body = {\n    requests: userIds.map((userId: string, index: number) => {\n      const addRequestBody: AadUserConversationMember & { '@odata.type': string; 'user@odata.bind': string } = {\n        '@odata.type': '#microsoft.graph.aadUserConversationMember',\n        'user@odata.bind': `https://graph.microsoft.com/v1.0/users/${userId}`,\n        roles: ['owner']\n      };\n      if (visibleHistoryStartDateTime) {\n        addRequestBody.visibleHistoryStartDateTime = visibleHistoryStartDateTime.toISOString();\n      }\n      return {\n        id: index,\n        method: 'POST',\n        url: `/chats/${chatId}/members`,\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: addRequestBody\n      };\n    })\n  };\n\n  await graph.api('$batch').middlewareOptions(prepScopes(chatOperationScopes.addChatMember)).post(body);\n};\n/**\n * Whether or not the cache is enabled\n */\nexport const isPhotoCacheEnabled = (): boolean => CacheService.config.photos.isEnabled && CacheService.config.isEnabled;\n\nexport const loadChatImage = async (graph: IGraph, url: string): Promise<string | null> => {\n  let cachedPhoto: CachePhoto | null;\n\n  // attempt to get user and photo from cache if enabled\n  if (isPhotoCacheEnabled()) {\n    const cache = CacheService.getCache<CachePhoto>(schemas.photos, schemas.photos.stores.teams);\n    cachedPhoto = await cache.getValue(url);\n    if (\n      cachedPhoto?.timeCached &&\n      cachedPhoto.photo &&\n      getPhotoInvalidationTime() > Date.now() - cachedPhoto.timeCached\n    ) {\n      return cachedPhoto.photo;\n    }\n  }\n  const response = (await graph\n    .api(url)\n    .responseType(ResponseType.RAW)\n    .middlewareOptions(prepScopes(chatOperationScopes.loadChatImage))\n    .get()) as Response & { '@odata.mediaEtag'?: string };\n\n  if (response.status === 404) {\n    // 404 means the resource does not have a photo\n    // we still want to cache that state\n    // so we return an object that can be cached\n    cachedPhoto = { eTag: undefined, photo: undefined };\n  } else if (!response.ok) {\n    return null;\n  }\n\n  const eTag = response['@odata.mediaEtag'];\n  const blob = await blobToBase64(await response.blob());\n\n  cachedPhoto = { eTag, photo: blob };\n  await storePhotoInCache(url, schemas.photos.stores.teams, cachedPhoto);\n  return blob;\n};\n\n/**\n * Creates a new chat thread via HTTP POST\n *\n * @param graph authenticated graph client from mgt\n * @param memberIds array of the user ids of users to be members of the chat. Must be at least 2.\n * @param isGroupChat if true a group chat will be created, otherwise a 1:1 chat will be created. Must be true if there are more than 2 members.\n * @param chatMessage if provided a message with this content will be sent to the chat after creation\n * @param chatName if provided and there are more than 2 members the topic of the chat will be set to this value\n * @returns {Promise<Chat>} the newly created chat\n */\nexport const createChatThread = async (\n  graph: IGraph,\n  memberIds: string[],\n  isGroupChat: boolean,\n  chatMessage: string | undefined,\n  chatName: string | undefined\n): Promise<Chat> => {\n  const body: Chat = {\n    chatType: isGroupChat || memberIds.length > 2 ? 'group' : 'oneOnOne',\n    members: memberIds.map(id => {\n      return {\n        '@odata.type': '#microsoft.graph.aadUserConversationMember',\n        roles: ['owner'],\n        'user@odata.bind': `https://graph.microsoft.com/v1.0/users('${id}')`\n      };\n    })\n  };\n  if (isGroupChat && chatName) body.topic = chatName;\n\n  const chat = (await graph\n    .api('/chats')\n    .middlewareOptions(prepScopes(chatOperationScopes.createChat))\n    .post(body)) as Chat;\n  if (!chat?.id) throw new Error('Chat id not returned from create chat thread');\n  if (chatMessage) {\n    await sendChatMessage(graph, chat.id, chatMessage);\n  }\n\n  return chat;\n};\n\n/**\n * Updates the topic of a chat via HTTP PATCH\n *\n * @param graph {IGraph} - authenticated graph client from mgt\n * @param chatId {string} - id of the chat to update\n * @param topic {string | null} - new value for the chat topic, null will remove the currently set topic\n */\nexport const updateChatTopic = async (graph: IGraph, chatId: string, topic: string | null): Promise<void> => {\n  await graph\n    .api(`/chats/${chatId}`)\n    .middlewareOptions(prepScopes(chatOperationScopes.updateChatMessage))\n    .patch({ topic });\n};\n\n/**\n * Load the chat threads from graph with the members and last message expanded\n *\n * @param graph authenticated graph client from mgt\n * @returns {Promise<GraphChat>}\n */\nexport const loadChatThreads = async (graph: IGraph, maxPage: number): Promise<ChatThreadCollection> =>\n  (await graph\n    .api(`me/chats?$top=${maxPage}&$expand=members,lastMessagePreview&orderby=lastMessagePreview/createdDateTime desc`)\n    .middlewareOptions(prepScopes(chatOperationScopes.loadChat))\n    .get()) as ChatThreadCollection;\n\n/**\n * Load the chat threads from graph with the members and last message expanded by next page link.\n *\n * @param graph authenticated graph client from mgt\n * @returns {Promise<GraphChat>}\n */\nexport const loadChatThreadsByPage = async (graph: IGraph, filter: string): Promise<ChatThreadCollection> =>\n  (await graph\n    .api(`me/chats?${filter}`)\n    .middlewareOptions(prepScopes(chatOperationScopes.loadChat))\n    .get()) as ChatThreadCollection;\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nexport const updateMessageContentWithImage = (\n  content: string,\n  index: string,\n  messageId: string,\n  image: string\n): string => {\n  const imageId = `${messageId}-${index}`;\n  const regex = new RegExp(`(<img[^>]+id=[\"']${imageId}[\"'][^>]+)src=[\"']([^\"']*)[\"']`);\n  const replacement = `$1src=\"${image}\"`;\n  const replaced = content.replace(regex, replacement);\n  return replaced;\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { ChatMessage, Message } from '@azure/communication-react';\nimport { GraphChatMessage } from 'src/statefulClient/StatefulGraphChatClient';\n\n/**\n * A typeguard to get the ChatMessage type\n * @param msg of Message\n * @returns ChatMessage\n */\nexport const isChatMessage = (msg: Message): msg is ChatMessage => {\n  return 'content' in msg;\n};\n\n/**\n * A typeguard to get the GraphChatMessage type\n * @param msg of Message\n * @returns GraphChatMessage\n */\nexport const isGraphChatMessage = (msg: Message): msg is GraphChatMessage => {\n  return 'content' in msg && 'hasUnsupportedContent' in msg && 'rawChatUrl' in msg;\n};\n\n/**\n * States of a chat.\n */\nexport type GraphChatClientStatus =\n  | 'initial'\n  | 'creating server connections'\n  | 'subscribing to notifications'\n  | 'loading messages'\n  | 'no chat id'\n  | 'no messages'\n  | 'ready'\n  | 'error';\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\n/**\n * Checks if DOM content has emojis and other HTML content.\n * @param dom the html content parsed into HTMLDocument.\n * @param emojisCount number of emojis in the content.\n * @returns true if only one emoji is in the content without other content, otherwise false.\n */\nconst hasOtherContent = (dom: Document, emojisCount: number): boolean => {\n  const isPtag = dom.body.firstChild?.nodeName === 'P';\n  if (isPtag) {\n    const firstChildNodes = dom.body.firstChild?.childNodes;\n    return firstChildNodes?.length !== emojisCount;\n  }\n  return false;\n};\n\n/**\n * Parses html content string into HTMLDocument, then replaces instances of the\n * emoji tag.\n * @param content the HTML string.\n * @returns HTML string with emoji tags changed to the HTML representation.\n */\nexport const rewriteEmojiContentToHTML = (content: string): string => {\n  const parser = new DOMParser();\n  const dom = parser.parseFromString(content, 'text/html');\n  const emojis = dom.querySelectorAll('emoji');\n  const emojisCount = emojis.length;\n  const size = emojisCount > 1 || hasOtherContent(dom, emojisCount) ? 20 : 50;\n\n  for (const emoji of emojis) {\n    const id = emoji.getAttribute('id') ?? '';\n    const alt = emoji.getAttribute('alt') ?? '';\n    const title = emoji.getAttribute('title') ?? '';\n\n    const span = document.createElement('span');\n    span.setAttribute('title', title);\n    span.setAttribute('type', `(${id})`);\n    span.setAttribute('class', `animated-emoticon-${size}-cool`);\n\n    const img = document.createElement('img');\n    img.setAttribute('itemscope', '');\n    img.setAttribute('itemtype', 'http://schema.skype.com/Emoji');\n    img.setAttribute('itemid', id);\n\n    img.setAttribute(\n      'src',\n      `https://statics.teams.cdn.office.net/evergreen-assets/personal-expressions/v2/assets/emoticons/${id}/default/${size}_f.png`\n    );\n    img.setAttribute('title', title);\n    img.setAttribute('alt', alt);\n    img.setAttribute('style', `width:${size}px;height:${size}px;`);\n\n    span.appendChild(img);\n    emoji.replaceWith(span);\n  }\n  return dom.body.innerHTML;\n};\n\n/**\n * Regex to detect and extract emoji alt text\n *\n * Pattern breakdown:\n * (<emoji[^>]+): Captures the opening emoji tag, including any attributes.\n * alt=[\"'](\\w*[^\"']*)[\"']: Matches and captures the \"alt\" attribute value within single or double quotes. The value can contain word characters but not quotes.\n * (.[^>]): Captures any remaining text within the opening emoji tag, excluding the closing angle bracket.\n * ><\\/emoji>: Matches the remaining part of the tag.\n */\nconst emojiRegex = /(<emoji[^>]+)alt=[\"'](\\w*[^\"']*)[\"'](.[^>]+)><\\/emoji>/;\nconst emojiMatch = (messageContent: string): RegExpMatchArray | null => {\n  return messageContent.match(emojiRegex);\n};\n// iterative repave the emoji custom element with the content of the alt attribute\n// on the emoji element\nconst processEmojiContent = (messageContent: string): string => {\n  let result = messageContent;\n  let match = emojiMatch(result);\n  while (match) {\n    result = result.replace(emojiRegex, '$2');\n    match = emojiMatch(result);\n  }\n  return result;\n};\n\n/**\n * if the content contains an <emoji> tag with an alt attribute the content is replaced by replacing the emoji tags with the content of their alt attribute.\n * @param {string} content\n * @returns {string} the content with any emoji tags replaced by the content of their alt attribute.\n */\nexport const rewriteEmojiContentToText = (content: string): string =>\n  emojiMatch(content) ? processEmojiContent(content) : content;\n","import { NullableOption, Identity } from '@microsoft/microsoft-graph-types';\n\nexport const botPrefix = 'botId::';\n\nexport const buildBotId = (application: NullableOption<Identity> | undefined) =>\n  application?.id ? `${botPrefix}${application.id}` : undefined;\n","import { BetaGraph, IGraph, Providers } from '@microsoft/mgt-element';\nimport { produce } from 'immer';\nimport { StatefulClient } from './StatefulClient';\nimport { graph } from '../utils/graph';\nimport { GraphConfig } from './GraphConfig';\n\nexport abstract class BaseStatefulClient<T> implements StatefulClient<T> {\n  private _graph: IGraph | undefined;\n\n  protected get graph(): IGraph | undefined {\n    if (this._graph) return this._graph;\n    if (Providers.globalProvider?.graph) {\n      this._graph = graph('mgt-chat', GraphConfig.version);\n    }\n    return this._graph;\n  }\n\n  protected set graph(value: IGraph | undefined) {\n    this._graph = value;\n  }\n\n  protected get betaGraph(): BetaGraph | undefined {\n    const g = this.graph;\n    if (g) return BetaGraph.fromGraph(g);\n\n    return undefined;\n  }\n\n  private _subscribers: ((state: T) => void)[] = [];\n  /**\n   * Register a callback to receive state updates\n   *\n   * @param {(state: GraphChatClient) => void} handler\n   * @memberof StatefulGraphChatClient\n   */\n  public onStateChange(handler: (state: T) => void): void {\n    if (!this._subscribers.includes(handler)) {\n      this._subscribers.push(handler);\n    }\n  }\n\n  /**\n   * Unregister a callback from receiving state updates\n   *\n   * @param {(state: GraphChatClient) => void} handler\n   * @memberof StatefulGraphChatClient\n   */\n  public offStateChange(handler: (state: T) => void): void {\n    const index = this._subscribers.indexOf(handler);\n    if (index !== -1) {\n      this._subscribers = this._subscribers.splice(index, 1);\n    }\n  }\n\n  /**\n   * Calls each subscriber with the next state to be emitted\n   *\n   * @param recipe - a function which produces the next state to be emitted\n   */\n  protected notifyStateChange(recipe: (draft: T) => void) {\n    this.state = produce(this.state, recipe);\n    this._subscribers.forEach(handler => handler(this.state));\n  }\n\n  protected abstract state: T;\n  /**\n   * Return the current state of the chat client\n   *\n   * @return {{GraphChatClient}\n   * @memberof StatefulGraphChatClient\n   */\n  public getState(): T {\n    return this.state;\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport {\n  ChatMessage as AcsChatMessage,\n  ContentSystemMessage,\n  Message,\n  MessageThreadProps,\n  SendBoxProps,\n  SystemMessage\n} from '@azure/communication-react';\nimport { IDynamicPerson, getUserWithPhoto } from '@microsoft/mgt-components';\nimport {\n  ActiveAccountChanged,\n  LoginChangedEvent,\n  ProviderState,\n  Providers,\n  error,\n  log,\n  warn\n} from '@microsoft/mgt-element';\nimport {\n  AadUserConversationMember,\n  Chat,\n  ChatMessage,\n  ChatMessageAttachment,\n  ChatRenamedEventMessageDetail,\n  MembersAddedEventMessageDetail,\n  MembersDeletedEventMessageDetail,\n  ChatMessageMention,\n  NullableOption\n} from '@microsoft/microsoft-graph-types';\nimport { v4 as uuid } from 'uuid';\nimport { currentUserId, currentUserName } from '../utils/currentUser';\nimport { graph } from '../utils/graph';\nimport { MessageCache } from './Caching/MessageCache';\nimport { GraphConfig } from './GraphConfig';\nimport { GraphNotificationClient } from './GraphNotificationClient';\nimport { ThreadEventEmitter } from './ThreadEventEmitter';\nimport {\n  MessageCollection,\n  addChatMembers,\n  deleteChatMessage,\n  loadChat,\n  loadChatImage,\n  loadChatThread,\n  loadChatThreadDelta,\n  loadMoreChatMessages,\n  removeChatMember,\n  sendChatMessage,\n  updateChatMessage,\n  updateChatTopic\n} from './graph.chat';\nimport { updateMessageContentWithImage } from '../utils/updateMessageContentWithImage';\nimport { GraphChatClientStatus, isChatMessage } from '../utils/types';\nimport { rewriteEmojiContentToHTML } from '../utils/rewriteEmojiContent';\nimport { buildBotId } from './buildBotId';\nimport { BaseStatefulClient } from './BaseStatefulClient';\n\nconst hasUnsupportedContent = (content: string, attachments: ChatMessageAttachment[]): boolean => {\n  const unsupportedContentTypes = [\n    'application/vnd.microsoft.card.codesnippet',\n    'application/vnd.microsoft.card.fluid',\n    'application/vnd.microsoft.card.fluidEmbedCard',\n    'reference'\n  ];\n  const isUnsupported: boolean[] = [];\n\n  if (attachments.length) {\n    for (const attachment of attachments) {\n      const contentType = attachment?.contentType ?? '';\n      isUnsupported.push(unsupportedContentTypes.includes(contentType));\n    }\n  } else {\n    // checking content with <attachment> tags\n    const unsupportedContentRegex = /<\\/?attachment>/gim;\n    const contentUnsupported = Boolean(content) && unsupportedContentRegex.test(content);\n    isUnsupported.push(contentUnsupported);\n  }\n  return isUnsupported.every(e => e === true);\n};\n\nconst buildAcsMessage = (\n  graphMessage: ChatMessage,\n  currentUser: string,\n  messageId: string,\n  content: string\n): GraphChatMessage => {\n  const senderId = graphMessage.from?.user?.id ?? buildBotId(graphMessage.from?.application) ?? undefined;\n  const chatId = graphMessage?.chatId ?? '';\n  const id = graphMessage?.id ?? '';\n  const chatUrl = `https://teams.microsoft.com/l/message/${chatId}/${id}?context={\"contextType\":\"chat\"}`;\n  const attachments = graphMessage?.attachments ?? [];\n\n  let messageData: GraphChatMessage = {\n    messageId,\n    contentType: graphMessage.body?.contentType ?? 'text',\n    messageType: 'chat',\n    content,\n    senderDisplayName: graphMessage.from?.user?.displayName ?? graphMessage.from?.application?.displayName ?? undefined,\n    createdOn: new Date(graphMessage.createdDateTime ?? Date.now()),\n    editedOn: graphMessage.lastEditedDateTime ? new Date(graphMessage.lastEditedDateTime) : undefined,\n    senderId,\n    mine: senderId === currentUser,\n    status: 'seen',\n    attached: 'top',\n    hasUnsupportedContent: hasUnsupportedContent(content, attachments),\n    rawChatUrl: chatUrl\n  };\n  if (graphMessage?.policyViolation) {\n    messageData = Object.assign(messageData, {\n      messageType: 'blocked',\n      link: 'https://go.microsoft.com/fwlink/?LinkId=2132837'\n    });\n  }\n  return messageData;\n};\n\n/**\n * Teams mentions are in the pattern <at id=\"1\">User</at>. This replacement\n * changes the mentions pattern to <msft-mention id=\"1\">User</msft-mention>\n * which will trigger the `mentionOptions` prop to be called in MessageThread.\n *\n * @param content is the message with mentions.\n * @returns string with replaced mention parts.\n */\nconst updateMentionsContent = (content: string): string => {\n  const msftMention = `<msft-mention id=\"$1\">$2</msft-mention>`;\n  const atRegex = /<at\\sid=\"(\\d+)\">([a-z0-9_.-\\s]+)<\\/at>/gim;\n  content = content\n    .replace(/&nbsp;<at/gim, '<at')\n    .replace(/at>&nbsp;/gim, 'at>')\n    .replace(atRegex, msftMention);\n  return content;\n};\n\n// 1x1 grey pixel\nconst placeholderImageContent =\n  'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAMSURBVBhXY7h58yYABRoCjB9qX5UAAAAASUVORK5CYII=';\n\ninterface ODataType {\n  '@odata.type': MessageEventType;\n}\ntype MembersAddedEventDetail = ODataType &\n  MembersAddedEventMessageDetail & {\n    '@odata.type': '#microsoft.graph.membersAddedEventMessageDetail';\n  };\ntype MembersRemovedEventDetail = ODataType &\n  MembersDeletedEventMessageDetail & {\n    '@odata.type': '#microsoft.graph.membersDeletedEventMessageDetail';\n  };\ntype ChatRenamedEventDetail = ODataType &\n  ChatRenamedEventMessageDetail & {\n    '@odata.type': '#microsoft.graph.chatRenamedEventMessageDetail';\n  };\n\ntype ChatMessageEvents = MembersAddedEventDetail | MembersRemovedEventDetail | ChatRenamedEventDetail;\n\nconst isChatMemberChangeEvent = (\n  eventDetail: unknown\n): eventDetail is MembersDeletedEventMessageDetail | MembersAddedEventMessageDetail => {\n  return (\n    typeof (eventDetail as MembersDeletedEventMessageDetail | MembersAddedEventMessageDetail)?.members !== 'undefined'\n  );\n};\n\n// defines the type of the state object returned from the StatefulGraphChatClient\nexport type GraphChatClient = Pick<\n  MessageThreadProps,\n  | 'userId'\n  | 'messages'\n  | 'participantCount'\n  | 'disableEditing'\n  | 'onLoadPreviousChatMessages'\n  | 'numberOfChatMessagesToReload'\n  | 'onUpdateMessage'\n  | 'onDeleteMessage'\n> &\n  Pick<SendBoxProps, 'onSendMessage'> & {\n    status: GraphChatClientStatus;\n    chat?: Chat;\n  } & {\n    participants: AadUserConversationMember[];\n    onAddChatMembers: (userIds: string[], history?: Date) => Promise<void>;\n    onRemoveChatMember: (membershipId: string) => Promise<void>;\n    onRenameChat: (topic: string | null) => Promise<void>;\n    mentions: NullableOption<ChatMessageMention[]>;\n    activeErrorMessages: Error[];\n  };\n\ninterface CreatedOn {\n  createdOn: Date;\n}\n\n/**\n * Simple object comparator function for sorting by createdOn date\n *\n * @param {CreatedOn} a\n * @param {CreatedOn} b\n */\nconst MessageCreatedComparator = (a: CreatedOn, b: CreatedOn) => a.createdOn.getTime() - b.createdOn.getTime();\n\nconst ChatMessageCreatedComparator = (a: ChatMessage, b: ChatMessage): number => {\n  if (a.createdDateTime && b.createdDateTime) {\n    if (a.createdDateTime === b.createdDateTime) return 0;\n    if (a.createdDateTime > b.createdDateTime) return 1;\n    return -1;\n  } else if (a.createdDateTime) {\n    return 1;\n  }\n  return -1;\n};\n\ntype MessageEventType =\n  | '#microsoft.graph.membersAddedEventMessageDetail'\n  | '#microsoft.graph.membersDeletedEventMessageDetail'\n  | '#microsoft.graph.chatRenamedEventMessageDetail';\n\n/**\n * Extended Message type with additional properties.\n */\nexport type GraphChatMessage = Message & {\n  hasUnsupportedContent: boolean;\n  rawChatUrl: string;\n};\n/**\n * Holder type account for async conversion of messages.\n * Some messages need to be written to the UI immediately and receive an async update.\n * Some messages do not have a current value and will be added after the future value is resolved.\n * Some messages do not have a future value and will be added immediately.\n */\ninterface MessageConversion {\n  currentValue?: GraphChatMessage;\n  futureValue?: Promise<GraphChatMessage>;\n}\n\n/**\n * Regex to detect and replace image urls using graph requests to supply the image content\n */\nconst graphImageUrlRegex = /(<img[^>]+)src=([\"']https:\\/\\/graph\\.microsoft\\.com[^\"']*[\"'])/;\n\nclass StatefulGraphChatClient extends BaseStatefulClient<GraphChatClient> {\n  private readonly _eventEmitter: ThreadEventEmitter;\n  private readonly _cache: MessageCache;\n  private _notificationClient: GraphNotificationClient | undefined;\n  private get _messagesPerCall() {\n    return 5;\n  }\n  private _nextLink?: string;\n  private _chat?: Chat = undefined;\n  private _userDisplayName = '';\n\n  constructor() {\n    super();\n    this.updateUserInfo();\n    Providers.globalProvider.onStateChanged(this.onLoginStateChanged);\n    Providers.globalProvider.onActiveAccountChanged(this.onActiveAccountChanged);\n    this._eventEmitter = new ThreadEventEmitter();\n    this.registerEventListeners();\n    this._cache = new MessageCache();\n    this.tryCreateGraphNotificationClient();\n  }\n\n  /**\n   * Attempts to create the graph and client objects. This can succeed during construction if the\n   * Provider has already logged in. If not, it will be tried again when the Provider logs in. Only\n   * calling tryCreateGraphNotificationClient() from onLoginStateChanged() only works if the Chat\n   * component is on the page at the time there is a sign-in - not always a guarantee.\n   */\n  private tryCreateGraphNotificationClient() {\n    try {\n      // exit if already created\n      if (this.graph && this._notificationClient) return;\n\n      // create the graph\n      this.graph = graph('mgt-chat', GraphConfig.version);\n      if (!this.graph) return;\n\n      // create the client\n      this._notificationClient = new GraphNotificationClient(this._eventEmitter, this.graph);\n    } catch (e) {\n      // ignore; it will be tried again later\n    }\n  }\n\n  /**\n   * Provides a method to clean up any resources being used internally when a consuming component is being removed from the DOM\n   */\n  public tearDown() {\n    this._notificationClient?.tearDown();\n  }\n\n  /**\n   * Update the state of the client when the Login state changes\n   *\n   * @private\n   * @param {LoginChangedEvent} e The event that triggered the change\n   * @memberof StatefulGraphChatClient\n   */\n  private readonly onLoginStateChanged = (e: LoginChangedEvent) => {\n    switch (e.detail) {\n      case ProviderState.SignedIn:\n        // update userId and displayName\n        this.updateUserInfo();\n        this.tryCreateGraphNotificationClient();\n        // load messages?\n        // configure subscriptions\n        // emit new state;\n        if (this.chatId) {\n          void this.updateFollowedChat();\n        }\n        return;\n      case ProviderState.SignedOut:\n        // clear userId\n        // clear subscriptions\n        // clear messages\n        // emit new state\n        return;\n      case ProviderState.Loading:\n      default:\n        // do nothing for now\n        return;\n    }\n  };\n\n  private readonly onActiveAccountChanged = (e: ActiveAccountChanged) => {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n    if (e.detail && this.userId !== e.detail?.id) {\n      void this.handleAccountChange();\n    }\n  };\n\n  private readonly handleAccountChange = async () => {\n    this.clearCurrentUserMessages();\n    // need to ensure that we close any existing connection if present\n    await this._notificationClient?.closeSignalRConnection();\n\n    this.updateUserInfo();\n    // by updating the followed chat the notification client will reconnect to SignalR\n    await this.updateFollowedChat();\n  };\n\n  private clearCurrentUserMessages() {\n    this.notifyStateChange((draft: GraphChatClient) => {\n      draft.messages = [];\n      draft.participants = [];\n      draft.chat = undefined;\n      draft.status = 'initial'; // no message?\n    });\n  }\n\n  private updateUserInfo() {\n    this.updateCurrentUserId();\n    this.updateCurrentUserName();\n  }\n\n  /**\n   * Changes the userDisplayName to the current value.\n   */\n  private updateCurrentUserName() {\n    this._userDisplayName = currentUserName();\n  }\n\n  /**\n   * Changes the current user ID value to the current value.\n   */\n  private updateCurrentUserId() {\n    this.userId = currentUserId();\n  }\n\n  /**\n   * Current User ID.\n   */\n  private _userId = '';\n\n  /**\n   * Returns the current User ID.\n   */\n  public get userId() {\n    return this._userId;\n  }\n\n  /**\n   * Sets the current User ID and updates the state value.\n   */\n  private set userId(userId: string) {\n    if (this._userId === userId) {\n      return;\n    }\n    this._userId = userId;\n    this.notifyStateChange((draft: GraphChatClient) => {\n      draft.userId = userId;\n    });\n  }\n\n  /**\n   * Current chat ID.\n   */\n  private _chatId = '';\n\n  /**\n   * Get the current chat ID.\n   */\n  public get chatId() {\n    return this._chatId;\n  }\n\n  /**\n   * Set the current chat ID and tries to get the chat data.\n   */\n  private set chatId(value: string) {\n    // take no action if the chatId is the same\n    if (value && this._chatId === value) {\n      return;\n    }\n    this._chatId = value;\n    if (this._chatId && this._sessionId) {\n      void this.updateFollowedChat();\n    }\n  }\n\n  private _sessionId: string | undefined;\n\n  public subscribeToChat(chatId: string, sessionId: string) {\n    if (chatId && sessionId) {\n      this._sessionId = sessionId;\n      this.chatId = chatId;\n    }\n  }\n\n  public setStatus(status: GraphChatClientStatus) {\n    this.notifyStateChange((draft: GraphChatClient) => {\n      draft.status = status;\n      draft.chat = { topic: 'Unknown' };\n    });\n  }\n\n  /**\n   * A helper to co-ordinate the loading of a chat and its messages, and the subscription to notifications for that chat\n   *\n   * @private\n   * @memberof StatefulGraphChatClient\n   */\n  private async updateFollowedChat() {\n    // avoid subscribing to a resource with an empty chatId\n    if (this.chatId && this._sessionId) {\n      // reset state to initial\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'initial';\n        draft.messages = [];\n        draft.mentions = [];\n        draft.chat = undefined;\n        draft.participants = [];\n        draft.activeErrorMessages = [];\n      });\n      // Subscribe to notifications for messages\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'creating server connections';\n      });\n      try {\n        // Prefer sequential promise resolving to catch loading message errors\n        // TODO: in parallel promise resolving, find out how to trigger different\n        // TODO: state for failed subscriptions in GraphChatClient.onSubscribeFailed\n        const tasks: Promise<unknown>[] = [this.loadChatData()];\n        // subscribing to notifications will trigger the chatMessageNotificationsSubscribed event\n        // this client will then load the chat and messages when that event listener is called\n        if (this._notificationClient) {\n          tasks.push(this._notificationClient.subscribeToChatNotifications(this._chatId, this._sessionId));\n          await Promise.all(tasks);\n        }\n      } catch (e) {\n        this.updateErrorState(e as Error);\n      }\n    } else {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'no chat id';\n        draft.chat = { topic: 'Unknown' };\n      });\n    }\n  }\n\n  private async loadChatData() {\n    if (!this.graph) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'error';\n        draft.activeErrorMessages.push(new Error('Graph client not available'));\n      });\n      return;\n    }\n    this.notifyStateChange((draft: GraphChatClient) => {\n      draft.status = 'loading messages';\n    });\n    try {\n      this._chat = await loadChat(this.graph, this.chatId);\n    } catch (e) {\n      return Promise.reject(e);\n    }\n    const cachedMessages = await this._cache.loadMessages(this._chatId);\n    if (cachedMessages) {\n      // use currently cached data\n      await this.writeMessagesToState(cachedMessages);\n      // load delta messages\n      const deltaMessages = await this.loadDeltaData(this._chatId, cachedMessages.lastModifiedDateTime);\n      // add delta messages to cache\n      const updatedState = await this._cache.cacheMessages(this._chatId, deltaMessages);\n      // writeMessagesToState concats with existing state, need to be careful not to create duplicate messages\n      updatedState.value = deltaMessages;\n      // update state\n      await this.writeMessagesToState(updatedState);\n    } else {\n      const messages: MessageCollection = await loadChatThread(this.graph, this._chatId, this._messagesPerCall);\n      await this._cache.cacheMessages(this._chatId, messages.value, true, messages.nextLink);\n      await this.writeMessagesToState(messages);\n    }\n  }\n\n  private async loadDeltaData(chatId: string, lastModified: string): Promise<ChatMessage[]> {\n    if (!this.graph) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'error';\n        draft.activeErrorMessages.push(new Error('Graph client not available'));\n      });\n      throw new Error('Graph client not available');\n    }\n    const result: ChatMessage[] = [];\n    let response = await loadChatThreadDelta(this.graph, chatId, lastModified, this._messagesPerCall);\n    result.push(...response.value);\n    while (response.nextLink) {\n      response = await loadMoreChatMessages(this.graph, response.nextLink);\n      result.push(...response.value);\n    }\n    return result.sort(ChatMessageCreatedComparator);\n  }\n\n  /**\n   * Handles updating state based on the response to a graph request for a collection of messages\n   * Handles messages that can be imedately rendered and those that require async calls to fetch data\n   *\n   * @private\n   * @param {MessageCollection} messages\n   * @memberof StatefulGraphChatClient\n   */\n  private async writeMessagesToState(messages: MessageCollection) {\n    this._nextLink = messages.nextLink;\n\n    const messageConversions = messages.value\n      // trying to filter out messages on the graph request causes a 400\n      // deleted messages are returned as messages with no content, which we can't filter on the graph request\n      // so we filter them out here\n      .filter(m => m.body?.content)\n      // This gives us both current and eventual values for each message\n      .map(m => this.convertChatMessage(m));\n\n    // Collect mentions\n    const mentions: NullableOption<ChatMessageMention[]> = messages.value\n      .map(m => m.mentions)\n      .filter(m => m?.length) as NullableOption<ChatMessageMention[]>;\n\n    // update the state with the current values\n    this.notifyStateChange((draft: GraphChatClient) => {\n      draft.participants = this._chat?.members || [];\n      draft.participantCount = draft.participants.length;\n      const initialMessages: Message[] = [];\n      draft.messages = draft.messages\n        .concat(\n          messageConversions\n            .map(m => m.currentValue)\n            // need to use a reduce here to filter out undefined values in a way that TypeScript understands\n            .reduce((acc, val) => {\n              if (val) acc.push(val);\n              return acc;\n            }, initialMessages)\n        )\n        .sort(MessageCreatedComparator);\n      draft.onLoadPreviousChatMessages = this._nextLink ? this.loadMoreMessages : undefined;\n      draft.status = this._nextLink ? 'loading messages' : !draft.messages.length ? 'no messages' : 'ready';\n      draft.chat = this._chat;\n      // Keep updating if there was a next link.\n      draft.mentions = draft.mentions?.concat(\n        ...Array.from(mentions as Iterable<ChatMessageMention>)\n      ) as NullableOption<ChatMessageMention[]>;\n    });\n    const futureMessages = messageConversions.filter(m => m.futureValue).map(m => m.futureValue);\n    // if there are eventual future values, wait for them to resolve and update the state\n    if (futureMessages.length > 0) {\n      (await Promise.all(futureMessages)).forEach(m => {\n        this.updateMessages(m);\n      });\n    }\n  }\n\n  /**\n   * Utility to convert a Graph Chat Message to an ACS Chat Message\n   * Some graph chat messages can synchronously be converted to ACS chat messages\n   * Others require an async call to get the ACS chat message\n   * Some messages can provide an initial state for immediate rendering while the async call is in progress\n   * This method returns an object containing the current value and a Promise of a future value\n   *\n   * @private\n   * @param {ChatMessage} message\n   * @return {*}  {MessageConversion}\n   * @memberof StatefulGraphChatClient\n   */\n  private convertChatMessage(message: ChatMessage): MessageConversion {\n    switch (message.messageType) {\n      case 'message':\n        return this.graphChatMessageToAcsChatMessage(message, this.userId);\n      case 'systemEventMessage':\n      case 'unknownFutureValue':\n        return { futureValue: this.buildSystemContentMessage(message) } as MessageConversion;\n      default:\n        throw new Error(`Unknown message type ${message.messageType?.toString() || 'undefined'}`);\n    }\n  }\n\n  /**\n   * Convert an event type to the name of an icon registered in registerIcons.tsx\n   *\n   * @param eventType\n   * @returns\n   */\n  private readonly resolveIcon = (eventType: MessageEventType): string => {\n    switch (eventType) {\n      case '#microsoft.graph.membersAddedEventMessageDetail':\n        return 'add-friend';\n      case '#microsoft.graph.membersDeletedEventMessageDetail':\n        return 'left-chat';\n      case '#microsoft.graph.chatRenamedEventMessageDetail':\n        return 'edit-svg';\n      default:\n        return 'Unknown';\n    }\n  };\n\n  private async buildSystemContentMessage(message: ChatMessage): Promise<SystemMessage> {\n    if (!this.graph) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'error';\n        draft.activeErrorMessages.push(new Error('Graph client not available'));\n      });\n      throw new Error('Graph client not available');\n    }\n    const eventDetail = message.eventDetail as ChatMessageEvents;\n    let messageContent = '';\n    const awaits: Promise<IDynamicPerson>[] = [];\n    const initiatorId = eventDetail.initiator?.user?.id;\n    // we're using getUserWithPhoto here because we want to tap into the caching that mgt-person uses to cut down on graph calls\n    if (initiatorId) {\n      awaits.push(getUserWithPhoto(this.graph, initiatorId));\n      const userIds: string[] = [];\n      if (isChatMemberChangeEvent(eventDetail)) {\n        eventDetail.members?.reduce((acc, m) => {\n          if (typeof m.id === 'string') {\n            acc.push(m.id);\n          }\n          return acc;\n        }, userIds);\n      }\n      for (const id of userIds ?? []) {\n        awaits.push(getUserWithPhoto(this.graph, id));\n      }\n      const people = await Promise.all(awaits);\n      const userNames = userIds\n        ?.filter(id => id !== initiatorId)\n        .map(m => this.getUserName(m, people))\n        .join(', ');\n      const initiatorUsername = this.getUserName(initiatorId, people);\n      switch (eventDetail['@odata.type']) {\n        case '#microsoft.graph.membersAddedEventMessageDetail':\n          messageContent = `${initiatorUsername} added ${userNames}`;\n          break;\n        case '#microsoft.graph.membersDeletedEventMessageDetail':\n          messageContent = `${initiatorUsername} removed ${userNames}`;\n          break;\n        case '#microsoft.graph.chatRenamedEventMessageDetail':\n          messageContent = eventDetail.chatDisplayName\n            ? `${initiatorUsername} renamed the chat to ${eventDetail.chatDisplayName}`\n            : `${initiatorUsername} removed the group name for this conversation`;\n          break;\n        // TODO: move this default case to a console.warn before release and emit an empty message\n        // it's here to help us catch messages we have't handled yet\n        default:\n          // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n          warn(`Unknown system message type ${eventDetail['@odata.type']}\n\ndetail: ${JSON.stringify(eventDetail)}`);\n      }\n    }\n\n    const result: ContentSystemMessage = {\n      createdOn: message.createdDateTime ? new Date(message.createdDateTime) : new Date(),\n      messageId: message.id || '',\n      systemMessageType: 'content',\n      messageType: 'system',\n      iconName: this.resolveIcon(eventDetail['@odata.type']),\n      content: messageContent\n    };\n\n    return result;\n  }\n\n  private getUserName(userId: string, people: IDynamicPerson[]) {\n    return people.find(p => p.id === userId)?.displayName || 'unknown user';\n  }\n\n  /**\n   * Async callback to load more messages\n   *\n   * @returns true if there are no more messages to load\n   */\n  private readonly loadMoreMessages = async () => {\n    if (!this._nextLink) {\n      return true;\n    }\n    if (!this.graph) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'error';\n        draft.activeErrorMessages.push(new Error('Graph client not available'));\n      });\n      throw new Error('Graph client not available');\n    }\n    const messages: MessageCollection = await loadMoreChatMessages(this.graph, this._nextLink);\n    await this._cache.cacheMessages(this._chatId, messages.value, true, messages.nextLink);\n    await this.writeMessagesToState(messages);\n    // return true when there are no more messages to load\n    return !this._nextLink;\n  };\n\n  /**\n   * Send a message to the chat thread\n   *\n   * @param {string} content - the content of the message\n   * @memberof StatefulGraphChatClient\n   */\n  public sendMessage = async (content: string) => {\n    if (!content) return;\n\n    if (!this.graph) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'error';\n        draft.activeErrorMessages.push(new Error('Graph client not available'));\n      });\n      return;\n    }\n\n    const pendingId = uuid();\n\n    // add a pending message to the state.\n    this.notifyStateChange((draft: GraphChatClient) => {\n      const pendingMessage: Message = {\n        clientMessageId: pendingId,\n        messageId: pendingId,\n        contentType: 'text',\n        messageType: 'chat',\n        content,\n        senderDisplayName: this._userDisplayName,\n        createdOn: new Date(),\n        senderId: this.userId,\n        mine: true,\n        status: 'sending'\n      };\n      draft.messages.push(pendingMessage);\n    });\n    try {\n      // send message\n      const chat: ChatMessage = await sendChatMessage(this.graph, this.chatId, content);\n      // emit new state\n      this.notifyStateChange((draft: GraphChatClient) => {\n        const draftIndex = draft.messages.findIndex(m => m.messageId === pendingId);\n        const message = this.graphChatMessageToAcsChatMessage(chat, this.userId).currentValue;\n        // we only need use the current value of the message\n        // this message can't have a future value as it's not been sent yet\n        if (message) draft.messages.splice(draftIndex, 1, message);\n      });\n    } catch (e) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        const draftMessage = draft.messages.find(m => m.messageId === pendingId);\n        (draftMessage as AcsChatMessage).status = 'failed';\n      });\n      throw new Error('Failed to send message');\n    }\n  };\n\n  /*\n   * Helper method to set the content of a message to show deletion\n   */\n  private readonly setDeletedContent = (message: AcsChatMessage) => {\n    message.content = '<em>This message has been deleted.</em>';\n    message.contentType = 'html';\n  };\n\n  /**\n   * Handler to delete a message\n   *\n   * @param messageId id of the message to be deleted, this is the clientMessageId when triggered by the re-send action on a failed message, or the messageId when triggered by the delete action on a sent message\n   * @returns {Promise<void>}\n   */\n  public deleteMessage = async (messageId: string): Promise<void> => {\n    if (!messageId) return;\n\n    if (!this.graph) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'error';\n        draft.activeErrorMessages.push(new Error('Graph client not available'));\n      });\n      return;\n    }\n    const message = this.state.messages.find(m => m.messageId === messageId) as AcsChatMessage;\n    // only messages not persisted to graph should have a clientMessageId\n    const uncommitted = this.state.messages.find(\n      m => (m as AcsChatMessage).clientMessageId === messageId\n    ) as AcsChatMessage;\n    if (message?.mine) {\n      try {\n        // uncommitted messages are not persisted to the graph, so don't call graph when deleting them\n        if (!uncommitted) {\n          await deleteChatMessage(this.graph, this.chatId, messageId);\n        }\n        this.notifyStateChange((draft: GraphChatClient) => {\n          const draftMessage = draft.messages.find(m => m.messageId === messageId) as AcsChatMessage;\n          if (draftMessage.clientMessageId) {\n            // just remove messages that were not saved to the graph\n            draft.messages.splice(draft.messages.indexOf(draftMessage), 1);\n          } else {\n            // show deleted messages which have been persisted to the graph as deleted in the UI\n            this.setDeletedContent(draftMessage);\n          }\n        });\n      } catch (e) {\n        // TODO: How do we handle failed deletes?\n      }\n    }\n  };\n\n  /**\n   * Update a message in the thread\n   *\n   * @param {string} messageId Id of the message to be updated\n   * @param {string} content new content of the message\n   * @memberof StatefulGraphChatClient\n   */\n  public updateMessage = async (messageId: string, content: string) => {\n    if (!messageId || !content) return;\n\n    if (!this.graph) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'error';\n        draft.activeErrorMessages.push(new Error('Graph client not available'));\n      });\n      return;\n    }\n    const message = this.state.messages.find(m => m.messageId === messageId) as AcsChatMessage;\n    if (message?.mine && message.content) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        const updating = draft.messages.find(m => m.messageId === messageId) as AcsChatMessage;\n        if (updating) {\n          updating.content = content;\n          updating.status = 'sending';\n        }\n      });\n      try {\n        await updateChatMessage(this.graph, this.chatId, messageId, content);\n        this.notifyStateChange((draft: GraphChatClient) => {\n          const updated = draft.messages.find(m => m.messageId === messageId) as AcsChatMessage;\n          updated.status = 'delivered';\n        });\n      } catch (e) {\n        this.notifyStateChange((draft: GraphChatClient) => {\n          const updating = draft.messages.find(m => m.messageId === messageId) as AcsChatMessage;\n          updating.status = 'failed';\n        });\n        throw new Error('Failed to update message');\n      }\n    }\n  };\n\n  /*\n   * Event handler to be called when a new message is received by the notification service\n   */\n  private readonly onMessageReceived = async (message: ChatMessage) => {\n    this.updateMentions(message);\n    await this._cache.cacheMessage(this._chatId, message);\n    const messageConversion = this.convertChatMessage(message);\n    const acsMessage = messageConversion.currentValue;\n    this.updateMessages(acsMessage);\n    if (messageConversion.futureValue) {\n      // if we have a future value then we need to wait for it to resolve before we can send the read receipt\n      const futureMessageState = await messageConversion.futureValue;\n      this.updateMessages(futureMessageState);\n    }\n  };\n\n  /**\n   * When you receive a new message, check if there are any mentions and update\n   * the state. This will allow to match users to mentions them during rendering.\n   *\n   * @param newMessage from teams.\n   * @returns\n   */\n  private readonly updateMentions = (newMessage: ChatMessage) => {\n    if (!newMessage) return;\n    this.notifyStateChange((draft: GraphChatClient) => {\n      const mentions = newMessage?.mentions ?? [];\n      draft.mentions = draft.mentions?.concat(\n        ...Array.from(mentions as Iterable<ChatMessageMention>)\n      ) as NullableOption<ChatMessageMention[]>;\n    });\n  };\n\n  /*\n   * Event handler to be called when a message deletion is received by the notification service\n   */\n  private readonly onMessageDeleted = (message: ChatMessage) => {\n    void this._cache.deleteMessage(this.chatId, message);\n    this.notifyStateChange((draft: GraphChatClient) => {\n      const draftMessage = draft.messages.find(m => m.messageId === message.id) as AcsChatMessage;\n      // TODO: confirm if we should show the deleted content message in all cases or only when the message was deleted by the current user\n      if (draftMessage) this.setDeletedContent(draftMessage);\n    });\n  };\n\n  /*\n   * Event handler to be called when a message edit is received by the notification service\n   */\n  private readonly onMessageEdited = async (message: ChatMessage) => {\n    await this._cache.cacheMessage(this._chatId, message);\n    const messageConversion = this.convertChatMessage(message);\n    this.updateMessages(messageConversion.currentValue);\n    if (messageConversion.futureValue) {\n      const eventualState = await messageConversion.futureValue;\n      this.updateMessages(eventualState);\n    }\n  };\n\n  private readonly checkForMissedMessages = async () => {\n    if (!this.graph) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'error';\n        draft.activeErrorMessages.push(new Error('Graph client not available'));\n      });\n      return;\n    }\n    const messages: MessageCollection = await loadChatThread(this.graph, this.chatId, this._messagesPerCall);\n    const messageConversions = messages.value\n      // trying to filter out messages on the graph request causes a 400\n      // deleted messages are returned as messages with no content, which we can't filter on the graph request\n      // so we filter them out here\n      // Violating DLP returns content as empty BUT with policyViolation set\n      .filter(m => m.body?.content || (!m.body?.content && m?.policyViolation))\n      // This gives us both current and eventual values for each message\n      .map(m => this.convertChatMessage(m));\n\n    // update the state with the current values\n    const currentValueMessages: GraphChatMessage[] = [];\n    messageConversions\n      .map(m => m.currentValue)\n      // need to use a reduce here to filter out undefined values in a way that TypeScript understands\n      .reduce((acc, val) => {\n        if (val) acc.push(val);\n        return acc;\n      }, currentValueMessages);\n    currentValueMessages.forEach(m => this.updateMessages(m));\n    const futureMessages = messageConversions.filter(m => m.futureValue).map(m => m.futureValue);\n    // if there are eventual future values, wait for them to resolve and update the state\n    if (futureMessages.length > 0) {\n      (await Promise.all(futureMessages)).forEach(m => {\n        this.updateMessages(m);\n      });\n    }\n    const hasOverlapWithExistingMessages = messages.value.some(m =>\n      this.state.messages.find(sm => sm.messageId === m.id)\n    );\n    if (!hasOverlapWithExistingMessages) {\n      // TODO handle the case where there were a lot of missed messages and we ned to get the next page of messages.\n      // This is not a common case, but we should handle it.\n    }\n    log('checked for missed messages');\n  };\n\n  private readonly onChatNotificationsSubscribed = (resource: string): void => {\n    if (resource.includes(`/${this.chatId}/`) && resource.includes('/messages')) {\n      void this.checkForMissedMessages();\n    } else {\n      // better clean this up as we don't want to be listening to events for other chats\n    }\n  };\n\n  private readonly onChatPropertiesUpdated = (chat: Chat): void => {\n    this._chat = chat;\n    this.notifyStateChange((draft: GraphChatClient) => {\n      draft.chat = chat;\n    });\n  };\n\n  private readonly onParticipantAdded = (added: AadUserConversationMember): void => {\n    this.notifyStateChange((draft: GraphChatClient) => {\n      if (!draft.participants.find(p => p.id === added.id)) {\n        draft.participants.push(added);\n      }\n    });\n  };\n\n  private readonly onParticipantRemoved = (added: AadUserConversationMember): void => {\n    if (added.id) this.removeParticipantFromState(added.id);\n  };\n\n  /**\n   * Update the state with given message either replacing an existing message matching on the id or adding to the list\n   *\n   * @private\n   * @param {(GraphChatMessage)} [message]\n   * @return {*}\n   * @memberof StatefulGraphChatClient\n   */\n  private updateMessages(message?: GraphChatMessage) {\n    if (!message) return;\n    this.notifyStateChange((draft: GraphChatClient) => {\n      const index = draft.messages.findIndex(m => m.messageId === message.messageId);\n      // this message is not already in thread so just add it\n      if (index === -1) {\n        // sort to ensure that messages are in the correct order should we get messages out of order\n        draft.messages = draft.messages.concat(message).sort(MessageCreatedComparator);\n      } else {\n        // replace the existing version of the message with the new one\n        draft.messages.splice(index, 1, message);\n      }\n    });\n  }\n\n  private removeParticipantFromState(membershipId: string): void {\n    this.notifyStateChange((draft: GraphChatClient) => {\n      const index = draft.participants.findIndex(p => p.id === membershipId);\n      if (index !== -1) {\n        draft.participants.splice(index, 1);\n      }\n    });\n  }\n\n  private readonly addChatMembers = async (userIds: string[], history?: Date): Promise<void> => {\n    if (!this.graph) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'error';\n        draft.activeErrorMessages.push(new Error('Graph client not available'));\n      });\n      return;\n    }\n    await addChatMembers(this.graph, this.chatId, userIds, history);\n  };\n\n  /**\n   * Removes the given member from the chat\n   *\n   * @param membershpId {string} id of the user for the chat,\n   * this is the id of the chat member resource in the graph, i.e. member.id, and NOT the user's id\n   * @returns {Promise<void>}\n   */\n  private readonly removeChatMember = async (membershpId: string): Promise<void> => {\n    if (!membershpId) return;\n    if (!this.graph) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'error';\n        draft.activeErrorMessages.push(new Error('Graph client not available'));\n      });\n      return;\n    }\n    const isPresent = this._chat?.members?.findIndex(m => m.id === membershpId) ?? -1;\n    if (isPresent === -1) return;\n    await removeChatMember(this.graph, this.chatId, membershpId);\n    this.removeParticipantFromState(membershpId);\n  };\n\n  private graphImageMatch(messageContent: string): RegExpMatchArray | null {\n    return messageContent.match(graphImageUrlRegex);\n  }\n\n  private processMessageContent(graphMessage: ChatMessage, currentUser: string): MessageConversion {\n    if (!this.graph) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'error';\n        draft.activeErrorMessages.push(new Error('Graph client not available'));\n      });\n      throw new Error('Graph client not available');\n    }\n    const conversion: MessageConversion = {};\n    // using a record here lets us track which image in the content each request is for\n    const futureImages: Record<number, Promise<string | null>> = {};\n    let messageResult = graphMessage.body?.content ?? '';\n    const messageId = graphMessage.id ?? '';\n    let index = 0;\n    let match = this.graphImageMatch(messageResult);\n    while (match) {\n      // note that the regex to replace the placeholder requires that the id be before and adjacent to the src attribute\n      messageResult = messageResult.replace(\n        graphImageUrlRegex,\n        `$1id=\"${messageId}-${index}\" src=\"${placeholderImageContent}\"`\n      );\n      const graphImageUrl = match[2].replace(/[\"']/g, '');\n      // collect promises for the image requests so that we can update the message content once they are all resolved\n      futureImages[index] = loadChatImage(this.graph, graphImageUrl);\n      index++;\n      match = this.graphImageMatch(messageResult);\n    }\n    let placeholderMessage = buildAcsMessage(graphMessage, currentUser, messageId, messageResult);\n    conversion.currentValue = placeholderMessage;\n    // local function to update the message with data from each of the resolved image requests\n    const updateMessage = async () => {\n      await Promise.all(Object.values(futureImages));\n      for (const [imageIndex, futureImage] of Object.entries(futureImages)) {\n        const image = await futureImage;\n        if (image && isChatMessage(placeholderMessage)) {\n          placeholderMessage = {\n            ...placeholderMessage,\n            ...{\n              content: updateMessageContentWithImage(placeholderMessage.content ?? '', imageIndex, messageId, image)\n            }\n          };\n        }\n      }\n      return placeholderMessage;\n    };\n    conversion.futureValue = updateMessage();\n    return conversion;\n  }\n\n  private graphChatMessageToAcsChatMessage(graphMessage: ChatMessage, currentUser: string): MessageConversion {\n    const messageId = graphMessage?.id ?? '';\n    if (!messageId) {\n      throw new Error('Cannot convert graph message to ACS message. No ID found on graph message');\n    }\n    let content = graphMessage.body?.content ?? 'undefined';\n    let result: MessageConversion = {};\n    content = rewriteEmojiContentToHTML(content);\n    // Handle any mentions in the content\n    content = updateMentionsContent(content);\n\n    const imageMatch = this.graphImageMatch(content ?? '');\n    if (imageMatch) {\n      // if the message contains an image, we need to fetch the image and replace the placeholder\n      result = this.processMessageContent(graphMessage, currentUser);\n    } else {\n      result.currentValue = buildAcsMessage(graphMessage, currentUser, messageId, content);\n    }\n    return result;\n  }\n\n  private readonly renameChat = async (topic: string | null): Promise<void> => {\n    if (!this.graph) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'error';\n        draft.activeErrorMessages.push(new Error('Graph client not available'));\n      });\n      return;\n    }\n    await updateChatTopic(this.graph, this.chatId, topic);\n    this.notifyStateChange(() => void (this._chat = { ...this._chat, ...{ topic } }));\n  };\n\n  /**\n   * Register event listeners for chat events to be triggered from the notification service\n   */\n  private registerEventListeners() {\n    this._eventEmitter.on('chatMessageReceived', (message: ChatMessage) => void this.onMessageReceived(message));\n    this._eventEmitter.on('chatMessageDeleted', this.onMessageDeleted);\n    this._eventEmitter.on('chatMessageEdited', (message: ChatMessage) => void this.onMessageEdited(message));\n    this._eventEmitter.on('notificationsSubscribedForResource', this.onChatNotificationsSubscribed);\n    this._eventEmitter.on('chatThreadPropertiesUpdated', this.onChatPropertiesUpdated);\n    // TODO: add define how to handle chat deletion\n    // this._eventEmitter.on('chatThreadDeleted', this.onChatDeleted);\n    this._eventEmitter.on('participantAdded', this.onParticipantAdded);\n    this._eventEmitter.on('participantRemoved', this.onParticipantRemoved);\n    this._eventEmitter.on('graphNotificationClientError', this.onGraphNotificationClientError);\n  }\n\n  /**\n   * Handles the GraphNotificationClient emitted errors.\n   */\n  private readonly onGraphNotificationClientError = (e: Error) => {\n    this.updateErrorState(e);\n  };\n\n  /**\n   * Emits the error state to the stateful client.\n   */\n  private readonly updateErrorState = (e: Error) => {\n    if (e?.message) {\n      error(e?.message);\n    } else {\n      error('an unknown error occurred', e);\n    }\n    this.notifyStateChange((draft: GraphChatClient) => {\n      draft.status = 'error';\n      draft.activeErrorMessages = [e];\n      draft.chat = { topic: 'Unknown' };\n    });\n  };\n\n  private readonly _initialState: GraphChatClient = {\n    status: 'initial',\n    userId: '',\n    messages: [],\n    mentions: [],\n    participants: [],\n    get participantCount() {\n      return this.participants?.length || 0;\n    },\n    disableEditing: false,\n    numberOfChatMessagesToReload: this._messagesPerCall,\n    onDeleteMessage: this.deleteMessage,\n    onSendMessage: this.sendMessage,\n    onUpdateMessage: this.updateMessage,\n    onAddChatMembers: this.addChatMembers,\n    onRemoveChatMember: this.removeChatMember,\n    onRenameChat: this.renameChat,\n    activeErrorMessages: [],\n    chat: this._chat\n  };\n  /**\n   * State of the chat client with initial values set\n   *\n   * @private\n   * @type {GraphChatClient}\n   * @memberof StatefulGraphChatClient\n   */\n  protected readonly state: GraphChatClient = { ...this._initialState };\n}\n\nexport { StatefulGraphChatClient };\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\nimport { makeStyles, shorthands } from '@fluentui/react-components';\nimport React from 'react';\nimport { ArrowSquareUpRight24Regular } from '@fluentui/react-icons';\n\nconst useStyles = makeStyles({\n  container: {\n    backgroundColor: '#ebebeb',\n    display: 'flex',\n    boxShadow: '0px 4px 8px 0px rgba(0, 0, 0, 0.14), 0px 0px 2px 0px rgba(0, 0, 0, 0.12)',\n    textDecorationLine: 'none',\n    color: '#424242',\n    ...shorthands.margin('18px', '0px', '8px', '0px'),\n    ...shorthands.borderRadius('6px'),\n    ...shorthands.padding('16px'),\n    ...shorthands.gap('6px'),\n    ':hover': {\n      backgroundColor: '#fafafa'\n    },\n    ':visited': {\n      color: '#424242'\n    }\n  },\n  cta: {\n    fontFamily: 'Segoe UI',\n    fontSize: '12px',\n    fontStyle: 'normal',\n    fontWeight: '400',\n    lineHeight: '16px',\n    textDecorationLine: 'none'\n  }\n});\n\ninterface UnsupportedContentProps {\n  targetUrl: string;\n}\n\nconst UnsupportedContent = (props: UnsupportedContentProps) => {\n  const styles = useStyles();\n  return (\n    <a className={styles.container} target=\"blank\" href={props.targetUrl}>\n      <ArrowSquareUpRight24Regular />\n      <p className={styles.cta}>View this message in Microsoft Teams.</p>\n    </a>\n  );\n};\n\nexport default UnsupportedContent;\n","import { MessageProps, MessageRenderer } from '@azure/communication-react';\nimport produce from 'immer';\nimport React from 'react';\nimport { renderToString } from 'react-dom/server';\nimport UnsupportedContent from '../components/UnsupportedContent/UnsupportedContent';\nimport { isChatMessage, isGraphChatMessage } from '../utils/types';\n\n/**\n * Renders the preferred content depending on whether it is supported.\n *\n * @param messageProps final message values from the state.\n * @param defaultOnRender default component to render content.\n * @returns\n */\nconst onRenderMessage = (messageProps: MessageProps, defaultOnRender?: MessageRenderer) => {\n  const message = messageProps?.message;\n  if (isGraphChatMessage(message) && message?.hasUnsupportedContent) {\n    const unsupportedContentComponent = <UnsupportedContent targetUrl={message.rawChatUrl} />;\n    messageProps = produce(messageProps, (draft: MessageProps) => {\n      if (isChatMessage(draft.message)) {\n        draft.message.content = renderToString(unsupportedContentComponent);\n      }\n    });\n  }\n\n  return defaultOnRender ? defaultOnRender(messageProps) : <></>;\n};\nexport { onRenderMessage };\n","import React from 'react';\nimport { MgtTemplateProps, Person } from '@microsoft/mgt-react';\nimport { ChatMessageMention, User } from '@microsoft/microsoft-graph-types';\nimport { GraphChatClient } from 'src/statefulClient/StatefulGraphChatClient';\nimport { Mention } from '@azure/communication-react';\n\nconst buildKey = (mention: Mention) => `${mention?.id}-${mention?.displayText}`;\n\nexport const renderMGTMention = (chatState: GraphChatClient) => {\n  return (mention: Mention, defaultRenderer: (mention: Mention) => JSX.Element): JSX.Element => {\n    let render: JSX.Element = defaultRenderer(mention);\n\n    const mentions = chatState?.mentions ?? [];\n    const flatMentions = mentions.flat();\n    const teamsMention: ChatMessageMention | undefined = flatMentions.find(\n      m => m.id?.toString() === mention?.id && m.mentionText === mention?.displayText\n    );\n\n    const user = teamsMention?.mentioned?.user as User;\n    if (user) {\n      const me = user?.id === chatState.userId;\n      const MgtMeMention = (_props: MgtTemplateProps) => {\n        return defaultRenderer(mention);\n      };\n      const MgtOtherMention = () => {\n        return <p className=\"otherMention\">{mention.displayText}</p>;\n      };\n      const MgtMention = me ? MgtMeMention : MgtOtherMention;\n      render = (\n        <Person className=\"mgt-person-mention\" userId={user?.id} personCardInteraction=\"hover\">\n          <MgtMention />\n        </Person>\n      );\n    }\n    render = <span key={buildKey(mention)}>{render}&nbsp;</span>;\n    return render;\n  };\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { mergeStyleSets, mergeStyles } from '@fluentui/react/lib/Styling';\n\nconst classNames = {\n  buttonIcon: 'button-icon',\n  icon: 'icon',\n  iconFilled: 'icon-filled',\n  iconUnfilled: 'icon-unfilled'\n};\n\nconst iconOnlyButtonStyle = mergeStyles({\n  width: '18px',\n  height: '18px'\n});\n\nconst buttonIconStyle = {};\n\nconst colors = {\n  iconRest: '#616161',\n  iconHover: '#5b5fc7'\n};\n\nconst buttonIconStyles = mergeStyleSets({\n  button: [classNames.buttonIcon, buttonIconStyle],\n\n  icon: [\n    classNames.icon,\n    {\n      fill: colors.iconRest,\n      [`.${classNames.buttonIcon}:hover &`]: {\n        fill: colors.iconHover,\n        color: colors.iconHover\n      }\n    }\n  ],\n\n  iconFilled: [\n    classNames.iconFilled,\n    {\n      display: 'none',\n      [`.${classNames.buttonIcon}:hover &`]: {\n        display: 'block'\n      }\n    }\n  ],\n\n  iconUnfilled: [\n    classNames.iconUnfilled,\n    {\n      display: 'block',\n      [`.${classNames.buttonIcon}:hover &`]: {\n        display: 'none'\n      }\n    }\n  ]\n});\n\nexport { buttonIconStyles, buttonIconStyle, iconOnlyButtonStyle };\n","import { createContext } from 'react';\nimport { BotInfoClient } from '../../statefulClient/BotInfoClient';\n\nexport const BotInfoContext = createContext<BotInfoClient | undefined>(undefined);\n","import { useContext, useEffect, useState } from 'react';\nimport { BotInfoContext } from '../components/Context/BotInfoContext';\n\nexport const useBotInfo = () => {\n  const botInfoClient = useContext(BotInfoContext);\n  const [botInfo, setBotInfo] = useState(() => botInfoClient?.getState());\n  useEffect(() => {\n    if (botInfoClient) {\n      botInfoClient.onStateChange(setBotInfo);\n      return () => botInfoClient.offStateChange(setBotInfo);\n    }\n  }, [botInfoClient]);\n  return botInfo;\n};\n","import { Person, ViewType } from '@microsoft/mgt-react';\nimport React, { FC, useEffect } from 'react';\nimport { useBotInfo } from '../../statefulClient/useBotInfo';\nimport { ChatAvatarProps } from './ChatAvatar';\n\ntype BotAvatarProps = ChatAvatarProps & {\n  view?: ViewType;\n};\n\nexport const BotAvatar: FC<BotAvatarProps> = ({ chatId, avatarId, view = 'image' }) => {\n  const botInfo = useBotInfo();\n\n  useEffect(() => {\n    if (chatId && avatarId && !botInfo?.botInfo.has(avatarId)) {\n      void botInfo?.loadBotInfo(chatId, avatarId);\n    }\n  }, [chatId, avatarId, botInfo]);\n\n  return (\n    <div>\n      <Person\n        personDetails={{\n          id: avatarId,\n          displayName: botInfo?.botInfo.has(avatarId)\n            ? botInfo.botInfo.get(avatarId)?.teamsAppDefinition?.displayName\n            : '',\n          personImage: botInfo?.botIcons.has(avatarId) ? botInfo.botIcons.get(avatarId) : ''\n        }}\n        avatarSize=\"small\"\n        personCardInteraction=\"none\"\n        view={view}\n        showPresence={false}\n      />\n    </div>\n  );\n};\n","import { Person } from '@microsoft/mgt-react';\nimport React, { FC, memo } from 'react';\nimport { botPrefix } from '../../statefulClient/buildBotId';\nimport { BotAvatar } from './BotAvatar';\n\nexport interface ChatAvatarProps {\n  /**\n   * The chat id\n   */\n  chatId: string;\n  /**\n   * The id of the entity to get the avatar for\n   * for bots this is prefixed with 'botId::'\n   *\n   */\n  avatarId: string;\n}\n\nconst AvatarSwitcher: FC<ChatAvatarProps> = ({ chatId, avatarId }) =>\n  avatarId.startsWith(botPrefix) ? (\n    <BotAvatar chatId={chatId} avatarId={avatarId.replace(botPrefix, '')} />\n  ) : (\n    <Person userId={avatarId} avatarSize=\"small\" personCardInteraction=\"hover\" showPresence={true} />\n  );\n\nexport const ChatAvatar = memo(AvatarSwitcher);\n","import { makeStyles } from '@fluentui/react-components';\n\nexport const useCommonHeaderStyles = makeStyles({\n  row: {\n    paddingInlineStart: '20px'\n  }\n});\n","import React from 'react';\nimport { AadUserConversationMember, Chat } from '@microsoft/microsoft-graph-types';\nimport { Person } from '@microsoft/mgt-react';\nimport { ChatHeaderProps } from './ChatTitle';\nimport { makeStyles } from '@fluentui/react-components';\nimport { useBotInfo } from '../../statefulClient/useBotInfo';\nimport { BotAvatar } from '../ChatAvatar/BotAvatar';\n\nconst getOtherParticipantUserId = (chat?: Chat, currentUserId = '') =>\n  (chat?.members as AadUserConversationMember[])?.find(m => m.userId !== currentUserId)?.userId;\n\nconst useStyles = makeStyles({\n  person: {\n    '--person-avatar-size': '32px',\n    '--person-alignment': 'center'\n  }\n});\nexport const OneToOneChatHeader = ({ chat, currentUserId }: ChatHeaderProps) => {\n  const botInfo = useBotInfo();\n  const styles = useStyles();\n  const id = getOtherParticipantUserId(chat, currentUserId);\n  if (!chat?.id) return null;\n  if (id) {\n    return (\n      <Person\n        className={styles.person}\n        userId={id}\n        view=\"oneline\"\n        avatarSize=\"small\"\n        personCardInteraction=\"hover\"\n        showPresence={true}\n      />\n    );\n  } else if (botInfo?.chatBots.has(chat.id)) {\n    return (\n      <>\n        {Array.from(botInfo.chatBots.get(chat.id)!).map(bot =>\n          bot.teamsAppDefinition?.bot?.id ? (\n            <BotAvatar\n              key={bot.teamsAppDefinition.bot.id}\n              chatId={chat.id!}\n              avatarId={bot.teamsAppDefinition.bot.id}\n              view=\"oneline\"\n            />\n          ) : null\n        )}\n      </>\n    );\n  }\n  return null;\n};\n","import React, { ReactNode } from 'react';\nimport { makeStyles, shorthands } from '@fluentui/react-components';\n\ninterface CircleProps {\n  height?: string;\n  width?: string;\n  children: ReactNode;\n}\nconst useStyles = makeStyles({\n  container: {\n    ...shorthands.border('1px solid var(--colorBrandBackground2)'),\n    ...shorthands.overflow('hidden'),\n    ...shorthands.borderRadius('50%')\n  },\n  background: {\n    display: 'flex',\n    justifyContent: 'center',\n    alignItems: 'center',\n    backgroundColor: 'var(--colorBrandBackground2)'\n  }\n});\nexport const Circle = ({ height, width, children }: CircleProps): JSX.Element => {\n  const styles = useStyles();\n  const style = { height: height ?? '32px', width: width ?? '32px' };\n  return (\n    <span className={styles.container} style={style}>\n      <span className={styles.background} style={style}>\n        {children}\n      </span>\n    </span>\n  );\n};\n","import React from 'react';\nimport { Chat } from '@microsoft/microsoft-graph-types';\nimport {\n  Calendar16Regular,\n  PeopleTeam16Regular,\n  bundleIcon,\n  Person16Regular,\n  Person16Filled\n} from '@fluentui/react-icons';\nimport { Circle } from '../Circle/Circle';\n\nconst MeetingIcon = bundleIcon(Calendar16Regular, Calendar16Regular);\nconst GroupIcon = bundleIcon(PeopleTeam16Regular, PeopleTeam16Regular);\nconst PersonIcon = bundleIcon(Person16Filled, Person16Regular);\n\nexport const ChatIcon = ({ chatType }: Chat): JSX.Element | null => {\n  const iconColor = 'var(--colorBrandForeground2)';\n\n  switch (chatType) {\n    case 'group':\n      return (\n        <Circle>\n          <GroupIcon color={iconColor} />\n        </Circle>\n      );\n    case 'meeting':\n      return (\n        <Circle>\n          <MeetingIcon color={iconColor} />\n        </Circle>\n      );\n    default:\n      return (\n        <Circle>\n          <PersonIcon color={iconColor} />\n        </Circle>\n      );\n  }\n};\n","import React, { useCallback, useState } from 'react';\nimport { AadUserConversationMember } from '@microsoft/microsoft-graph-types';\nimport { Edit16Filled, Edit16Regular, bundleIcon } from '@fluentui/react-icons';\nimport {\n  Button,\n  Field,\n  Input,\n  InputOnChangeData,\n  OnOpenChangeData,\n  Popover,\n  PopoverSurface,\n  PopoverTrigger,\n  makeStyles,\n  tokens\n} from '@fluentui/react-components';\nimport type { PopoverProps } from '@fluentui/react-components';\nimport { ChatIcon } from '../ChatIcon/ChatIcon';\nimport { ChatHeaderProps } from './ChatTitle';\n\nconst EditIcon = bundleIcon(Edit16Filled, Edit16Regular);\nconst useStyles = makeStyles({\n  chatTitle: {\n    marginInlineStart: '10px'\n  },\n  container: {\n    display: 'flex',\n    flexDirection: 'column',\n    gridRowGap: '16px',\n    minWidth: '300px',\n    backgroundColor: tokens.colorNeutralBackground1\n  },\n  formButtons: {\n    display: 'flex',\n    flexDirection: 'row',\n    justifyContent: 'flex-end',\n    gridColumnGap: '8px'\n  }\n});\nconst reduceToFirstNamesList = (participants: AadUserConversationMember[] = [], userId = '') => {\n  return participants\n    .filter(p => p.userId !== userId)\n    .map(p => {\n      if (p.displayName?.includes(' ')) {\n        return p.displayName.split(' ')[0];\n      }\n      return p.displayName || p.email || p.id;\n    })\n    .join(', ');\n};\nexport const GroupChatHeader = ({ chat, currentUserId, onRenameChat }: ChatHeaderProps) => {\n  const styles = useStyles();\n  const [isPopoverOpen, setIsPopoverOpen] = useState(false);\n  const handleOpenChange = useCallback((_, data: OnOpenChangeData) => setIsPopoverOpen(data.open || false), []);\n  const onCancelClicked = useCallback(() => setIsPopoverOpen(false), []);\n  const [chatName, setChatName] = useState(chat?.topic);\n  const onChatNameChanged = useCallback(\n    (_: React.FormEvent<HTMLInputElement | HTMLTextAreaElement>, data: InputOnChangeData) => {\n      setChatName(data.value);\n    },\n    []\n  );\n  const renameChat = useCallback(() => {\n    void onRenameChat(chatName || null);\n  }, [chatName, onRenameChat]);\n  const chatTitle = chat?.topic\n    ? chat.topic\n    : reduceToFirstNamesList(chat?.members as AadUserConversationMember[], currentUserId);\n  const trapFocus = true;\n  const popoverProps: Partial<PopoverProps> = {\n    trapFocus,\n    inertTrapFocus: trapFocus,\n    inline: true,\n    positioning: 'below-start',\n    open: isPopoverOpen,\n    onOpenChange: handleOpenChange\n  };\n  return (\n    <>\n      <ChatIcon chatType={chat?.chatType} />\n      <span className={styles.chatTitle}>{chatTitle}</span>\n      {chat?.id && (\n        <Popover {...popoverProps}>\n          <PopoverTrigger>\n            <Button appearance=\"transparent\" icon={<EditIcon />} aria-label=\"Name group chat\"></Button>\n          </PopoverTrigger>\n          <PopoverSurface>\n            <div className={styles.container}>\n              <Field label=\"Group name\">\n                <Input placeholder=\"Enter group name\" onChange={onChatNameChanged} value={chatName || ''} />\n              </Field>\n              <div className={styles.formButtons}>\n                <Button appearance=\"secondary\" onClick={onCancelClicked}>\n                  Cancel\n                </Button>\n                <Button appearance=\"primary\" disabled={chatName === chat?.topic} onClick={renameChat}>\n                  Send\n                </Button>\n              </div>\n            </div>\n          </PopoverSurface>\n        </Popover>\n      )}\n    </>\n  );\n};\n","import React, { memo } from 'react';\nimport { Chat } from '@microsoft/microsoft-graph-types';\nimport { makeStyles, mergeClasses } from '@fluentui/react-components';\nimport { useCommonHeaderStyles } from './useCommonHeaderStyles';\nimport { OneToOneChatHeader } from './OneToOneChatHeader';\nimport { GroupChatHeader } from './GroupChatHeader';\n\nexport interface ChatHeaderProps {\n  chat?: Chat;\n  currentUserId?: string;\n  onRenameChat: (newName: string | null) => Promise<void>;\n}\n\nconst useTitleStyles = makeStyles({\n  chatHeader: {\n    display: 'flex',\n    alignItems: 'center',\n    columnGap: '0',\n    lineHeight: '32px',\n    fontSize: '18px',\n    fontWeight: 700,\n    marginBlockStart: '11px',\n    marginBlockEnd: '7px',\n    zIndex: 3\n  }\n});\n\n/**\n * Shows the \"name\" of the chat.\n * For group chats where the topic is set it will show the topic.\n * For group chats with no topic it will show the first names of other participants comma separated.\n * For 1:1 chats it will show the first name of the other participant.\n */\nconst ChatTitle = ({ chat, currentUserId, onRenameChat }: ChatHeaderProps) => {\n  const styles = useTitleStyles();\n  const commonStyles = useCommonHeaderStyles();\n  return (\n    <div className={mergeClasses(styles.chatHeader, commonStyles.row)}>\n      {chat?.chatType !== 'oneOnOne' ? (\n        <GroupChatHeader chat={chat} currentUserId={currentUserId} onRenameChat={onRenameChat} />\n      ) : (\n        <OneToOneChatHeader chat={chat} currentUserId={currentUserId} onRenameChat={onRenameChat} />\n      )}\n    </div>\n  );\n};\n\nexport default memo(ChatTitle);\n","/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/consistent-type-definitions */\nimport { PersonType,GroupType,UserType,IDynamicPerson,PersonCardInteraction } from '@microsoft/mgt-components';\nimport { registerMgtPeoplePickerComponent } from '@microsoft/mgt-components';\nimport { TemplateContext,TemplateRenderedData } from '@microsoft/mgt-element';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport * as MicrosoftGraph from '@microsoft/microsoft-graph-types';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport * as MicrosoftGraphBeta from '@microsoft/microsoft-graph-types-beta';\nimport {wrapMgt} from '../Mgt';\n\nexport type PeoplePickerProps = {\n\tgroupId?: string;\n\tgroupIds?: string[];\n\ttype?: PersonType;\n\tgroupType?: GroupType;\n\tuserType?: UserType;\n\ttransitiveSearch?: boolean;\n\tpeople?: IDynamicPerson[];\n\tshowMax?: number;\n\tdisableImages?: boolean;\n\tshowPresence?: boolean;\n\tpersonCardInteraction?: PersonCardInteraction;\n\tselectedPeople?: IDynamicPerson[];\n\tdefaultSelectedUserIds?: string[];\n\tdefaultSelectedGroupIds?: string[];\n\tplaceholder?: string;\n\tdisabled?: boolean;\n\tallowAnyEmail?: boolean;\n\tselectionMode?: string;\n\tuserIds?: string[];\n\tuserFilters?: string;\n\tpeopleFilters?: string;\n\tgroupFilters?: string;\n\tariaLabel?: string;\n\ttemplateContext?: TemplateContext;\n\tselectionChanged?: (e: CustomEvent<IDynamicPerson[]>) => void;\n\ttemplateRendered?: (e: CustomEvent<TemplateRenderedData>) => void;\n}\n\nexport const PeoplePicker = wrapMgt<PeoplePickerProps>('people-picker', registerMgtPeoplePickerComponent);\n\n","import React, { ChangeEvent, useCallback, useState } from 'react';\nimport { ChoiceGroup, IChoiceGroupOption } from '@fluentui/react';\nimport { shorthands, makeStyles, Button, Input, InputOnChangeData } from '@fluentui/react-components';\nimport { IDynamicPerson, PeoplePicker } from '@microsoft/mgt-react';\n\ninterface AddChatMembersProps {\n  closeDialog: () => void;\n  addChatMembers: (userIds: string[], history?: Date) => Promise<void>;\n}\n\nconst useStyles = makeStyles({\n  addMembers: {\n    display: 'flex',\n    flexDirection: 'column',\n    paddingBlockEnd: '18px',\n    ...shorthands.paddingInline('20px')\n  },\n  buttonRow: {\n    display: 'flex',\n    columnGap: '8px',\n    flexDirection: 'row',\n    justifyContent: 'flex-end',\n    paddingBlockStart: '18px'\n  },\n  dialogHeading: {\n    paddingInlineStart: '4px',\n    marginBlockStart: '18px',\n    marginBlockEnd: '10px'\n  },\n  historyInput: { width: '48px' },\n  option: {\n    display: 'flex',\n    alignItems: 'center',\n    columnGap: '4px'\n  },\n  radio: {\n    marginBlockStart: '8px',\n    paddingInlineStart: '2px'\n  }\n});\n\nconst AddChatMembers = ({ addChatMembers, closeDialog }: AddChatMembersProps) => {\n  const styles = useStyles();\n  const [daysOfHistory, setDaysOfHistory] = useState<number>(1);\n  const handleHistoryChanged = useCallback(\n    (_: ChangeEvent<HTMLInputElement>, data: InputOnChangeData) => {\n      if (data.value) {\n        const newNumber = parseInt(data.value, 10);\n        setDaysOfHistory(newNumber);\n      }\n    },\n    [setDaysOfHistory]\n  );\n\n  const [historyOption, setHistoryOption] = useState<string | undefined>('none');\n  const onHistoryOptionChange = React.useCallback(\n    (_, option: IChoiceGroupOption | undefined) => {\n      if (option) setHistoryOption(option.key);\n    },\n    [setHistoryOption]\n  );\n\n  const [selectedPeople, setSelectedPeople] = useState<IDynamicPerson[]>([]);\n  const peopleSelectionChanged = useCallback(\n    (e: CustomEvent<IDynamicPerson[]>) => {\n      setSelectedPeople(e.detail);\n    },\n    [setSelectedPeople]\n  );\n\n  const addToChat = useCallback(() => {\n    let history: Date | undefined;\n    if (historyOption === 'days') {\n      history = new Date(new Date().getTime() - daysOfHistory * 24 * 60 * 60 * 1000);\n    } else if (historyOption === 'all') {\n      history = new Date('0001-01-01T00:00:00Z');\n    }\n    void addChatMembers(\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      selectedPeople.map(p => p.id!),\n      history\n    ).then(closeDialog);\n  }, [selectedPeople, historyOption, daysOfHistory, addChatMembers, closeDialog]);\n\n  const chatHistoryOptions: IChoiceGroupOption[] = [\n    {\n      key: 'none',\n      text: \"Don't include chat history\"\n    },\n    {\n      key: 'days',\n      text: 'Include history from the past number of days: ',\n\n      onRenderField: (props, render) => {\n        return render ? (\n          <div className={styles.option}>\n            {render(props)}\n            <Input\n              type=\"number\"\n              value={daysOfHistory.toString()}\n              onChange={handleHistoryChanged}\n              min={1}\n              className={styles.historyInput}\n            />\n          </div>\n        ) : null;\n      }\n    },\n    { key: 'all', text: 'Include all chat history' }\n  ];\n  return (\n    <div className={styles.addMembers}>\n      <h3 className={styles.dialogHeading}>Add</h3>\n      <PeoplePicker\n        selectedPeople={selectedPeople}\n        selectionChanged={peopleSelectionChanged}\n        disabled={selectedPeople.length >= 20}\n      />\n      <ChoiceGroup\n        className={styles.radio}\n        options={chatHistoryOptions}\n        selectedKey={historyOption}\n        onChange={onHistoryOptionChange}\n      />\n      <div className={styles.buttonRow}>\n        <Button onClick={closeDialog} appearance=\"secondary\">\n          Cancel\n        </Button>\n        <Button onClick={addToChat} appearance=\"primary\" disabled={selectedPeople.length < 1}>\n          Add\n        </Button>\n      </div>\n    </div>\n  );\n};\n\nexport { AddChatMembers };\n","import React, { useCallback, useState } from 'react';\nimport {\n  makeStyles,\n  mergeClasses,\n  shorthands,\n  Button,\n  Dialog,\n  DialogActions,\n  DialogBody,\n  DialogContent,\n  DialogSurface,\n  DialogTitle\n} from '@fluentui/react-components';\nimport { List, ListItem } from '@fluentui/react-migration-v0-v9';\nimport { Person } from '@microsoft/mgt-react';\nimport { AadUserConversationMember } from '@microsoft/microsoft-graph-types';\nimport { Dismiss20Filled, bundleIcon, iconFilledClassName, iconRegularClassName } from '@fluentui/react-icons';\n\ninterface ListChatMembersProps {\n  currentUserId: string;\n  members: AadUserConversationMember[];\n  removeChatMember: (membershipId: string) => Promise<void>;\n  closeParentPopover: () => void;\n}\n\nconst RemovePerson = bundleIcon(Dismiss20Filled, () => <></>);\n\nconst useStyles = makeStyles({\n  iconPlaceholder: {\n    display: 'flex',\n    width: '24px'\n  },\n  listItem: {\n    listStyleType: 'none',\n    width: '100%',\n    ':focus-visible': {\n      [`& .${iconFilledClassName}`]: {\n        display: 'inline',\n        color: 'var(--colorNeutralForeground2BrandHover)'\n      },\n      [`& .${iconRegularClassName}`]: {\n        display: 'none'\n      }\n    }\n  },\n  memberList: {\n    fontWeight: 800,\n    gridGap: '8px',\n    ...shorthands.marginBlock('0'),\n    ...shorthands.padding('0')\n  },\n  personRow: {\n    display: 'flex',\n    flexDirection: 'row',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    ...shorthands.paddingBlock('5px'),\n    ...shorthands.paddingInline('16px'),\n    cursor: 'pointer',\n    ':hover': {\n      backgroundColor: 'var(--colorSubtleBackgroundHover)',\n      [`& .${iconFilledClassName}`]: {\n        display: 'inline',\n        color: 'var(--colorNeutralForeground2BrandHover)'\n      },\n      [`& .${iconRegularClassName}`]: {\n        display: 'none'\n      }\n    }\n  },\n  fullWidth: {\n    width: '100%'\n  }\n});\n\nconst ListChatMembers = ({ members, currentUserId, removeChatMember, closeParentPopover }: ListChatMembersProps) => {\n  const styles = useStyles();\n  const [removeDialogOpen, setRemoveDialogOpen] = useState(false);\n  const [removeUser, setRemoveUser] = useState<AadUserConversationMember | undefined>(undefined);\n  const openRemoveDialog = useCallback((user: AadUserConversationMember) => {\n    if (!user) return;\n    setRemoveUser(user);\n    setRemoveDialogOpen(true);\n  }, []);\n\n  const closeDialog = useCallback(() => {\n    setRemoveUser(undefined);\n    setRemoveDialogOpen(false);\n    closeParentPopover();\n  }, [closeParentPopover]);\n\n  const removeMember = useCallback(() => {\n    if (!removeUser?.id) {\n      closeDialog();\n      return;\n    }\n\n    void removeChatMember(removeUser.id).then(closeDialog);\n  }, [removeUser, removeChatMember, closeDialog]);\n\n  return (\n    <>\n      <Dialog open={removeDialogOpen} onOpenChange={(_, data) => setRemoveDialogOpen(data.open)}>\n        <DialogSurface>\n          <DialogBody>\n            <DialogTitle>Remove {removeUser?.displayName || ''} from the conversation?</DialogTitle>\n            <DialogContent>They&apos;ll still have access to the chat history.</DialogContent>\n            <DialogActions>\n              <Button appearance=\"secondary\" onClick={closeDialog}>\n                Close\n              </Button>\n              <Button appearance=\"primary\" onClick={removeMember}>\n                Remove\n              </Button>\n            </DialogActions>\n          </DialogBody>\n        </DialogSurface>\n      </Dialog>\n      <List navigable className={styles.memberList}>\n        {members.map(member => {\n          const isCurrentUser = currentUserId === member.userId;\n          return member?.userId ? (\n            <ListItem\n              key={member.userId}\n              className={styles.listItem}\n              onClick={() => {\n                if (isCurrentUser) {\n                  closeDialog();\n                } else {\n                  openRemoveDialog(member);\n                }\n              }}\n            >\n              <div className={mergeClasses(styles.personRow, styles.fullWidth)}>\n                <Person className={styles.fullWidth} tabIndex={-1} userId={member.userId} view=\"oneline\" showPresence />\n                <span className={styles.iconPlaceholder}>{!isCurrentUser && <RemovePerson />}</span>\n              </div>\n            </ListItem>\n          ) : null;\n        })}\n      </List>\n    </>\n  );\n};\n\nexport { ListChatMembers };\n","import React, { memo, useCallback, useState } from 'react';\nimport {\n  makeStyles,\n  shorthands,\n  Button,\n  Popover,\n  PopoverSurface,\n  PopoverTrigger,\n  Divider,\n  OnOpenChangeData,\n  Dialog,\n  DialogActions,\n  DialogBody,\n  DialogContent,\n  DialogSurface,\n  DialogTitle,\n  DialogTrigger,\n  PopoverProps\n} from '@fluentui/react-components';\nimport {\n  bundleIcon,\n  PeopleAdd24Regular,\n  PeopleAdd24Filled,\n  DoorArrowLeft24Filled,\n  DoorArrowLeft24Regular\n} from '@fluentui/react-icons';\nimport { AadUserConversationMember } from '@microsoft/microsoft-graph-types';\nimport { AddChatMembers } from './AddChatMembers';\nimport { ListChatMembers } from './ListChatMembers';\n\ninterface ManageChatMembersProps {\n  currentUserId: string;\n  members: AadUserConversationMember[];\n  removeChatMember: (membershipId: string) => Promise<void>;\n  addChatMembers: (userIds: string[], history?: Date) => Promise<void>;\n}\n\nconst AddPeople = bundleIcon(PeopleAdd24Filled, PeopleAdd24Regular);\nconst Leave = bundleIcon(DoorArrowLeft24Filled, DoorArrowLeft24Regular);\n\nconst useStyles = makeStyles({\n  button: {\n    justifyContent: 'flex-start',\n    ...shorthands.paddingInline('16px')\n  },\n  buttonRow: {\n    display: 'flex',\n    flexDirection: 'column'\n  },\n  container: {\n    ...shorthands.paddingBlock('4px')\n  },\n  divider: {\n    ...shorthands.marginBlock('4px')\n  },\n  popover: {\n    ...shorthands.padding('0 !important')\n  },\n  triggerButton: {\n    ...shorthands.marginInline('0px', '8px'),\n    ...shorthands.paddingInline('0'),\n    '--spacingHorizontalSNudge': '2px',\n    minWidth: 'unset !important',\n    width: 'max-content'\n  }\n});\n\nconst ManageChatMembersComponent = ({\n  currentUserId,\n  members,\n  addChatMembers,\n  removeChatMember\n}: ManageChatMembersProps) => {\n  const styles = useStyles();\n  const [isPopoverOpen, setIsPopoverOpen] = useState(false);\n  const [showAddMembers, setShowAddMembers] = useState(false);\n  const openAddMembers = useCallback(() => {\n    setShowAddMembers(true);\n  }, [setShowAddMembers]);\n  const closeCallout = useCallback(() => {\n    setShowAddMembers(false);\n    setIsPopoverOpen(false);\n  }, [setShowAddMembers]);\n  const handleOpenChange = useCallback(\n    (_, data: OnOpenChangeData) => setIsPopoverOpen(data.open || false),\n    [setIsPopoverOpen]\n  );\n\n  const leaveChat = useCallback(() => {\n    const me = members.find(member => member.userId === currentUserId);\n    if (me?.id) {\n      void removeChatMember(me.id).then(closeCallout);\n      return;\n    }\n    closeCallout();\n  }, [removeChatMember, members, currentUserId, closeCallout]);\n  const trapFocus = true;\n  const popoverProps: Partial<PopoverProps> = {\n    trapFocus,\n    inertTrapFocus: trapFocus,\n    inline: true,\n    positioning: 'below-start',\n    open: isPopoverOpen,\n    onOpenChange: handleOpenChange\n  };\n  return (\n    <Popover {...popoverProps}>\n      <PopoverTrigger>\n        <Button className={styles.triggerButton} appearance=\"transparent\" icon={<AddPeople />}>\n          {members.length}\n        </Button>\n      </PopoverTrigger>\n      <PopoverSurface className={styles.popover}>\n        {showAddMembers ? (\n          <AddChatMembers closeDialog={closeCallout} addChatMembers={addChatMembers} />\n        ) : (\n          <div className={styles.container}>\n            <ListChatMembers\n              members={members}\n              removeChatMember={removeChatMember}\n              currentUserId={currentUserId}\n              closeParentPopover={closeCallout}\n            />\n            <Divider className={styles.divider} />\n            <div className={styles.buttonRow}>\n              <Button appearance=\"subtle\" icon={<AddPeople />} onClick={openAddMembers} className={styles.button}>\n                Add people\n              </Button>\n              <Dialog>\n                <DialogTrigger>\n                  <Button appearance=\"subtle\" icon={<Leave />} className={styles.button}>\n                    Leave\n                  </Button>\n                </DialogTrigger>\n                <DialogSurface>\n                  <DialogBody>\n                    <DialogTitle>Leave the conversation?</DialogTitle>\n                    <DialogContent>You&apos;ll still have access to the chat history.</DialogContent>\n                    <DialogActions>\n                      <DialogTrigger disableButtonEnhancement>\n                        <Button appearance=\"secondary\" onClick={closeCallout}>\n                          Cancel\n                        </Button>\n                      </DialogTrigger>\n                      {members.length > 2 && (\n                        <Button appearance=\"primary\" onClick={leaveChat}>\n                          Leave\n                        </Button>\n                      )}\n                    </DialogActions>\n                  </DialogBody>\n                </DialogSurface>\n              </Dialog>\n            </div>\n          </div>\n        )}\n      </PopoverSurface>\n    </Popover>\n  );\n};\n\nconst ManageChatMembers = memo(ManageChatMembersComponent);\n\nexport { ManageChatMembers };\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\nimport {\n  Button,\n  Menu,\n  MenuItemLink,\n  MenuList,\n  MenuPopover,\n  MenuProps,\n  MenuTrigger,\n  makeStyles\n} from '@fluentui/react-components';\nimport { MoreHorizontal24Filled, MoreHorizontal24Regular, bundleIcon } from '@fluentui/react-icons';\nimport { createSvgIcon } from '@fluentui/react-icons-northstar';\nimport React from 'react';\n\nconst TeamsIcon = createSvgIcon({\n  svg: () => (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n      <path\n        d=\"M17.0797 8H14.1797L12.4697 8.82V12.89C12.5119 13.5868 12.8184 14.2412 13.3267 14.7197C13.8349 15.1981 14.5067 15.4645 15.2047 15.4645C15.9028 15.4645 16.5745 15.1981 17.0828 14.7197C17.5911 14.2412 17.8976 13.5868 17.9397 12.89V8.82C17.9399 8.70887 17.9174 8.59886 17.8737 8.49668C17.83 8.39449 17.766 8.30225 17.6856 8.22556C17.6052 8.14887 17.51 8.08933 17.4058 8.05055C17.3017 8.01178 17.1907 7.99458 17.0797 8Z\"\n        fill=\"#115EA3\"\n      />\n      <path\n        d=\"M16 7C17.1046 7 18 6.10457 18 5C18 3.89543 17.1046 3 16 3C14.8954 3 14 3.89543 14 5C14 6.10457 14.8954 7 16 7Z\"\n        fill=\"#115EA3\"\n      />\n      <path\n        d=\"M6.82 8H14.18C14.3975 8 14.606 8.08639 14.7598 8.24017C14.9136 8.39395 15 8.60252 15 8.82V13.5C15 14.6935 14.5259 15.8381 13.682 16.682C12.8381 17.5259 11.6935 18 10.5 18C9.30653 18 8.16193 17.5259 7.31802 16.682C6.47411 15.8381 6 14.6935 6 13.5V8.82C6 8.60252 6.08639 8.39395 6.24017 8.24017C6.39395 8.08639 6.60252 8 6.82 8Z\"\n        fill=\"#B4D6FA\"\n      />\n      <path\n        d=\"M11 8C12.6569 8 14 6.65685 14 5C14 3.34315 12.6569 2 11 2C9.34315 2 8 3.34315 8 5C8 6.65685 9.34315 8 11 8Z\"\n        fill=\"#B4D6FA\"\n      />\n      <path\n        opacity=\"0.5\"\n        d=\"M6.00003 8.82V13.5C5.99696 14.3892 6.25799 15.2593 6.75003 16H10.97C11.5005 16 12.0092 15.7893 12.3842 15.4142C12.7593 15.0391 12.97 14.5304 12.97 14V8H6.75003C6.5449 8.01757 6.35389 8.11166 6.21494 8.26358C6.07599 8.4155 5.99928 8.61412 6.00003 8.82Z\"\n        fill=\"#242424\"\n      />\n      <path\n        opacity=\"0.5\"\n        d=\"M11.9699 6H8.16992C8.3332 6.46135 8.60686 6.87575 8.96704 7.20706C9.32722 7.53837 9.76299 7.77654 10.2363 7.9008C10.7097 8.02505 11.2062 8.03162 11.6827 7.91993C12.1592 7.80823 12.6011 7.58167 12.9699 7.26V7C12.9699 6.73478 12.8646 6.48043 12.677 6.29289C12.4895 6.10536 12.2351 6 11.9699 6Z\"\n        fill=\"#242424\"\n      />\n      <path\n        opacity=\"0.1\"\n        d=\"M6.00003 8.82V13.5C5.99696 14.3892 6.25799 15.2593 6.75003 16H10.97C11.5005 16 12.0092 15.7893 12.3842 15.4142C12.7593 15.0391 12.97 14.5304 12.97 14V8H6.75003C6.5449 8.01757 6.35389 8.11166 6.21494 8.26358C6.07599 8.4155 5.99928 8.61412 6.00003 8.82Z\"\n        fill=\"white\"\n      />\n      <path\n        opacity=\"0.1\"\n        d=\"M11.9699 6H8.16992C8.3332 6.46135 8.60686 6.87575 8.96704 7.20706C9.32722 7.53837 9.76299 7.77654 10.2363 7.9008C10.7097 8.02505 11.2062 8.03162 11.6827 7.91993C12.1592 7.80823 12.6011 7.58167 12.9699 7.26V7C12.9699 6.73478 12.8646 6.48043 12.677 6.29289C12.4895 6.10536 12.2351 6 11.9699 6Z\"\n        fill=\"white\"\n      />\n      <path\n        d=\"M11 5H3C2.44772 5 2 5.44772 2 6V14C2 14.5523 2.44772 15 3 15H11C11.5523 15 12 14.5523 12 14V6C12 5.44772 11.5523 5 11 5Z\"\n        fill=\"#115EA3\"\n      />\n      <path d=\"M10 8H8V13H7V8H5V7H10V8Z\" fill=\"white\" />\n    </svg>\n  ),\n  displayName: 'TeamsIcon'\n});\n\nconst EllipsisIcon = bundleIcon(MoreHorizontal24Filled, MoreHorizontal24Regular);\n\nconst menuProps: Partial<MenuProps> = {\n  inline: true,\n  hasIcons: true,\n  closeOnScroll: true,\n  positioning: 'below-start'\n};\n\nconst ellipsisMenuStyles = makeStyles({\n  menuPopover: {\n    zIndex: 2,\n\n    '& .fui-MenuItemLink__content': {\n      fontFamily: 'Segoe UI',\n      fontSize: '12px',\n      fontStyle: 'normal',\n      fontWeight: '600'\n    }\n  }\n});\ninterface MenuItemsProps {\n  chatWebUrl: string;\n}\n\nconst EllipsisMenu = (props: MenuItemsProps) => {\n  const styles = ellipsisMenuStyles();\n\n  return (\n    <Menu {...menuProps}>\n      <MenuTrigger disableButtonEnhancement>\n        <Button appearance=\"transparent\" icon={<EllipsisIcon />} />\n      </MenuTrigger>\n\n      <MenuPopover className={styles.menuPopover}>\n        <MenuList>\n          <MenuItemLink icon={<TeamsIcon />} target=\"_blank\" href={props.chatWebUrl}>\n            Go to Microsoft Teams\n          </MenuItemLink>\n        </MenuList>\n      </MenuPopover>\n    </Menu>\n  );\n};\n\nexport { EllipsisMenu };\n","import { Divider, makeStyles, mergeClasses } from '@fluentui/react-components';\nimport React from 'react';\nimport { GraphChatClient } from '../../statefulClient/StatefulGraphChatClient';\nimport ChatTitle from './ChatTitle';\nimport { ManageChatMembers } from '../ManageChatMembers/ManageChatMembers';\nimport { useCommonHeaderStyles } from './useCommonHeaderStyles';\nimport { EllipsisMenu } from './EllipsisMenu';\n\nconst useHeaderStyles = makeStyles({\n  chatHeader: {\n    display: 'flex',\n    flexDirection: 'column',\n    rowGap: 0,\n    zIndex: 4\n  },\n  secondRow: {\n    display: 'flex',\n    flexDirection: 'row',\n    justifyContent: 'flex-start',\n    alignItems: 'center',\n    height: '30px'\n  },\n  noGrow: {\n    flexGrow: 0\n  }\n});\ninterface ChatHeaderProps {\n  chatState: GraphChatClient;\n}\nconst ChatHeader = ({ chatState }: ChatHeaderProps) => {\n  const styles = useHeaderStyles();\n  const commonStyles = useCommonHeaderStyles();\n  const chatWebUrl = chatState?.chat?.webUrl ?? 'https://teams.microsoft.com/v2';\n\n  return (\n    <div className={styles.chatHeader}>\n      <ChatTitle chat={chatState.chat} currentUserId={chatState.userId} onRenameChat={chatState.onRenameChat} />\n      <Divider appearance=\"subtle\" />\n      <div className={mergeClasses(styles.secondRow, commonStyles.row)}>\n        {chatState.participants?.length > 0 && chatState.chat?.chatType === 'group' && (\n          <>\n            <ManageChatMembers\n              members={chatState.participants}\n              removeChatMember={chatState.onRemoveChatMember}\n              currentUserId={chatState.userId}\n              addChatMembers={chatState.onAddChatMembers}\n            />\n            <Divider vertical appearance=\"subtle\" inset className={styles.noGrow} />\n          </>\n        )}\n        <EllipsisMenu chatWebUrl={chatWebUrl} />\n      </div>\n      <Divider appearance=\"subtle\" />\n    </div>\n  );\n};\n\nexport { ChatHeader };\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport React from 'react';\n\nexport const GenericErrorIcon = () => {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"68\" height=\"68\" viewBox=\"0 0 68 68\" fill=\"none\">\n      <path\n        d=\"M58.0129 27.6675L43.4354 42.3725C42.5854 43.2225 42.9679 44.71 44.1579 45.0075L64.1754 50.32C65.3654 50.6175 66.4279 49.555 66.1304 48.365L60.6904 28.39C60.3079 27.2 58.8629 26.775 58.0129 27.6675Z\"\n        fill=\"url(#paint0_linear_11292_9370)\"\n      />\n      <path\n        d=\"M15.5978 11.0075L6.92782 29.835C6.41782 30.94 7.31032 32.1725 8.50032 32.0875L29.1128 30.175C30.3453 30.0475 30.9828 28.6875 30.2603 27.6675L18.3178 10.7525C17.5953 9.73251 16.1078 9.90251 15.5978 11.0075Z\"\n        fill=\"url(#paint1_linear_11292_9370)\"\n      />\n      <path\n        d=\"M32.0877 13.6423L7.05516 50.7448C5.56766 52.9123 7.01266 55.8873 9.64766 56.0998L54.3152 59.2448C56.9502 59.4148 58.7777 56.6948 57.6302 54.3148L37.9952 14.0673C36.8477 11.6873 33.5752 11.4748 32.0877 13.6423Z\"\n        fill=\"#FFD590\"\n      />\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M58.8201 35.5298C58.5651 36.4223 59.0751 37.3998 59.9676 37.6548C60.8601 37.9523 61.7951 37.4423 62.0501 36.5498L65.7476 24.3098C66.0026 23.4173 65.4926 22.4398 64.6001 22.1848C63.7076 21.9298 62.7301 22.4398 62.4751 23.3323L58.8201 35.5298ZM60.6902 41.5648C60.6902 42.621 59.834 43.4773 58.7777 43.4773C57.7215 43.4773 56.8652 42.621 56.8652 41.5648C56.8652 40.5085 57.7215 39.6523 58.7777 39.6523C59.834 39.6523 60.6902 40.5085 60.6902 41.5648Z\"\n        fill=\"#3E8EED\"\n      />\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M31.3668 41.9901C31.2818 42.9251 32.0043 43.7326 32.9393 43.8176C33.8743 43.8601 34.6818 43.1801 34.7668 42.2451L35.9993 24.8626C36.0843 23.9276 35.3618 23.1201 34.4268 23.0351C33.4918 22.9501 32.6843 23.6726 32.5993 24.6076L31.3668 41.9901ZM34.5965 47.8551C34.5965 48.9114 33.7402 49.7676 32.684 49.7676C31.6277 49.7676 30.7715 48.9114 30.7715 47.8551C30.7715 46.7989 31.6277 45.9426 32.684 45.9426C33.7402 45.9426 34.5965 46.7989 34.5965 47.8551Z\"\n        fill=\"white\"\n      />\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M11.3473 21.6326C11.6023 22.5676 12.5373 23.0776 13.4298 22.8226C14.3223 22.5676 14.8323 21.6326 14.6198 20.7401L11.1348 8.45757C10.8798 7.52257 9.94479 7.01257 9.05229 7.26757C8.11729 7.52257 7.60729 8.45757 7.86229 9.35007L11.3473 21.6326ZM16.4472 26.7327C16.4472 27.7889 15.5909 28.6452 14.5347 28.6452C13.4784 28.6452 12.6222 27.7889 12.6222 26.7327C12.6222 25.6764 13.4784 24.8202 14.5347 24.8202C15.5909 24.8202 16.4472 25.6764 16.4472 26.7327Z\"\n        fill=\"#28C2D1\"\n      />\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M34.3818 8.75509C34.2118 8.58509 34.1268 8.37259 34.0843 8.16009L33.6593 5.44009C33.5743 4.84509 33.9993 4.33509 34.5518 4.25009C34.8493 4.20759 35.1468 4.29259 35.3593 4.46259C35.5718 4.63259 35.6993 4.88759 35.7418 5.14259L36.1243 7.86259C36.2093 8.45759 35.7843 8.96759 35.2318 9.05259C34.9343 9.09509 34.5943 8.96759 34.3818 8.75509ZM39.2694 9.09522C39.0144 9.52022 39.0994 10.0302 39.4394 10.3702C39.4819 10.4127 39.5669 10.4977 39.6519 10.4977C40.1619 10.7952 40.7994 10.6252 41.0544 10.1577L42.3719 7.94772C42.4994 7.69272 42.5419 7.43772 42.4994 7.14022C42.4569 6.92772 42.3294 6.71522 42.1594 6.58772C42.1382 6.56647 42.1169 6.55584 42.0957 6.54522C42.0744 6.53459 42.0532 6.52397 42.0319 6.50272C41.5219 6.20522 40.8844 6.37522 40.6294 6.84272L39.2694 9.09522ZM43.3069 13.8126C43.3494 13.8976 43.4344 14.0251 43.5194 14.1101C43.8594 14.4076 44.3269 14.4926 44.7094 14.2801L46.9194 13.1751C47.1744 13.0476 47.3444 12.8351 47.4294 12.5801C47.5144 12.3251 47.5144 12.0276 47.3869 11.7726L47.3869 11.7726C47.3019 11.6451 47.2169 11.5176 47.0894 11.4326C47.0244 11.3677 46.9347 11.3276 46.8581 11.2933L46.858 11.2933C46.8344 11.2827 46.8119 11.2727 46.7919 11.2626C46.5369 11.1776 46.2394 11.1776 45.9844 11.3051L43.7744 12.4101C43.5194 12.5376 43.3494 12.7501 43.2644 13.0051C43.1794 13.3026 43.1794 13.5576 43.3069 13.8126Z\"\n        fill=\"#E1DFDD\"\n      />\n      <defs>\n        <linearGradient\n          id=\"paint0_linear_11292_9370\"\n          x1=\"42.1229\"\n          y1=\"42.8716\"\n          x2=\"57.8851\"\n          y2=\"39.5913\"\n          gradientUnits=\"userSpaceOnUse\"\n        >\n          <stop offset=\"0.000984252\" stopColor=\"#72ACF1\" />\n          <stop offset=\"1\" stopColor=\"#A7CBF6\" />\n        </linearGradient>\n        <linearGradient\n          id=\"paint1_linear_11292_9370\"\n          x1=\"28.8553\"\n          y1=\"30.7359\"\n          x2=\"17.0695\"\n          y2=\"23.6816\"\n          gradientUnits=\"userSpaceOnUse\"\n        >\n          <stop offset=\"0.000984252\" stopColor=\"#7BDDEF\" />\n          <stop offset=\"1\" stopColor=\"#C3F2F4\" />\n        </linearGradient>\n      </defs>\n    </svg>\n  );\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport React from 'react';\nimport { makeStyles, shorthands } from '@fluentui/react-components';\nimport { GenericErrorIcon } from './GenericErrorIcon';\n\nconst useStyles = makeStyles({\n  container: {\n    backgroundColor: 'var(--Neutral-Background-2-Rest, #FAFAFA)',\n    display: 'flex',\n    flexWrap: 'wrap',\n    flexDirection: 'column',\n    alignContent: 'center',\n    justifyContent: 'center',\n    width: '100%',\n    height: '100%',\n    fontFamily: 'Segoe UI',\n    ...shorthands.paddingInline('0 16px'),\n    ...shorthands.gap('24px')\n  },\n  icon: {\n    display: 'flex',\n    flexWrap: 'wrap',\n    justifyContent: 'center',\n    alignContent: 'center'\n  },\n  messageContainer: {},\n  message: {\n    color: 'var(--Neutral-Foreground-1-Rest, #242424)',\n    textAlign: 'center',\n    fontSize: '16px',\n    fontStyle: 'normal',\n    fontWeight: '600',\n    lineHeight: '22px'\n  },\n  subheading: {\n    color: 'var(--Neutral-Foreground-2-Rest, #424242)',\n    textAlign: 'center',\n    fontSize: '14px',\n    fontStyle: 'normal',\n    fontWeight: '400',\n    lineHeight: '20px'\n  }\n});\n/**\n * Error message component props\n */\ninterface IMGTErrorProps {\n  icon?: React.FC;\n  message: string;\n  subheading?: React.FC;\n}\n\nconst EmptySubheading = () => {\n  return <p></p>;\n};\n\n/**\n * Renders a full screen error message.\n * @returns\n */\nconst Error = ({ icon = GenericErrorIcon, message, subheading }: IMGTErrorProps): JSX.Element => {\n  const styles = useStyles();\n  const IconTemplate = icon;\n  const SubheadingTemplate = subheading ? subheading : EmptySubheading;\n\n  return (\n    <div className={styles.container}>\n      <div className={styles.icon}>\n        <IconTemplate />\n      </div>\n      <div className={styles.messageContainer}>\n        <div className={styles.message}>{message}</div>\n        {subheading && (\n          <div className={styles.subheading}>\n            <SubheadingTemplate />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport { Error };\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport React from 'react';\nexport const LoadingMessagesErrorIcon = () => {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"91\" height=\"57\" viewBox=\"0 0 91 57\" fill=\"none\">\n      <path\n        d=\"M8.94601 17.9535C13.4725 17.9535 17.142 14.2841 17.142 9.75753C17.142 5.231 13.4725 1.56152 8.94601 1.56152C4.41948 1.56152 0.75 5.231 0.75 9.75753C0.75 14.2841 4.41948 17.9535 8.94601 17.9535Z\"\n        fill=\"#CCE4F6\"\n      />\n      <path\n        d=\"M13.3704 16.8063C13.2065 16.6424 13.0425 16.4785 12.8786 16.4785C12.3869 16.1506 11.8951 15.8228 11.5673 15.6589C11.5673 15.6589 11.4034 15.6589 11.4034 15.4949C10.9116 15.331 10.7477 15.1671 10.5838 15.0032C10.5838 15.0032 10.4198 14.6753 10.4198 14.3475V13.2001C10.7477 13.0361 10.9116 12.8722 11.0755 12.7083C11.0755 12.7083 11.4034 12.3805 11.7312 11.7248C11.8951 11.5609 11.8951 11.233 11.8951 11.233C12.3869 11.233 12.8786 10.7412 12.8786 10.2495C12.8786 10.0856 12.8786 9.92164 12.7147 9.75772C12.8786 9.26596 13.0426 8.61028 13.0426 8.11852C13.0426 6.47932 12.7147 5.00404 11.4034 4.34836C10.5838 2.87308 8.28887 2.54523 6.81359 3.20091C5.3383 3.85659 4.51871 5.33189 4.02695 4.18444C4.02695 4.18444 2.87951 5.33188 3.20735 6.80717C3.37127 7.79069 4.19088 8.28245 5.01048 8.28245C5.01048 8.77421 5.17439 9.26596 5.33831 9.75772C5.33831 9.92164 5.17438 10.0856 5.17438 10.0856C5.17438 10.5773 5.66615 11.0691 6.15792 11.0691C6.15792 11.3969 6.64968 12.3804 7.79712 13.0361V14.1836C7.79712 14.3475 7.79711 14.6753 7.63319 14.8393C7.46927 15.0032 7.30536 15.0032 6.97752 15.331C6.64968 15.4949 6.64967 15.4949 6.48575 15.4949C6.48575 15.4949 6.15791 15.6589 5.66615 15.9867C5.33831 16.1506 5.17439 16.4785 4.84655 16.6424C6.15791 17.2981 7.46928 17.7898 9.10848 17.7898C10.5838 17.9537 12.059 17.6259 13.3704 16.8063Z\"\n        fill=\"#66AEE5\"\n      />\n      <path\n        d=\"M82.4579 52.7043C86.8939 52.7043 90.49 49.1082 90.49 44.6722C90.49 40.2362 86.8939 36.6401 82.4579 36.6401C78.0219 36.6401 74.4258 40.2362 74.4258 44.6722C74.4258 49.1082 78.0219 52.7043 82.4579 52.7043Z\"\n        fill=\"#E7DFF3\"\n      />\n      <path\n        d=\"M86.0634 48.2778L86.2273 47.9499C86.8829 47.1303 87.2108 45.9829 87.2108 44.8354C87.2108 42.0488 85.0798 39.7539 82.621 39.7539C80.1622 39.7539 78.0312 42.0488 78.0312 44.8354C78.0312 45.819 78.1952 46.6386 78.6869 47.4582C78.8509 47.6221 78.8509 47.786 79.0148 47.9499L79.1787 48.2778C79.8344 49.2613 79.5065 50.5726 78.6869 51.2283L78.3591 51.3922C78.3591 51.3922 80.1622 52.7036 82.785 52.7036C85.4077 52.7036 87.2108 51.3922 87.2108 51.3922L86.883 51.2283C85.5716 50.5726 85.4077 49.2613 86.0634 48.2778Z\"\n        fill=\"#CFC0E8\"\n      />\n      <path\n        d=\"M68.6889 53.8517H31.3151C30.4955 53.8517 29.8398 53.196 29.8398 52.3764V38.6071C29.8398 37.7875 30.4955 37.1318 31.3151 37.1318H68.6889C69.5085 37.1318 70.1642 37.7875 70.1642 38.6071V52.3764C70.1642 53.196 69.5085 53.8517 68.6889 53.8517Z\"\n        fill=\"#B6A0DC\"\n      />\n      <path\n        d=\"M62.9519 56.3109C63.2798 56.6387 63.7715 56.4748 64.0994 56.3109L67.3778 53.8521H59.3457L62.9519 56.3109Z\"\n        fill=\"#B6A0DC\"\n      />\n      <path\n        d=\"M22.5586 17.7895H57.4219C58.1543 17.7895 58.7402 17.1338 58.7402 16.3142V1.72528C58.7402 0.905683 58.1543 0.25 57.4219 0.25H22.5586C21.8262 0.25 21.2402 0.905683 21.2402 1.72528V16.3142C21.3867 17.1338 21.9726 17.7895 22.5586 17.7895Z\"\n        fill=\"#0078D4\"\n      />\n      <path\n        d=\"M28.9452 20.4118C28.6174 20.7396 28.1256 20.7396 27.7978 20.4118L24.3555 17.7891H32.7154L28.9452 20.4118Z\"\n        fill=\"#0078D4\"\n      />\n      <path\n        d=\"M59.6739 47.9504C60.8508 47.9504 61.8049 46.9963 61.8049 45.8194C61.8049 44.6425 60.8508 43.6885 59.6739 43.6885C58.497 43.6885 57.543 44.6425 57.543 45.8194C57.543 46.9963 58.497 47.9504 59.6739 47.9504Z\"\n        fill=\"#654994\"\n      />\n      <path\n        d=\"M50.4942 47.9504C51.6711 47.9504 52.6252 46.9963 52.6252 45.8194C52.6252 44.6425 51.6711 43.6885 50.4942 43.6885C49.3174 43.6885 48.3633 44.6425 48.3633 45.8194C48.3633 46.9963 49.3174 47.9504 50.4942 47.9504Z\"\n        fill=\"#654994\"\n      />\n      <path\n        d=\"M41.3146 47.9509C42.4915 47.9509 43.4455 46.9968 43.4455 45.8199C43.4455 44.643 42.4915 43.689 41.3146 43.689C40.1377 43.689 39.1836 44.643 39.1836 45.8199C39.1836 46.9968 40.1377 47.9509 41.3146 47.9509Z\"\n        fill=\"#654994\"\n      />\n    </svg>\n  );\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport React from 'react';\n\nimport { Link, LinkProps } from '@fluentui/react-components';\n\nexport const OpenTeamsLink = (props: LinkProps & { as?: 'a' }) => (\n  <Link href=\"https://teams.microsoft.com\" {...props}>\n    open the Teams app\n  </Link>\n);\n\nexport const OpenTeamsLinkError = () => {\n  return (\n    <p>\n      If the problem continues, <OpenTeamsLink /> to view the issue.\n    </p>\n  );\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport React from 'react';\n\nexport const RequireValidChatId = () => {\n  return <p>A valid chat id is required.</p>;\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport React from 'react';\n\nexport const TypeANewMessage = () => {\n  return <p>Type a new message and send.</p>;\n};\n","import { TeamsAppInstallation } from '@microsoft/microsoft-graph-types-beta';\nimport { BaseStatefulClient } from './BaseStatefulClient';\nimport { loadBotInChat, loadBotIcon } from './graph.chat';\n\nexport interface BotInfo {\n  botInfo: Map<string, TeamsAppInstallation>;\n  chatBots: Map<string, Set<TeamsAppInstallation>>;\n  botIcons: Map<string, string>;\n  loadBotInfo: (chatId: string, botId: string) => Promise<void>;\n}\n\nconst requestKey = (chatId: string, botId: string) => `${chatId}::${botId}`;\n\nexport class BotInfoClient extends BaseStatefulClient<BotInfo> {\n  private readonly infoRequestMap = new Map<string, Promise<unknown>>();\n\n  public loadBotInfo = async (chatId: string, botId: string) => {\n    const beta = this.betaGraph;\n    if (!beta) return;\n    const key = requestKey(chatId, botId);\n    if (!this.infoRequestMap.has(key)) {\n      const requestPromise = loadBotInChat(beta, chatId, botId);\n      this.infoRequestMap.set(key, requestPromise);\n      const botInfo = await requestPromise;\n      if (botInfo?.value.length > 0) {\n        // update state with the text info\n        this.notifyStateChange((draft: BotInfo) => {\n          botInfo.value.forEach(app => {\n            if (app.teamsAppDefinition?.bot?.id) {\n              draft.botInfo.set(app.teamsAppDefinition?.bot?.id, app);\n              if (!draft.chatBots.has(chatId)) {\n                draft.chatBots.set(chatId, new Set());\n              }\n              draft.chatBots.get(chatId)?.add(app);\n            }\n          });\n        });\n        // load the appIcon for each bot\n        for (const app of botInfo.value) {\n          const appIcon = await loadBotIcon(beta, app);\n          this.notifyStateChange((draft: BotInfo) => {\n            if (app.teamsAppDefinition?.bot?.id) {\n              draft.botIcons.set(app.teamsAppDefinition?.bot?.id, appIcon);\n            }\n          });\n        }\n      }\n    }\n  };\n  protected state: BotInfo = {\n    botInfo: new Map<string, TeamsAppInstallation>(),\n    chatBots: new Map<string, Set<TeamsAppInstallation>>(),\n    botIcons: new Map<string, string>(),\n    loadBotInfo: this.loadBotInfo\n  };\n}\n","import React from 'react';\nimport { DEFAULT_COMPONENT_ICONS } from '@azure/communication-react';\nimport { registerIcons } from '@fluentui/react';\nimport { buttonIconStyles } from './common.styles';\n\nconst registerAppIcons = () => {\n  const icons = Object.assign(DEFAULT_COMPONENT_ICONS, {\n    // TODO: Register the info and errorbadge icons\n    'add-friend': (\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"16\"\n        height=\"16\"\n        viewBox=\"0 0 16 16\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        className={buttonIconStyles.button}\n      >\n        <path\n          className={buttonIconStyles.icon}\n          d=\"M6.22176 13.9567C3.55468 13.653 2 11.8026 2 10V9.5C2 8.67157 2.67157 8 3.5 8H5.59971C5.43777 8.31679 5.30564 8.65136 5.20703 9H3.5C3.22386 9 3 9.22386 3 9.5V10C3 11.1281 3.88187 12.333 5.50235 12.7996C5.69426 13.216 5.93668 13.6043 6.22176 13.9567ZM9.62596 5.06907C9.70657 4.81036 9.75 4.53525 9.75 4.25C9.75 2.73122 8.51878 1.5 7 1.5C5.48122 1.5 4.25 2.73122 4.25 4.25C4.25 5.53662 5.13357 6.61687 6.32704 6.91706C6.64202 6.55055 7.00446 6.226 7.40482 5.95294C7.27488 5.98371 7.13934 6 7 6C6.0335 6 5.25 5.2165 5.25 4.25C5.25 3.2835 6.0335 2.5 7 2.5C7.9665 2.5 8.75 3.2835 8.75 4.25C8.75 4.73141 8.55561 5.16743 8.24104 5.48382C8.67558 5.28783 9.14016 5.14664 9.62596 5.06907ZM10.5 15C12.9853 15 15 12.9853 15 10.5C15 8.01472 12.9853 6 10.5 6C8.01472 6 6 8.01472 6 10.5C6 12.9853 8.01472 15 10.5 15ZM10.5 8C10.7761 8 11 8.22386 11 8.5V10H12.5C12.7761 10 13 10.2239 13 10.5C13 10.7761 12.7761 11 12.5 11H11V12.5C11 12.7761 10.7761 13 10.5 13C10.2239 13 10 12.7761 10 12.5V11H8.5C8.22386 11 8 10.7761 8 10.5C8 10.2239 8.22386 10 8.5 10H10V8.5C10 8.22386 10.2239 8 10.5 8Z\"\n        />\n      </svg>\n    ),\n    'left-chat': (\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"16\"\n        height=\"16\"\n        viewBox=\"0 0 16 16\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        className={buttonIconStyles.button}\n      >\n        <path\n          className={buttonIconStyles.icon}\n          d=\"M6.22176 13.9567C3.55468 13.653 2 11.8026 2 10V9.5C2 8.67157 2.67157 8 3.5 8H5.59971C5.43777 8.31679 5.30564 8.65136 5.20703 9H3.5C3.22386 9 3 9.22386 3 9.5V10C3 11.1281 3.88187 12.333 5.50235 12.7996C5.69426 13.216 5.93668 13.6043 6.22176 13.9567ZM9.62596 5.06907C9.70657 4.81036 9.75 4.53525 9.75 4.25C9.75 2.73122 8.51878 1.5 7 1.5C5.48122 1.5 4.25 2.73122 4.25 4.25C4.25 5.53662 5.13357 6.61687 6.32704 6.91706C6.64202 6.55055 7.00446 6.226 7.40482 5.95294C7.27488 5.98371 7.13934 6 7 6C6.0335 6 5.25 5.2165 5.25 4.25C5.25 3.2835 6.0335 2.5 7 2.5C7.9665 2.5 8.75 3.2835 8.75 4.25C8.75 4.73141 8.55561 5.16743 8.24104 5.48382C8.67558 5.28783 9.14016 5.14664 9.62596 5.06907ZM15 10.5C15 12.9853 12.9853 15 10.5 15C8.01472 15 6 12.9853 6 10.5C6 8.01472 8.01472 6 10.5 6C12.9853 6 15 8.01472 15 10.5ZM8.14684 10.146L8.14433 10.1486C8.09744 10.196 8.06198 10.2505 8.03794 10.3086C8.01385 10.3667 8.0004 10.4303 8.00001 10.497L8 10.5L8.00001 10.503C8.0004 10.5697 8.01385 10.6333 8.03794 10.6914C8.06234 10.7504 8.09851 10.8056 8.14645 10.8536L10.1464 12.8536C10.3417 13.0488 10.6583 13.0488 10.8536 12.8536C11.0488 12.6583 11.0488 12.3417 10.8536 12.1464L9.70711 11H12.5C12.7761 11 13 10.7761 13 10.5C13 10.2239 12.7761 10 12.5 10H9.70711L10.8536 8.85355C11.0488 8.65829 11.0488 8.34171 10.8536 8.14645C10.6583 7.95118 10.3417 7.95118 10.1464 8.14645L8.14684 10.146Z\"\n        />\n      </svg>\n    ),\n    'edit-svg': (\n      <svg\n        viewBox=\"0 0 24 24\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"16\"\n        height=\"16\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        className={buttonIconStyles.button}\n      >\n        <g className={buttonIconStyles.icon}>\n          <path d=\"M20.9519 3.0481C19.5543 1.65058 17.2885 1.65064 15.8911 3.04825L3.94103 14.9997C3.5347 15.4061 3.2491 15.9172 3.116 16.4762L2.02041 21.0777C1.96009 21.3311 2.03552 21.5976 2.21968 21.7817C2.40385 21.9659 2.67037 22.0413 2.92373 21.981L7.52498 20.8855C8.08418 20.7523 8.59546 20.4666 9.00191 20.0601L20.952 8.10861C22.3493 6.71112 22.3493 4.4455 20.9519 3.0481ZM16.9518 4.10884C17.7634 3.29709 19.0795 3.29705 19.8912 4.10876C20.7028 4.9204 20.7029 6.23632 19.8913 7.04801L19 7.93946L16.0606 5.00012L16.9518 4.10884ZM15 6.06084L17.9394 9.00018L7.94119 18.9995C7.73104 19.2097 7.46668 19.3574 7.17755 19.4263L3.76191 20.2395L4.57521 16.8237C4.64402 16.5346 4.79168 16.2704 5.00175 16.0603L15 6.06084Z\" />\n        </g>\n      </svg>\n    ),\n    'leave-svg': (\n      <svg\n        viewBox=\"0 0 24 24\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        className={buttonIconStyles.button}\n      >\n        <g className={buttonIconStyles.icon}>\n          <path\n            className={buttonIconStyles.iconUnfilled}\n            d=\"M6.25 2C5.00736 2 4 3.00736 4 4.25V19.75C4 20.9926 5.00736 22 6.25 22H12.8096C12.3832 21.5557 12.0194 21.051 11.7322 20.5H6.25C5.83579 20.5 5.5 20.1642 5.5 19.75V4.25C5.5 3.83579 5.83579 3.5 6.25 3.5H17.75C18.1642 3.5 18.5 3.83579 18.5 4.25V11.0764C19.0232 11.1572 19.5258 11.3004 20 11.4982V4.25C20 3.00736 18.9926 2 17.75 2H6.25ZM17.5 23C20.5376 23 23 20.5376 23 17.5C23 14.4624 20.5376 12 17.5 12C14.4624 12 12 14.4624 12 17.5C12 20.5376 14.4624 23 17.5 23ZM21 17.5C21 17.7761 20.7761 18 20.5 18H15.7071L17.3536 19.6464C17.5488 19.8417 17.5488 20.1583 17.3536 20.3536C17.1583 20.5488 16.8417 20.5488 16.6464 20.3536L14.1464 17.8536C13.9512 17.6583 13.9512 17.3417 14.1464 17.1464L16.6464 14.6464C16.8417 14.4512 17.1583 14.4512 17.3536 14.6464C17.5488 14.8417 17.5488 15.1583 17.3536 15.3536L15.7071 17H20.5C20.7761 17 21 17.2239 21 17.5ZM8.5 13.25C9.32843 13.25 10 12.5784 10 11.75C10 10.9216 9.32843 10.25 8.5 10.25C7.67157 10.25 7 10.9216 7 11.75C7 12.5784 7.67157 13.25 8.5 13.25Z\"\n          />\n          <path\n            className={buttonIconStyles.iconFilled}\n            d=\"M6.25 2.75C5.42157 2.75 4.75 3.42157 4.75 4.25V19.75C4.75 20.5784 5.42157 21.25 6.25 21.25H12.1902C11.4405 20.1905 11 18.8967 11 17.5C11 13.9101 13.9101 11 17.5 11C18.1063 11 18.6932 11.083 19.25 11.2383V4.25C19.25 3.42157 18.5784 2.75 17.75 2.75H6.25ZM8.5 13.25C7.67157 13.25 7 12.5784 7 11.75C7 10.9216 7.67157 10.25 8.5 10.25C9.32843 10.25 10 10.9216 10 11.75C10 12.5784 9.32843 13.25 8.5 13.25ZM17.5 23C20.5376 23 23 20.5376 23 17.5C23 14.4624 20.5376 12 17.5 12C14.4624 12 12 14.4624 12 17.5C12 20.5376 14.4624 23 17.5 23ZM21 17.5C21 17.7761 20.7761 18 20.5 18H15.7071L17.3536 19.6464C17.5488 19.8417 17.5488 20.1583 17.3536 20.3536C17.1583 20.5488 16.8417 20.5488 16.6464 20.3536L14.1464 17.8536C13.9512 17.6583 13.9512 17.3417 14.1464 17.1464L16.6464 14.6464C16.8417 14.4512 17.1583 14.4512 17.3536 14.6464C17.5488 14.8417 17.5488 15.1583 17.3536 15.3536L15.7071 17H20.5C20.7761 17 21 17.2239 21 17.5Z\"\n          />\n        </g>\n      </svg>\n    ),\n    'people-add-svg': (\n      <svg\n        viewBox=\"0 0 24 24\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        className={buttonIconStyles.button}\n      >\n        <g className={buttonIconStyles.icon}>\n          <path\n            className={buttonIconStyles.iconUnfilled}\n            d=\"M5.5 7C5.5 5.61929 6.61929 4.5 8 4.5C9.38071 4.5 10.5 5.61929 10.5 7C10.5 8.38071 9.38071 9.5 8 9.5C6.61929 9.5 5.5 8.38071 5.5 7ZM8 3C5.79086 3 4 4.79086 4 7C4 9.20914 5.79086 11 8 11C10.2091 11 12 9.20914 12 7C12 4.79086 10.2091 3 8 3ZM15.5 8C15.5 7.17157 16.1716 6.5 17 6.5C17.8284 6.5 18.5 7.17157 18.5 8C18.5 8.82843 17.8284 9.5 17 9.5C16.1716 9.5 15.5 8.82843 15.5 8ZM17 5C15.3431 5 14 6.34315 14 8C14 9.65685 15.3431 11 17 11C18.6569 11 20 9.65685 20 8C20 6.34315 18.6569 5 17 5ZM4.25 13C3.00736 13 2 14.0074 2 15.25V15.5011L2 15.5022L2.00001 15.5048L2.00007 15.5111L2.00035 15.5277C2.00064 15.5406 2.00117 15.5571 2.0021 15.5771C2.00396 15.6169 2.00745 15.6705 2.01398 15.7358C2.02701 15.8661 2.05233 16.045 2.10165 16.2564C2.19995 16.6776 2.39654 17.2404 2.79183 17.8051C3.61066 18.9749 5.17178 20 8 20C9.36897 20 10.4411 19.7598 11.2758 19.3793C11.1268 18.8851 11.035 18.366 11.0082 17.8299C10.3633 18.2108 9.41267 18.5 8 18.5C5.57822 18.5 4.51434 17.6501 4.02067 16.9449C3.75971 16.5721 3.62818 16.1974 3.56241 15.9155C3.5297 15.7753 3.514 15.6612 3.50653 15.5865C3.50281 15.5493 3.50117 15.5222 3.50047 15.5072L3.5 15.4947V15.25C3.5 14.8358 3.83579 14.5 4.25 14.5H11.7322C11.9807 14.0233 12.2865 13.5813 12.6405 13.1831C12.3674 13.0653 12.0663 13 11.75 13H4.25ZM23 17.5C23 14.4624 20.5376 12 17.5 12C14.4624 12 12 14.4624 12 17.5C12 20.5376 14.4624 23 17.5 23C20.5376 23 23 20.5376 23 17.5ZM18.0006 18L18.0011 20.5035C18.0011 20.7797 17.7773 21.0035 17.5011 21.0035C17.225 21.0035 17.0011 20.7797 17.0011 20.5035L17.0006 18H14.4956C14.2197 18 13.9961 17.7762 13.9961 17.5C13.9961 17.2239 14.2197 17 14.4956 17H17.0005L17 14.4993C17 14.2231 17.2239 13.9993 17.5 13.9993C17.7761 13.9993 18 14.2231 18 14.4993L18.0005 17H20.4966C20.7725 17 20.9961 17.2239 20.9961 17.5C20.9961 17.7762 20.7725 18 20.4966 18H18.0006Z\"\n          />\n          <path\n            className={buttonIconStyles.iconFilled}\n            d=\"M8 11C10.2091 11 12 9.20914 12 7C12 4.79086 10.2091 3 8 3C5.79086 3 4 4.79086 4 7C4 9.20914 5.79086 11 8 11ZM17 11C18.6569 11 20 9.65685 20 8C20 6.34315 18.6569 5 17 5C15.3431 5 14 6.34315 14 8C14 9.65685 15.3431 11 17 11ZM4.25 13C3.00736 13 2 14.0074 2 15.25V15.5C2 15.5 2 20 8 20C9.38985 20 10.4578 19.7585 11.2783 19.3875C11.0973 18.7901 11 18.1564 11 17.5C11 15.8431 11.6199 14.3311 12.6405 13.1831C12.3674 13.0653 12.0663 13 11.75 13H4.25ZM23 17.5C23 14.4624 20.5376 12 17.5 12C14.4624 12 12 14.4624 12 17.5C12 20.5376 14.4624 23 17.5 23C20.5376 23 23 20.5376 23 17.5ZM18.0006 18L18.0011 20.5035C18.0011 20.7797 17.7773 21.0035 17.5011 21.0035C17.225 21.0035 17.0011 20.7797 17.0011 20.5035L17.0006 18H14.4956C14.2197 18 13.9961 17.7762 13.9961 17.5C13.9961 17.2239 14.2197 17 14.4956 17H17.0005L17 14.4993C17 14.2231 17.2239 13.9993 17.5 13.9993C17.7761 13.9993 18 14.2231 18 14.4993L18.0005 17H20.4966C20.7725 17 20.9961 17.2239 20.9961 17.5C20.9961 17.7762 20.7725 18 20.4966 18H18.0006Z\"\n          />\n        </g>\n      </svg>\n    )\n  });\n  registerIcons({ icons });\n};\n\nexport { registerAppIcons };\n","import { FluentThemeProvider, MessageThread, SendBox, MessageThreadStyles } from '@azure/communication-react';\nimport { FluentTheme } from '@fluentui/react';\nimport { FluentProvider, makeStyles, shorthands, webLightTheme } from '@fluentui/react-components';\nimport { v4 as uuid } from 'uuid';\nimport { StatefulGraphChatClient } from '../../statefulClient/StatefulGraphChatClient';\nimport { useGraphChatClient } from '../../statefulClient/useGraphChatClient';\nimport { onRenderMessage } from '../../utils/chat';\nimport { renderMGTMention } from '../../utils/mentions';\nimport { registerAppIcons } from '../styles/registerIcons';\nimport { Spinner } from '@microsoft/mgt-react';\nimport { enableMapSet } from 'immer';\nimport React, { useEffect, useState } from 'react';\nimport { ChatAvatar } from '../ChatAvatar/ChatAvatar';\nimport { ChatHeader } from '../ChatHeader/ChatHeader';\nimport { BotInfoContext } from '../Context/BotInfoContext';\nimport { Error } from '../Error/Error';\nimport { LoadingMessagesErrorIcon } from '../Error/LoadingMessageErrorIcon';\nimport { OpenTeamsLinkError } from '../Error/OpenTeams';\nimport { RequireValidChatId } from '../Error/RequireAValidChatId';\nimport { TypeANewMessage } from '../Error/TypeANewMessage';\nimport { BotInfoClient } from '../../statefulClient/BotInfoClient';\n\nregisterAppIcons();\n\ninterface IMgtChatProps {\n  chatId: string;\n}\n\nconst useStyles = makeStyles({\n  chat: {\n    display: 'flex',\n    flexDirection: 'column',\n    height: '100%',\n    ...shorthands.overflow('auto'),\n    paddingBlockEnd: '12px',\n    backgroundColor: 'var(--Neutral-Background-2-Rest, #FAFAFA)'\n  },\n  chatMessages: {\n    height: '100%',\n    ...shorthands.paddingInline('20px'),\n    ...shorthands.overflow('auto'),\n    '& img': {\n      maxWidth: '100%',\n      height: 'auto'\n    },\n\n    '& ul': {\n      ...shorthands.padding('unset')\n    },\n    '& .ui-chat__item__message': {\n      marginLeft: 'unset',\n      '& ul': {\n        ...shorthands.paddingInline('40px', '0px')\n      }\n    },\n    '& .fui-Chat': {\n      maxWidth: 'unset'\n    }\n  },\n  chatInput: {\n    ...shorthands.paddingInline('16px'),\n    ...shorthands.overflow('unset')\n  },\n  fullHeight: {\n    height: '100%'\n  },\n  spinner: {\n    justifyContent: 'center',\n    display: 'flex',\n    alignItems: 'center',\n    height: '100%'\n  },\n  unsupportedContent: {\n    color: 'red'\n  }\n});\n\n/**\n * Styling for the MessageThread and its components.\n */\nconst messageThreadStyles: MessageThreadStyles = {\n  chatContainer: {\n    '& .uiBox': {\n      zIndex: 'unset',\n      '& div[data-ui-status]': {\n        display: 'inline-flex',\n        justifyContent: 'center',\n        flexDirection: 'column'\n      }\n    }\n  },\n  chatMessageContainer: {\n    '& p>.mgtPersonMention,msftMention': {\n      display: 'inline-block',\n      ...shorthands.marginInline('0px')\n    },\n    '& .otherMention': {\n      color: 'var(--accent-base-color)',\n      ...shorthands.margin('0px')\n    }\n  },\n  myChatMessageContainer: {\n    '& p>.mgtPersonMention,msftMention': {\n      display: 'inline-block',\n      ...shorthands.marginInline('0px')\n    },\n    '& .otherMention': {\n      color: 'var(--accent-base-color)',\n      ...shorthands.margin('0px')\n    }\n  }\n};\n\n/**\n * Provides a stable sessionId for the lifetime of the browser tab.\n * @returns a string that is either read from session storage or generated and placed in session storage\n */\nconst useSessionId = (): string => {\n  const [sessionId] = useState<string>(() => uuid());\n  return sessionId;\n};\n\nexport const Chat = ({ chatId }: IMgtChatProps) => {\n  useEffect(() => {\n    enableMapSet();\n  }, []);\n  const styles = useStyles();\n  const chatClient: StatefulGraphChatClient = useGraphChatClient();\n  const [botInfoClient] = useState(() => new BotInfoClient());\n  const [chatState, setChatState] = useState(chatClient.getState());\n  const sessionId = useSessionId();\n\n  useEffect(() => {\n    chatClient.onStateChange(setChatState);\n    return () => {\n      chatClient.offStateChange(setChatState);\n    };\n  }, [chatClient]);\n\n  // when chatId or sessionId changes this effect subscribes or unsubscribes\n  // the component to/from web socket based notifications for the given chatId\n  useEffect(() => {\n    // we must have both a chatId & sessionId to subscribe.\n    if (chatId && sessionId) chatClient.subscribeToChat(chatId, sessionId);\n    else chatClient.setStatus('no chat id');\n  }, [chatId, sessionId, chatClient]);\n\n  const isLoading = [\n    'initial',\n    'creating server connections',\n    'subscribing to notifications',\n    'loading messages'\n  ].includes(chatState.status);\n\n  const disabled = !chatId || !!chatState.activeErrorMessages.length;\n  const placeholderText = disabled ? 'You cannot send a message' : 'Type a message...';\n\n  return (\n    <BotInfoContext.Provider value={botInfoClient}>\n      <FluentThemeProvider fluentTheme={FluentTheme}>\n        <FluentProvider id=\"fluentui\" theme={webLightTheme} className={styles.fullHeight}>\n          <div className={styles.chat}>\n            <ChatHeader chatState={chatState} />\n            {chatState.userId && chatId && chatState.messages.length > 0 ? (\n              <>\n                <div className={styles.chatMessages}>\n                  <MessageThread\n                    userId={chatState.userId}\n                    messages={chatState.messages}\n                    showMessageDate={true}\n                    disableEditing={chatState.disableEditing}\n                    numberOfChatMessagesToReload={chatState.numberOfChatMessagesToReload}\n                    onLoadPreviousChatMessages={chatState.onLoadPreviousChatMessages}\n                    // TODO: Messages date rendering is behind beta flag, find out how to enable it\n                    // onDisplayDateTimeString={(date: Date) => date.toISOString()}\n\n                    // current behavior for re-send is a delete call with the clientMessageId and the a new send call\n                    onDeleteMessage={chatState.onDeleteMessage}\n                    onSendMessage={chatState.onSendMessage}\n                    onUpdateMessage={chatState.onUpdateMessage}\n                    // render props\n                    onRenderAvatar={(userId?: string) => {\n                      return userId ? <ChatAvatar chatId={chatId} avatarId={userId} /> : <></>;\n                    }}\n                    styles={messageThreadStyles}\n                    mentionOptions={{\n                      displayOptions: {\n                        onRenderMention: renderMGTMention(chatState)\n                      }\n                    }}\n                    onRenderMessage={onRenderMessage}\n                  />\n                </div>\n                <div className={styles.chatInput}>\n                  <SendBox onSendMessage={chatState.onSendMessage} strings={{ placeholderText }} />\n                </div>\n              </>\n            ) : (\n              <>\n                {isLoading && (\n                  <div className={styles.spinner}>\n                    <Spinner /> <br />\n                    {chatState.status}\n                  </div>\n                )}\n                {chatState.status === 'no messages' && (\n                  <Error\n                    icon={LoadingMessagesErrorIcon}\n                    message=\"No messages were found for this chat.\"\n                    subheading={TypeANewMessage}\n                  ></Error>\n                )}\n                {chatState.status === 'no chat id' && (\n                  <Error message=\"No chat id has been provided.\" subheading={RequireValidChatId}></Error>\n                )}\n                {chatState.status === 'error' && (\n                  <Error message=\"We're sorry—we've run into an issue.\" subheading={OpenTeamsLinkError}></Error>\n                )}\n                <div className={styles.chatInput}>\n                  <SendBox disabled={disabled} onSendMessage={chatState.onSendMessage} strings={{ placeholderText }} />\n                </div>\n              </>\n            )}\n          </div>\n        </FluentProvider>\n      </FluentThemeProvider>\n    </BotInfoContext.Provider>\n  );\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { useEffect, useState } from 'react';\nimport { StatefulGraphChatClient } from './StatefulGraphChatClient';\nimport { log } from '@microsoft/mgt-element';\n\n/**\n * Custom hook to abstract the creation of a stateful graph chat client.\n * @param {string} chatId the current chatId to be rendered\n * @param {React.EffectCallback} pre an optional useEffect function to be run before other useEffects\n * @param {React.EffectCallback} post an optional useEffect function to be run after other useEffects\n * @returns {StatefulGraphChatClient} a stateful graph chat client that is subscribed to the given chatId\n */\nexport const useGraphChatClient = (): StatefulGraphChatClient => {\n  const [chatClient] = useState<StatefulGraphChatClient>(() => new StatefulGraphChatClient());\n\n  // Returns a cleanup function to call tearDown on the chatClient\n  // This allows us to clean up when the consuming component is being unmounted from the DOM\n  useEffect(() => {\n    return () => {\n      log('invoked clean up effect');\n      chatClient.tearDown();\n    };\n  }, [chatClient]);\n\n  return chatClient;\n};\n","import React from 'react';\nimport { Chat } from '@microsoft/microsoft-graph-types';\nimport { makeStyles, shorthands } from '@fluentui/react-components';\nimport { CalendarLtr24Regular, PeopleTeam24Regular, Person24Regular, bundleIcon } from '@fluentui/react-icons';\nimport { error } from '@microsoft/mgt-element';\nimport { Circle } from '../Circle/Circle';\nimport { MgtTemplateProps } from '@microsoft/mgt-react';\n\nconst useStyles = makeStyles({\n  defaultProfileImage: {\n    ...shorthands.borderRadius('50%'),\n    objectFit: 'cover',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center'\n  }\n});\n\nconst GroupIcon = bundleIcon(PeopleTeam24Regular, PeopleTeam24Regular);\nconst PersonIcon = bundleIcon(Person24Regular, Person24Regular);\nconst MeetingIcon = bundleIcon(CalendarLtr24Regular, CalendarLtr24Regular);\n\nexport const ChatListItemIcon = ({ chatType }: Chat & MgtTemplateProps): JSX.Element | null => {\n  const styles = useStyles();\n  if (!chatType) return null;\n\n  const iconColor = 'var(--colorBrandForeground2)';\n\n  switch (chatType) {\n    case 'meeting':\n      return (\n        <Circle>\n          <MeetingIcon color={iconColor} />\n        </Circle>\n      );\n    case 'oneOnOne':\n      return (\n        <div className={styles.defaultProfileImage}>\n          <Circle>\n            <PersonIcon color={iconColor} />\n          </Circle>\n        </div>\n      );\n    case 'group':\n      return (\n        <Circle>\n          <GroupIcon color={iconColor} />\n        </Circle>\n      );\n    default:\n      error(`Attempted to render an icon for chat of type: ${chatType}`);\n      return null;\n  }\n};\n","import React, { useCallback } from 'react';\nimport { makeStyles } from '@fluentui/react-components';\nimport { ChatListItemIcon } from '../ChatListItemIcon/ChatListItemIcon';\nimport { Chat, AadUserConversationMember } from '@microsoft/microsoft-graph-types';\nimport { Person } from '@microsoft/mgt-react';\nimport { MgtTemplateProps } from '@microsoft/mgt-react';\n\ninterface IDefaultProfileIconProps {\n  chat: Chat;\n  userId: string;\n}\n\nconst useStyles = makeStyles({\n  person: {\n    '--person-avatar-size': '32px',\n    '--person-alignment': 'center'\n  }\n});\n\nexport const DefaultProfileIcon = ({ chat, userId }: IDefaultProfileIconProps & MgtTemplateProps) => {\n  const styles = useStyles();\n\n  const otherAad = useCallback(() => {\n    const other = chat.members?.find(m => (m as AadUserConversationMember).userId !== userId);\n    return other as AadUserConversationMember;\n  }, [chat, userId]);\n\n  return (\n    <>\n      {chat.chatType === 'oneOnOne' && (\n        <Person\n          className={styles.person}\n          userId={otherAad()?.userId ?? undefined}\n          avatarSize=\"small\"\n          showPresence={true}\n          personCardInteraction=\"hover\"\n        >\n          <ChatListItemIcon chatType=\"oneOnOne\" template=\"no-data\" />\n        </Person>\n      )}\n      {chat.chatType === 'group' && <ChatListItemIcon chatType=\"group\" />}\n      {chat.chatType === 'meeting' && <ChatListItemIcon chatType=\"meeting\" />}\n    </>\n  );\n};\n","import React, { useState, useEffect, useRef } from 'react';\nimport { makeStyles, mergeClasses, shorthands } from '@fluentui/react-components';\nimport {\n  Chat,\n  ConversationMember,\n  AadUserConversationMember,\n  NullableOption,\n  TeamworkApplicationIdentity,\n  TeamsAppInstallation\n} from '@microsoft/microsoft-graph-types';\nimport { Providers, error } from '@microsoft/mgt-element';\nimport { rewriteEmojiContentToText } from '../../utils/rewriteEmojiContent';\nimport { convert } from 'html-to-text';\nimport { loadBotsInChat } from '../../statefulClient/graph.chat';\nimport { DefaultProfileIcon } from './DefaultProfileIcon';\nimport { GraphChatThread } from '../../statefulClient/StatefulGraphChatListClient';\n\ninterface IChatListItemProps {\n  chat: GraphChatThread;\n  userId: string | undefined;\n  isSelected: boolean;\n  isRead: boolean;\n}\n\ninterface EventMessageDetailWithType {\n  '@odata.type': string;\n}\n\nconst useStyles = makeStyles({\n  // highlight selection\n  isSelected: {\n    backgroundColor: '#e6f7ff'\n  },\n\n  isUnSelected: {\n    backgroundColor: '#ffffff'\n  },\n\n  // highlight text\n  isBold: {\n    fontWeight: 'bold'\n  },\n\n  isNormal: {\n    fontWeight: 'normal'\n  },\n\n  chatListItem: {\n    display: 'flex',\n    alignItems: 'center',\n    width: '100%',\n    paddingRight: '10px',\n    paddingLeft: '10px'\n  },\n\n  profileImage: {\n    ...shorthands.flex(0, 0, 'auto'),\n    marginRight: '10px',\n    objectFit: 'cover',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center'\n  },\n\n  defaultProfileImage: {\n    ...shorthands.borderRadius('50%'),\n    objectFit: 'cover',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center'\n  },\n\n  chatInfo: {\n    flexGrow: 1,\n    flexShrink: 1,\n    minWidth: 0,\n    ...shorthands.padding('5px')\n  },\n\n  chatTitle: {\n    textAlign: 'left',\n    ...shorthands.margin('0'),\n    fontSize: '1em',\n    color: '#333',\n    textOverflow: 'ellipsis',\n    ...shorthands.overflow('hidden'),\n    whiteSpace: 'nowrap',\n    width: 'auto'\n  },\n\n  chatMessage: {\n    fontSize: '0.9em',\n    color: '#666',\n    textAlign: 'left',\n    ...shorthands.margin('0'),\n    textOverflow: 'ellipsis',\n    ...shorthands.overflow('hidden'),\n    whiteSpace: 'nowrap',\n    width: 'auto',\n    minHeight: '20px' // ensures formatting is consistent with empty previewMessage\n  },\n\n  chatTimestamp: {\n    flexShrink: 0,\n    textAlign: 'right',\n    alignSelf: 'start',\n    marginLeft: 'auto',\n    paddingLeft: '10px',\n    fontSize: '0.8em',\n    color: '#999',\n    whiteSpace: 'nowrap'\n  },\n\n  person: {\n    '--person-avatar-size': '32px',\n    '--person-alignment': 'center'\n  }\n});\n\nconst IGNORE_BOTS_WITH_NAME = ['Updates'];\n\n// regex to match different tags\nconst imageTagRegex = /(<img[^>]+)/;\nconst attachmentTagRegex = /(<attachment[^>]+)/;\nconst systemEventTagRegex = /(<systemEventMessage[^>]+)/;\n\nexport const ChatListItem = ({ chat, userId: myId, isSelected, isRead }: IChatListItemProps) => {\n  const styles = useStyles();\n\n  // manage the internal state of the chat\n  const [bots, setBots] = useState<TeamsAppInstallation[]>();\n  const isBotsLoadingOrLoaded = useRef(false);\n\n  // if chat changes, the bots need to change too\n  useEffect(() => {\n    setBots(undefined);\n    isBotsLoadingOrLoaded.current = false;\n  }, [chat?.id]);\n\n  const startLoadingBotsInChat = async (chatId: string) => {\n    // ensure this is only called once\n    if (isBotsLoadingOrLoaded.current) {\n      return;\n    }\n\n    const provider = Providers.globalProvider;\n\n    // set to loading\n    isBotsLoadingOrLoaded.current = true;\n\n    // load the bots\n    const graph = provider.graph.forComponent('ChatListItem');\n    try {\n      const botsResponse = await loadBotsInChat(graph, chatId);\n      setBots(botsResponse.value);\n    } catch (e) {\n      error(e);\n      setBots([]);\n    }\n  };\n\n  // shortcut if no valid user\n  if (!myId) {\n    return <></>;\n  }\n\n  const getMemberName = (member: ConversationMember): string => {\n    return member?.displayName || (member as AadUserConversationMember)?.email || member?.id || 'Unknown';\n  };\n\n  const getTitleFromNames = (names: string[], useFirstNamesIfAppropriate: boolean) => {\n    names = names.sort();\n    if (names.length === 1) {\n      return names[0];\n    }\n\n    if (names.length === 2 && useFirstNamesIfAppropriate) {\n      const firstNames = names.map(n => n.split(' ')[0]);\n      return firstNames.join(' and ');\n    }\n\n    if (names.length === 2) {\n      return names.join(' and ');\n    }\n\n    if (names.length === 3 && useFirstNamesIfAppropriate) {\n      const firstNames = names.map(n => n.split(' ')[0]);\n      return firstNames.join(', ');\n    }\n\n    if (names.length === 3) {\n      return names.join(', ');\n    }\n\n    if (names.length > 3 && useFirstNamesIfAppropriate) {\n      const firstNames = names.map(n => n.split(' ')[0]);\n      const firstThree = firstNames.slice(0, 3);\n      const remainingCount = names.length - 3 + 1; // +1 for the current user\n      return firstThree.join(', ') + ' +' + remainingCount;\n    }\n\n    if (names.length > 3) {\n      const firstThree = names.slice(0, 3);\n      const remainingCount = names.length - 3 + 1; // +1 for the current user\n      return firstThree.join(', ') + ' +' + remainingCount;\n    }\n  };\n\n  // Copied and modified from the sample ChatItem.tsx\n  // Determines the title in the case of 1:1 and self chats\n  // Self Chats are not possible, however, 1:1 chats with a bot will show no other members other than self.\n  const getTitleFromChat = (c: Chat) => {\n    // use the topic if available\n    if (c.topic) {\n      return c.topic;\n    }\n\n    const others = (c.members || []).filter(m => (m as AadUserConversationMember).userId !== myId);\n\n    // when there are no other people, and we have bot information to make the most informed decision\n    if (others.length === 0 && bots) {\n      const names = bots\n        .filter(\n          a =>\n            a.teamsAppDefinition?.bot?.id &&\n            a.teamsAppDefinition?.displayName &&\n            IGNORE_BOTS_WITH_NAME.indexOf(a.teamsAppDefinition?.displayName) === -1\n        )\n        .map(a => a.teamsAppDefinition!.displayName!);\n      if (names.length > 0) {\n        const unique = names.filter((n, i) => names.indexOf(n) === i);\n        return getTitleFromNames(unique, false);\n      }\n      const me = c.members?.find(m => (m as AadUserConversationMember).userId === myId);\n      return me ? getMemberName(me) : 'Me';\n    }\n\n    const application = c.lastMessagePreview?.from?.application as TeamworkApplicationIdentity;\n\n    // when there are no people, and we don't have any bot information but we do have application information\n    if (others.length === 0 && application) {\n      void startLoadingBotsInChat(c.id!);\n      return application.displayName ? application.displayName : application.id;\n    }\n\n    // when there are no people, and we don't have any bot or application information\n    if (others.length === 0) {\n      void startLoadingBotsInChat(c.id!);\n      return c.id;\n    }\n\n    // when there are people, use them\n    if (others.length > 0) {\n      const names = others.map(o => getMemberName(o));\n      return getTitleFromNames(names, true);\n    }\n\n    return c.id;\n  };\n\n  // Derives the timestamp to display\n  const extractTimestamp = (timestamp: NullableOption<string>): string => {\n    if (!timestamp) return '';\n    const currentDate = new Date();\n    const date = new Date(timestamp);\n\n    const [month, day, year] = [date.getMonth(), date.getDate(), date.getFullYear()];\n    const [currentMonth, currentDay, currentYear] = [\n      currentDate.getMonth(),\n      currentDate.getDate(),\n      currentDate.getFullYear()\n    ];\n\n    // if the message was sent today, return the time\n    if (currentDay === day && currentMonth === month && currentYear === year) {\n      return date.toLocaleTimeString(navigator.language, { hour: 'numeric', minute: '2-digit' });\n    }\n\n    // if the message was sent in a previous year, include the year\n    if (currentYear !== year) {\n      return date.toLocaleDateString(navigator.language, { month: 'numeric', day: 'numeric', year: 'numeric' });\n    }\n\n    // otherwise, return the month and day\n    return date.toLocaleDateString(navigator.language, { month: 'numeric', day: 'numeric' });\n  };\n\n  // Chooses the correct timestamp to display\n  const determineCorrectTimestamp = (c: Chat) => {\n    let timestamp: NullableOption<string>;\n\n    // lastMessageTime is the time of the last message sent in the chat\n    // lastUpdatedTime is Date and time at which the chat was renamed or list of members were last changed.\n    const lastMessageTime = c.lastMessagePreview?.createdDateTime\n      ? new Date(c.lastMessagePreview.createdDateTime)\n      : null;\n    const lastUpdatedTime = c.lastUpdatedDateTime ? new Date(c.lastUpdatedDateTime) : null;\n\n    if (lastMessageTime && lastUpdatedTime && lastMessageTime > lastUpdatedTime) {\n      timestamp = String(lastMessageTime);\n    } else if (lastMessageTime && lastUpdatedTime && lastUpdatedTime > lastMessageTime) {\n      timestamp = String(lastUpdatedTime);\n    } else if (lastMessageTime) {\n      timestamp = String(lastMessageTime);\n    } else if (lastUpdatedTime) {\n      timestamp = String(lastUpdatedTime);\n    } else {\n      timestamp = null;\n    }\n\n    return timestamp;\n  };\n\n  const getLastMessagePreviewPrefix = (c: Chat) => {\n    // if the last message was sent by the current user, display 'You: '\n    if (c.lastMessagePreview?.from?.user?.id === myId) {\n      return 'You: ';\n    }\n\n    // if you are only chatting with one other person, don't display their name\n    if (c.chatType === 'oneOnOne') {\n      return '';\n    }\n\n    // if the last message was sent from a user, use their display name\n    if (c.lastMessagePreview?.from?.user?.displayName) {\n      return `${c.lastMessagePreview.from.user.displayName}: `;\n    }\n\n    // if the last message is from a bot and we have all the app info, use the app name\n    if (c.lastMessagePreview?.from?.application?.id && bots) {\n      const bot = bots.find(a => a.teamsAppDefinition?.bot?.id === c.lastMessagePreview?.from?.application?.id);\n      if (bot?.teamsAppDefinition?.displayName) {\n        return `${bot.teamsAppDefinition.displayName}: `;\n      }\n    }\n\n    // if the last message is from a bot and we don't have all the app info, load it\n    if (c.lastMessagePreview?.from?.application?.displayName) {\n      void startLoadingBotsInChat(c.id!);\n      return `${c.lastMessagePreview.from.application.displayName}: `;\n    }\n\n    return '';\n  };\n\n  const enrichPreviewMessage = (c: Chat) => {\n    const prefix = getLastMessagePreviewPrefix(c);\n    let content = c.lastMessagePreview?.body?.content;\n\n    // handle null or undefined content\n    if (!content) {\n      if (c.lastMessagePreview?.isDeleted) {\n        return 'This message was deleted';\n      } else if (c.lastMessagePreview) {\n        return `${prefix}Sent a message`;\n      } else {\n        return '';\n      }\n    }\n\n    // handle HTML\n    if (c.lastMessagePreview?.body?.contentType === 'html') {\n      // handle images\n      const imageMatch = content.match(imageTagRegex);\n      if (imageMatch) {\n        return `${prefix}Sent an image`;\n      }\n\n      /* handle attachments\n       *\n       * NOTE: There is a discrepency between what the Graph API returns and what the Graph subscription\n       * notification sends in the case of attachments. The Graph API returns an empty content string so\n       * the preview will be 'Sent a message' whereas the Graph subscription notification returns HTML\n       * content with an attachment and will display 'Sent a file'. To make this consistent, we could\n       * change the below to 'Sent a message', however, the Teams client uses 'Sent a file'.\n       */\n      const attachmentMatch = content.match(attachmentTagRegex);\n      if (attachmentMatch) {\n        return `${prefix}Sent a file`;\n      }\n\n      /* handle system events\n       *\n       * NOTE: While Graph subscription notifications send events for both users being added and removed,\n       * the Graph API only returns a message for users being added.\n       */\n      const systemEventMessage = content.match(systemEventTagRegex);\n      if (systemEventMessage) {\n        const type = (c.lastMessagePreview?.eventDetail as EventMessageDetailWithType)?.['@odata.type'];\n        switch (type) {\n          case '#microsoft.graph.membersAddedEventMessageDetail':\n            return `${prefix}User added`;\n        }\n      }\n\n      // convert html to text\n      content = rewriteEmojiContentToText(content);\n      content = convert(content);\n    }\n\n    // handle general chats from people and bots\n    return `${prefix}${content}`;\n  };\n\n  const container = mergeClasses(\n    styles.chatListItem,\n    isSelected ? styles.isSelected : styles.isUnSelected,\n    isRead ? styles.isNormal : styles.isBold\n  );\n\n  // short cut if the id is not defined\n  if (!myId) {\n    return <></>;\n  }\n  return (\n    <div className={container}>\n      <div className={styles.profileImage}>\n        <DefaultProfileIcon chat={chat} userId={myId} />\n      </div>\n      <div className={styles.chatInfo}>\n        <p className={styles.chatTitle}>{getTitleFromChat(chat)}</p>\n        <p className={styles.chatMessage}>{enrichPreviewMessage(chat)}</p>\n      </div>\n      <div className={styles.chatTimestamp}>{extractTimestamp(determineCorrectTimestamp(chat))}</div>\n    </div>\n  );\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { BetaGraph, IGraph, Providers, createFromProvider, error, log } from '@microsoft/mgt-element';\nimport {\n  HubConnection,\n  HubConnectionBuilder,\n  HubConnectionState,\n  IHttpConnectionOptions,\n  LogLevel\n} from '@microsoft/signalr';\nimport { ThreadEventEmitter } from './ThreadEventEmitter';\nimport type {\n  Entity,\n  Subscription,\n  ChatMessage,\n  Chat,\n  AadUserConversationMember\n} from '@microsoft/microsoft-graph-types';\nimport { GraphConfig } from './GraphConfig';\nimport { SubscriptionsCache, ComponentType } from './Caching/SubscriptionCache';\nimport { Timer } from '../utils/Timer';\nimport { getOrGenerateGroupId } from './getOrGenerateGroupId';\nimport { v4 as uuid } from 'uuid';\n\nexport const appSettings = {\n  defaultSubscriptionLifetimeInMinutes: 10,\n  renewalThreshold: 75, // The number of seconds before subscription expires it will be renewed\n  renewalTimerInterval: 3, // The number of seconds between executions of the renewal timer\n  useCanary: GraphConfig.useCanary\n};\n\ntype ChangeTypes = 'created' | 'updated' | 'deleted';\n\ninterface Notification<T extends Entity> {\n  subscriptionId: string;\n  changeType: ChangeTypes;\n  resource: string;\n  resourceData: T & {\n    id: string;\n    '@odata.type': string;\n    '@odata.id': string;\n  };\n  EncryptedContent: string;\n}\n\ntype ReceivedNotification = Notification<Chat> | Notification<ChatMessage> | Notification<AadUserConversationMember>;\n\nconst isMessageNotification = (o: Notification<Entity>): o is Notification<ChatMessage> =>\n  o.resource.includes('/messages(');\nconst isMembershipNotification = (o: Notification<Entity>): o is Notification<AadUserConversationMember> =>\n  o.resource.includes('/members');\n\nexport class GraphNotificationUserClient {\n  private readonly instanceId = uuid();\n  private connection?: HubConnection = undefined;\n  private renewalTimeout?: string;\n  private renewalCount = 0;\n  private wasConnected?: boolean | undefined;\n  private userId = '';\n  private lastNotificationUrl = '';\n  private subscriptionId = '';\n\n  private readonly subscriptionCache: SubscriptionsCache = new SubscriptionsCache();\n  private readonly timer = new Timer();\n  private get graph() {\n    return this._graph;\n  }\n  private get beta() {\n    return BetaGraph.fromGraph(this._graph);\n  }\n  private get subscriptionGraph() {\n    return GraphConfig.useCanary\n      ? createFromProvider(Providers.globalProvider, GraphConfig.canarySubscriptionVersion, 'mgt-chat')\n      : this.beta;\n  }\n\n  /**\n   *\n   */\n  constructor(\n    private readonly emitter: ThreadEventEmitter,\n    private readonly _graph: IGraph\n  ) {}\n\n  /**\n   * Removes any active timers that may exist to prevent memory leaks and perf issues.\n   * Call this method when the component that depends an instance of this class is being removed from the DOM\n   * i.e\n   */\n  public tearDown() {\n    log('cleaning up graph user notification resources');\n    if (this.renewalTimeout) this.timer.clearTimeout(this.renewalTimeout);\n    this.timer.close();\n  }\n\n  private readonly getToken = async () => {\n    const token = await Providers.globalProvider.getAccessToken();\n    if (!token) throw new Error('Could not retrieve token for user');\n    return token;\n  };\n\n  private readonly receiveNotificationMessage = (message: string) => {\n    if (typeof message !== 'string') throw new Error('Expected string from receivenotificationmessageasync');\n\n    const ackMessage: unknown = { StatusCode: '200' };\n    const notification: ReceivedNotification = JSON.parse(message) as ReceivedNotification;\n    // only process notifications for the current subscription\n    if (this.subscriptionId && this.subscriptionId !== notification.subscriptionId) {\n      log('Received notification for a different subscription', notification);\n      return ackMessage;\n    }\n\n    log('received user notification message', notification);\n    const emitter: ThreadEventEmitter | undefined = this.emitter;\n    if (!notification.resourceData) throw new Error('Message did not contain resourceData');\n    if (isMessageNotification(notification)) {\n      this.processMessageNotification(notification, emitter);\n    } else if (isMembershipNotification(notification)) {\n      this.processMembershipNotification(notification, emitter);\n    } else {\n      this.processChatPropertiesNotification(notification, emitter);\n    }\n    // Need to return a status code string of 200 so that graph knows the message was received and doesn't re-send the notification\n    return GraphConfig.ackAsString ? JSON.stringify(ackMessage) : ackMessage;\n  };\n\n  private processMessageNotification(notification: Notification<ChatMessage>, emitter: ThreadEventEmitter | undefined) {\n    const message = notification.resourceData;\n\n    switch (notification.changeType) {\n      case 'created':\n        emitter?.chatMessageReceived(message);\n        return;\n      case 'updated':\n        emitter?.chatMessageEdited(message);\n        return;\n      case 'deleted':\n        emitter?.chatMessageDeleted(message);\n        return;\n      default:\n        throw new Error('Unknown change type');\n    }\n  }\n\n  private processMembershipNotification(\n    notification: Notification<AadUserConversationMember>,\n    emitter: ThreadEventEmitter | undefined\n  ) {\n    const member = notification.resourceData;\n    switch (notification.changeType) {\n      case 'created':\n        emitter?.participantAdded(member);\n        return;\n      case 'deleted':\n        emitter?.participantRemoved(member);\n        return;\n      default:\n        throw new Error('Unknown change type');\n    }\n  }\n\n  private processChatPropertiesNotification(notification: Notification<Chat>, emitter: ThreadEventEmitter | undefined) {\n    const chat = notification.resourceData;\n    switch (notification.changeType) {\n      case 'updated':\n        emitter?.chatThreadPropertiesUpdated(chat);\n        return;\n      case 'deleted':\n        emitter?.chatThreadDeleted(chat);\n        return;\n      default:\n        throw new Error('Unknown change type');\n    }\n  }\n\n  private readonly cacheSubscription = async (userId: string, subscriptionRecord: Subscription): Promise<void> => {\n    log(subscriptionRecord);\n    await this.subscriptionCache.cacheSubscription(userId, ComponentType.User, subscriptionRecord);\n  };\n\n  private async createSubscription(userId: string): Promise<Subscription> {\n    const groupId = getOrGenerateGroupId(userId);\n    log('Creating a new subscription with group Id:', groupId);\n    const resourcePath = `/users/${userId}/chats/getAllmessages`;\n    const changeTypes: ChangeTypes[] = ['created', 'updated', 'deleted'];\n\n    // build subscription request\n    const expirationDateTime = new Date(\n      new Date().getTime() + appSettings.defaultSubscriptionLifetimeInMinutes * 60 * 1000\n    ).toISOString();\n    const subscriptionDefinition: Subscription = {\n      changeType: changeTypes.join(','),\n      notificationUrl: `${GraphConfig.webSocketsPrefix}?groupId=${groupId}`,\n      resource: resourcePath,\n      expirationDateTime,\n      includeResourceData: true,\n      clientState: 'wsssecret'\n    };\n\n    log('subscribing to changes for ' + resourcePath);\n    const subscriptionEndpoint = GraphConfig.subscriptionEndpoint;\n    // send subscription POST to Graph\n    const subscription: Subscription = (await this.subscriptionGraph\n      .api(subscriptionEndpoint)\n      .post(subscriptionDefinition)) as Subscription;\n    if (!subscription?.notificationUrl) throw new Error('Subscription not created');\n    log(subscription);\n\n    this.subscriptionId = subscription.id!;\n    await this.cacheSubscription(userId, subscription);\n\n    log('Subscription created.');\n\n    return subscription;\n  }\n\n  private async deleteCachedSubscriptions(userId: string) {\n    try {\n      log('Removing all user subscriptions from cache...');\n      await this.subscriptionCache.deleteCachedSubscriptions(userId);\n      this.subscriptionId = '';\n      log('Successfully removed all user subscriptions from cache.');\n    } catch (e) {\n      error('Failed to remove all user subscriptions from cache.', e);\n    }\n  }\n\n  private trySwitchToConnected() {\n    if (this.wasConnected !== true) {\n      log('The user will receive notifications from the user subscription.');\n      this.wasConnected = true;\n      this.emitter?.connected();\n    }\n  }\n\n  private trySwitchToDisconnected(ignoreIfUndefined = false) {\n    if (ignoreIfUndefined && this.wasConnected === undefined) return;\n    if (this.wasConnected !== false) {\n      log('The user will NOT receive notifications from the user subscription.');\n      this.wasConnected = false;\n      this.emitter?.disconnected();\n    }\n  }\n\n  private readonly renewalSync = () => {\n    void this.renewal();\n  };\n\n  private readonly renewal = async () => {\n    let nextRenewalTimeInSec = appSettings.renewalTimerInterval;\n    try {\n      const currentUserId = this.userId;\n\n      // if there is a current subscription...\n      let subscription = await this.getSubscription(currentUserId);\n      if (subscription) {\n        // attempt a renewal if necessary\n        try {\n          const expirationTime = new Date(subscription.expirationDateTime!);\n          const diff = Math.round((expirationTime.getTime() - new Date().getTime()) / 1000);\n          if (diff <= 0) {\n            log(`Renewing user subscription ${subscription.id!} that has already expired...`);\n            this.trySwitchToDisconnected(true);\n            await this.renewSubscription(currentUserId, subscription);\n            log(`Successfully renewed user subscription ${subscription.id!}.`);\n          } else if (diff <= appSettings.renewalThreshold) {\n            log(`Renewing user subscription ${subscription.id!} that will expire in ${diff} seconds...`);\n            await this.renewSubscription(currentUserId, subscription);\n            log(`Successfully renewed user subscription ${subscription.id!}.`);\n          }\n        } catch (e) {\n          error(`Failed to renew user subscription ${subscription.id!}.`, e);\n          await this.deleteCachedSubscriptions(currentUserId);\n          subscription = undefined;\n        }\n      }\n\n      // if there is no subscription, try to create one\n      if (!subscription) {\n        try {\n          this.trySwitchToDisconnected(true);\n          subscription = await this.createSubscription(currentUserId);\n        } catch (e) {\n          const err = e as { statusCode?: number; message: string };\n          if (err.statusCode === 403 && err.message.indexOf('has reached its limit') > 0) {\n            // if the limit is reached, back-off (NOTE: this should probably be a 429)\n            nextRenewalTimeInSec = appSettings.renewalTimerInterval * 3;\n            throw new Error(\n              `Failed to create a new subscription due to a limitation; retrying in ${nextRenewalTimeInSec} seconds: ${err.message}.`\n            );\n          } else if (err.statusCode === 403 || err.statusCode === 402) {\n            // permanent error, stop renewal\n            error('Failed to create a new subscription due to a permanent condition; stopping renewals.', e);\n            return; // exit without setting the next renewal timer\n          } else {\n            // transient error, retry\n            throw new Error(\n              `Failed to create a new subscription due to a transient condition; retrying in ${nextRenewalTimeInSec} seconds: ${err.message}.`\n            );\n          }\n        }\n      }\n\n      // create or reconnect the SignalR connection\n      // notificationUrl comes in the form of websockets:https://graph.microsoft.com/beta/subscriptions/notificationChannel/websockets/<Id>?groupid=<UserId>&sessionid=default\n      // if <Id> changes, we need to create a new connection\n      if (this.connection?.state === HubConnectionState.Connected) {\n        await this.connection?.send('ping'); // ensure the connection is still alive\n      }\n      if (!this.connection) {\n        log(`Creating a new SignalR connection for subscription ${subscription.id!}...`);\n        this.trySwitchToDisconnected(true);\n        this.lastNotificationUrl = subscription.notificationUrl!;\n        await this.createSignalRConnection(subscription.notificationUrl!);\n        log(`Successfully created a new SignalR connection for subscription ${subscription.id!}.`);\n      } else if (this.connection.state !== HubConnectionState.Connected) {\n        log(`Reconnecting SignalR connection for subscription ${subscription.id!}...`);\n        this.trySwitchToDisconnected(true);\n        await this.connection.start();\n        log(`Successfully reconnected SignalR connection for subscription ${subscription.id!}.`);\n      } else if (this.lastNotificationUrl !== subscription.notificationUrl) {\n        log(`Updating SignalR connection for subscription ${subscription.id!} due to new notification URL...`);\n        this.trySwitchToDisconnected(true);\n        await this.closeSignalRConnection();\n        this.lastNotificationUrl = subscription.notificationUrl!;\n        await this.createSignalRConnection(subscription.notificationUrl!);\n        log(`Successfully updated SignalR connection for subscription ${subscription.id!}.`);\n      }\n\n      // emit the new connection event if necessary\n      this.trySwitchToConnected();\n    } catch (e) {\n      error('Error in user subscription connection process.', e);\n      this.trySwitchToDisconnected();\n    }\n    this.renewalTimeout = this.timer.setTimeout(\n      'renewal:' + this.instanceId,\n      this.renewalSync,\n      nextRenewalTimeInSec * 1000\n    );\n  };\n\n  private async getSubscription(userId: string): Promise<Subscription | undefined> {\n    const subscriptions = (await this.subscriptionCache.loadSubscriptions(userId))?.subscriptions || [];\n    return subscriptions.length > 0 ? subscriptions[0] : undefined;\n  }\n\n  // this is used to create a unique session id for the web socket connection\n  private getSessionId(): string {\n    return uuid();\n  }\n\n  private readonly renewSubscription = async (userId: string, subscription: Subscription): Promise<void> => {\n    this.renewalCount++;\n    log(`Renewing Graph subscription for ChatList. RenewalCount: ${this.renewalCount}.`);\n\n    const newExpirationTime = new Date(\n      new Date().getTime() + appSettings.defaultSubscriptionLifetimeInMinutes * 60 * 1000\n    );\n    // PATCH /subscriptions/{id}\n    const subscriptionId = subscription.id;\n    const expirationDateTime = newExpirationTime.toISOString();\n    const renewedSubscription = (await this.graph.api(`${GraphConfig.subscriptionEndpoint}/${subscriptionId}`).patch({\n      expirationDateTime\n    })) as Subscription;\n    return this.cacheSubscription(userId, renewedSubscription);\n  };\n\n  private async createSignalRConnection(notificationUrl: string) {\n    const connectionOptions: IHttpConnectionOptions = {\n      accessTokenFactory: this.getToken,\n      withCredentials: false\n    };\n\n    const connection = new HubConnectionBuilder()\n      .withUrl(GraphConfig.adjustNotificationUrl(notificationUrl, this.getSessionId()), connectionOptions)\n      .configureLogging(LogLevel.Information)\n      .build();\n\n    connection.on('receivenotificationmessageasync', this.receiveNotificationMessage);\n    connection.on('EchoMessage', log);\n\n    this.connection = connection;\n    await connection.start();\n  }\n\n  public async closeSignalRConnection() {\n    // stop the connection and set it to undefined so it will reconnect when next subscription is created.\n    this.trySwitchToDisconnected();\n    try {\n      await this.connection?.stop();\n    } catch (e) {\n      error('Error closing a prior SignalR connection.', e);\n    }\n    this.connection = undefined;\n  }\n\n  public subscribeToUserNotifications(userId: string) {\n    log(`User subscription with id: ${userId}`);\n    this.wasConnected = undefined;\n    this.userId = userId;\n    this.renewalTimeout = this.timer.setTimeout('renewal:' + this.instanceId, this.renewalSync, 0);\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { CacheItem, CacheSchema, CacheService, CacheStore, Providers, schemas } from '@microsoft/mgt-react';\nimport { isConversationCacheEnabled } from './isConversationCacheEnabled';\nimport { cacheEntryIsValid } from './cacheEntryIsValid';\n\n/*\n * This implementation does not store the last read time in the \"chats\" store by design. Records\n * in the \"chats\" store potentially contain hundreds of messages and can be quite large. However,\n * those records are only read or written when the chat is loaded or when the user requests more\n * historical messages. The last read time is updated on a timer that by default is configured\n * for every 30 seconds, and this would put more pressure on the IndexedDB storage than is needed.\n */\n\ninterface LastReadData extends CacheItem {\n  chatId: string;\n  lastReadTime: string; // ISO 8601 timestamp\n}\n\nexport class LastReadCache {\n  private get cache(): CacheStore<LastReadData> {\n    const conversation: CacheSchema = schemas.conversation;\n    const cache = CacheService.getCache<LastReadData>(conversation, conversation.stores.lastRead);\n    cache.getDBName = async () => {\n      const id = await Providers.getCacheId();\n      if (id) {\n        // this removal of dashes is done because when a user signs out, the code looks for contains matches\n        // from getCacheId to remove the cache/db. If the id has no dashes, it will not be removed.\n        return `mgt-lastreadcache-${id.replace(/-/g, '')}`;\n      }\n\n      // needed for build error\n      throw new Error('CacheId is not available');\n    };\n    return cache;\n  }\n\n  public async loadLastReadTime(chatId: string): Promise<LastReadData | null | undefined> {\n    if (isConversationCacheEnabled()) {\n      const data = await this.cache.getValue(chatId);\n      if (data && cacheEntryIsValid(data)) return data;\n    }\n    return undefined;\n  }\n\n  public async cacheLastReadTime(chatId: string, lastReadTime: Date | string): Promise<LastReadData> {\n    if (lastReadTime instanceof Date) {\n      lastReadTime = lastReadTime.toISOString();\n    }\n    const data = { chatId, lastReadTime };\n    await this.cache.putValue(chatId, data);\n    return data;\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { MessageThreadProps, ErrorBarProps, Message } from '@azure/communication-react';\nimport { ActiveAccountChanged, IGraph, Providers, log } from '@microsoft/mgt-element';\nimport { GraphError } from '@microsoft/microsoft-graph-client';\nimport {\n  AadUserConversationMember,\n  ChatMessage,\n  ChatRenamedEventMessageDetail,\n  ItemBody,\n  MembersAddedEventMessageDetail,\n  MembersDeletedEventMessageDetail,\n  TeamsAppInstalledEventMessageDetail,\n  TeamsAppRemovedEventMessageDetail\n} from '@microsoft/microsoft-graph-types';\nimport { produce } from 'immer';\nimport { currentUserId } from '../utils/currentUser';\nimport { graph } from '../utils/graph';\nimport { GraphConfig } from './GraphConfig';\nimport { GraphNotificationUserClient } from './GraphNotificationUserClient';\nimport { ThreadEventEmitter } from './ThreadEventEmitter';\nimport { ChatThreadCollection, loadChatThreads, loadChatThreadsByPage, loadChatWithPreview } from './graph.chat';\nimport { ChatMessageInfo, Chat as GraphChat } from '@microsoft/microsoft-graph-types';\nimport { error } from '@microsoft/mgt-element';\nimport { LastReadCache } from '../statefulClient/Caching/LastReadCache';\n\ninterface ODataType {\n  '@odata.type': MessageEventType;\n}\ntype MembersAddedEventDetail = ODataType &\n  MembersAddedEventMessageDetail & {\n    '@odata.type': '#microsoft.graph.membersAddedEventMessageDetail';\n  };\ntype MembersRemovedEventDetail = ODataType &\n  MembersDeletedEventMessageDetail & {\n    '@odata.type': '#microsoft.graph.membersDeletedEventMessageDetail';\n  };\ntype ChatRenamedEventDetail = ODataType &\n  ChatRenamedEventMessageDetail & {\n    '@odata.type': '#microsoft.graph.chatRenamedEventMessageDetail';\n  };\ntype TeamsAppInstalledEventDetail = ODataType &\n  TeamsAppInstalledEventMessageDetail & {\n    '@odata.type': '#microsoft.graph.teamsAppInstalledEventMessageDetail';\n  };\ntype TeamsAppRemovedEventDetail = ODataType &\n  TeamsAppRemovedEventMessageDetail & {\n    '@odata.type': '#microsoft.graph.teamsAppRemovedEventMessageDetail';\n  };\n\ntype ChatMessageEvents =\n  | MembersAddedEventDetail\n  | MembersRemovedEventDetail\n  | ChatRenamedEventDetail\n  | TeamsAppInstalledEventDetail\n  | TeamsAppRemovedEventDetail;\n\nexport type GraphChatThread = GraphChat & {\n  isRead: boolean;\n};\n\n// defines the type of the state object returned from the StatefulGraphChatListClient\nexport type GraphChatListClient = Pick<MessageThreadProps, 'userId'> & {\n  status:\n    | 'initial'\n    | 'creating server connections'\n    | 'server connection lost'\n    | 'server connection established'\n    | 'subscribing to notifications'\n    | 'loading chats'\n    | 'no chats'\n    | 'chats loaded'\n    | 'chat message received'\n    | 'chat details loaded'\n    | 'chats read'\n    | 'chat selected'\n    | 'chat unselected'\n    | 'fatal error';\n  chatThreads: GraphChatThread[];\n  chatMessage: ChatMessage | undefined;\n  moreChatThreadsToLoad: boolean | undefined;\n  internalSelectedChat: GraphChatThread | undefined;\n  internalPrevSelectedChat: GraphChatThread | undefined;\n  fireOnSelected: boolean; // takes care of a case when we first init ChatList and sets the selected chat Id but onselected is not fired.\n} & Pick<ErrorBarProps, 'activeErrorMessages'>;\n\ninterface StatefulClient<T> {\n  /**\n   * Get the current state of the client\n   */\n  getState(): T;\n  /**\n   * Register a callback to receive state updates\n   *\n   * @param handler Callback to receive state updates\n   */\n  onStateChange(handler: (state: T) => void): void;\n  /**\n   * Remove a callback from receiving state updates\n   *\n   * @param handler Callback to be unregistered\n   */\n  offStateChange(handler: (state: T) => void): void;\n  /**\n   * Provides the number of chat threads to display with each load more.\n   */\n  chatThreadsPerPage: number;\n  /**\n   * Method for loading more chat threads\n   */\n  tryLoadChatThreads(): void;\n  /**\n   * Method for loading more chat threads\n   */\n  tryLoadMoreChatThreads(): void;\n  /**\n   * Method for marking all chat threads as read\n   */\n  markAllChatThreadsAsRead(): void;\n  /**\n   * Method for caching last read time for all included chat threads\n   */\n  cacheLastReadTime(action: 'all' | 'selected'): void;\n  /**\n   * Method for setting the currently selected chat\n   * @param chatThread - currently selected chat\n   */\n  setSelectedChat(chatThread: GraphChatThread): void;\n  /**\n   * Method for setting the currently selected chat\n   * @param chatId - currently selected chat id\n   */\n  setSelectedChatId(chatId: string): void;\n}\n\ntype MessageEventType =\n  | '#microsoft.graph.membersAddedEventMessageDetail'\n  | '#microsoft.graph.membersDeletedEventMessageDetail'\n  | '#microsoft.graph.chatRenamedEventMessageDetail'\n  | '#microsoft.graph.teamsAppInstalledEventMessageDetail'\n  | '#microsoft.graph.teamsAppRemovedEventMessageDetail';\n\n/**\n * Extended Message type with additional properties.\n */\nexport type GraphChatMessage = Message & {\n  hasUnsupportedContent: boolean;\n  rawChatUrl: string;\n};\n\nconst GraphChatThreadLastMsgPreviewCreatedComparator = (a: GraphChatThread, b: GraphChatThread): number => {\n  if (a.lastMessagePreview?.createdDateTime && b.lastMessagePreview?.createdDateTime) {\n    const dateA = new Date(a.lastMessagePreview.createdDateTime);\n    const dateB = new Date(b.lastMessagePreview.createdDateTime);\n    if (dateA === dateB) return 0;\n    return dateB > dateA ? 1 : -1;\n  } else if (b.lastMessagePreview?.createdDateTime) {\n    return 1;\n  }\n  return -1;\n};\n\nexport interface ChatListEvent {\n  type:\n    | 'chatMessageReceived'\n    | 'chatMessageDeleted'\n    | 'chatMessageEdited'\n    | 'chatRenamed'\n    | 'memberAdded'\n    | 'memberRemoved'\n    | 'systemEvent'\n    | 'teamsAppInstalled'\n    | 'teamsAppRemoved';\n  message: ChatMessage;\n}\n\nclass StatefulGraphChatListClient implements StatefulClient<GraphChatListClient> {\n  private readonly _notificationClient: GraphNotificationUserClient;\n  private readonly _eventEmitter: ThreadEventEmitter;\n  private readonly _cache: LastReadCache;\n  private readonly _graph: IGraph;\n  private _stateSubscribers: ((state: GraphChatListClient) => void)[] = [];\n  private _initialSelectedChatId: string | undefined;\n  private _loadPromise: Promise<void> | undefined;\n  private _loadMorePromise: Promise<void> | undefined;\n\n  constructor() {\n    this.userId = currentUserId();\n    Providers.globalProvider.onActiveAccountChanged(this.onActiveAccountChanged);\n    this._eventEmitter = new ThreadEventEmitter();\n    this.registerEventListeners();\n    this._cache = new LastReadCache();\n    this._graph = graph('mgt-chat', GraphConfig.version);\n\n    this._notificationClient = new GraphNotificationUserClient(this._eventEmitter, this._graph);\n\n    this.updateUserSubscription(this.userId);\n  }\n\n  /**\n   * Provides the number of chat threads to display with each load more.\n   */\n  public chatThreadsPerPage = 20;\n\n  /**\n   * Provides a method to clean up any resources being used internally when a consuming component is being removed from the DOM\n   */\n  public tearDown() {\n    this._notificationClient.tearDown();\n  }\n\n  private sleep(ms: number) {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  }\n\n  /**\n   * Switches to a fatal error state and logs the error.\n   */\n  public raiseFatalError(e: Error) {\n    error(e);\n    this.notifyStateChange((draft: GraphChatListClient) => {\n      draft.status = 'fatal error';\n      draft.chatThreads = [];\n    });\n  }\n\n  /**\n   * Load more chat threads if applicable.\n   */\n  public async tryLoadMoreChatThreads() {\n    try {\n      // do not load if another activity is in progress\n      if (this._loadPromise || this._loadMorePromise) {\n        return;\n      }\n\n      // make sure there is something to load\n      const state = this.getState();\n      if (!state.moreChatThreadsToLoad) {\n        return;\n      }\n\n      // log\n      log('loading more chat threads...');\n\n      // set promise; load and append\n      try {\n        this._loadMorePromise = this.loadAndAppendChatThreads(\n          '',\n          [],\n          state.chatThreads.length + this.chatThreadsPerPage\n        );\n        await this._loadMorePromise;\n      } catch (e) {\n        error('Failed to load more chat threads; aborting...', e);\n      }\n    } finally {\n      this._loadMorePromise = undefined;\n    }\n\n    // log\n    log('successfully loaded more chat threads.');\n  }\n\n  /**\n   * Loads chat threads without regard for the existing threads.\n   */\n  public async tryLoadChatThreads() {\n    // set the state to loading and clear all chats\n\n    // do not load if there is another load already running\n    if (this._loadPromise) {\n      return;\n    }\n\n    // wait for any load more to finish\n    if (this._loadMorePromise) {\n      await this._loadMorePromise;\n    }\n\n    // clear and announce loading\n    this.notifyStateChange((draft: GraphChatListClient) => {\n      draft.status = 'loading chats';\n      draft.chatThreads = [];\n    });\n\n    // log\n    log('loading chat threads...');\n\n    // try several times to load more chats\n    try {\n      let loaded = false;\n      let count = 0;\n      do {\n        count++;\n        try {\n          this._loadPromise = this.loadAndAppendChatThreads('', [], this.chatThreadsPerPage);\n          await this._loadPromise;\n          loaded = true;\n        } catch (e) {\n          if (count > 3) {\n            error('Failed to load chat threads; aborting...', e);\n            throw Error('Failed to load chat threads even after 3 attempts; no more attempts will be made.');\n          }\n          error('Failed to load chat threads; retrying...', e);\n          await this.sleep(2000);\n        }\n      } while (!loaded);\n    } finally {\n      this._loadPromise = undefined;\n    }\n\n    // log\n    log('successfully loaded chat threads.');\n  }\n\n  private async handleChatThreadsResponse(\n    latestChatThreads: ChatThreadCollection,\n    items: GraphChatThread[],\n    maxItems: number\n  ) {\n    const latestItems = latestChatThreads.value as GraphChatThread[];\n    const checkedItems = await this.checkWhetherToMarkAsRead(latestItems);\n\n    const idsIncheckedItems = new Set(checkedItems.map(item => item.id));\n    items = items.filter(item => !idsIncheckedItems.has(item.id));\n    items = items.concat(checkedItems);\n    items.sort(GraphChatThreadLastMsgPreviewCreatedComparator);\n\n    const handlerNextLink = latestChatThreads['@odata.nextLink'];\n\n    if (items.length > maxItems) {\n      // return exact page size\n      this.handleChatThreads(items.slice(0, maxItems), 'more');\n      return;\n    }\n\n    if (items.length < maxItems && handlerNextLink) {\n      await this.loadAndAppendChatThreads(handlerNextLink, items, maxItems);\n      return;\n    }\n\n    this.handleChatThreads(items, handlerNextLink);\n  }\n\n  private async loadAndAppendChatThreads(nextLink: string, items: GraphChatThread[], maxItems: number) {\n    if (maxItems < 1) {\n      error('maxItem is invalid: ' + maxItems);\n      return;\n    }\n\n    const response = !nextLink\n      ? await loadChatThreads(this._graph, maxItems > 50 ? 50 : maxItems) // max page count cannot exceed 50 per documentation\n      : await loadChatThreadsByPage(this._graph, nextLink.split('?')[1]);\n    await this.handleChatThreadsResponse(response, items, maxItems);\n  }\n\n  public clearSelectedChat = () => {\n    const state = this.getState();\n\n    if (state.internalSelectedChat) {\n      this.notifyStateChange((draft: GraphChatListClient) => {\n        draft.status = 'chat unselected';\n        draft.internalPrevSelectedChat = state.internalSelectedChat;\n        draft.internalSelectedChat = undefined;\n      });\n    }\n  };\n\n  public setSelectedChatId = (chatId: string) => {\n    // the first time we are setting the selected chat, we may still be loading chat threads.\n    // so trying the code block after this will not work as there are no chat threads yet.\n    // we are setting this flag so that the `chats loaded` on ChatList can fire onselected.\n    if (!this._initialSelectedChatId) {\n      this._initialSelectedChatId = chatId;\n      return;\n    }\n\n    const state = this.getState();\n    if (!state.internalSelectedChat || state.internalSelectedChat.id !== chatId) {\n      const chatThread = state.chatThreads.find(c => c.id === chatId);\n      if (chatThread) {\n        this.setSelectedChat(chatThread);\n      }\n    }\n  };\n\n  public setSelectedChat = (chatThread: GraphChatThread): void => {\n    const state = this.getState();\n\n    if (state.internalSelectedChat) {\n      this.notifyStateChange((draft: GraphChatListClient) => {\n        draft.status = 'chat unselected';\n        draft.internalPrevSelectedChat = state.internalSelectedChat;\n        draft.internalSelectedChat = undefined;\n      });\n    }\n\n    this.notifyStateChange((draft: GraphChatListClient) => {\n      draft.status = 'chat selected';\n      draft.internalSelectedChat = {\n        ...chatThread,\n        isRead: true\n      };\n\n      draft.chatThreads = state.chatThreads.map((c: GraphChatThread) => {\n        if (c.id === chatThread.id && draft.internalSelectedChat) {\n          return draft.internalSelectedChat;\n        }\n        return c;\n      });\n\n      this.updateLastReadTime(draft.internalSelectedChat.id);\n    });\n  };\n\n  public markAllChatThreadsAsRead = () => {\n    // mark as read after chat thread is found in current state\n    this.notifyStateChange((draft: GraphChatListClient) => {\n      draft.status = 'chats read';\n      draft.chatThreads = this.getState().chatThreads.map((chatThread: GraphChatThread) => {\n        if (chatThread.id && !chatThread.isRead) {\n          return {\n            ...chatThread,\n            isRead: true\n          };\n        }\n        return chatThread;\n      });\n    });\n\n    this.cacheLastReadTime('all');\n  };\n\n  public cacheLastReadTime = (action: 'all' | 'selected') => {\n    const state = this.getState();\n    // cache last read time after all chat threads\n    if (action === 'all') {\n      state.chatThreads.forEach((chatThread: GraphChatThread) => {\n        if (chatThread.id) {\n          void this._cache.cacheLastReadTime(chatThread.id, new Date());\n        }\n      });\n    }\n\n    // cache last read time after chat thread is found in current state\n    if (action === 'selected') {\n      const selectedChatId = state.internalSelectedChat?.id;\n      this.updateLastReadTime(selectedChatId);\n    }\n  };\n\n  private updateLastReadTime(selectedChatId: string | undefined) {\n    if (selectedChatId) {\n      log(`caching the last-read timestamp of now to chat ID '${selectedChatId}'...`);\n      void this._cache.cacheLastReadTime(selectedChatId, new Date());\n    }\n  }\n\n  // check whether to mark the chat as read or not\n  private readonly checkWhetherToMarkAsRead = async (c: GraphChatThread[]): Promise<GraphChatThread[]> => {\n    const result = await Promise.all(\n      c.map(async (chatThread: GraphChatThread) => {\n        // when the last message is from you, the thread is read\n        if (this.userId === chatThread.lastMessagePreview?.from?.user?.id) {\n          return {\n            ...chatThread,\n            isRead: true\n          };\n        }\n\n        // when there is not a last read time, the thread is unread\n        const lastReadData = await this._cache.loadLastReadTime(chatThread.id!);\n        if (!lastReadData) {\n          return chatThread;\n        }\n\n        // when the last message is newer than the last read time, the thread is unread\n        const lastUpdatedDateTime = chatThread.lastUpdatedDateTime ? new Date(chatThread.lastUpdatedDateTime) : null;\n        const lastMessagePreviewCreatedDateTime = chatThread.lastMessagePreview?.createdDateTime\n          ? new Date(chatThread.lastMessagePreview?.createdDateTime)\n          : null;\n        const lastReadTime = new Date(lastReadData.lastReadTime);\n        const isRead = !(\n          (lastUpdatedDateTime && lastUpdatedDateTime > lastReadTime) ||\n          (lastMessagePreviewCreatedDateTime && lastMessagePreviewCreatedDateTime > lastReadTime) ||\n          !lastReadData.lastReadTime\n        );\n        return {\n          ...chatThread,\n          isRead\n        };\n      })\n    );\n    return result;\n  };\n\n  /**\n   * Register a callback to receive state updates\n   *\n   * @param {(state: GraphChatListClient) => void} handler\n   * @memberof StatefulGraphChatListClient\n   */\n  public onStateChange(handler: (state: GraphChatListClient) => void): void {\n    if (!this._stateSubscribers.includes(handler)) {\n      this._stateSubscribers.push(handler);\n    }\n  }\n\n  /**\n   * Unregister a callback from receiving state updates\n   *\n   * @param {(state: GraphChatListClient) => void} handler\n   * @memberof StatefulGraphChatListClient\n   */\n  public offStateChange(handler: (state: GraphChatListClient) => void): void {\n    const index = this._stateSubscribers.indexOf(handler);\n    if (index !== -1) {\n      this._stateSubscribers = this._stateSubscribers.splice(index, 1);\n    }\n  }\n\n  private readonly _initialState: GraphChatListClient = {\n    status: 'initial',\n    activeErrorMessages: [],\n    userId: '',\n    chatThreads: [],\n    moreChatThreadsToLoad: undefined,\n    chatMessage: undefined,\n    internalSelectedChat: undefined,\n    internalPrevSelectedChat: undefined,\n    fireOnSelected: false\n  };\n\n  /**\n   * State of the chat client with initial values set\n   *\n   * @private\n   * @type {GraphChatListClient}\n   * @memberof StatefulGraphChatListClient\n   */\n  private _state: GraphChatListClient = { ...this._initialState };\n\n  /**\n   * Calls each subscriber with the next state to be emitted\n   *\n   * @param recipe - a function which produces the next state to be emitted\n   */\n  private notifyStateChange(recipe: (draft: GraphChatListClient) => void) {\n    this._state = produce(this._state, recipe);\n    this._stateSubscribers.forEach(handler => handler(this._state));\n  }\n\n  /**\n   * Handle ChatListEvent event types.\n   */\n  private notifyChatMessageEventChange(event: ChatListEvent) {\n    this.notifyStateChange((draft: GraphChatListClient) => {\n      // find the chat thread\n      const chatThreadIndex = draft.chatThreads.findIndex(c => c.id === event.message.chatId);\n      const chatThread: GraphChatThread | undefined = draft.chatThreads[chatThreadIndex];\n\n      if (\n        chatThread &&\n        event.message.lastModifiedDateTime &&\n        chatThread.lastMessagePreview?.createdDateTime &&\n        event.message.lastModifiedDateTime < chatThread.lastMessagePreview.createdDateTime\n      ) {\n        log('message is older than last message preview, ignoring', event.message);\n        return;\n      }\n\n      // func to bring the chat thread to the top of the list\n      const bringToTop = (newThread?: GraphChatThread) => {\n        draft.chatThreads.splice(chatThreadIndex, 1);\n        if (newThread) {\n          draft.chatThreads.unshift(newThread);\n        } else if (chatThread) {\n          draft.chatThreads.unshift(chatThread);\n        }\n      };\n\n      // handle the events\n      if (event.type === 'chatRenamed' && event.message?.eventDetail && chatThread) {\n        // rename the chat thread in-place\n        chatThread.topic =\n          (event.message.eventDetail as ChatRenamedEventMessageDetail)?.chatDisplayName ?? chatThread.topic;\n      } else if (event.type === 'memberAdded' && chatThread) {\n        // async load the updated chat details because the notification does not include the displayName\n        // of the user that was added.\n        void this.loadChatDetails(chatThread.id!);\n        bringToTop();\n      } else if (event.type === 'memberRemoved' && event.message?.eventDetail && chatThread) {\n        // update the user list to remove the user; while we could add a \"User removed\" message\n        // the Teams client doesn't show a message and the Graph API does not show a message either\n        const membersToRemove = (event.message.eventDetail as MembersDeletedEventMessageDetail).members;\n        if (membersToRemove) {\n          const membersToRemoveSet = new Set(membersToRemove.map(member => member.id));\n          chatThread.members = chatThread.members?.filter(member => {\n            const user = member as AadUserConversationMember;\n            return !membersToRemoveSet.has(user.userId);\n          });\n        }\n      } else if (event.type === 'teamsAppInstalled' && event.message?.eventDetail && chatThread) {\n        // add a message about the app being added; Teams does \"User added\", but this provides\n        // more clarity since the user list doesn't change\n        const details = event.message.eventDetail as TeamsAppInstalledEventMessageDetail;\n        chatThread.lastMessagePreview = {\n          body: {\n            content: `${details.teamsAppDisplayName || details.teamsAppId} app added`,\n            contentType: 'text'\n          } as ItemBody,\n          lastModifiedDateTime: event.message.lastModifiedDateTime\n        } as ChatMessageInfo;\n        bringToTop();\n      } else if (event.type === 'teamsAppRemoved' && event.message?.eventDetail && chatThread) {\n        // there is no behavior in teams for an app being removed\n      } else if (event.type === 'chatMessageEdited' && chatThread) {\n        // update the last message preview in-place\n        chatThread.lastMessagePreview = event.message as ChatMessageInfo;\n        chatThread.lastUpdatedDateTime = event.message.lastModifiedDateTime;\n      } else if (event.type === 'chatMessageDeleted' && chatThread) {\n        // update the last message preview in-place\n        chatThread.lastMessagePreview = {\n          lastModifiedDateTime: event.message.lastModifiedDateTime,\n          isDeleted: true\n        } as ChatMessageInfo;\n      } else if (event.type === 'chatMessageReceived' && event.message && chatThread) {\n        draft.status = 'chat message received';\n        draft.chatMessage = event.message;\n        // update the last message preview and bring to the top\n        chatThread.lastMessagePreview = event.message as ChatMessageInfo;\n        chatThread.lastUpdatedDateTime = event.message.lastModifiedDateTime;\n        // this resets the chat thread read state for all chats including the active chat\n        if (draft.internalSelectedChat && draft.internalSelectedChat.id === draft.chatMessage.chatId) {\n          chatThread.isRead = true;\n        } else if (this.userId === event.message.from?.user?.id) {\n          chatThread.isRead = true;\n        } else {\n          chatThread.isRead = false;\n        }\n        bringToTop();\n      } else if (event.type === 'chatMessageReceived' && event.message?.chatId) {\n        draft.status = 'chat message received';\n        draft.chatMessage = event.message;\n        // create a new chat thread at the top\n        const newChatThread: GraphChatThread = {\n          id: event.message.chatId,\n          lastMessagePreview: event.message as ChatMessageInfo,\n          lastUpdatedDateTime: event.message.lastModifiedDateTime,\n          isRead: this.userId === event.message.from?.user?.id\n        };\n        draft.chatThreads.unshift(newChatThread);\n        // async load more info\n        void this.loadChatDetails(event.message.chatId);\n      } else {\n        log(`received unrecognized event type '${event.type}' from the user subscription.`);\n      }\n    });\n  }\n\n  private async loadChatDetails(chatId: string) {\n    try {\n      const loaded = await loadChatWithPreview(this._graph, chatId);\n      this.notifyStateChange((draft: GraphChatListClient) => {\n        draft.status = 'chat details loaded';\n        const chatThread = draft.chatThreads?.findIndex(c => c.id === chatId) ?? -1;\n        if (chatThread > -1) {\n          draft.chatThreads[chatThread] = Object.assign(draft.chatThreads[chatThread], loaded);\n        }\n      });\n    } catch (e) {\n      error(`Failed to load chat details for chat ID ${chatId}.`, e);\n    }\n  }\n\n  /*\n   * Returns the type of events by checking the chat message.\n   */\n  private getSystemMessageType(message: ChatMessage) {\n    // check if this is a SystemEvent\n    if (message.messageType === 'systemEventMessage') {\n      const eventDetail = message.eventDetail as ChatMessageEvents;\n      switch (eventDetail['@odata.type']) {\n        case '#microsoft.graph.membersAddedEventMessageDetail':\n          return 'memberAdded';\n        case '#microsoft.graph.membersDeletedEventMessageDetail':\n          return 'memberRemoved';\n        case '#microsoft.graph.chatRenamedEventMessageDetail':\n          return 'chatRenamed';\n        case '#microsoft.graph.teamsAppInstalledEventMessageDetail':\n          return 'teamsAppInstalled';\n        case '#microsoft.graph.teamsAppRemovedEventMessageDetail':\n          return 'teamsAppRemoved';\n        default:\n          return eventDetail['@odata.type'];\n      }\n    }\n\n    return 'chatMessageReceived';\n  }\n\n  /*\n   * Event handler to be called when a new message is received by the notification service\n   */\n  private readonly onMessageReceived = (message: ChatMessage) => {\n    if (message.chatId) {\n      this.notifyChatMessageEventChange({ message, type: this.getSystemMessageType(message) });\n    }\n  };\n\n  /*\n   * Event handler to be called when a message deletion is received by the notification service\n   */\n  private readonly onMessageDeleted = (message: ChatMessage) => {\n    if (message.chatId) {\n      this.notifyChatMessageEventChange({ message, type: 'chatMessageDeleted' });\n    }\n  };\n\n  /*\n   * Event handler to be called when a message edit is received by the notification service\n   */\n  private readonly onMessageEdited = (message: ChatMessage) => {\n    if (message.chatId) {\n      this.notifyChatMessageEventChange({ message, type: 'chatMessageEdited' });\n    }\n  };\n\n  /**\n   * Return the current state of the chat client\n   *\n   * @return {{GraphChatListClient}\n   * @memberof StatefulGraphChatListClient\n   */\n  public getState(): GraphChatListClient {\n    return this._state;\n  }\n\n  /*\n   * Event handler to be called when we need to load more chat threads.\n   */\n  private readonly handleChatThreads = (chatThreads: GraphChatThread[], nextLink: string | undefined) => {\n    this.notifyStateChange((draft: GraphChatListClient) => {\n      draft.status = chatThreads.length > 0 ? 'chats loaded' : 'no chats';\n      draft.chatThreads = chatThreads;\n      draft.moreChatThreadsToLoad = Boolean(nextLink);\n      draft.fireOnSelected = false;\n      if (this._initialSelectedChatId) {\n        // again, we expect this code to only run once, during the init of ChatList component if and only if _initialSelectedChatId is set.\n        const toFindId = this._initialSelectedChatId;\n        const chat = chatThreads.find(c => c.id === toFindId);\n        this._initialSelectedChatId = ''; // ensure we only set the selected chat once\n        if (chat) {\n          draft.internalSelectedChat = chat;\n          draft.fireOnSelected = true;\n        } else {\n          log('Chat with id ' + toFindId + ' not found in loaded chat threads.');\n        }\n      }\n    });\n  };\n\n  private readonly onActiveAccountChanged = (e: ActiveAccountChanged) => {\n    if (!e.detail) {\n      return;\n    }\n    const [newUserId] = e.detail.id.split('.');\n\n    if (newUserId && this.userId !== newUserId) {\n      void this.handleAccountChange(newUserId);\n    }\n  };\n\n  private readonly handleAccountChange = async (userId: string) => {\n    this.clearCurrentUserMessages();\n\n    // need to ensure that we close any existing connection if present\n    await this._notificationClient?.closeSignalRConnection();\n\n    // update user info\n    this.userId = userId;\n\n    // by updating the followed chat the notification client will reconnect to SignalR\n    this.updateUserSubscription(userId);\n  };\n\n  private clearCurrentUserMessages() {\n    this.notifyStateChange((draft: GraphChatListClient) => {\n      draft.status = 'initial';\n      draft.chatThreads = [];\n    });\n  }\n\n  /**\n   * Current User ID.\n   */\n  private _userId = '';\n\n  /**\n   * Returns the current User ID.\n   */\n  public get userId() {\n    return this._userId;\n  }\n\n  /**\n   * Sets the current User ID and updates the state value.\n   */\n  private set userId(userId: string) {\n    if (this._userId === userId) {\n      return;\n    }\n    this._userId = userId;\n    this.notifyStateChange((draft: GraphChatListClient) => {\n      draft.userId = userId;\n    });\n  }\n\n  /**\n   * A helper to co-ordinate the loading of a chat and its messages, and the subscription to notifications for that chat\n   *\n   * @private\n   * @memberof StatefulGraphChatListClient\n   */\n  private updateUserSubscription(userId: string) {\n    if (!userId) return;\n\n    // reset state to initial\n    this.notifyStateChange((draft: GraphChatListClient) => {\n      draft.status = 'initial';\n    });\n    // Subscribe to notifications for messages\n    this.notifyStateChange((draft: GraphChatListClient) => {\n      draft.status = 'creating server connections';\n    });\n    try {\n      this._notificationClient.subscribeToUserNotifications(userId);\n    } catch (e) {\n      error('Failed to load chat data or subscribe to notications: ', e);\n      if (e instanceof GraphError) {\n        this.notifyStateChange((draft: GraphChatListClient) => {\n          draft.status = 'no chats';\n        });\n      }\n    }\n  }\n\n  /**\n   * Register event listeners for chat events to be triggered from the notification service\n   */\n  private registerEventListeners() {\n    this._eventEmitter.on('chatMessageReceived', (message: ChatMessage) => void this.onMessageReceived(message));\n    this._eventEmitter.on('chatMessageDeleted', this.onMessageDeleted);\n    this._eventEmitter.on('chatMessageEdited', (message: ChatMessage) => void this.onMessageEdited(message));\n    this._eventEmitter.on('disconnected', () => {\n      this.notifyStateChange((draft: GraphChatListClient) => {\n        draft.status = 'server connection lost';\n        draft.chatThreads = [];\n      });\n    });\n    this._eventEmitter.on('connected', () => {\n      this.notifyStateChange((draft: GraphChatListClient) => {\n        draft.status = 'server connection established';\n      });\n    });\n  }\n}\n\nexport { StatefulGraphChatListClient };\n","import {\n  Button,\n  Menu,\n  MenuItem,\n  MenuList,\n  MenuPopover,\n  MenuProps,\n  MenuTrigger,\n  makeStyles\n} from '@fluentui/react-components';\nimport { MoreHorizontal24Filled, MoreHorizontal24Regular, bundleIcon } from '@fluentui/react-icons';\nimport React, { useCallback } from 'react';\nimport { ChatListMenuItem } from './ChatListMenuItem';\nimport { IChatListActions } from './IChatListActions';\n\nconst EllipsisIcon = bundleIcon(MoreHorizontal24Filled, MoreHorizontal24Regular);\n\nconst menuProps: Partial<MenuProps> = {\n  inline: true,\n  hasIcons: false,\n  closeOnScroll: true,\n  positioning: 'below-start'\n};\n\nconst ellipsisMenuStyles = makeStyles({\n  menuPopover: {\n    zIndex: 10,\n    '& .fui-MenuItemLink__content': {\n      fontFamily: 'Segoe UI',\n      fontSize: '12px',\n      fontStyle: 'normal',\n      fontWeight: '600'\n    }\n  }\n});\nexport interface IChatListMenuItemsProps {\n  menuItems?: ChatListMenuItem[];\n}\n\nexport const EllipsisMenu = (\n  props: IChatListMenuItemsProps & {\n    actions: IChatListActions;\n  }\n) => {\n  const styles = ellipsisMenuStyles();\n\n  const menuItems: ChatListMenuItem[] = props.menuItems === undefined ? [] : props.menuItems;\n\n  const clickMenuItem = useCallback((menuItem: ChatListMenuItem) => {\n    menuItem.onClick(props.actions);\n  }, []);\n\n  return (\n    <Menu {...menuProps}>\n      <MenuTrigger disableButtonEnhancement>\n        <Button appearance=\"transparent\" icon={<EllipsisIcon />} />\n      </MenuTrigger>\n      <MenuPopover className={styles.menuPopover}>\n        <MenuList>\n          {menuItems.map((menuItem, index) => (\n            <MenuItem key={index} content={menuItem.displayText} onClick={() => clickMenuItem(menuItem)} />\n          ))}\n        </MenuList>\n      </MenuPopover>\n    </Menu>\n  );\n};\n","import React, { useCallback } from 'react';\nimport { MgtTemplateProps } from '@microsoft/mgt-react';\nimport { makeStyles, shorthands, Button } from '@fluentui/react-components';\nimport { EllipsisMenu, IChatListMenuItemsProps } from './EllipsisMenu';\nimport { ChatListButtonItem } from './ChatListButtonItem';\nimport { Circle } from '../Circle/Circle';\nimport { IChatListActions } from './IChatListActions';\n\nconst useStyles = makeStyles({\n  headerContainer: {\n    display: 'flex',\n    width: '100%',\n    flexDirection: 'row',\n    rowGap: 0,\n    zIndex: 3,\n    paddingTop: '8px',\n    paddingLeft: '10px',\n    paddingRight: '10px',\n    paddingBlockEnd: '8px'\n  },\n  controlsContainer: {\n    display: 'flex',\n    flexDirection: 'row',\n    justifyContent: 'space-between', // This distributes the space evenly\n    alignItems: 'center'\n  },\n  buttonIcon: {\n    flexGrow: 0,\n    flexShrink: 0,\n    flexBasis: '35px',\n    ...shorthands.borderRadius('50%'), // This will make it round\n    marginRight: '10px',\n    objectFit: 'cover', // This ensures the image covers the area without stretching\n    display: 'flex',\n    alignItems: 'center', // This will vertically center the image\n    justifyContent: 'center' // This will horizontally center the image\n  },\n  button: {\n    ...shorthands.border('none'),\n    ...shorthands.padding(0), // Remove padding\n    minWidth: 0, // Allow the button to shrink to the size of its content\n    '&:hover': {\n      backgroundColor: 'transparent'\n    }\n  }\n});\n\n// this is a stub to move the logic here that should end up here.\nexport const ChatListHeader = (\n  props: MgtTemplateProps &\n    IChatListMenuItemsProps & {\n      buttonItems?: ChatListButtonItem[];\n      actions: IChatListActions;\n    }\n) => {\n  const classes = useStyles();\n\n  const buttonItems: ChatListButtonItem[] = props.buttonItems === undefined ? [] : props.buttonItems;\n  const clickButton = useCallback((buttonItem: ChatListButtonItem) => {\n    buttonItem.onClick(props.actions);\n  }, []);\n\n  return (\n    <>\n      {buttonItems.length === 0 && (props.menuItems === undefined || props.menuItems?.length === 0) ? (\n        <></>\n      ) : (\n        <div className={classes.headerContainer}>\n          <div className={classes.controlsContainer}>\n            <div>\n              {buttonItems.map((buttonItem, index) => (\n                <Button key={index} className={classes.button} onClick={() => clickButton(buttonItem)}>\n                  <div className={classes.buttonIcon}>\n                    <Circle>{buttonItem.renderIcon()}</Circle>\n                  </div>\n                </Button>\n              ))}\n            </div>\n            <div>\n              <EllipsisMenu actions={props.actions} menuItems={props.menuItems} />\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  );\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport React from 'react';\n\nexport const CreateANewChat = () => {\n  return <p>Start a new chat to communicate.</p>;\n};\n","import React, { useCallback, useEffect, useState, useRef } from 'react';\nimport { ChatListItem } from '../ChatListItem/ChatListItem';\nimport { MgtTemplateProps, Spinner, log, error } from '@microsoft/mgt-react';\nimport { makeStyles, Button, FluentProvider, shorthands, webLightTheme } from '@fluentui/react-components';\nimport { FluentThemeProvider } from '@azure/communication-react';\nimport { FluentTheme } from '@fluentui/react';\nimport { ChatMessage } from '@microsoft/microsoft-graph-types';\nimport {\n  StatefulGraphChatListClient,\n  GraphChatListClient,\n  GraphChatThread\n} from '../../statefulClient/StatefulGraphChatListClient';\nimport { ChatListHeader } from '../ChatListHeader/ChatListHeader';\nimport { IChatListMenuItemsProps } from '../ChatListHeader/EllipsisMenu';\nimport { ChatListButtonItem } from '../ChatListHeader/ChatListButtonItem';\nimport { Error } from '../Error/Error';\nimport { LoadingMessagesErrorIcon } from '../Error/LoadingMessageErrorIcon';\nimport { CreateANewChat } from '../Error/CreateANewChat';\nimport { OpenTeamsLinkError } from '../Error/OpenTeams';\nimport { IChatListActions } from '../ChatListHeader/IChatListActions';\n\nexport interface IChatListProps {\n  onSelected: (e: GraphChatThread) => void;\n  onUnselected?: (e: GraphChatThread) => void;\n  onLoaded?: (e: GraphChatThread[]) => void;\n  onAllMessagesRead: (e: string[]) => void;\n  buttonItems?: ChatListButtonItem[];\n  chatThreadsPerPage: number;\n  lastReadTimeInterval?: number;\n  selectedChatId?: string;\n  onMessageReceived?: (msg: ChatMessage) => void;\n  onConnectionChanged?: (connected: boolean) => void;\n}\n\nconst useStyles = makeStyles({\n  chatList: {\n    display: 'flex',\n    flexDirection: 'column',\n    height: '100%',\n    ...shorthands.overflow('hidden'),\n    paddingBlockEnd: '12px'\n  },\n  chatListItems: {\n    height: '100%',\n    visibility: 'visible',\n    paddingRight: '2px'\n  },\n  scrollbox: {\n    ...shorthands.overflow('auto'),\n    visibility: 'hidden',\n    '::-webkit-scrollbar': {\n      width: '8px'\n    },\n    '::-webkit-scrollbar-track': {\n      backgroundColor: 'transparent'\n    },\n    '::-webkit-scrollbar-thumb': {\n      backgroundColor: '#a0a0a0'\n    },\n    ':hover': {\n      visibility: 'visible'\n    },\n    ':focus': {\n      visibility: 'visible'\n    }\n  },\n  fullHeight: {\n    height: '100%'\n  },\n  spinner: {\n    justifyContent: 'center',\n    display: 'flex',\n    alignItems: 'center',\n    height: '100%'\n  },\n  button: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    width: '100%',\n    ...shorthands.padding('0px'),\n    ...shorthands.border('none')\n  },\n  error: {\n    display: 'flex',\n    justifyContent: 'center',\n    height: '100%'\n  },\n  bottomWhitespace: {\n    height: '80%',\n    width: '100%'\n  }\n});\n\n// this is a stub to move the logic here that should end up here.\nexport const ChatList = ({\n  lastReadTimeInterval = 30000, // default to 30 seconds\n  selectedChatId,\n  onMessageReceived,\n  onAllMessagesRead,\n  onLoaded,\n  onConnectionChanged,\n  onSelected,\n  onUnselected,\n  chatThreadsPerPage,\n  ...props\n}: MgtTemplateProps & IChatListProps & IChatListMenuItemsProps) => {\n  const styles = useStyles();\n  const [chatListClient] = useState<StatefulGraphChatListClient>(() => new StatefulGraphChatListClient());\n  const [chatListActions] = useState<IChatListActions>(() => {\n    return {\n      markAllChatThreadsAsRead: () => chatListClient.markAllChatThreadsAsRead()\n    };\n  });\n  const [initialLastReadTimeInterval, setInitialLastReadTimeInterval] = useState<number | undefined>();\n  const [chatListState, setChatListState] = useState<GraphChatListClient | undefined>();\n\n  useEffect(() => {\n    chatListClient.onStateChange(setChatListState);\n    return () => {\n      chatListClient.offStateChange(setChatListState);\n    };\n  }, [chatListClient]);\n\n  useEffect(() => {\n    if (chatThreadsPerPage < 1) {\n      error('chatThreadsPerPage must be greater than 0!');\n      return;\n    }\n\n    // todo: implement a upperbound limit for chatThreadsPerPage\n    chatListClient.chatThreadsPerPage = chatThreadsPerPage;\n  }, [chatListClient, chatThreadsPerPage]);\n\n  useEffect(() => {\n    if (!selectedChatId) {\n      chatListClient.clearSelectedChat();\n    } else {\n      chatListClient.setSelectedChatId(selectedChatId);\n    }\n  }, [chatListClient, selectedChatId]);\n\n  // Store last read time in cache so that when the user comes back to the chat list,\n  // we know what messages they are likely to have not read. This is not perfect because\n  // the user could have read messages in another client (for instance, the Teams client).\n  useEffect(() => {\n    // setup timer only after we have a defined chatListClient\n    if (initialLastReadTimeInterval) {\n      error('lastReadTimeInterval can only be set once.');\n      return;\n    }\n\n    if (lastReadTimeInterval < 1) {\n      error('lastReadTimeInterval must be greater than 0!');\n      return;\n    }\n\n    // todo: implement a upperbound limit for lastReadTimeInterval\n    setInitialLastReadTimeInterval(lastReadTimeInterval);\n\n    const timer = setInterval(() => {\n      chatListClient.cacheLastReadTime('selected');\n    }, lastReadTimeInterval);\n\n    return () => {\n      clearInterval(timer);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [chatListClient, lastReadTimeInterval]); // initialLastReadTimeInterval is used to ensure we only set interval once.\n\n  useEffect(() => {\n    if (!chatListState) {\n      return;\n    }\n\n    // handle state changes\n    if (chatListState.status === 'chat message received' && onMessageReceived && chatListState.chatMessage) {\n      onMessageReceived(chatListState.chatMessage);\n    }\n\n    if (chatListState.status === 'chat selected' && onSelected && chatListState.internalSelectedChat) {\n      onSelected(chatListState.internalSelectedChat);\n    }\n\n    if (chatListState.status === 'chat unselected' && onUnselected && chatListState.internalPrevSelectedChat) {\n      onUnselected(chatListState.internalPrevSelectedChat);\n    }\n\n    if (chatListState.status === 'chats read' && onAllMessagesRead && chatListState.chatThreads) {\n      onAllMessagesRead(chatListState.chatThreads.map(c => c.id!));\n    }\n\n    if (chatListState.status === 'chats loaded' && onLoaded) {\n      onLoaded(chatListState?.chatThreads ?? []);\n    }\n\n    if (\n      chatListState.status === 'chats loaded' &&\n      chatListState.fireOnSelected &&\n      onSelected &&\n      chatListState.internalSelectedChat\n    ) {\n      onSelected(chatListState.internalSelectedChat);\n    }\n\n    if (chatListState.status === 'no chats' && onLoaded) {\n      onLoaded([]);\n    }\n\n    if (chatListState.status === 'server connection established' && onConnectionChanged) {\n      onConnectionChanged(true);\n      void chatListClient.tryLoadChatThreads().catch(e => chatListClient.raiseFatalError(e as Error));\n    }\n\n    if (chatListState.status === 'server connection lost' && onConnectionChanged) {\n      onConnectionChanged(false);\n    }\n  }, [\n    chatListClient,\n    chatListState,\n    onLoaded,\n    onMessageReceived,\n    onSelected,\n    onUnselected,\n    onAllMessagesRead,\n    onConnectionChanged\n  ]);\n\n  // this only runs once when the component is unmounted\n  useEffect(() => {\n    // tear down\n    return () => {\n      // log state of chatlistclient for debugging purposes\n      log('ChatList unmounted.', chatListClient.getState());\n      chatListClient.tearDown();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []); // required for the teardown to only run once\n\n  const onClickChatListItem = useCallback(\n    (chat: GraphChatThread) => {\n      if (chatListClient) {\n        chatListClient.setSelectedChat(chat);\n      }\n    },\n    [chatListClient]\n  );\n\n  const chatListButtonItems = props.buttonItems === undefined ? [] : props.buttonItems;\n  const chatListMenuItems = props.menuItems === undefined ? [] : props.menuItems;\n\n  const isLoading = ['creating server connections', 'subscribing to notifications', 'loading chats'].includes(\n    chatListState?.status ?? ''\n  );\n\n  const targetElementRef = useRef(null);\n\n  useEffect(() => {\n    // define the intersection observer callback\n    const handleIntersection = (entries: IntersectionObserverEntry[]) => {\n      for (const entry of entries) {\n        // The element has come into view, you can perform your actions here\n        if (entry.isIntersecting && chatListClient) {\n          chatListClient.tryLoadMoreChatThreads().catch(e => error('Failed to load more chat threads.', e));\n        }\n      }\n    };\n\n    // create a new Intersection Observer instance\n    const observer = new IntersectionObserver(handleIntersection, {\n      root: null, // observing intersections with the viewport\n      rootMargin: '0px',\n      threshold: 0.03 // Callback is invoked when 3% of the target is visible\n    });\n\n    // start observing\n    if (targetElementRef.current) {\n      observer.observe(targetElementRef.current);\n    }\n\n    return () => observer.disconnect();\n  }, [chatListClient, chatListState]);\n\n  return (\n    <FluentThemeProvider fluentTheme={FluentTheme}>\n      <FluentProvider theme={webLightTheme} className={styles.fullHeight}>\n        <div className={styles.chatList}>\n          {chatListState?.status !== 'server connection lost' && chatListActions && (\n            <ChatListHeader actions={chatListActions} buttonItems={chatListButtonItems} menuItems={chatListMenuItems} />\n          )}\n          {chatListState && chatListState.chatThreads.length > 0 ? (\n            <>\n              <div className={styles.scrollbox}>\n                <div className={styles.chatListItems}>\n                  {chatListState?.chatThreads.map(c => (\n                    <Button className={styles.button} key={c.id} onClick={() => onClickChatListItem(c)}>\n                      <ChatListItem\n                        key={c.id}\n                        chat={c}\n                        userId={chatListState.userId}\n                        isSelected={c.id === chatListState?.internalSelectedChat?.id}\n                        isRead={c.isRead}\n                      />\n                    </Button>\n                  ))}\n                  {chatListState?.moreChatThreadsToLoad && (\n                    <div ref={targetElementRef} className={styles.bottomWhitespace}>\n                      &nbsp;\n                    </div>\n                  )}\n                </div>\n              </div>\n            </>\n          ) : (\n            <>\n              <div className={styles.error}>\n                {isLoading && (\n                  <div className={styles.spinner}>\n                    <Spinner /> <br />\n                    {chatListState?.status}\n                  </div>\n                )}\n                {chatListState?.status === 'no chats' && (\n                  <Error\n                    icon={LoadingMessagesErrorIcon}\n                    message=\"No threads were found for this user.\"\n                    subheading={CreateANewChat}\n                  ></Error>\n                )}\n                {chatListState?.status === 'server connection lost' && (\n                  <Error message=\"We ran into a problem. Reconnecting...\" subheading={OpenTeamsLinkError}></Error>\n                )}\n                {chatListState?.status === 'fatal error' && (\n                  <Error message=\"We're sorry—we've run into an issue.\" subheading={OpenTeamsLinkError}></Error>\n                )}\n              </div>\n            </>\n          )}\n        </div>\n      </FluentProvider>\n    </FluentThemeProvider>\n  );\n};\n","import React, { FC, useCallback, useState } from 'react';\nimport { IDynamicPerson } from '@microsoft/mgt-components';\nimport { Chat } from '@microsoft/microsoft-graph-types';\nimport { IGraph, PeoplePicker, Spinner, error } from '@microsoft/mgt-react';\nimport {\n  Button,\n  Field,\n  FluentProvider,\n  Input,\n  InputOnChangeData,\n  Textarea,\n  TextareaOnChangeData,\n  makeStyles,\n  typographyStyles,\n  shorthands,\n  webLightTheme\n} from '@fluentui/react-components';\nimport { Send24Regular } from '@fluentui/react-icons';\nimport { createChatThread } from '../../statefulClient/graph.chat';\nimport { graph } from '../../utils/graph';\nimport { currentUserId } from '../../utils/currentUser';\n\ninterface NewChatProps {\n  mode?: 'oneOnOne' | 'group' | 'auto';\n  enableToLabel?: boolean;\n  onChatCreated: (chat: Chat) => void;\n  onCancelClicked: () => void;\n}\n\nconst useStyles = makeStyles({\n  title: {\n    ...typographyStyles.subtitle2,\n    ...shorthands.marginInline('32px')\n  },\n  form: {\n    display: 'flex',\n    flexDirection: 'column',\n    gridRowGap: '16px',\n    minWidth: '300px',\n    '& textarea': {\n      fontSize: 'var(--type-ramp-base-font-size)',\n      '::placeholder': {\n        fontSize: 'var(--type-ramp-base-font-size)'\n      }\n    }\n  },\n  formButtons: {\n    display: 'flex',\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    gridColumnGap: '8px'\n  },\n  sendIconContainer: {\n    display: 'flex',\n    alignItems: 'center'\n  },\n  sendIcon: {\n    color: 'var(--colorBrandForeground2)',\n    cursor: 'pointer'\n  }\n});\n\nconst NewChat: FC<NewChatProps> = ({ mode = 'auto', enableToLabel, onChatCreated, onCancelClicked }: NewChatProps) => {\n  const styles = useStyles();\n  type NewChatState = 'initial';\n\n  const [isGroup, setIsGroup] = useState<boolean>(mode === 'group');\n\n  const [state, setState] = useState<NewChatState | 'creating chat' | 'done'>('initial');\n  // chat member data control\n  const [selectedPeople, setSelectedPeople] = useState<IDynamicPerson[]>([]);\n  const onSelectedPeopleChange = useCallback(\n    (event: CustomEvent<IDynamicPerson[]>) => {\n      if (event.detail) {\n        setSelectedPeople(event.detail);\n        if (mode === 'auto') {\n          setIsGroup(event.detail.length > 1);\n        }\n      }\n    },\n    [mode]\n  );\n  // chat name data control\n  const [chatName, setChatName] = useState<string>('');\n  const onChatNameChanged = useCallback((_: React.FormEvent<HTMLInputElement>, data: InputOnChangeData) => {\n    setChatName(data.value);\n  }, []);\n\n  // initial message data control\n  const [initialMessage, setInitialMessage] = useState<string>('');\n  const onInitialMessageChange = useCallback((_: React.FormEvent<HTMLTextAreaElement>, data: TextareaOnChangeData) => {\n    setInitialMessage(data.value);\n  }, []);\n  const createChat = useCallback(() => {\n    const graphClient: IGraph = graph('mgt-new-chat');\n    setState('creating chat');\n    const chatMembers = [currentUserId()];\n    selectedPeople.reduce((acc, person) => {\n      if (person.id) acc.push(person.id);\n      return acc;\n    }, chatMembers);\n    void createChatThread(graphClient, chatMembers, isGroup, initialMessage, chatName)\n      .then(chat => {\n        setState('done');\n        onChatCreated(chat);\n      })\n      .catch(e => {\n        // To be consistent with Teams, more specific behavior should be implemented\n        // to handle scenarios like no selectedPeople and empty initialMessage\n        error('Failed to create chat thread:', e);\n        setState('initial');\n      });\n  }, [onChatCreated, selectedPeople, initialMessage, chatName, isGroup]);\n\n  return (\n    <FluentProvider theme={webLightTheme}>\n      {state === 'initial' ? (\n        <div className={styles.form}>\n          <Field label={enableToLabel ? 'To' : ''}>\n            <PeoplePicker\n              disabled={(mode === 'oneOnOne' && selectedPeople?.length > 0) || selectedPeople?.length > 19}\n              ariaLabel=\"Select people to chat with\"\n              selectedPeople={selectedPeople}\n              selectionChanged={onSelectedPeopleChange}\n              userFilters={`not(id eq '${currentUserId()}')`} // Filters self; self chat is not supported\n              userType={'user'} // Needed for above filter\n            />\n          </Field>\n\n          {isGroup && (\n            <Field label=\"Group name\">\n              <Input placeholder=\"Chat name\" onChange={onChatNameChanged} value={chatName} />\n            </Field>\n          )}\n          <Textarea\n            placeholder=\"Type your first message\"\n            size=\"large\"\n            resize=\"vertical\"\n            value={initialMessage}\n            onChange={onInitialMessageChange}\n          />\n          <div className={styles.formButtons}>\n            <Button appearance=\"secondary\" onClick={onCancelClicked}>\n              Cancel\n            </Button>\n            <div className={styles.sendIconContainer}>\n              <Send24Regular className={styles.sendIcon} onClick={createChat} />\n            </div>\n          </div>\n        </div>\n      ) : (\n        <>\n          {state}\n          {state !== 'done' && <Spinner />}\n        </>\n      )}\n    </FluentProvider>\n  );\n};\n\nexport { NewChat };\n","import * as React from 'react';\nimport { memo, useCallback } from 'react';\nimport { PageHeader } from '../components/PageHeader';\nimport { shorthands, makeStyles, Dialog, DialogSurface, DialogBody, DialogTitle } from '@fluentui/react-components';\nimport { Chat as GraphChat, ChatMessage } from '@microsoft/microsoft-graph-types';\nimport { ChatList, Chat, NewChat, ChatListButtonItem, ChatListMenuItem, IChatListActions } from '@microsoft/mgt-chat';\nimport { Compose24Filled, Compose24Regular, bundleIcon } from '@fluentui/react-icons';\nimport { GraphChatThread } from '../../../../packages/mgt-chat/src/statefulClient/StatefulGraphChatListClient';\nimport { useIsSignedIn } from '../hooks/useIsSignedIn';\n\nconst ChatAddIconBundle = bundleIcon(Compose24Filled, Compose24Regular);\n\nexport const ChatAddIcon = (): JSX.Element => {\n  const iconColor = 'var(--colorBrandForeground2)';\n  return <ChatAddIconBundle color={iconColor} />;\n};\n\nconst useStyles = makeStyles({\n  container: {\n    display: 'flex',\n    flexDirection: 'row',\n    height: '79vh'\n  },\n  side: {\n    display: 'flex',\n    flexDirection: 'column',\n    flexWrap: 'nowrap',\n    width: '80%',\n    ...shorthands.overflow('auto'),\n    maxHeight: '80vh',\n    height: '100%'\n  },\n  newChat: {\n    paddingBottom: '10px',\n    marginRight: '0px',\n    marginLeft: 'auto'\n  },\n  dialog: {\n    display: 'block'\n  },\n  dialogSurface: {\n    contain: 'unset'\n  }\n});\n\ninterface ChatListWrapperProps {\n  onSelected: (e: GraphChatThread) => void;\n  onNewChat: (actions: IChatListActions) => void;\n  selectedChatId: string | undefined;\n}\n\nconst ChatListWrapper = memo(({ onSelected, onNewChat, selectedChatId }: ChatListWrapperProps) => {\n  const buttons: ChatListButtonItem[] = [\n    {\n      renderIcon: () => <ChatAddIcon />,\n      onClick: onNewChat\n    }\n  ];\n  const menus: ChatListMenuItem[] = [\n    {\n      displayText: 'Mark all as read',\n      onClick: (actions: IChatListActions) => actions.markAllChatThreadsAsRead()\n    },\n    {\n      displayText: 'My custom menu item',\n      onClick: () => console.log('My custom menu item clicked')\n    }\n  ];\n  const onAllMessagesRead = useCallback((chatIds: string[]) => {\n    console.log(`Number of chats marked as read: ${chatIds.length}`);\n  }, []);\n  const onLoaded = useCallback((chatThreads: GraphChatThread[]) => {\n    console.log(chatThreads.length, ' total chat threads loaded.');\n  }, []);\n  const onMessageReceived = useCallback((msg: ChatMessage) => {\n    console.log('SampleChatLog: Message received', msg);\n  }, []);\n  const onConnectionChanged = React.useCallback((connected: boolean) => {\n    console.log('Connection changed: ', connected);\n  }, []);\n  const onUnselected = useCallback((chatThread: GraphChatThread) => {\n    console.log('Unselected: ', chatThread.id);\n  }, []);\n\n  return (\n    <ChatList\n      selectedChatId={selectedChatId}\n      onLoaded={onLoaded}\n      chatThreadsPerPage={10}\n      menuItems={menus}\n      buttonItems={buttons}\n      onSelected={onSelected}\n      onMessageReceived={onMessageReceived}\n      onAllMessagesRead={onAllMessagesRead}\n      onConnectionChanged={onConnectionChanged}\n      onUnselected={onUnselected}\n    />\n  );\n});\n\nconst ChatPage: React.FunctionComponent = () => {\n  const styles = useStyles();\n  const [chatId, setChatId] = React.useState<string>('');\n  const [isNewChatOpen, setIsNewChatOpen] = React.useState(false);\n  const [isSignedIn] = useIsSignedIn();\n  const onChatSelected = React.useCallback(\n    (e: GraphChatThread) => {\n      if (chatId !== e.id) {\n        setChatId(e.id ?? '');\n      }\n    },\n    [chatId]\n  );\n\n  const onNewChat = React.useCallback(() => {\n    setIsNewChatOpen(true);\n  }, []);\n\n  const onChatCreated = React.useCallback(\n    (e: GraphChat) => {\n      setIsNewChatOpen(false);\n      if (chatId !== e.id) {\n        setChatId(e.id ?? '');\n      }\n    },\n    [chatId]\n  );\n\n  return (\n    <>\n      <PageHeader\n        title={'Chats'}\n        description={'Stay in touch with your teammates and navigate your chats'}\n      ></PageHeader>\n      <div className={styles.container}>\n        <div className={styles.newChat}>\n          <Dialog open={isNewChatOpen}>\n            <DialogSurface className={styles.dialogSurface}>\n              <DialogBody className={styles.dialog}>\n                <DialogTitle>New Chat</DialogTitle>\n                <NewChat onChatCreated={onChatCreated} onCancelClicked={() => setIsNewChatOpen(false)}></NewChat>\n              </DialogBody>\n            </DialogSurface>\n          </Dialog>\n        </div>\n        <div className={styles.side}>\n          {isSignedIn && <ChatListWrapper selectedChatId={chatId} onSelected={onChatSelected} onNewChat={onNewChat} />}\n        </div>\n        <div className={styles.side}>\n          <Chat chatId={chatId} />\n        </div>\n      </div>\n    </>\n  );\n};\n\nexport default ChatPage;\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\ninterface SectionsConfig {\n  /**\n   * Gets or sets whether the organization section is shown\n   *\n   */\n  organization?: {\n    /**\n     * Gets or sets whether the \"Works with\" section is shown\n     *\n     * @type {boolean}\n     */\n    showWorksWith: boolean;\n  };\n\n  /**\n   * Gets or sets whether the messages section is shown\n   *\n   * @type {boolean}\n   */\n  mailMessages: boolean;\n\n  /**\n   * Gets or sets whether the files section is shown\n   *\n   * @type {boolean}\n   */\n  files: boolean;\n\n  /**\n   * Gets or sets whether the profile section is shown\n   *\n   * @type {boolean}\n   */\n  profile: boolean;\n}\n\nexport class MgtPersonCardConfig {\n  public static sections: SectionsConfig = {\n    files: true,\n    mailMessages: true,\n    organization: { showWorksWith: true },\n    profile: true\n  };\n  public static useContactApis = true;\n  public static isSendMessageVisible = true;\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { MgtPersonCardConfig } from './MgtPersonCardConfig';\n\n/**\n * Scopes used to fetch data for the mgt-person-card component\n *\n * @static\n * @return {*}  {string[]}\n * @memberof MgtPersonCard\n */\n\nexport const getMgtPersonCardScopes = (): string[] => {\n  const scopes: string[] = [];\n\n  if (MgtPersonCardConfig.sections.files) {\n    scopes.push('Sites.Read.All');\n  }\n\n  if (MgtPersonCardConfig.sections.mailMessages) {\n    scopes.push('Mail.Read');\n    scopes.push('Mail.ReadBasic');\n  }\n\n  if (MgtPersonCardConfig.sections.organization) {\n    scopes.push('User.Read.All');\n\n    if (MgtPersonCardConfig.sections.organization.showWorksWith) {\n      scopes.push('People.Read.All');\n    }\n  }\n\n  if (MgtPersonCardConfig.sections.profile) {\n    scopes.push('User.Read.All');\n  }\n\n  if (MgtPersonCardConfig.useContactApis) {\n    scopes.push('Contacts.Read');\n  }\n\n  if (scopes.indexOf('User.Read.All') < 0) {\n    // at minimum, we need these scopes\n    scopes.push('User.ReadBasic.All');\n    scopes.push('User.Read');\n  }\n\n  if (scopes.indexOf('People.Read.All') < 0) {\n    // at minimum, we need these scopes\n    scopes.push('People.Read');\n  }\n\n  if (MgtPersonCardConfig.isSendMessageVisible) {\n    // Chat.ReadWrite can create a chat and send a message, so just request one scope instead of two\n    scopes.push('Chat.ReadWrite');\n  }\n\n  // return unique\n  return [...new Set(scopes)];\n};\n","/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/consistent-type-definitions */\nimport { registerMgtSpinnerComponent } from '@microsoft/mgt-components';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport * as MicrosoftGraph from '@microsoft/microsoft-graph-types';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport * as MicrosoftGraphBeta from '@microsoft/microsoft-graph-types-beta';\nimport {wrapMgt} from '../Mgt';\n\ntype SpinnerProps = Record<string, never>\n\nexport const Spinner = wrapMgt<SpinnerProps>('spinner', registerMgtSpinnerComponent);\n\n"],"names":["useStyles","makeStyles","divider","alignItems","paddingTop","marginBottom","PageHeader","props","styles","_jsxs","children","_jsx","title","description","Divider","className","minimalChatScopesList","chatOperationScopes","peoplePickerScopes","loadPresence","searchUsers","searchPeople","Array","from","concat","Object","values","getMgtPersonCardScopes","reduce","acc","scopes","forEach","s","add","Set","GraphConfig","_classCallCheck","_createClass","key","get","useCanary","graphEndpoint","this","canarySubscriptionVersion","baseCanaryUrl","value","url","sessionId","arguments","length","undefined","replace","sessionIdRegex","match","paramSeparator","indexOf","replaceOrAppendSessionId","webSocketsPrefix","_defineProperty","ComponentType","isConversationCacheEnabled","CacheService","config","conversation","isEnabled","SubscriptionsCache","schemas","getCache","stores","subscriptions","_loadSubscriptions","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","chatId","data","wrap","_context2","prev","next","cache","transaction","_ref","_callee","store","_context","sent","lastAccessDateTime","Date","toISOString","put","stop","_x2","apply","abrupt","_x","_cacheSubscription","_callee4","componentType","subscriptionRecord","_context4","_ref2","_callee3","cacheEntry","subIndex","_context3","log","findIndex","resource","push","_x6","_x3","_x4","_x5","delete","inactivityThreshold","queryDb","IDBKeyRange","upperBound","then","filter","d","catch","err","Timer","_this","Map","event","intervalWork","type","work","has","id","worker","SharedWorker","URL","port","onmessage","onMessage","callback","delay","timeoutWork","set","postMessage","close","getOrGenerateGroupId","localStorage","getItem","newValue","uuid","setItem","appSettings","GraphNotificationClient","emitter","_graph","token","Providers","globalProvider","getAccessToken","Error","connectionId","message","notification","JSON","parse","resourceData","includes","processMessageNotification","o","isMembershipNotification","processChatPropertiesNotification","processMembershipNotification","ackMessage","StatusCode","ackAsString","stringify","subscriptionCache","cacheSubscription","Chat","renewalTimeout","startRenewalTimer","timer","clearTimeout","setTimeout","instanceId","syncRenewalTimerWrapper","renewalTimer","_yield$_this$subscrip","_iterator","_step","subscription","expirationTime","now","loadSubscriptions","t2","t1","t3","t0","_createForOfIteratorHelper","n","done","expirationDateTime","Math","round","getTime","renewalCount","renewChatSubscriptions","t4","e","f","finish","t5","error","awaits","_iterator2","_step2","renewSubscription","Promise","all","_ref5","_callee5","subscriptionId","_this$graph","renewedSubscription","_context5","graph","api","subscriptionEndpoint","patch","reject","cleanupTimer","_callee6","offset","threshold","inactiveSubs","tasks","_iterator3","_step3","inactive","_iterator4","_step4","_inactive","_context6","getCacheId","min","loadInactiveSubscriptions","removeSubscriptions","deleteCachedSubscriptions","startCleanupTimer","BetaGraph","fromGraph","createFromProvider","beta","cleanupTimeout","changeType","chatMessageReceived","chatMessageEdited","chatMessageDeleted","member","participantAdded","participantRemoved","chat","chatThreadPropertiesUpdated","chatThreadDeleted","_subscribeToResource","_callee7","resourcePath","changeTypes","subscriptionDefinition","subscriptionGraph","_context7","join","notificationUrl","includeResourceData","clientState","post","connection","createSignalRConnection","_createSignalRConnection","_callee8","connectionOptions","_context8","accessTokenFactory","getToken","withCredentials","HubConnectionBuilder","withUrl","adjustNotificationUrl","withAutomaticReconnect","configureLogging","LogLevel","Information","build","onreconnected","onReconnect","on","receiveNotificationMessage","start","_deleteSubscription","_callee9","_this$graph2","_context9","_x7","_removeSubscriptions","_callee10","_iterator5","_step5","_context10","deleteSubscription","_x8","cleanupTimerSync","_closeSignalRConnection","_callee11","_this$connection","_context11","_subscribeToChatNotifications","_callee12","cacheData","_cacheData$subscripti","someExpired","webSocketUrl","promises","_this2","_context12","some","find","subscribeToResource","graphNotificationClientError","_x9","_x10","getCurrentUser","_Providers$globalProv","_Providers$globalProv2","state","ProviderState","SignedIn","getActiveAccount","call","currentUserId","_getCurrentUser","split","component","version","forComponent","cacheEntryIsValid","timeCached","invalidationPeriod","defaultInvalidationPeriod","MessageCache","chats","_loadMessages","getValue","_cacheMessages","messages","updateNextLink","nextLink","cachedData","maxLastModifiedDateTime","_args2","curr","lastModifiedDateTime","putValue","m","addMessageToCacheData","_cacheMessage","_cachedData$lastModif","spliceIndex","splice","_deleteMessage","ThreadEventEmitter","EventEmitter","listener","off","emit","resouce","loadChat","middlewareOptions","prepScopes","loadChatWithPreview","loadChatThread","_ref3","messageCount","_response$OdataNext","response","orderby","top","loadBotInChat","_ref4","botId","expand","loadBotIcon","installedApp","_installedApp$teamsAp","teamsApp","distributionMethod","loadStoreBotIcon","loadLobBotIcon","_x11","_x12","_ref6","_installedApp$teamsAp2","_installedApp$teamsAp3","teamsAppId","appDefinitionId","teamsAppDefinition","responseType","ResponseType","RAW","blobToBase64","blob","_x13","_x14","_ref7","_installedApp$teamsAp4","colorIcon","webUrl","fetch","_x15","loadChatThreadDelta","_ref8","lastModified","_response$OdataNext2","_x16","_x17","_x18","_x19","loadMoreChatMessages","_ref9","_response$OdataNext3","_x20","_x21","loadBotsInChat","_ref10","_x22","_x23","sendChatMessage","_ref11","content","body","_x24","_x25","_x26","updateChatMessage","_ref12","messageId","_x27","_x28","_x29","_x30","deleteChatMessage","_ref13","_callee13","_context13","_x31","_x32","_x33","removeChatMember","_ref14","_callee14","membershipId","_context14","_x34","_x35","_x36","addChatMembers","_ref15","_callee15","userIds","visibleHistoryStartDateTime","_context15","requests","map","userId","index","addRequestBody","roles","method","headers","_x37","_x38","_x39","_x40","loadChatImage","_ref16","_callee16","cachedPhoto","_cachedPhoto","eTag","_context16","photos","teams","photo","getPhotoInvalidationTime","status","ok","storePhotoInCache","_x41","_x42","createChatThread","_ref17","_callee17","memberIds","isGroupChat","chatMessage","chatName","_context17","chatType","members","topic","_x43","_x44","_x45","_x46","_x47","updateChatTopic","_ref18","_callee18","_context18","_x48","_x49","_x50","loadChatThreads","_ref19","_callee19","maxPage","_context19","_x51","_x52","loadChatThreadsByPage","_ref20","_callee20","_context20","_x53","_x54","updateMessageContentWithImage","image","imageId","regex","RegExp","replacement","isChatMessage","msg","emojiRegex","emojiMatch","messageContent","rewriteEmojiContentToText","result","processEmojiContent","botPrefix","BaseStatefulClient","g","handler","_subscribers","recipe","produce","hasUnsupportedContent","attachments","unsupportedContentTypes","isUnsupported","_attachment$contentTy","attachment","contentType","contentUnsupported","Boolean","test","every","buildAcsMessage","graphMessage","currentUser","_graphMessage$from$us","_graphMessage$from","_graphMessage$from2","_graphMessage$chatId","_graphMessage$id","_graphMessage$attachm","_graphMessage$body$co","_graphMessage$body","_graphMessage$from$us2","_graphMessage$from3","_graphMessage$from4","_graphMessage$created","application","senderId","user","chatUrl","messageData","messageType","senderDisplayName","displayName","createdOn","createdDateTime","editedOn","lastEditedDateTime","mine","attached","rawChatUrl","policyViolation","assign","link","isChatMemberChangeEvent","eventDetail","MessageCreatedComparator","a","b","ChatMessageCreatedComparator","graphImageUrlRegex","StatefulGraphChatClient","_BaseStatefulClient","_callSuper","_assertThisInitialized","detail","updateUserInfo","tryCreateGraphNotificationClient","updateFollowedChat","SignedOut","Loading","_e$detail","handleAccountChange","_this$_notificationCl","clearCurrentUserMessages","_notificationClient","closeSignalRConnection","eventType","_nextLink","notifyStateChange","draft","activeErrorMessages","_cache","cacheMessages","_chatId","writeMessagesToState","pendingId","pendingMessage","clientMessageId","_userDisplayName","draftIndex","graphChatMessageToAcsChatMessage","currentValue","uncommitted","draftMessage","setDeletedContent","updating","messageConversion","acsMessage","futureMessageState","updateMentions","cacheMessage","convertChatMessage","updateMessages","futureValue","newMessage","_newMessage$mentions","_draft$mentions","mentions","_toConsumableArray","deleteMessage","eventualState","messageConversions","currentValueMessages","futureMessages","_messagesPerCall","_m$body","_m$body2","val","sm","checkForMissedMessages","_chat","added","participants","p","removeParticipantFromState","history","membershpId","_this$_chat$members$f","_this$_chat","_objectSpread","updateErrorState","participantCount","_this$participants","disableEditing","numberOfChatMessagesToReload","onDeleteMessage","onSendMessage","sendMessage","onUpdateMessage","updateMessage","onAddChatMembers","onRemoveChatMember","onRenameChat","renameChat","_initialState","onStateChanged","onLoginStateChanged","onActiveAccountChanged","_eventEmitter","registerEventListeners","_inherits","_this$_notificationCl2","tearDown","updateCurrentUserId","updateCurrentUserName","_getCurrentUser2","name","currentUserName","_userId","_sessionId","_updateFollowedChat","loadChatData","subscribeToChatNotifications","_loadChatData","cachedMessages","deltaMessages","updatedState","loadMessages","loadDeltaData","_loadDeltaData","sort","_writeMessagesToState","_m$body3","_this2$_chat","_draft$mentions2","onLoadPreviousChatMessages","loadMoreMessages","_message$messageType","buildSystemContentMessage","toString","_buildSystemContentMessage","_eventDetail$initiato","initiatorId","_eventDetail$members","_i","_arr","people","userNames","initiatorUsername","_this3","initiator","getUserWithPhoto","getUserName","chatDisplayName","warn","systemMessageType","iconName","resolveIcon","_people$find","_graphMessage$body$co2","_graphMessage$body2","_graphMessage$id2","conversion","futureImages","messageResult","graphImageMatch","graphImageUrl","placeholderMessage","_i2","_Object$entries","_Object$entries$_i","imageIndex","futureImage","_placeholderMessage$c","entries","_slicedToArray","_graphMessage$id3","_graphMessage$body$co3","_graphMessage$body3","_content","updateMentionsContent","dom","DOMParser","parseFromString","emojis","querySelectorAll","emojisCount","size","_dom$body$firstChild","firstChild","nodeName","_dom$body$firstChild2","firstChildNodes","childNodes","hasOtherContent","_emoji$getAttribute","_emoji$getAttribute2","_emoji$getAttribute3","emoji","getAttribute","alt","span","document","createElement","setAttribute","img","appendChild","replaceWith","innerHTML","rewriteEmojiContentToHTML","processMessageContent","_this4","onMessageReceived","onMessageDeleted","onMessageEdited","onChatNotificationsSubscribed","onChatPropertiesUpdated","onParticipantAdded","onParticipantRemoved","onGraphNotificationClientError","container","backgroundColor","display","boxShadow","textDecorationLine","color","shorthands","margin","borderRadius","padding","gap","cta","fontFamily","fontSize","fontStyle","fontWeight","lineHeight","React","target","href","targetUrl","ArrowSquareUpRight24Regular","onRenderMessage","messageProps","defaultOnRender","_messageProps","unsupportedContentComponent","UnsupportedContent","renderToString","buildKey","mention","displayText","renderMGTMention","chatState","defaultRenderer","_chatState$mentions","_teamsMention$mention","render","teamsMention","flat","_m$id","mentionText","mentioned","MgtMention","_props","Person","personCardInteraction","classNames","colors","mergeStyles","width","height","buttonIconStyles","mergeStyleSets","button","icon","fill","iconFilled","iconUnfilled","BotInfoContext","createContext","useBotInfo","botInfoClient","useContext","_useState","useState","getState","_useState2","botInfo","setBotInfo","useEffect","onStateChange","offStateChange","BotAvatar","_botInfo$botInfo$get","avatarId","_ref$view","view","loadBotInfo","personDetails","personImage","botIcons","avatarSize","showPresence","ChatAvatar","memo","startsWith","useCommonHeaderStyles","row","paddingInlineStart","person","OneToOneChatHeader","_chat$members","getOtherParticipantUserId","chatBots","bot","_bot$teamsAppDefiniti","border","overflow","background","justifyContent","Circle","style","MeetingIcon","bundleIcon","Calendar16Regular","GroupIcon","PeopleTeam16Regular","PersonIcon","Person16Filled","Person16Regular","ChatIcon","iconColor","EditIcon","Edit16Filled","Edit16Regular","chatTitle","marginInlineStart","flexDirection","gridRowGap","minWidth","tokens","colorNeutralBackground1","formButtons","gridColumnGap","GroupChatHeader","isPopoverOpen","setIsPopoverOpen","handleOpenChange","useCallback","_","open","onCancelClicked","_useState3","_useState4","setChatName","onChatNameChanged","_p$displayName","email","reduceToFirstNamesList","popoverProps","trapFocus","inertTrapFocus","inline","positioning","onOpenChange","Popover","PopoverTrigger","Button","appearance","PopoverSurface","Field","label","Input","placeholder","onChange","onClick","disabled","useTitleStyles","chatHeader","columnGap","marginBlockStart","marginBlockEnd","zIndex","commonStyles","mergeClasses","PeoplePicker","wrapMgt","registerMgtPeoplePickerComponent","addMembers","paddingBlockEnd","paddingInline","buttonRow","paddingBlockStart","dialogHeading","historyInput","option","radio","AddChatMembers","closeDialog","daysOfHistory","setDaysOfHistory","handleHistoryChanged","newNumber","parseInt","historyOption","setHistoryOption","onHistoryOptionChange","_useState5","_useState6","selectedPeople","setSelectedPeople","peopleSelectionChanged","addToChat","chatHistoryOptions","text","onRenderField","selectionChanged","ChoiceGroup","options","selectedKey","RemovePerson","Dismiss20Filled","iconPlaceholder","listItem","listStyleType","iconFilledClassName","iconRegularClassName","memberList","gridGap","marginBlock","personRow","paddingBlock","cursor","fullWidth","ListChatMembers","closeParentPopover","removeDialogOpen","setRemoveDialogOpen","removeUser","setRemoveUser","openRemoveDialog","removeMember","Dialog","DialogSurface","DialogBody","DialogTitle","DialogContent","DialogActions","List","navigable","isCurrentUser","ListItem","tabIndex","AddPeople","PeopleAdd24Filled","PeopleAdd24Regular","Leave","DoorArrowLeft24Filled","DoorArrowLeft24Regular","popover","triggerButton","marginInline","ManageChatMembers","showAddMembers","setShowAddMembers","openAddMembers","closeCallout","leaveChat","me","DialogTrigger","disableButtonEnhancement","TeamsIcon","createSvgIcon","svg","xmlns","viewBox","opacity","EllipsisIcon","MoreHorizontal24Filled","MoreHorizontal24Regular","menuProps","hasIcons","closeOnScroll","ellipsisMenuStyles","menuPopover","EllipsisMenu","Menu","MenuTrigger","MenuPopover","MenuList","MenuItemLink","chatWebUrl","useHeaderStyles","rowGap","secondRow","noGrow","flexGrow","ChatHeader","_chatState$chat$webUr","_chatState$chat","_chatState$participan","_chatState$chat2","ChatTitle","vertical","inset","GenericErrorIcon","fillRule","clipRule","x1","y1","x2","y2","gradientUnits","stopColor","flexWrap","alignContent","messageContainer","textAlign","subheading","EmptySubheading","_ref$icon","IconTemplate","SubheadingTemplate","LoadingMessagesErrorIcon","OpenTeamsLink","Link","OpenTeamsLinkError","RequireValidChatId","TypeANewMessage","requestKey","BotInfoClient","_len","args","_key","requestPromise","_loop","betaGraph","infoRequestMap","app","_app$teamsAppDefiniti","_app$teamsAppDefiniti2","_draft$chatBots$get","appIcon","_app$teamsAppDefiniti3","_app$teamsAppDefiniti4","delegateYield","icons","DEFAULT_COMPONENT_ICONS","focusable","registerIcons","registerAppIcons","chatMessages","maxWidth","marginLeft","chatInput","fullHeight","spinner","unsupportedContent","messageThreadStyles","chatContainer","chatMessageContainer","myChatMessageContainer","enableMapSet","chatClient","useGraphChatClient","setChatState","useSessionId","subscribeToChat","setStatus","isLoading","placeholderText","Provider","FluentThemeProvider","fluentTheme","FluentTheme","FluentProvider","theme","webLightTheme","MessageThread","showMessageDate","onRenderAvatar","mentionOptions","displayOptions","onRenderMention","SendBox","strings","Spinner","defaultProfileImage","objectFit","PeopleTeam24Regular","Person24Regular","CalendarLtr24Regular","ChatListItemIcon","DefaultProfileIcon","_otherAad$userId","_otherAad","otherAad","template","isSelected","isUnSelected","isBold","isNormal","chatListItem","paddingRight","paddingLeft","profileImage","flex","marginRight","chatInfo","flexShrink","textOverflow","whiteSpace","minHeight","chatTimestamp","alignSelf","IGNORE_BOTS_WITH_NAME","imageTagRegex","attachmentTagRegex","systemEventTagRegex","ChatListItem","myId","isRead","bots","setBots","isBotsLoadingOrLoaded","useRef","current","startLoadingBotsInChat","provider","botsResponse","getMemberName","getTitleFromNames","names","useFirstNamesIfAppropriate","firstThree","slice","remainingCount","c","_c$lastMessagePreview","others","_c$members","_a$teamsAppDefinition","_a$teamsAppDefinition2","_a$teamsAppDefinition3","unique","i","lastMessagePreview","getTitleFromChat","_c$lastMessagePreview8","_c$lastMessagePreview10","_c$lastMessagePreview9","prefix","_c$lastMessagePreview3","_c$lastMessagePreview4","_c$lastMessagePreview5","_c$lastMessagePreview7","_a$teamsAppDefinition4","_c$lastMessagePreview6","getLastMessagePreviewPrefix","isDeleted","_c$lastMessagePreview11","convert","enrichPreviewMessage","timestamp","currentDate","date","getMonth","getDate","getFullYear","month","day","year","currentYear","toLocaleTimeString","navigator","language","hour","minute","toLocaleDateString","extractTimestamp","_c$lastMessagePreview2","lastMessageTime","lastUpdatedTime","lastUpdatedDateTime","String","determineCorrectTimestamp","GraphNotificationUserClient","User","renewal","nextRenewalTimeInSec","diff","_this$connection2","getSubscription","trySwitchToDisconnected","createSubscription","statusCode","HubConnectionState","Connected","send","lastNotificationUrl","trySwitchToConnected","renewalSync","newExpirationTime","_createSubscription","groupId","_deleteCachedSubscriptions","_this$emitter","wasConnected","connected","_this$emitter2","disconnected","_getSubscription","_yield$this$subscript","getSessionId","_this$connection3","LastReadCache","lastRead","getDBName","_loadLastReadTime","_cacheLastReadTime","lastReadTime","GraphChatThreadLastMsgPreviewCreatedComparator","_a$lastMessagePreview","_b$lastMessagePreview","_b$lastMessagePreview2","dateA","dateB","StatefulGraphChatListClient","internalSelectedChat","internalPrevSelectedChat","_initialSelectedChatId","chatThread","chatThreads","setSelectedChat","updateLastReadTime","cacheLastReadTime","action","_state$internalSelect","selectedChatId","_chatThread$lastMessa","_chatThread$lastMessa2","_chatThread$lastMessa3","lastReadData","lastMessagePreviewCreatedDateTime","loadLastReadTime","moreChatThreadsToLoad","fireOnSelected","notifyChatMessageEventChange","getSystemMessageType","toFindId","_e$detail$id$split","newUserId","updateUserSubscription","ms","resolve","_tryLoadMoreChatThreads","_loadPromise","_loadMorePromise","loadAndAppendChatThreads","chatThreadsPerPage","_tryLoadChatThreads","loaded","count","sleep","_handleChatThreadsResponse","latestChatThreads","items","maxItems","latestItems","checkedItems","idsIncheckedItems","handlerNextLink","checkWhetherToMarkAsRead","item","handleChatThreads","_loadAndAppendChatThreads","handleChatThreadsResponse","_stateSubscribers","_state","_chatThread$lastMessa4","_event$message","_event$message2","_event$message3","_event$message4","_event$message5","chatThreadIndex","_event$message$eventD","_event$message$eventD2","bringToTop","newThread","unshift","loadChatDetails","membersToRemove","_chatThread$members","membersToRemoveSet","details","teamsAppDisplayName","_event$message$from","_event$message$from2","newChatThread","_loadChatDetails","_draft$chatThreads$fi","_draft$chatThreads","subscribeToUserNotifications","GraphError","menuItems","clickMenuItem","menuItem","actions","MenuItem","headerContainer","controlsContainer","buttonIcon","flexBasis","ChatListHeader","_props$menuItems","classes","buttonItems","clickButton","buttonItem","renderIcon","CreateANewChat","chatList","chatListItems","visibility","scrollbox","bottomWhitespace","ChatList","_chatListState$status","_ref$lastReadTimeInte","lastReadTimeInterval","onAllMessagesRead","onLoaded","onConnectionChanged","onSelected","onUnselected","_objectWithoutProperties","_excluded","chatListClient","markAllChatThreadsAsRead","chatListActions","initialLastReadTimeInterval","setInitialLastReadTimeInterval","_useState7","_useState8","chatListState","setChatListState","setSelectedChatId","clearSelectedChat","setInterval","clearInterval","_chatListState$chatTh","tryLoadChatThreads","raiseFatalError","onClickChatListItem","chatListButtonItems","chatListMenuItems","targetElementRef","observer","IntersectionObserver","isIntersecting","tryLoadMoreChatThreads","root","rootMargin","observe","disconnect","_chatListState$intern","ref","typographyStyles","subtitle2","form","sendIconContainer","sendIcon","NewChat","_ref$mode","mode","enableToLabel","onChatCreated","isGroup","setIsGroup","setState","onSelectedPeopleChange","_useState9","_useState10","initialMessage","setInitialMessage","onInitialMessageChange","createChat","graphClient","chatMembers","ariaLabel","userFilters","userType","Textarea","resize","Send24Regular","ChatAddIconBundle","Compose24Filled","Compose24Regular","ChatAddIcon","side","maxHeight","newChat","paddingBottom","dialog","dialogSurface","contain","ChatListWrapper","onNewChat","buttons","menus","console","chatIds","_React$useState","_React$useState2","setChatId","_React$useState3","_React$useState4","isNewChatOpen","setIsNewChatOpen","_useIsSignedIn","useIsSignedIn","isSignedIn","onChatSelected","_e$id","_e$id2","_Fragment","MgtPersonCardConfig","sections","files","mailMessages","organization","showWorksWith","profile","useContactApis","isSendMessageVisible","registerMgtSpinnerComponent"],"sourceRoot":""}