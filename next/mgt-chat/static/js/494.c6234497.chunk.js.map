{"version":3,"file":"static/js/494.c6234497.chunk.js","mappings":"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","sources":["../../../packages/mgt-chat/src/statefulClient/chatOperationScopes.ts","../../../packages/mgt-chat/src/statefulClient/GraphConfig.ts","../../../packages/mgt-chat/src/statefulClient/Caching/SubscriptionCache.ts","../../../packages/mgt-chat/src/statefulClient/Caching/isConversationCacheEnabled.ts","../../../packages/mgt-components/dist/es6/graph/src/graph/graph.groups.ts","../../../packages/mgt-chat/src/utils/Timer.ts","../../../packages/mgt-chat/src/statefulClient/GraphNotificationClient.ts","../../../packages/mgt-chat/src/utils/currentUser.ts","../../../packages/mgt-chat/src/utils/graph.ts","../../../packages/mgt-chat/src/statefulClient/Caching/cacheEntryIsValid.ts","../../../packages/mgt-chat/src/statefulClient/Caching/MessageCache.ts","../../../packages/mgt-chat/src/statefulClient/ThreadEventEmitter.ts","../../../packages/mgt-chat/src/statefulClient/graph.chat.ts","../../../packages/mgt-chat/src/utils/updateMessageContentWithImage.ts","../../../packages/mgt-chat/src/utils/types.ts","../../../packages/mgt-chat/src/statefulClient/StatefulGraphChatClient.ts","../../../packages/mgt-chat/src/utils/rewriteEmojiContent.ts","../../../packages/mgt-chat/src/statefulClient/useGraphChatClient.ts","../../../packages/mgt-chat/src/components/UnsupportedContent/UnsupportedContent.tsx","../../../packages/mgt-chat/src/utils/chat.tsx","../../../packages/mgt-chat/src/utils/mentions.tsx","../../../packages/mgt-chat/src/components/styles/common.styles.ts","../../../packages/mgt-chat/src/components/ChatHeader/useCommonHeaderStyles.tsx","../../../packages/mgt-chat/src/components/ChatHeader/OneToOneChatHeader.tsx","../../../packages/mgt-chat/src/components/Circle/Circle.tsx","../../../packages/mgt-chat/src/components/ChatIcon/ChatIcon.tsx","../../../packages/mgt-chat/src/components/ChatHeader/GroupChatHeader.tsx","../../../packages/mgt-chat/src/components/ChatHeader/ChatTitle.tsx","../../../packages/mgt-components/dist/es6/components/mgt-people-picker/src/components/mgt-people-picker/mgt-people-picker-css.ts","../../../packages/mgt-components/dist/es6/components/mgt-people-picker/src/components/mgt-people-picker/strings.ts","../../../packages/mgt-components/dist/es6/components/mgt-people-picker/src/components/mgt-people-picker/mgt-people-picker.ts","../../../packages/mgt-react/src/generated/people-picker.ts","../../../packages/mgt-chat/src/components/ManageChatMembers/AddChatMembers.tsx","../../../packages/mgt-chat/src/components/ManageChatMembers/ListChatMembers.tsx","../../../packages/mgt-chat/src/components/ManageChatMembers/ManageChatMembers.tsx","../../../packages/mgt-chat/src/components/ChatHeader/EllipsisMenu.tsx","../../../packages/mgt-chat/src/components/ChatHeader/ChatHeader.tsx","../../../packages/mgt-chat/src/components/Error/GenericErrorIcon.tsx","../../../packages/mgt-chat/src/components/Error/Error.tsx","../../../packages/mgt-chat/src/components/Error/LoadingMessageErrorIcon.tsx","../../../packages/mgt-chat/src/components/Error/OpenTeams.tsx","../../../packages/mgt-chat/src/components/Error/RequireAValidChatId.tsx","../../../packages/mgt-chat/src/components/Error/TypeANewMessage.tsx","../../../packages/mgt-chat/src/components/styles/registerIcons.tsx","../../../packages/mgt-chat/src/components/Chat/Chat.tsx","../../../packages/mgt-chat/src/components/ChatListItemIcon/ChatListItemIcon.tsx","../../../packages/mgt-chat/src/components/ChatListItem/DefaultProfileIcon.tsx","../../../packages/mgt-chat/src/components/ChatListItem/ChatListItem.tsx","../../../packages/mgt-chat/src/statefulClient/GraphNotificationUserClient.ts","../../../packages/mgt-chat/src/components/ChatListHeader/EllipsisMenu.tsx","../../../packages/mgt-chat/src/components/ChatListHeader/ChatListHeader.tsx","../../../packages/mgt-chat/src/components/ChatList/ChatList.tsx","../../../packages/mgt-chat/src/components/NewChat/NewChat.tsx","pages/Chats/ChatItem.tsx","pages/Chats/ChatListTemplate.tsx","pages/ChatPage.tsx","../../../packages/mgt-components/dist/es6/components/mgt-person-card/src/components/mgt-person-card/getMgtPersonCardScopes.ts","../../../packages/mgt-element/dist/es6/src/BetaGraph.ts"],"sourcesContent":["/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\nimport { getMgtPersonCardScopes } from '@microsoft/mgt-components/dist/es6/exports';\n\n/**\n * The lowest count of scopes required to perform all chat operations\n */\nexport const minimalChatScopesList = ['ChatMember.ReadWrite', 'Chat.ReadWrite'];\n\n/**\n * Object mapping chat operations to the scopes required to perform them\n */\nexport const chatOperationScopes: Record<string, string[]> = {\n  loadChat: ['Chat.ReadWrite'],\n  loadChatMessages: ['Chat.ReadWrite'],\n  loadChatImage: ['Chat.ReadWrite'],\n  sendChatMessage: ['Chat.ReadWrite'],\n  updateChatMessage: ['Chat.ReadWrite'],\n  deleteChatMessage: ['Chat.ReadWrite'],\n  removeChatMember: ['ChatMember.ReadWrite'],\n  addChatMember: ['ChatMember.ReadWrite'],\n  createChat: ['Chat.ReadWrite'],\n  loadAppsInChat: ['TeamsAppInstallation.ReadForChat']\n};\n\n/**\n * Object mapping chat operations to the scopes required to perform them\n * This should be used when we migrate this code to use scope aware requests\n */\nexport const chatOperationScopesFullListing: Record<string, string[]> = {\n  loadChat: ['Chat.ReadBasic', 'Chat.Read', 'Chat.ReadWrite'],\n  loadChatMessages: ['Chat.Read', 'Chat.ReadWrite'],\n  loadChatImage: ['ChannelMessage.Read.All', 'Chat.Read', 'Chat.ReadWrite', 'Group.Read.All', 'Group.ReadWrite.All'],\n  sendChatMessage: ['ChatMessage.Send', 'ChatMessage.Send', 'Chat.ReadWrite', 'Group.ReadWrite.All'],\n  updateChatMessage: ['ChannelMessage.ReadWrite', 'Chat.ReadWrite', 'Group.ReadWrite.All'],\n  deleteChatMessage: ['ChannelMessage.ReadWrite', 'Chat.ReadWrite'],\n  removeChatMember: ['ChatMember.ReadWrite'],\n  addChatMember: ['ChatMember.ReadWrite', 'Chat.ReadWrite'],\n  createChat: ['Chat.Create', 'Chat.ReadWrite'],\n  loadAppsInChat: [\n    'TeamsAppInstallation.ReadForChat',\n    'TeamsAppInstallation.ReadWriteSelfForChat',\n    'TeamsAppInstallation.ReadWriteForChat',\n    'TeamsAppInstallation.ReadWriteAndConsentSelfForChat',\n    'TeamsAppInstallation.ReadWriteAndConsentForChat'\n  ]\n};\n\n/**\n * The permission set required to use the people picker to search for users\n * as defined in docs: https://learn.microsoft.com/en-us/graph/toolkit/components/people-picker#microsoft-graph-permissions\n * N.B. presence permissions not currently documented\n */\nexport const peoplePickerScopes: Record<string, string[]> = {\n  loadPresence: ['Presence.Read.All'],\n  searchUsers: ['User.ReadBasic.All'],\n  searchPeople: ['People.Read']\n};\n\n/**\n * Provides an array of the distinct scopes required for all chat operations\n */\nexport const allChatScopes = Array.from(\n  [['User.Read']]\n    .concat([minimalChatScopesList])\n    .concat(Object.values(peoplePickerScopes))\n    .concat([getMgtPersonCardScopes()])\n    .reduce((acc, scopes) => {\n      scopes.forEach(s => acc.add(s));\n      return acc;\n    }, new Set<string>())\n);\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { GraphEndpoint } from '@microsoft/mgt-element';\n\nexport class GraphConfig {\n  public static ackAsString = false;\n\n  public static useCanary = false;\n\n  public static version = 'v1.0';\n\n  public static canarySubscriptionVersion = 'testprodv1.0e2ewebsockets';\n\n  public static webSocketsPrefix = 'websockets:';\n\n  public static get graphEndpoint(): GraphEndpoint {\n    return GraphConfig.useCanary ? 'https://canary.graph.microsoft.com' : 'https://graph.microsoft.com';\n  }\n\n  public static get baseCanaryUrl(): string {\n    return `${GraphConfig.graphEndpoint}/${this.canarySubscriptionVersion}`;\n  }\n\n  public static get subscriptionEndpoint(): string {\n    return GraphConfig.useCanary ? `${GraphConfig.baseCanaryUrl}/subscriptions` : '/subscriptions';\n  }\n\n  public static adjustNotificationUrl(url: string): string {\n    if (GraphConfig.useCanary && url) {\n      url = url.replace('https://graph.microsoft.com/1.0', GraphConfig.baseCanaryUrl);\n      url = url.replace('https://graph.microsoft.com/beta', GraphConfig.baseCanaryUrl);\n    }\n    return url.replace(GraphConfig.webSocketsPrefix, '');\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { CacheItem, CacheSchema, CacheService, CacheStore, log, schemas } from '@microsoft/mgt-react';\nimport { Subscription } from '@microsoft/microsoft-graph-types';\nimport { isConversationCacheEnabled } from './isConversationCacheEnabled';\nimport { IDBPObjectStore } from 'idb';\n\nexport enum ComponentType {\n  User = 'user',\n  Chat = 'chat'\n}\n\ntype CachedSubscriptionData = CacheItem & {\n  componentEntityId: string;\n  sessionId: string;\n  subscriptions: Subscription[];\n  lastAccessDateTime: string;\n  componentType: ComponentType;\n};\n\nconst buildCacheKey = (componentEntityId: string, sessionId: string): string => `${componentEntityId}:${sessionId}`;\n\nexport class SubscriptionsCache {\n  private get cache(): CacheStore<CachedSubscriptionData> {\n    const conversation: CacheSchema = schemas.conversation;\n    return CacheService.getCache<CachedSubscriptionData>(conversation, conversation.stores.subscriptions);\n  }\n\n  public async loadSubscriptions(\n    componentEntityId: string,\n    sessionId: string\n  ): Promise<CachedSubscriptionData | undefined> {\n    if (isConversationCacheEnabled()) {\n      const cacheKey = buildCacheKey(componentEntityId, sessionId);\n      let data;\n      await this.cache.transaction(async (store: IDBPObjectStore<unknown, [string], string, 'readwrite'>) => {\n        data = (await store.get(cacheKey)) as CachedSubscriptionData | undefined;\n        if (data) {\n          data.lastAccessDateTime = new Date().toISOString();\n          await store.put(data, cacheKey);\n        }\n      });\n      return data || undefined;\n    }\n    return undefined;\n  }\n\n  public async cacheSubscription(\n    componentEntityId: string,\n    componentType: ComponentType,\n    sessionId: string,\n    subscriptionRecord: Subscription\n  ): Promise<void> {\n    await this.cache.transaction(async (store: IDBPObjectStore<unknown, [string], string, 'readwrite'>) => {\n      log('cacheSubscription', subscriptionRecord);\n      const cacheKey = buildCacheKey(componentEntityId, sessionId);\n\n      let cacheEntry = (await store.get(cacheKey)) as CachedSubscriptionData | undefined;\n      if (cacheEntry && cacheEntry.componentEntityId === componentEntityId) {\n        const subIndex = cacheEntry.subscriptions.findIndex(s => s.resource === subscriptionRecord.resource);\n        if (subIndex !== -1) {\n          cacheEntry.subscriptions[subIndex] = subscriptionRecord;\n        } else {\n          cacheEntry.subscriptions.push(subscriptionRecord);\n        }\n      } else {\n        cacheEntry = {\n          componentEntityId,\n          componentType,\n          sessionId,\n          subscriptions: [subscriptionRecord],\n          // we're cheating a bit here to ensure that we have a defined lastAccessDateTime\n          // but we're updating the value for all cases before storing it.\n          lastAccessDateTime: ''\n        };\n      }\n      cacheEntry.lastAccessDateTime = new Date().toISOString();\n\n      await store.put(cacheEntry, cacheKey);\n    });\n  }\n\n  public deleteCachedSubscriptions(componentEntityId: string, sessionId: string): Promise<void> {\n    return this.cache.delete(buildCacheKey(componentEntityId, sessionId));\n  }\n\n  public loadInactiveSubscriptions(\n    inactivityThreshold: string,\n    componentType: ComponentType\n  ): Promise<CachedSubscriptionData[]> {\n    return this.cache\n      .queryDb('lastAccessDateTime', IDBKeyRange.upperBound(inactivityThreshold))\n      .then((data: CachedSubscriptionData[]) => data.filter(d => d.componentType === componentType))\n      .catch(err => {\n        // propogate the error back to the call of this function\n        throw err;\n      });\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { CacheService } from '@microsoft/mgt-react';\n\nexport const isConversationCacheEnabled = (): boolean => {\n  const conversation = CacheService.config.conversation;\n  return conversation.isEnabled && CacheService.config.isEnabled;\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport {\n  IGraph,\n  prepScopes,\n  CacheItem,\n  CacheService,\n  CacheStore,\n  BatchResponse,\n  CollectionResponse\n} from '@microsoft/mgt-element';\nimport { Group } from '@microsoft/microsoft-graph-types';\nimport { schemas } from './cacheStores';\n\n/**\n * Group Type enumeration\n *\n * @export\n * @enum {number}\n */\nexport enum GroupType {\n  /**\n   * Any group Type\n   */\n  any = 0,\n\n  /**\n   * Office 365 group\n   */\n  // eslint-disable-next-line no-bitwise\n  unified = 1 << 0,\n\n  /**\n   * Security group\n   */\n  // eslint-disable-next-line no-bitwise\n  security = 1 << 1,\n\n  /**\n   * Mail Enabled Security group\n   */\n  // eslint-disable-next-line no-bitwise\n  mailenabledsecurity = 1 << 2,\n\n  /**\n   * Distribution Group\n   */\n  // eslint-disable-next-line no-bitwise\n  distribution = 1 << 3\n}\n\n/**\n * Object to be stored in cache\n */\nexport interface CacheGroup extends CacheItem {\n  /**\n   * stringified json representing a user\n   */\n  group?: string;\n}\n\n/**\n * Object to be stored in cache representing individual people\n */\ninterface CacheGroupQuery extends CacheItem {\n  /**\n   * json representing a person stored as string\n   */\n  groups?: string[];\n  /**\n   * top number of results\n   */\n  top?: number;\n}\n\n/**\n * Defines the expiration time\n */\nconst getGroupsInvalidationTime = (): number =>\n  CacheService.config.groups.invalidationPeriod || CacheService.config.defaultInvalidationPeriod;\n\n/**\n * Whether the groups store is enabled\n */\nconst getIsGroupsCacheEnabled = (): boolean => CacheService.config.groups.isEnabled && CacheService.config.isEnabled;\n\n/**\n * Searches the Graph for Groups\n *\n * @export\n * @param {IGraph} graph\n * @param {string} query - what to search for\n * @param {number} [top=10] - number of groups to return\n * @param {GroupType} [groupTypes=GroupType.any] - the type of group to search for\n * @returns {Promise<Group[]>} An array of Groups\n */\nexport const findGroups = async (\n  graph: IGraph,\n  query: string,\n  top = 10,\n  groupTypes: GroupType = GroupType.any,\n  groupFilters = ''\n): Promise<Group[]> => {\n  const scopes = 'Group.Read.All';\n\n  let cache: CacheStore<CacheGroupQuery>;\n  const key = `${query ? query : '*'}*${groupTypes}*${groupFilters}:${top}`;\n\n  if (getIsGroupsCacheEnabled()) {\n    cache = CacheService.getCache(schemas.groups, schemas.groups.stores.groupsQuery);\n    const cacheGroupQuery = await cache.getValue(key);\n    if (cacheGroupQuery && getGroupsInvalidationTime() > Date.now() - cacheGroupQuery.timeCached) {\n      if (cacheGroupQuery.top >= top) {\n        // if request is less than the cache's requests, return a slice of the results\n        return cacheGroupQuery.groups.map(x => JSON.parse(x) as Group).slice(0, top + 1);\n      }\n      // if the new request needs more results than what's presently in the cache, graph must be called again\n    }\n  }\n\n  let filterQuery = '';\n  let responses: Map<string, BatchResponse<CollectionResponse<Group>>>;\n  const batchedResult: Group[] = [];\n\n  if (query !== '') {\n    filterQuery = `(startswith(displayName,'${query}') or startswith(mailNickname,'${query}') or startswith(mail,'${query}'))`;\n  }\n\n  if (groupFilters) {\n    filterQuery += `${query ? ' and ' : ''}${groupFilters}`;\n  }\n\n  if (groupTypes !== GroupType.any) {\n    const batch = graph.createBatch<CollectionResponse<Group>>();\n\n    const filterGroups: string[] = [];\n\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-enum-comparison, no-bitwise\n    if (GroupType.unified === (groupTypes & GroupType.unified)) {\n      filterGroups.push(\"groupTypes/any(c:c+eq+'Unified')\");\n    }\n\n    // eslint-disable-next-line no-bitwise, @typescript-eslint/no-unsafe-enum-comparison\n    if (GroupType.security === (groupTypes & GroupType.security)) {\n      filterGroups.push('(mailEnabled eq false and securityEnabled eq true)');\n    }\n\n    // eslint-disable-next-line no-bitwise, @typescript-eslint/no-unsafe-enum-comparison\n    if (GroupType.mailenabledsecurity === (groupTypes & GroupType.mailenabledsecurity)) {\n      filterGroups.push('(mailEnabled eq true and securityEnabled eq true)');\n    }\n\n    // eslint-disable-next-line no-bitwise, @typescript-eslint/no-unsafe-enum-comparison\n    if (GroupType.distribution === (groupTypes & GroupType.distribution)) {\n      filterGroups.push('(mailEnabled eq true and securityEnabled eq false)');\n    }\n\n    filterQuery = filterQuery ? `${filterQuery} and ` : '';\n    for (const filter of filterGroups) {\n      batch.get(filter, `/groups?$filter=${filterQuery + filter}`, ['Group.Read.All']);\n    }\n\n    try {\n      responses = await batch.executeAll();\n\n      for (const filterGroup of filterGroups) {\n        if (responses.get(filterGroup).content.value) {\n          for (const group of responses.get(filterGroup).content.value) {\n            const repeat = batchedResult.find(batchedGroup => batchedGroup.id === group.id);\n            if (!repeat) {\n              batchedResult.push(group);\n            }\n          }\n        }\n      }\n    } catch (_) {\n      try {\n        const queries: Promise<CollectionResponse<Group>>[] = [];\n        for (const filter of filterGroups) {\n          queries.push(\n            graph\n              .api('groups')\n              .filter(`${filterQuery} and ${filter}`)\n              .top(top)\n              .count(true)\n              .header('ConsistencyLevel', 'eventual')\n              .middlewareOptions(prepScopes(scopes))\n              .get() as Promise<CollectionResponse<Group>>\n          );\n        }\n        return (await Promise.all(queries)).map(x => x.value).reduce((a, b) => a.concat(b), []);\n      } catch (e) {\n        return [];\n      }\n    }\n  } else {\n    if (batchedResult.length === 0) {\n      const result = (await graph\n        .api('groups')\n        .filter(filterQuery)\n        .top(top)\n        .count(true)\n        .header('ConsistencyLevel', 'eventual')\n        .middlewareOptions(prepScopes(scopes))\n        .get()) as CollectionResponse<Group>;\n      if (getIsGroupsCacheEnabled() && result) {\n        await cache.putValue(key, { groups: result.value.map(x => JSON.stringify(x)), top });\n      }\n      return result ? result.value : null;\n    }\n  }\n\n  return batchedResult;\n};\n\n/**\n * Searches the Graph for group members\n *\n * @export\n * @param {IGraph} graph\n * @param {string} query - what to search for\n * @param {string} groupId - what to search for\n * @param {number} [top=10] - number of groups to return\n * @param {boolean} [transitive=false] - whether the return should contain a flat list of all nested members\n * @param {GroupType} [groupTypes=GroupType.any] - the type of group to search for\n * @returns {Promise<Group[]>} An array of Groups\n */\nexport const findGroupsFromGroup = async (\n  graph: IGraph,\n  query: string,\n  groupId: string,\n  top = 10,\n  transitive = false,\n  groupTypes: GroupType = GroupType.any\n): Promise<Group[]> => {\n  const scopes = 'Group.Read.All';\n\n  let cache: CacheStore<CacheGroupQuery>;\n  const key = `${groupId}:${query || '*'}:${groupTypes}:${transitive}`;\n\n  if (getIsGroupsCacheEnabled()) {\n    cache = CacheService.getCache(schemas.groups, schemas.groups.stores.groupsQuery);\n    const cacheGroupQuery = await cache.getValue(key);\n    if (cacheGroupQuery && getGroupsInvalidationTime() > Date.now() - cacheGroupQuery.timeCached) {\n      if (cacheGroupQuery.top >= top) {\n        // if request is less than the cache's requests, return a slice of the results\n        return cacheGroupQuery.groups.map(x => JSON.parse(x) as Group).slice(0, top + 1);\n      }\n      // if the new request needs more results than what's presently in the cache, graph must be called again\n    }\n  }\n\n  const apiUrl = `groups/${groupId}/${transitive ? 'transitiveMembers' : 'members'}/microsoft.graph.group`;\n  let filterQuery = '';\n  if (query !== '') {\n    filterQuery = `(startswith(displayName,'${query}') or startswith(mailNickname,'${query}') or startswith(mail,'${query}'))`;\n  }\n\n  if (groupTypes !== GroupType.any) {\n    const filterGroups = [];\n\n    // eslint-disable-next-line no-bitwise, @typescript-eslint/no-unsafe-enum-comparison\n    if (GroupType.unified === (groupTypes & GroupType.unified)) {\n      filterGroups.push(\"groupTypes/any(c:c+eq+'Unified')\");\n    }\n\n    // eslint-disable-next-line no-bitwise, @typescript-eslint/no-unsafe-enum-comparison\n    if (GroupType.security === (groupTypes & GroupType.security)) {\n      filterGroups.push('(mailEnabled eq false and securityEnabled eq true)');\n    }\n\n    // eslint-disable-next-line no-bitwise, @typescript-eslint/no-unsafe-enum-comparison\n    if (GroupType.mailenabledsecurity === (groupTypes & GroupType.mailenabledsecurity)) {\n      filterGroups.push('(mailEnabled eq true and securityEnabled eq true)');\n    }\n\n    // eslint-disable-next-line no-bitwise, @typescript-eslint/no-unsafe-enum-comparison\n    if (GroupType.distribution === (groupTypes & GroupType.distribution)) {\n      filterGroups.push('(mailEnabled eq true and securityEnabled eq false)');\n    }\n\n    filterQuery += (query !== '' ? ' and ' : '') + filterGroups.join(' or ');\n  }\n\n  const result = (await graph\n    .api(apiUrl)\n    .filter(filterQuery)\n    .count(true)\n    .top(top)\n    .header('ConsistencyLevel', 'eventual')\n    .middlewareOptions(prepScopes(scopes))\n    .get()) as CollectionResponse<Group>;\n\n  if (getIsGroupsCacheEnabled() && result) {\n    await cache.putValue(key, { groups: result.value.map(x => JSON.stringify(x)), top });\n  }\n\n  return result ? result.value : null;\n};\n\n/**\n * async promise, returns all Graph groups associated with the id provided\n *\n * @param {string} id\n * @returns {(Promise<User>)}\n * @memberof Graph\n */\nexport const getGroup = async (graph: IGraph, id: string, requestedProps?: string[]): Promise<Group> => {\n  const scopes = 'Group.Read.All';\n  let cache: CacheStore<CacheGroup>;\n\n  if (getIsGroupsCacheEnabled()) {\n    cache = CacheService.getCache(schemas.groups, schemas.groups.stores.groups);\n    // check cache\n    const group = await cache.getValue(id);\n\n    // is it stored and is timestamp good?\n    if (group && getGroupsInvalidationTime() > Date.now() - group.timeCached) {\n      const cachedData = group.group ? (JSON.parse(group.group) as Group) : null;\n      const uniqueProps =\n        requestedProps && cachedData ? requestedProps.filter(prop => !Object.keys(cachedData).includes(prop)) : null;\n\n      // return without any worries\n      if (!uniqueProps || uniqueProps.length <= 1) {\n        return cachedData;\n      }\n    }\n  }\n\n  let apiString = `/groups/${id}`;\n  if (requestedProps) {\n    apiString = apiString + '?$select=' + requestedProps.toString();\n  }\n\n  // else we must grab it\n  const response = (await graph.api(apiString).middlewareOptions(prepScopes(scopes)).get()) as Group;\n  if (getIsGroupsCacheEnabled()) {\n    await cache.putValue(id, { group: JSON.stringify(response) });\n  }\n  return response;\n};\n\n/**\n * Returns a Promise of Graph Groups array associated with the groupIds array\n *\n * @export\n * @param {IGraph} graph\n * @param {string[]} groupIds, an array of string ids\n * @returns {Promise<Group[]>}\n */\nexport const getGroupsForGroupIds = async (graph: IGraph, groupIds: string[], filters = ''): Promise<Group[]> => {\n  if (!groupIds || groupIds.length === 0) {\n    return [];\n  }\n  const batch = graph.createBatch();\n  const groupDict: Record<string, Group | Promise<Group>> = {};\n  const notInCache: string[] = [];\n  let cache: CacheStore<CacheGroup>;\n\n  if (getIsGroupsCacheEnabled()) {\n    cache = CacheService.getCache(schemas.groups, schemas.groups.stores.groups);\n  }\n\n  for (const id of groupIds) {\n    groupDict[id] = null;\n    let group: CacheGroup;\n    if (getIsGroupsCacheEnabled()) {\n      group = await cache.getValue(id);\n    }\n    if (group && getGroupsInvalidationTime() > Date.now() - group.timeCached) {\n      groupDict[id] = group.group ? (JSON.parse(group.group) as Group) : null;\n    } else if (id !== '') {\n      let apiUrl = `/groups/${id}`;\n      if (filters) {\n        apiUrl = `${apiUrl}?$filters=${filters}`;\n      }\n      batch.get(id, apiUrl, ['Group.Read.All']);\n      notInCache.push(id);\n    }\n  }\n  try {\n    const responses = await batch.executeAll();\n    // iterate over groupIds to ensure the order of ids\n    for (const id of groupIds) {\n      const response = responses.get(id);\n      if (response?.content) {\n        groupDict[id] = response.content as Group;\n        if (getIsGroupsCacheEnabled()) {\n          await cache.putValue(id, { group: JSON.stringify(response.content) });\n        }\n      }\n    }\n    return Promise.all(Object.values(groupDict));\n  } catch (_) {\n    // fallback to making the request one by one\n    try {\n      // call getGroup for all the users that weren't cached\n      groupIds\n        .filter(id => notInCache.includes(id))\n        .forEach(id => {\n          groupDict[id] = getGroup(graph, id);\n        });\n      if (getIsGroupsCacheEnabled()) {\n        // store all users that weren't retrieved from the cache, into the cache\n        await Promise.all(\n          groupIds\n            .filter(id => notInCache.includes(id))\n            .map(async id => await cache.putValue(id, { group: JSON.stringify(await groupDict[id]) }))\n        );\n      }\n      return Promise.all(Object.values(groupDict));\n    } catch (e) {\n      return [];\n    }\n  }\n};\n\n/**\n * Gets groups from the graph that are in the group ids\n *\n * @param graph\n * @param query\n * @param groupId\n * @param top\n * @param transitive\n * @param groupTypes\n * @param filters\n * @returns\n */\nexport const findGroupsFromGroupIds = async (\n  graph: IGraph,\n  query: string,\n  groupIds: string[],\n  top = 10,\n  groupTypes: GroupType = GroupType.any,\n  filters = ''\n): Promise<Group[]> => {\n  const foundGroups: Group[] = [];\n  const graphGroups = await findGroups(graph, query, top, groupTypes, filters);\n  if (graphGroups) {\n    for (const group of graphGroups) {\n      if (group.id && groupIds.includes(group.id)) {\n        foundGroups.push(group);\n      }\n    }\n  }\n  return foundGroups;\n};\n","import { v4 as uuid } from 'uuid';\nimport { TimerWork } from './timerWorker';\n\nexport interface Work {\n  id: string;\n  callback: () => void;\n}\n\nexport class Timer {\n  private readonly worker: SharedWorker;\n  private readonly work = new Map<string, () => void>();\n  constructor() {\n    this.worker = new SharedWorker(/* webpackChunkName: \"timer-worker\" */ new URL('./timerWorker.js', import.meta.url));\n    this.worker.port.onmessage = this.onMessage;\n  }\n\n  public setTimeout(callback: () => void, delay: number): string {\n    const timeoutWork: TimerWork = {\n      type: 'setTimeout',\n      id: uuid(),\n      delay\n    };\n\n    this.work.set(timeoutWork.id, callback);\n\n    this.worker.port.postMessage(timeoutWork);\n\n    return timeoutWork.id;\n  }\n\n  public clearTimeout(id: string): void {\n    if (this.work.has(id)) {\n      const timeoutWork: TimerWork = {\n        type: 'clearTimeout',\n        id\n      };\n      this.worker.port.postMessage(timeoutWork);\n      this.work.delete(id);\n    }\n  }\n\n  public setInterval(callback: () => void, delay: number): string {\n    const intervalWork: TimerWork = {\n      type: 'setInterval',\n      id: uuid(),\n      delay\n    };\n\n    this.work.set(intervalWork.id, callback);\n\n    this.worker.port.postMessage(intervalWork);\n\n    return intervalWork.id;\n  }\n\n  public clearInterval(id: string): void {\n    if (this.work.has(id)) {\n      const intervalWork: TimerWork = {\n        type: 'clearInterval',\n        id\n      };\n      this.worker.port.postMessage(intervalWork);\n      this.work.delete(id);\n    }\n  }\n\n  private readonly onMessage = (event: MessageEvent<TimerWork>): void => {\n    const intervalWork = event.data;\n    if (!intervalWork) {\n      return;\n    }\n\n    switch (intervalWork.type) {\n      case 'runCallback': {\n        if (this.work.has(intervalWork.id)) {\n          const work = this.work.get(intervalWork.id);\n          work?.();\n        }\n        break;\n      }\n    }\n  };\n\n  public close() {\n    this.worker.port.close();\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { BetaGraph, IGraph, Providers, createFromProvider, error, log } from '@microsoft/mgt-element';\nimport { HubConnection, HubConnectionBuilder, IHttpConnectionOptions, LogLevel } from '@microsoft/signalr';\nimport { ThreadEventEmitter } from './ThreadEventEmitter';\nimport type {\n  Entity,\n  Subscription,\n  ChatMessage,\n  Chat,\n  AadUserConversationMember\n} from '@microsoft/microsoft-graph-types';\nimport { GraphConfig } from './GraphConfig';\nimport { SubscriptionsCache, ComponentType } from './Caching/SubscriptionCache';\nimport { Timer } from '../utils/Timer';\n\nexport const appSettings = {\n  defaultSubscriptionLifetimeInMinutes: 10,\n  renewalThreshold: 75, // The number of seconds before subscription expires it will be renewed\n  renewalTimerInterval: 20, // The number of seconds between executions of the renewal timer\n  removalThreshold: 1 * 60, // number of seconds after the last update of a subscription to consider in inactive\n  removalTimerInterval: 1 * 60, // the number of seconds between executions of the timer to remove inactive subscriptions\n  useCanary: GraphConfig.useCanary\n};\n\ntype ChangeTypes = 'created' | 'updated' | 'deleted';\n\ninterface Notification<T extends Entity> {\n  subscriptionId: string;\n  changeType: ChangeTypes;\n  resource: string;\n  resourceData: T & {\n    id: string;\n    '@odata.type': string;\n    '@odata.id': string;\n  };\n  EncryptedContent: string;\n}\n\ntype ReceivedNotification = Notification<Chat> | Notification<ChatMessage> | Notification<AadUserConversationMember>;\n\nconst isMessageNotification = (o: Notification<Entity>): o is Notification<ChatMessage> =>\n  o.resource.includes('/messages(');\nconst isMembershipNotification = (o: Notification<Entity>): o is Notification<AadUserConversationMember> =>\n  o.resource.includes('/members');\n\nexport class GraphNotificationClient {\n  private connection?: HubConnection = undefined;\n  private renewalTimeout?: string;\n  private cleanupTimeout?: string;\n  private renewalCount = 0;\n  private chatId = '';\n  private sessionId = '';\n  private readonly subscriptionCache: SubscriptionsCache = new SubscriptionsCache();\n  private readonly timer = new Timer();\n  private get graph() {\n    return this._graph;\n  }\n  private get beta() {\n    return BetaGraph.fromGraph(this._graph);\n  }\n  private get subscriptionGraph() {\n    return GraphConfig.useCanary\n      ? createFromProvider(Providers.globalProvider, GraphConfig.canarySubscriptionVersion, 'mgt-chat')\n      : this.beta;\n  }\n\n  /**\n   *\n   */\n  constructor(\n    private readonly emitter: ThreadEventEmitter,\n    private readonly _graph: IGraph\n  ) {\n    // start the cleanup timer when we create the notification client.\n    this.startCleanupTimer();\n  }\n\n  /**\n   * Removes any active timers that may exist to prevent memory leaks and perf issues.\n   * Call this method when the component that depends an instance of this class is being removed from the DOM\n   * i.e\n   */\n  public async tearDown() {\n    log('cleaning up graph notification resources');\n    if (this.cleanupTimeout) this.timer.clearTimeout(this.cleanupTimeout);\n    if (this.renewalTimeout) this.timer.clearTimeout(this.renewalTimeout);\n    this.timer.close();\n    await this.unsubscribeFromChatNotifications(this.chatId, this.sessionId);\n  }\n\n  private readonly getToken = async () => {\n    const token = await Providers.globalProvider.getAccessToken();\n    if (!token) throw new Error('Could not retrieve token for user');\n    return token;\n  };\n\n  // TODO: understand if this is needed under the native model\n  private readonly onReconnect = (connectionId: string | undefined) => {\n    log(`Reconnected. ConnectionId: ${connectionId || 'undefined'}`);\n    // void this.renewChatSubscriptions();\n  };\n\n  private readonly receiveNotificationMessage = (message: string) => {\n    if (typeof message !== 'string') throw new Error('Expected string from receivenotificationmessageasync');\n\n    const notification: ReceivedNotification = JSON.parse(message) as ReceivedNotification;\n    log('received notification message', notification);\n    const emitter: ThreadEventEmitter | undefined = this.emitter;\n    if (!notification.resourceData) throw new Error('Message did not contain resourceData');\n    if (isMessageNotification(notification)) {\n      this.processMessageNotification(notification, emitter);\n    } else if (isMembershipNotification(notification)) {\n      this.processMembershipNotification(notification, emitter);\n    } else {\n      this.processChatPropertiesNotification(notification, emitter);\n    }\n    // Need to return a status code string of 200 so that graph knows the message was received and doesn't re-send the notification\n    const ackMessage: unknown = { StatusCode: '200' };\n    return GraphConfig.ackAsString ? JSON.stringify(ackMessage) : ackMessage;\n  };\n\n  private processMessageNotification(notification: Notification<ChatMessage>, emitter: ThreadEventEmitter | undefined) {\n    const message = notification.resourceData;\n\n    switch (notification.changeType) {\n      case 'created':\n        emitter?.chatMessageReceived(message);\n        return;\n      case 'updated':\n        emitter?.chatMessageEdited(message);\n        return;\n      case 'deleted':\n        emitter?.chatMessageDeleted(message);\n        return;\n      default:\n        throw new Error('Unknown change type');\n    }\n  }\n\n  private processMembershipNotification(\n    notification: Notification<AadUserConversationMember>,\n    emitter: ThreadEventEmitter | undefined\n  ) {\n    const member = notification.resourceData;\n    switch (notification.changeType) {\n      case 'created':\n        emitter?.participantAdded(member);\n        return;\n      case 'deleted':\n        emitter?.participantRemoved(member);\n        return;\n      default:\n        throw new Error('Unknown change type');\n    }\n  }\n\n  private processChatPropertiesNotification(notification: Notification<Chat>, emitter: ThreadEventEmitter | undefined) {\n    const chat = notification.resourceData;\n    switch (notification.changeType) {\n      case 'updated':\n        emitter?.chatThreadPropertiesUpdated(chat);\n        return;\n      case 'deleted':\n        emitter?.chatThreadDeleted(chat);\n        return;\n      default:\n        throw new Error('Unknown change type');\n    }\n  }\n\n  private readonly cacheSubscription = async (subscriptionRecord: Subscription): Promise<void> => {\n    log(subscriptionRecord);\n\n    await this.subscriptionCache.cacheSubscription(this.chatId, ComponentType.Chat, this.sessionId, subscriptionRecord);\n\n    // only start timer once. undefined for renewalInterval is semaphore it has stopped.\n    if (this.renewalTimeout === undefined) this.startRenewalTimer();\n  };\n\n  private async subscribeToResource(resourcePath: string, changeTypes: ChangeTypes[]) {\n    // build subscription request\n    const expirationDateTime = new Date(\n      new Date().getTime() + appSettings.defaultSubscriptionLifetimeInMinutes * 60 * 1000\n    ).toISOString();\n    const subscriptionDefinition: Subscription = {\n      changeType: changeTypes.join(','),\n      notificationUrl: `${GraphConfig.webSocketsPrefix}?groupId=${this.chatId}&sessionId=${this.sessionId}`,\n      resource: resourcePath,\n      expirationDateTime,\n      includeResourceData: true,\n      clientState: 'wsssecret'\n    };\n\n    log('subscribing to changes for ' + resourcePath);\n    const subscriptionEndpoint = GraphConfig.subscriptionEndpoint;\n    // send subscription POST to Graph\n    const subscription: Subscription = (await this.subscriptionGraph\n      .api(subscriptionEndpoint)\n      .post(subscriptionDefinition)) as Subscription;\n    if (!subscription?.notificationUrl) throw new Error('Subscription not created');\n    log(subscription);\n\n    const awaits: Promise<void>[] = [];\n    // Cache the subscription in storage for re-hydration on page refreshes\n    awaits.push(this.cacheSubscription(subscription));\n\n    // create a connection to the web socket if one does not exist\n    if (!this.connection) awaits.push(this.createSignalRConnection(subscription.notificationUrl));\n\n    log('Invoked CreateSubscription');\n    return Promise.all(awaits);\n  }\n\n  private readonly startRenewalTimer = () => {\n    if (this.renewalTimeout) this.timer.clearTimeout(this.renewalTimeout);\n    this.renewalTimeout = this.timer.setTimeout(this.syncRenewalTimerWrapper, appSettings.renewalTimerInterval * 1000);\n    log(`Start renewal timer . Id: ${this.renewalTimeout}`);\n  };\n\n  private readonly syncRenewalTimerWrapper = () => void this.renewalTimer();\n\n  private readonly renewalTimer = async () => {\n    log(`running subscription renewal timer for chatId: ${this.chatId} sessionId: ${this.sessionId}`);\n    const subscriptions =\n      (await this.subscriptionCache.loadSubscriptions(this.chatId, this.sessionId))?.subscriptions || [];\n    if (subscriptions.length === 0) {\n      log(`No subscriptions found in session state. Stop renewal timer ${this.renewalTimeout}.`);\n      if (this.renewalTimeout) this.timer.clearTimeout(this.renewalTimeout);\n      return;\n    }\n\n    for (const subscription of subscriptions) {\n      if (!subscription.expirationDateTime) continue;\n      const expirationTime = new Date(subscription.expirationDateTime);\n      const now = new Date();\n      const diff = Math.round((expirationTime.getTime() - now.getTime()) / 1000);\n\n      if (diff <= appSettings.renewalThreshold) {\n        this.renewalCount++;\n        log(`Renewing Graph subscription. RenewalCount: ${this.renewalCount}`);\n        // stop interval to prevent new invokes until refresh is ready.\n        if (this.renewalTimeout) this.timer.clearTimeout(this.renewalTimeout);\n        this.renewalTimeout = undefined;\n        await this.renewChatSubscriptions();\n        // There is one subscription that need expiration, all subscriptions will be renewed\n        break;\n      }\n    }\n    this.renewalTimeout = this.timer.setTimeout(this.syncRenewalTimerWrapper, appSettings.renewalTimerInterval * 1000);\n  };\n\n  public renewChatSubscriptions = async () => {\n    const expirationTime = new Date(\n      new Date().getTime() + appSettings.defaultSubscriptionLifetimeInMinutes * 60 * 1000\n    );\n\n    const subscriptionCache = await this.subscriptionCache.loadSubscriptions(this.chatId, this.sessionId);\n    const awaits: Promise<unknown>[] = [];\n    for (const subscription of subscriptionCache?.subscriptions || []) {\n      if (!subscription.id) continue;\n      // the renewSubscription method caches the updated subscription to track the new expiration time\n      awaits.push(this.renewSubscription(subscription.id, expirationTime.toISOString()));\n      log(`Invoked RenewSubscription ${subscription.id}`);\n    }\n    await Promise.all(awaits);\n    if (!this.renewalTimeout) {\n      this.renewalTimeout = this.timer.setTimeout(\n        this.syncRenewalTimerWrapper,\n        appSettings.renewalTimerInterval * 1000\n      );\n    }\n  };\n\n  public renewSubscription = async (subscriptionId: string, expirationDateTime: string): Promise<void> => {\n    // PATCH /subscriptions/{id}\n    const renewedSubscription = (await this.graph.api(`${GraphConfig.subscriptionEndpoint}/${subscriptionId}`).patch({\n      expirationDateTime\n    })) as Subscription;\n    return this.cacheSubscription(renewedSubscription);\n  };\n\n  public async createSignalRConnection(notificationUrl: string) {\n    const connectionOptions: IHttpConnectionOptions = {\n      accessTokenFactory: this.getToken,\n      withCredentials: false\n    };\n    const connection = new HubConnectionBuilder()\n      .withUrl(GraphConfig.adjustNotificationUrl(notificationUrl), connectionOptions)\n      .withAutomaticReconnect()\n      .configureLogging(LogLevel.Information)\n      .build();\n\n    connection.onreconnected(this.onReconnect);\n\n    connection.on('receivenotificationmessageasync', this.receiveNotificationMessage);\n\n    connection.on('EchoMessage', log);\n\n    this.connection = connection;\n    try {\n      await connection.start();\n      log(connection);\n    } catch (e) {\n      error('An error occurred connecting to the notification web socket', e);\n    }\n  }\n\n  private async deleteSubscription(id: string) {\n    try {\n      await this.graph.api(`${GraphConfig.subscriptionEndpoint}/${id}`).delete();\n    } catch (e) {\n      error(e);\n    }\n  }\n\n  private async removeSubscriptions(subscriptions: Subscription[]): Promise<unknown[]> {\n    const tasks: Promise<unknown>[] = [];\n    for (const s of subscriptions) {\n      // if there is no id or the subscription is expired, skip\n      if (!s.id || (s.expirationDateTime && new Date(s.expirationDateTime) <= new Date())) continue;\n      tasks.push(this.deleteSubscription(s.id));\n    }\n    return Promise.all(tasks);\n  }\n\n  private startCleanupTimer() {\n    this.cleanupTimeout = this.timer.setTimeout(this.cleanupTimerSync, appSettings.removalTimerInterval * 1000);\n  }\n\n  private readonly cleanupTimerSync = () => {\n    void this.cleanupTimer();\n  };\n\n  private readonly cleanupTimer = async () => {\n    log(`running cleanup timer`);\n    const offset = Math.min(\n      appSettings.removalThreshold * 1000,\n      appSettings.defaultSubscriptionLifetimeInMinutes * 60 * 1000\n    );\n    const threshold = new Date(new Date().getTime() - offset).toISOString();\n    const inactiveSubs = await this.subscriptionCache.loadInactiveSubscriptions(threshold, ComponentType.Chat);\n    let tasks: Promise<unknown>[] = [];\n    for (const inactive of inactiveSubs) {\n      tasks.push(this.removeSubscriptions(inactive.subscriptions));\n    }\n    await Promise.all(tasks);\n    tasks = [];\n    for (const inactive of inactiveSubs) {\n      tasks.push(this.subscriptionCache.deleteCachedSubscriptions(inactive.componentEntityId, inactive.sessionId));\n    }\n    this.startCleanupTimer();\n  };\n\n  public async closeSignalRConnection() {\n    // stop the connection and set it to undefined so it will reconnect when next subscription is created.\n    await this.connection?.stop();\n    this.connection = undefined;\n  }\n\n  private async unsubscribeFromChatNotifications(chatId: string, sessionId: string) {\n    await this.closeSignalRConnection();\n    const cacheData = await this.subscriptionCache.loadSubscriptions(chatId, sessionId);\n    if (cacheData) {\n      await Promise.all([\n        this.removeSubscriptions(cacheData.subscriptions),\n        this.subscriptionCache.deleteCachedSubscriptions(chatId, sessionId)\n      ]);\n    }\n  }\n\n  public async subscribeToChatNotifications(chatId: string, sessionId: string) {\n    // if we have a \"previous\" chat state at present, unsubscribe for the previous chatId\n    if (this.chatId && this.sessionId && chatId !== this.chatId) {\n      await this.unsubscribeFromChatNotifications(this.chatId, this.sessionId);\n    }\n    this.chatId = chatId;\n    this.sessionId = sessionId;\n    // MGT uses a per-user cache, so no concerns of loading the cached data for another user.\n    const cacheData = await this.subscriptionCache.loadSubscriptions(chatId, sessionId);\n    if (cacheData) {\n      // check subscription validity & renew if all still valid otherwise recreate\n      const someExpired = cacheData.subscriptions.some(\n        s => s.expirationDateTime && new Date(s.expirationDateTime) <= new Date()\n      );\n      // for a given user + app + chatId + sessionId they only get one websocket and receive all notifications via that websocket.\n      const webSocketUrl = cacheData.subscriptions.find(s => s.notificationUrl)?.notificationUrl;\n      if (someExpired) {\n        await this.removeSubscriptions(cacheData.subscriptions);\n      } else if (webSocketUrl) {\n        await this.createSignalRConnection(webSocketUrl);\n        await this.renewChatSubscriptions();\n        return;\n      }\n      await this.subscriptionCache.deleteCachedSubscriptions(chatId, sessionId);\n    }\n    const promises: Promise<unknown>[] = [];\n    promises.push(this.subscribeToResource(`/chats/${chatId}/messages`, ['created', 'updated', 'deleted']));\n    promises.push(this.subscribeToResource(`/chats/${chatId}/members`, ['created', 'deleted']));\n    promises.push(this.subscribeToResource(`/chats/${chatId}`, ['updated', 'deleted']));\n    await Promise.all(promises).catch((e: Error) => {\n      this?.emitter.graphNotificationClientError(e);\n    });\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { ProviderState, Providers } from '@microsoft/mgt-element';\n\nconst getCurrentUser = () =>\n  Providers.globalProvider.state === ProviderState.SignedIn ? Providers.globalProvider.getActiveAccount?.() : undefined;\nconst currentUserId = () => getCurrentUser()?.id.split('.')[0] || '';\nconst currentUserName = () => getCurrentUser()?.name || '';\n\nexport { getCurrentUser, currentUserId, currentUserName };\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { IGraph, Providers } from '@microsoft/mgt-element';\n\nexport const graph = (component: string, version?: string): IGraph => {\n  if (!component) throw new Error('Component name is required');\n  return Providers.globalProvider?.graph.forComponent(component, version);\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { CacheItem, CacheService } from '@microsoft/mgt-react';\n\n/**\n * Defines the expiration time\n */\nconst getConversationCacheInvalidationTime = (): number => {\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n  const conversation = CacheService.config.conversation;\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-return, @typescript-eslint/no-unsafe-member-access\n  return conversation.invalidationPeriod || CacheService.config.defaultInvalidationPeriod;\n};\n\nexport const cacheEntryIsValid = (cacheEntry: CacheItem) =>\n  cacheEntry.timeCached && getConversationCacheInvalidationTime() > Date.now() - cacheEntry.timeCached;\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { CacheItem, CacheSchema, CacheService, CacheStore, schemas } from '@microsoft/mgt-react';\nimport { ChatMessage } from '@microsoft/microsoft-graph-types';\nimport { GraphCollection } from '../graph.chat';\nimport { isConversationCacheEnabled } from './isConversationCacheEnabled';\nimport { cacheEntryIsValid } from './cacheEntryIsValid';\n\ninterface CachedMessageData extends CacheItem, GraphCollection<ChatMessage> {\n  chatId: string;\n  lastModifiedDateTime: string; // ISO 8601 timestamp, should be max from values in messages\n}\n\nexport class MessageCache {\n  private get cache(): CacheStore<CachedMessageData> {\n    const conversation: CacheSchema = schemas.conversation;\n    return CacheService.getCache<CachedMessageData>(conversation, conversation.stores.chats);\n  }\n\n  public async loadMessages(chatId: string): Promise<CachedMessageData | null | undefined> {\n    if (isConversationCacheEnabled()) {\n      const data = await this.cache.getValue(chatId);\n      if (data && cacheEntryIsValid(data)) return data;\n    }\n    return undefined;\n  }\n\n  public async cacheMessages(\n    chatId: string,\n    messages: ChatMessage[],\n    updateNextLink = false,\n    nextLink?: string\n  ): Promise<CachedMessageData> {\n    const cachedData = await this.cache.getValue(chatId);\n    if (!cachedData) {\n      const maxLastModifiedDateTime = messages.reduce((acc: string, curr: ChatMessage) => {\n        if (curr.lastModifiedDateTime && curr.lastModifiedDateTime > acc) acc = curr.lastModifiedDateTime;\n        return acc;\n      }, '');\n      const data = {\n        chatId,\n        value: messages,\n        lastModifiedDateTime: maxLastModifiedDateTime,\n        nextLink\n      };\n      // nothing cached, create and store.\n      await this.cache.putValue(chatId, data);\n      return data;\n    } else {\n      // need to iterate through the messages and either push or splice them into the array.\n      messages.forEach(m => this.addMessageToCacheData(m, cachedData));\n      if (updateNextLink) {\n        cachedData.nextLink = nextLink;\n      }\n      // update persisted data\n      await this.cache.putValue(chatId, cachedData);\n      return cachedData;\n    }\n  }\n\n  public async cacheMessage(chatId: string, message: ChatMessage): Promise<void> {\n    const cachedData = await this.cache.getValue(chatId);\n    if (!cachedData) {\n      // nothing cached, create and store.\n      await this.cache.putValue(chatId, {\n        chatId,\n        value: [message],\n        lastModifiedDateTime: message.lastModifiedDateTime || ''\n      });\n    } else {\n      this.addMessageToCacheData(message, cachedData);\n      // update persisted data\n      await this.cache.putValue(chatId, cachedData);\n    }\n  }\n\n  private addMessageToCacheData(message: ChatMessage, cachedData: CachedMessageData) {\n    const spliceIndex = cachedData.value.findIndex(m => m.id === message.id);\n    if (spliceIndex !== -1) {\n      cachedData.value.splice(spliceIndex, 1, message);\n    } else {\n      cachedData.value.push(message);\n    }\n    // coerce potential nullish values to an empty string to allow comparison\n    if (message.lastModifiedDateTime && message.lastModifiedDateTime > (cachedData.lastModifiedDateTime ?? ''))\n      cachedData.lastModifiedDateTime = message.lastModifiedDateTime;\n  }\n\n  public async deleteMessage(chatId: string, message: ChatMessage) {\n    const cachedData = await this.cache.getValue(chatId);\n    // for now we're ignoring the case where we didn't find anything in the cache for the given chatId as there's nothing to delete.\n    if (cachedData) {\n      const spliceIndex = cachedData.value.findIndex(m => m.id === message.id);\n      cachedData.value.splice(spliceIndex, 1);\n      await this.cache.putValue(chatId, cachedData);\n    }\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport { ReadReceiptReceivedEvent, TypingIndicatorReceivedEvent } from '@azure/communication-signaling';\nimport { AadUserConversationMember, Chat, ChatMessage } from '@microsoft/microsoft-graph-types';\nimport { EventEmitter } from 'events';\n\nexport type ChatEvent =\n  | 'chatMessageReceived'\n  | 'chatMessageEdited'\n  | 'chatMessageDeleted'\n  | 'typingIndicatorReceived'\n  | 'readReceiptReceived'\n  | 'chatThreadDeleted'\n  | 'chatThreadPropertiesUpdated'\n  | 'participantAdded'\n  | 'participantRemoved'\n  | 'disconnected'\n  | 'connected'\n  | 'reconnected'\n  | 'notificationsSubscribedForResource'\n  | 'graphNotificationClientError';\n\nexport class ThreadEventEmitter {\n  private readonly emitter: EventEmitter = new EventEmitter();\n\n  on(event: ChatEvent, listener: (...args: any[]) => void) {\n    this.emitter.on(event, listener);\n  }\n\n  off(event: ChatEvent, listener: (...args: any[]) => void) {\n    this.emitter.off(event, listener);\n  }\n\n  chatMessageReceived(e: ChatMessage) {\n    this.emitter.emit('chatMessageReceived', e);\n  }\n  chatMessageEdited(e: ChatMessage) {\n    this.emitter.emit('chatMessageEdited', e);\n  }\n  chatMessageDeleted(e: ChatMessage) {\n    this.emitter.emit('chatMessageDeleted', e);\n  }\n  typingIndicatorReceived(e: TypingIndicatorReceivedEvent) {\n    this.emitter.emit('typingIndicatorReceived', e);\n  }\n  readReceiptReceived(e: ReadReceiptReceivedEvent) {\n    this.emitter.emit('readReceiptReceived', e);\n  }\n  chatThreadDeleted(e: Chat) {\n    this.emitter.emit('chatThreadDeleted', e);\n  }\n  chatThreadPropertiesUpdated(e: Chat) {\n    this.emitter.emit('chatThreadPropertiesUpdated', e);\n  }\n  participantAdded(e: AadUserConversationMember) {\n    this.emitter.emit('participantAdded', e);\n  }\n  participantRemoved(e: AadUserConversationMember) {\n    this.emitter.emit('participantRemoved', e);\n  }\n  notificationsSubscribedForResource(resouce: string) {\n    this.emitter.emit('notificationsSubscribedForResource', resouce);\n  }\n  disconnected() {\n    this.emitter.emit('disconnected');\n  }\n  connected() {\n    this.emitter.emit('connected');\n  }\n  reconnected() {\n    this.emitter.emit('reconnected');\n  }\n  graphNotificationClientError(error: Error) {\n    this.emitter.emit('graphNotificationClientError', error);\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport {\n  schemas,\n  CachePhoto,\n  getPhotoInvalidationTime,\n  storePhotoInCache,\n  blobToBase64\n} from '@microsoft/mgt-components';\nimport { CacheService, IGraph, prepScopes } from '@microsoft/mgt-element';\nimport { ResponseType } from '@microsoft/microsoft-graph-client';\nimport {\n  AadUserConversationMember,\n  Chat,\n  ChatMessage,\n  Chat as GraphChat,\n  TeamsAppInstallation\n} from '@microsoft/microsoft-graph-types';\nimport { chatOperationScopes } from './chatOperationScopes';\n/**\n * Generic collection response from graph\n */\nexport interface GraphCollection<T = any> {\n  '@odata.nextLink'?: string;\n  nextLink?: string;\n  value: T[];\n}\n\n/**\n * Object representing a collection of chat messages\n */\nexport type MessageCollection = GraphCollection<ChatMessage>;\nexport type ChatThreadCollection = GraphCollection<GraphChat>;\nexport type AppCollection = GraphCollection<TeamsAppInstallation>;\n\n/**\n * Load the specified chat from graph with the members expanded\n *\n * @param graph authenticated graph client from mgt\n * @param chatId the id of the chat to load\n * @returns {Promise<Chat>}\n */\nexport const loadChat = async (graph: IGraph, chatId: string): Promise<Chat> =>\n  (await graph\n    .api(`/chats/${chatId}?$expand=members`)\n    .middlewareOptions(prepScopes(...chatOperationScopes.loadChat))\n    .get()) as Chat;\n\n/**\n * Load the specified chat from graph with the members and last message expanded\n *\n * @param graph authenticated graph client from mgt\n * @param chatId the id of the chat to load\n * @returns {Promise<Chat>}\n */\nexport const loadChatWithPreview = async (graph: IGraph, chatId: string): Promise<Chat> =>\n  (await graph\n    .api(`/chats/${chatId}?$expand=members,lastMessagePreview`)\n    .middlewareOptions(prepScopes(...chatOperationScopes.loadChat))\n    .get()) as Chat;\n\n/**\n * Load the first page of messages from the specified chat\n * Will provide a nextLink to load more messages if there are more than the specified messageCount\n *\n * @param graph authenticated graph client from mgt\n * @param chatId the id of the chat to load messages from\n * @param messageCount how many messages to load per page\n * @returns {Promise<MessageCollection>} a collection of messages and a possible nextLink to load more messages\n */\nexport const loadChatThread = async (\n  graph: IGraph,\n  chatId: string,\n  messageCount: number\n): Promise<MessageCollection> => {\n  const response = (await graph\n    .api(`/chats/${chatId}/messages`)\n    .orderby('createdDateTime DESC')\n    .top(messageCount)\n    .middlewareOptions(prepScopes(...chatOperationScopes.loadChatMessages))\n    .get()) as MessageCollection;\n  // split the nextLink on version to maintain a relative path\n  response.nextLink = response['@odata.nextLink']?.split(graph.version)[1];\n  return response;\n};\n\n/**\n * Load the first page of messages from the specified chat which were modified after the specified timestamp\n * Will provide a nextLink to load more messages if there are more than the specified messageCount\n *\n * @param graph authenticated graph client from mgt\n * @param chatId the id of the chat to load messages from\n * @param lastModified the ISO 8601 timestamp after which data should be loaded from.\n * @param messageCount how many messages to load per page\n * @returns {Promise<MessageCollection>} a collection of messages and a possible nextLink to load more messages\n */\nexport const loadChatThreadDelta = async (\n  graph: IGraph,\n  chatId: string,\n  lastModified: string,\n  messageCount: number\n): Promise<MessageCollection> => {\n  const response = (await graph\n    .api(`/chats/${chatId}/messages`)\n    .filter(`lastModifiedDateTime gt ${lastModified}`)\n    .orderby('lastModifiedDateTime DESC')\n    .top(messageCount)\n    .middlewareOptions(prepScopes(...chatOperationScopes.loadChatMessages))\n    .get()) as MessageCollection;\n  // split the nextLink on version to maintain a relative path\n  response.nextLink = response['@odata.nextLink']?.split(graph.version)[1];\n  return response;\n};\n\n/**\n * Loads another page of messages from the specified chat\n *\n * @param graph authenticated graph client from mgt\n * @param nextLink the nextLink to load more messages from\n * @returns {Promise<MessageCollection>} a collection of messages and a possible nextLink to load more messages\n */\nexport const loadMoreChatMessages = async (graph: IGraph, nextLink: string): Promise<MessageCollection> => {\n  // not defining scopes here because this uses a nextLink and the initial request ensures the required scopes are present\n  const response = (await graph.api(nextLink).get()) as MessageCollection;\n  // split the nextLink on version to maintain a relative path\n  response.nextLink = response['@odata.nextLink']?.split(graph.version)[1];\n  return response;\n};\n\nexport const loadAppsInChat = async (graph: IGraph, chatId: string): Promise<AppCollection> => {\n  const response = (await graph\n    .api(`/chats/${chatId}/installedApps`)\n    .expand('teamsAppDefinition($expand=bot)')\n    .middlewareOptions(prepScopes(...chatOperationScopes.loadAppsInChat))\n    .get()) as AppCollection;\n  return response;\n};\n\n/**\n * Creates a new chat message via HTTP POST\n *\n * @param graph authenticated graph client from mgt\n * @param chatId id of the chat to send the message to\n * @param content content of the message to send\n * @returns {Promise<ChatMessage>} the newly created message\n */\nexport const sendChatMessage = async (graph: IGraph, chatId: string, content: string): Promise<ChatMessage> => {\n  // TODO: remove this code that lets me simulate a failure during debugging\n  // let fail = false;\n\n  // debugger;\n  // if (fail) throw new Error('fail');\n\n  return (await graph\n    .api(`/chats/${chatId}/messages`)\n    .middlewareOptions(prepScopes(...chatOperationScopes.sendChatMessage))\n    .post({ body: { content } })) as ChatMessage;\n};\n\n/**\n * Updates a chat message via HTTP PATCH\n *\n * @param graph authenticated graph client from mgt\n * @param chatId the id of the chat containing the message to update\n * @param messageId the id of the message to update\n * @param content the new content of the message\n * @returns {Promise<void>}\n */\nexport const updateChatMessage = async (\n  graph: IGraph,\n  chatId: string,\n  messageId: string,\n  content: string\n): Promise<void> => {\n  // TODO: remove this code that lets me simulate a failure during debugging\n  // let fail = false;\n\n  // debugger;\n  // if (fail) throw new Error('fail');\n\n  await graph\n    .api(`/chats/${chatId}/messages/${messageId}`)\n    .middlewareOptions(prepScopes(...chatOperationScopes.updateChatMessage))\n    .patch({ body: { content } });\n};\n\n/**\n * Deletes a chat message via HTTP POST to the softDelete action\n *\n * @param graph authenticated graph client from mgt\n * @param chatId the id of the chat containing the message to delete\n * @param messageId the id of the message to delete\n * @returns {Promise<void>}\n */\nexport const deleteChatMessage = async (graph: IGraph, chatId: string, messageId: string): Promise<void> => {\n  await graph\n    .api(`/me/chats/${chatId}/messages/${messageId}/softDelete`)\n    .middlewareOptions(prepScopes(...chatOperationScopes.deleteChatMessage))\n    .post({});\n};\n\nexport const removeChatMember = async (graph: IGraph, chatId: string, membershipId: string): Promise<void> => {\n  await graph\n    .api(`/chats/${chatId}/members/${membershipId}`)\n    .middlewareOptions(prepScopes(...chatOperationScopes.removeChatMember))\n    .delete();\n};\n\nexport const addChatMembers = async (\n  graph: IGraph,\n  chatId: string,\n  userIds: string[],\n  visibleHistoryStartDateTime?: Date\n): Promise<void> => {\n  const body = {\n    requests: userIds.map((userId: string, index: number) => {\n      const addRequestBody: AadUserConversationMember & { '@odata.type': string; 'user@odata.bind': string } = {\n        '@odata.type': '#microsoft.graph.aadUserConversationMember',\n        'user@odata.bind': `https://graph.microsoft.com/v1.0/users/${userId}`,\n        roles: ['owner']\n      };\n      if (visibleHistoryStartDateTime) {\n        addRequestBody.visibleHistoryStartDateTime = visibleHistoryStartDateTime.toISOString();\n      }\n      return {\n        id: index,\n        method: 'POST',\n        url: `/chats/${chatId}/members`,\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: addRequestBody\n      };\n    })\n  };\n\n  await graph\n    .api('$batch')\n    .middlewareOptions(prepScopes(...chatOperationScopes.addChatMember))\n    .post(body);\n};\n/**\n * Whether or not the cache is enabled\n */\nexport const isPhotoCacheEnabled = (): boolean => CacheService.config.photos.isEnabled && CacheService.config.isEnabled;\n\nexport const loadChatImage = async (graph: IGraph, url: string): Promise<string | null> => {\n  let cachedPhoto: CachePhoto | null;\n\n  // attempt to get user and photo from cache if enabled\n  if (isPhotoCacheEnabled()) {\n    const cache = CacheService.getCache<CachePhoto>(schemas.photos, schemas.photos.stores.teams);\n    cachedPhoto = await cache.getValue(url);\n    if (\n      cachedPhoto?.timeCached &&\n      cachedPhoto.photo &&\n      getPhotoInvalidationTime() > Date.now() - cachedPhoto.timeCached\n    ) {\n      return cachedPhoto.photo;\n    }\n  }\n  const response = (await graph\n    .api(url)\n    .responseType(ResponseType.RAW)\n    .middlewareOptions(prepScopes(...chatOperationScopes.loadChatImage))\n    .get()) as Response & { '@odata.mediaEtag'?: string };\n\n  if (response.status === 404) {\n    // 404 means the resource does not have a photo\n    // we still want to cache that state\n    // so we return an object that can be cached\n    cachedPhoto = { eTag: undefined, photo: undefined };\n  } else if (!response.ok) {\n    return null;\n  }\n\n  const eTag = response['@odata.mediaEtag'];\n  const blob = await blobToBase64(await response.blob());\n\n  cachedPhoto = { eTag, photo: blob };\n  await storePhotoInCache(url, schemas.photos.stores.teams, cachedPhoto);\n  return blob;\n};\n\n/**\n * Creates a new chat thread via HTTP POST\n *\n * @param graph authenticated graph client from mgt\n * @param memberIds array of the user ids of users to be members of the chat. Must be at least 2.\n * @param isGroupChat if true a group chat will be created, otherwise a 1:1 chat will be created. Must be true if there are more than 2 members.\n * @param chatMessage if provided a message with this content will be sent to the chat after creation\n * @param chatName if provided and there are more than 2 members the topic of the chat will be set to this value\n * @returns {Promise<Chat>} the newly created chat\n */\nexport const createChatThread = async (\n  graph: IGraph,\n  memberIds: string[],\n  isGroupChat: boolean,\n  chatMessage: string | undefined,\n  chatName: string | undefined\n): Promise<Chat> => {\n  const body: Chat = {\n    chatType: isGroupChat || memberIds.length > 2 ? 'group' : 'oneOnOne',\n    members: memberIds.map(id => {\n      return {\n        '@odata.type': '#microsoft.graph.aadUserConversationMember',\n        roles: ['owner'],\n        'user@odata.bind': `https://graph.microsoft.com/v1.0/users('${id}')`\n      };\n    })\n  };\n  if (isGroupChat && chatName) body.topic = chatName;\n\n  const chat = (await graph\n    .api('/chats')\n    .middlewareOptions(prepScopes(...chatOperationScopes.createChat))\n    .post(body)) as Chat;\n  if (!chat?.id) throw new Error('Chat id not returned from create chat thread');\n  if (chatMessage) {\n    await sendChatMessage(graph, chat.id, chatMessage);\n  }\n\n  return chat;\n};\n\n/**\n * Updates the topic of a chat via HTTP PATCH\n *\n * @param graph {IGraph} - authenticated graph client from mgt\n * @param chatId {string} - id of the chat to update\n * @param topic {string | null} - new value for the chat topic, null will remove the currently set topic\n */\nexport const updateChatTopic = async (graph: IGraph, chatId: string, topic: string | null): Promise<void> => {\n  await graph\n    .api(`/chats/${chatId}`)\n    .middlewareOptions(prepScopes(...chatOperationScopes.updateChatMessage))\n    .patch({ topic });\n};\n\n/**\n * Load the chat threads from graph with the members and last message expanded\n *\n * @param graph authenticated graph client from mgt\n * @returns {Promise<GraphChat>}\n */\nexport const loadChatThreads = async (graph: IGraph, maxPage: number): Promise<ChatThreadCollection> =>\n  (await graph\n    .api(`me/chats?$top=${maxPage}&$expand=members,lastMessagePreview&orderby=lastMessagePreview/createdDateTime desc`)\n    .middlewareOptions(prepScopes(...chatOperationScopes.loadChat))\n    .get()) as ChatThreadCollection;\n\n/**\n * Load the chat threads from graph with the members and last message expanded by next page link.\n *\n * @param graph authenticated graph client from mgt\n * @returns {Promise<GraphChat>}\n */\nexport const loadChatThreadsByPage = async (graph: IGraph, filter: string): Promise<ChatThreadCollection> =>\n  (await graph\n    .api(`me/chats?${filter}`)\n    .middlewareOptions(prepScopes(...chatOperationScopes.loadChat))\n    .get()) as ChatThreadCollection;\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nexport const updateMessageContentWithImage = (\n  content: string,\n  index: string,\n  messageId: string,\n  image: string\n): string => {\n  const imageId = `${messageId}-${index}`;\n  const regex = new RegExp(`(<img[^>]+id=[\"']${imageId}[\"'][^>]+)src=[\"']([^\"']*)[\"']`);\n  const replacement = `$1src=\"${image}\"`;\n  const replaced = content.replace(regex, replacement);\n  return replaced;\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { ChatMessage, Message } from '@azure/communication-react';\nimport { GraphChatMessage } from 'src/statefulClient/StatefulGraphChatClient';\n\n/**\n * A typeguard to get the ChatMessage type\n * @param msg of Message\n * @returns ChatMessage\n */\nexport const isChatMessage = (msg: Message): msg is ChatMessage => {\n  return 'content' in msg;\n};\n\n/**\n * A typeguard to get the GraphChatMessage type\n * @param msg of Message\n * @returns GraphChatMessage\n */\nexport const isGraphChatMessage = (msg: Message): msg is GraphChatMessage => {\n  return 'content' in msg && 'hasUnsupportedContent' in msg && 'rawChatUrl' in msg;\n};\n\n/**\n * States of a chat.\n */\nexport type GraphChatClientStatus =\n  | 'initial'\n  | 'creating server connections'\n  | 'subscribing to notifications'\n  | 'loading messages'\n  | 'no chat id'\n  | 'no messages'\n  | 'ready'\n  | 'error';\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport {\n  ChatMessage as AcsChatMessage,\n  ContentSystemMessage,\n  Message,\n  MessageThreadProps,\n  SendBoxProps,\n  SystemMessage\n} from '@azure/communication-react';\nimport { IDynamicPerson, getUserWithPhoto } from '@microsoft/mgt-components';\nimport {\n  ActiveAccountChanged,\n  IGraph,\n  LoginChangedEvent,\n  ProviderState,\n  Providers,\n  error,\n  log,\n  warn\n} from '@microsoft/mgt-element';\nimport {\n  AadUserConversationMember,\n  Chat,\n  ChatMessage,\n  ChatMessageAttachment,\n  ChatRenamedEventMessageDetail,\n  MembersAddedEventMessageDetail,\n  MembersDeletedEventMessageDetail,\n  ChatMessageMention,\n  NullableOption\n} from '@microsoft/microsoft-graph-types';\nimport { produce } from 'immer';\nimport { v4 as uuid } from 'uuid';\nimport { currentUserId, currentUserName } from '../utils/currentUser';\nimport { graph } from '../utils/graph';\nimport { MessageCache } from './Caching/MessageCache';\nimport { GraphConfig } from './GraphConfig';\nimport { GraphNotificationClient } from './GraphNotificationClient';\nimport { ThreadEventEmitter } from './ThreadEventEmitter';\nimport {\n  MessageCollection,\n  addChatMembers,\n  deleteChatMessage,\n  loadChat,\n  loadChatImage,\n  loadChatThread,\n  loadChatThreadDelta,\n  loadMoreChatMessages,\n  removeChatMember,\n  sendChatMessage,\n  updateChatMessage,\n  updateChatTopic\n} from './graph.chat';\nimport { updateMessageContentWithImage } from '../utils/updateMessageContentWithImage';\nimport { GraphChatClientStatus, isChatMessage } from '../utils/types';\nimport { rewriteEmojiContentToHTML } from '../utils/rewriteEmojiContent';\n\n// 1x1 grey pixel\nconst placeholderImageContent =\n  'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAMSURBVBhXY7h58yYABRoCjB9qX5UAAAAASUVORK5CYII=';\n\ninterface ODataType {\n  '@odata.type': MessageEventType;\n}\ntype MembersAddedEventDetail = ODataType &\n  MembersAddedEventMessageDetail & {\n    '@odata.type': '#microsoft.graph.membersAddedEventMessageDetail';\n  };\ntype MembersRemovedEventDetail = ODataType &\n  MembersDeletedEventMessageDetail & {\n    '@odata.type': '#microsoft.graph.membersDeletedEventMessageDetail';\n  };\ntype ChatRenamedEventDetail = ODataType &\n  ChatRenamedEventMessageDetail & {\n    '@odata.type': '#microsoft.graph.chatRenamedEventMessageDetail';\n  };\n\ntype ChatMessageEvents = MembersAddedEventDetail | MembersRemovedEventDetail | ChatRenamedEventDetail;\n\nconst isChatMemberChangeEvent = (\n  eventDetail: unknown\n): eventDetail is MembersDeletedEventMessageDetail | MembersAddedEventMessageDetail => {\n  return (\n    typeof (eventDetail as MembersDeletedEventMessageDetail | MembersAddedEventMessageDetail)?.members !== 'undefined'\n  );\n};\n\n// defines the type of the state object returned from the StatefulGraphChatClient\nexport type GraphChatClient = Pick<\n  MessageThreadProps,\n  | 'userId'\n  | 'messages'\n  | 'participantCount'\n  | 'disableEditing'\n  | 'onLoadPreviousChatMessages'\n  | 'numberOfChatMessagesToReload'\n  | 'onUpdateMessage'\n  | 'onDeleteMessage'\n> &\n  Pick<SendBoxProps, 'onSendMessage'> & {\n    status: GraphChatClientStatus;\n    chat?: Chat;\n  } & {\n    participants: AadUserConversationMember[];\n    onAddChatMembers: (userIds: string[], history?: Date) => Promise<void>;\n    onRemoveChatMember: (membershipId: string) => Promise<void>;\n    onRenameChat: (topic: string | null) => Promise<void>;\n    mentions: NullableOption<ChatMessageMention[]>;\n    activeErrorMessages: Error[];\n  };\n\ninterface StatefulClient<T> {\n  /**\n   * Get the current state of the client\n   */\n  getState(): T;\n  /**\n   * Register a callback to receive state updates\n   *\n   * @param handler Callback to receive state updates\n   */\n  onStateChange(handler: (state: T) => void): void;\n  /**\n   * Remove a callback from receiving state updates\n   *\n   * @param handler Callback to be unregistered\n   */\n  offStateChange(handler: (state: T) => void): void;\n}\n\ninterface CreatedOn {\n  createdOn: Date;\n}\n\n/**\n * Simple object comparator function for sorting by createdOn date\n *\n * @param {CreatedOn} a\n * @param {CreatedOn} b\n */\nconst MessageCreatedComparator = (a: CreatedOn, b: CreatedOn) => a.createdOn.getTime() - b.createdOn.getTime();\n\nconst ChatMessageCreatedComparator = (a: ChatMessage, b: ChatMessage): number => {\n  if (a.createdDateTime && b.createdDateTime) {\n    if (a.createdDateTime === b.createdDateTime) return 0;\n    if (a.createdDateTime > b.createdDateTime) return 1;\n    return -1;\n  } else if (a.createdDateTime) {\n    return 1;\n  }\n  return -1;\n};\n\ntype MessageEventType =\n  | '#microsoft.graph.membersAddedEventMessageDetail'\n  | '#microsoft.graph.membersDeletedEventMessageDetail'\n  | '#microsoft.graph.chatRenamedEventMessageDetail';\n\n/**\n * Extended Message type with additional properties.\n */\nexport type GraphChatMessage = Message & {\n  hasUnsupportedContent: boolean;\n  rawChatUrl: string;\n};\n/**\n * Holder type account for async conversion of messages.\n * Some messages need to be written to the UI immediately and receive an async update.\n * Some messages do not have a current value and will be added after the future value is resolved.\n * Some messages do not have a future value and will be added immediately.\n */\ninterface MessageConversion {\n  currentValue?: GraphChatMessage;\n  futureValue?: Promise<GraphChatMessage>;\n}\n\n/**\n * Regex to detect and replace image urls using graph requests to supply the image content\n */\nconst graphImageUrlRegex = /(<img[^>]+)src=([\"']https:\\/\\/graph\\.microsoft\\.com[^\"']*[\"'])/;\n\nclass StatefulGraphChatClient implements StatefulClient<GraphChatClient> {\n  private readonly _eventEmitter: ThreadEventEmitter;\n  private readonly _cache: MessageCache;\n  private _graph: IGraph = Providers.globalProvider.graph;\n  private _notificationClient: GraphNotificationClient;\n  private _subscribers: ((state: GraphChatClient) => void)[] = [];\n  private get _messagesPerCall() {\n    return 5;\n  }\n  private _nextLink?: string;\n  private _chat?: Chat = undefined;\n  private _userDisplayName = '';\n\n  constructor() {\n    this.updateUserInfo();\n    Providers.globalProvider.onStateChanged(this.onLoginStateChanged);\n    Providers.globalProvider.onActiveAccountChanged(this.onActiveAccountChanged);\n    this._eventEmitter = new ThreadEventEmitter();\n    this.registerEventListeners();\n    this._notificationClient = new GraphNotificationClient(this._eventEmitter, this._graph);\n    this._cache = new MessageCache();\n  }\n\n  /**\n   * Updates the provider graph SDK client and the notification client. By now,\n   * an assumption is made that the Providers.globalProvider.graph is available\n   * and won't throw a TypeError when you access graph.forComponent.\n   */\n  private updateGraphNotificationClient() {\n    this._graph = graph('mgt-chat', GraphConfig.version);\n    this._notificationClient = new GraphNotificationClient(this._eventEmitter, this.graph);\n  }\n\n  /**\n   * Provides a method to clean up any resources being used internally when a consuming component is being removed from the DOM\n   */\n  public async tearDown() {\n    await this._notificationClient?.tearDown();\n  }\n\n  /**\n   * Register a callback to receive state updates\n   *\n   * @param {(state: GraphChatClient) => void} handler\n   * @memberof StatefulGraphChatClient\n   */\n  public onStateChange(handler: (state: GraphChatClient) => void): void {\n    if (!this._subscribers.includes(handler)) {\n      this._subscribers.push(handler);\n    }\n  }\n\n  /**\n   * Unregister a callback from receiving state updates\n   *\n   * @param {(state: GraphChatClient) => void} handler\n   * @memberof StatefulGraphChatClient\n   */\n  public offStateChange(handler: (state: GraphChatClient) => void): void {\n    const index = this._subscribers.indexOf(handler);\n    if (index !== -1) {\n      this._subscribers = this._subscribers.splice(index, 1);\n    }\n  }\n\n  /**\n   * Calls each subscriber with the next state to be emitted\n   *\n   * @param recipe - a function which produces the next state to be emitted\n   */\n  private notifyStateChange(recipe: (draft: GraphChatClient) => void) {\n    this._state = produce(this._state, recipe);\n    this._subscribers.forEach(handler => handler(this._state));\n  }\n\n  /**\n   * Return the current state of the chat client\n   *\n   * @return {{GraphChatClient}\n   * @memberof StatefulGraphChatClient\n   */\n  public getState(): GraphChatClient {\n    return this._state;\n  }\n\n  /**\n   * Update the state of the client when the Login state changes\n   *\n   * @private\n   * @param {LoginChangedEvent} e The event that triggered the change\n   * @memberof StatefulGraphChatClient\n   */\n  private readonly onLoginStateChanged = (e: LoginChangedEvent) => {\n    switch (e.detail) {\n      case ProviderState.SignedIn:\n        // update userId and displayName\n        this.updateUserInfo();\n        this.updateGraphNotificationClient();\n        // load messages?\n        // configure subscriptions\n        // emit new state;\n        if (this.chatId) {\n          void this.updateFollowedChat();\n        }\n        return;\n      case ProviderState.SignedOut:\n        // clear userId\n        // clear subscriptions\n        // clear messages\n        // emit new state\n        return;\n      case ProviderState.Loading:\n      default:\n        // do nothing for now\n        return;\n    }\n  };\n\n  private readonly onActiveAccountChanged = (e: ActiveAccountChanged) => {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n    if (e.detail && this.userId !== e.detail?.id) {\n      void this.handleAccountChange();\n    }\n  };\n\n  private readonly handleAccountChange = async () => {\n    this.clearCurrentUserMessages();\n    // need to ensure that we close any existing connection if present\n    await this._notificationClient?.closeSignalRConnection();\n\n    this.updateUserInfo();\n    // by updating the followed chat the notification client will reconnect to SignalR\n    await this.updateFollowedChat();\n  };\n\n  private clearCurrentUserMessages() {\n    this.notifyStateChange((draft: GraphChatClient) => {\n      draft.messages = [];\n      draft.participants = [];\n      draft.chat = undefined;\n      draft.status = 'initial'; // no message?\n    });\n  }\n\n  private updateUserInfo() {\n    this.updateCurrentUserId();\n    this.updateCurrentUserName();\n  }\n\n  /**\n   * Changes the userDisplayName to the current value.\n   */\n  private updateCurrentUserName() {\n    this._userDisplayName = currentUserName();\n  }\n\n  /**\n   * Changes the current user ID value to the current value.\n   */\n  private updateCurrentUserId() {\n    this.userId = currentUserId();\n  }\n\n  /**\n   * Current User ID.\n   */\n  private _userId = '';\n\n  /**\n   * Returns the current User ID.\n   */\n  public get userId() {\n    return this._userId;\n  }\n\n  /**\n   * Sets the current User ID and updates the state value.\n   */\n  private set userId(userId: string) {\n    if (this._userId === userId) {\n      return;\n    }\n    this._userId = userId;\n    this.notifyStateChange((draft: GraphChatClient) => {\n      draft.userId = userId;\n    });\n  }\n\n  /**\n   * Current chat ID.\n   */\n  private _chatId = '';\n\n  /**\n   * Get the current chat ID.\n   */\n  public get chatId() {\n    return this._chatId;\n  }\n\n  /**\n   * Set the current chat ID and tries to get the chat data.\n   */\n  private set chatId(value: string) {\n    // take no action if the chatId is the same\n    if (value && this._chatId === value) {\n      return;\n    }\n    this._chatId = value;\n    if (this._chatId && this._sessionId) {\n      void this.updateFollowedChat();\n    }\n  }\n\n  private _sessionId: string | undefined;\n\n  public subscribeToChat(chatId: string, sessionId: string) {\n    if (chatId && sessionId) {\n      this._sessionId = sessionId;\n      this.chatId = chatId;\n    }\n  }\n\n  public setStatus(status: GraphChatClientStatus) {\n    this.notifyStateChange((draft: GraphChatClient) => {\n      draft.status = status;\n      draft.chat = { topic: 'Unknown' };\n    });\n  }\n\n  /**\n   * A helper to co-ordinate the loading of a chat and its messages, and the subscription to notifications for that chat\n   *\n   * @private\n   * @memberof StatefulGraphChatClient\n   */\n  private async updateFollowedChat() {\n    // avoid subscribing to a resource with an empty chatId\n    if (this.chatId && this._sessionId) {\n      // reset state to initial\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'initial';\n        draft.messages = [];\n        draft.mentions = [];\n        draft.chat = undefined;\n        draft.participants = [];\n        draft.activeErrorMessages = [];\n      });\n      // Subscribe to notifications for messages\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'creating server connections';\n      });\n      try {\n        // Prefer sequential promise resolving to catch loading message errors\n        // TODO: in parallel promise resolving, find out how to trigger different\n        // TODO: state for failed subscriptions in GraphChatClient.onSubscribeFailed\n        const tasks: Promise<unknown>[] = [this.loadChatData()];\n        // subscribing to notifications will trigger the chatMessageNotificationsSubscribed event\n        // this client will then load the chat and messages when that event listener is called\n        tasks.push(this._notificationClient.subscribeToChatNotifications(this._chatId, this._sessionId));\n        await Promise.all(tasks);\n      } catch (e) {\n        this.updateErrorState(e as Error);\n      }\n    } else {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'no chat id';\n        draft.chat = { topic: 'Unknown' };\n      });\n    }\n  }\n\n  private async loadChatData() {\n    this.notifyStateChange((draft: GraphChatClient) => {\n      draft.status = 'loading messages';\n    });\n    try {\n      this._chat = await loadChat(this.graph, this.chatId);\n    } catch (e) {\n      return Promise.reject(e);\n    }\n    const cachedMessages = await this._cache.loadMessages(this._chatId);\n    if (cachedMessages) {\n      // use currently cached data\n      await this.writeMessagesToState(cachedMessages);\n      // load delta messages\n      const deltaMessages = await this.loadDeltaData(this._chatId, cachedMessages.lastModifiedDateTime);\n      // add delta messages to cache\n      const updatedState = await this._cache.cacheMessages(this._chatId, deltaMessages);\n      // writeMessagesToState concats with existing state, need to be careful not to create duplicate messages\n      updatedState.value = deltaMessages;\n      // update state\n      await this.writeMessagesToState(updatedState);\n    } else {\n      const messages: MessageCollection = await loadChatThread(this.graph, this._chatId, this._messagesPerCall);\n      await this._cache.cacheMessages(this._chatId, messages.value, true, messages.nextLink);\n      await this.writeMessagesToState(messages);\n    }\n  }\n\n  private async loadDeltaData(chatId: string, lastModified: string): Promise<ChatMessage[]> {\n    const result: ChatMessage[] = [];\n    let response = await loadChatThreadDelta(this.graph, chatId, lastModified, this._messagesPerCall);\n    result.push(...response.value);\n    while (response.nextLink) {\n      response = await loadMoreChatMessages(this.graph, response.nextLink);\n      result.push(...response.value);\n    }\n    return result.sort(ChatMessageCreatedComparator);\n  }\n\n  /**\n   * Handles updating state based on the response to a graph request for a collection of messages\n   * Handles messages that can be imedately rendered and those that require async calls to fetch data\n   *\n   * @private\n   * @param {MessageCollection} messages\n   * @memberof StatefulGraphChatClient\n   */\n  private async writeMessagesToState(messages: MessageCollection) {\n    this._nextLink = messages.nextLink;\n\n    const messageConversions = messages.value\n      // trying to filter out messages on the graph request causes a 400\n      // deleted messages are returned as messages with no content, which we can't filter on the graph request\n      // so we filter them out here\n      .filter(m => m.body?.content)\n      // This gives us both current and eventual values for each message\n      .map(m => this.convertChatMessage(m));\n\n    // Collect mentions\n    const mentions: NullableOption<ChatMessageMention[]> = messages.value\n      .map(m => m.mentions)\n      .filter(m => m?.length) as NullableOption<ChatMessageMention[]>;\n\n    // update the state with the current values\n    this.notifyStateChange((draft: GraphChatClient) => {\n      draft.participants = this._chat?.members || [];\n      draft.participantCount = draft.participants.length;\n      const initialMessages: Message[] = [];\n      draft.messages = draft.messages\n        .concat(\n          messageConversions\n            .map(m => m.currentValue)\n            // need to use a reduce here to filter out undefined values in a way that TypeScript understands\n            .reduce((acc, val) => {\n              if (val) acc.push(val);\n              return acc;\n            }, initialMessages)\n        )\n        .sort(MessageCreatedComparator);\n      draft.onLoadPreviousChatMessages = this._nextLink ? this.loadMoreMessages : undefined;\n      draft.status = this._nextLink ? 'loading messages' : !draft.messages.length ? 'no messages' : 'ready';\n      draft.chat = this._chat;\n      // Keep updating if there was a next link.\n      draft.mentions = draft.mentions?.concat(\n        ...Array.from(mentions as Iterable<ChatMessageMention>)\n      ) as NullableOption<ChatMessageMention[]>;\n    });\n    const futureMessages = messageConversions.filter(m => m.futureValue).map(m => m.futureValue);\n    // if there are eventual future values, wait for them to resolve and update the state\n    if (futureMessages.length > 0) {\n      (await Promise.all(futureMessages)).forEach(m => {\n        this.updateMessages(m);\n      });\n    }\n  }\n\n  /**\n   * Utility to convert a Graph Chat Message to an ACS Chat Message\n   * Some graph chat messages can synchronously be converted to ACS chat messages\n   * Others require an async call to get the ACS chat message\n   * Some messages can provide an initial state for immediate rendering while the async call is in progress\n   * This method returns an object containing the current value and a Promise of a future value\n   *\n   * @private\n   * @param {ChatMessage} message\n   * @return {*}  {MessageConversion}\n   * @memberof StatefulGraphChatClient\n   */\n  private convertChatMessage(message: ChatMessage): MessageConversion {\n    switch (message.messageType) {\n      case 'message':\n        return this.graphChatMessageToAcsChatMessage(message, this.userId);\n      case 'systemEventMessage':\n      case 'unknownFutureValue':\n        return { futureValue: this.buildSystemContentMessage(message) } as MessageConversion;\n      default:\n        throw new Error(`Unknown message type ${message.messageType?.toString() || 'undefined'}`);\n    }\n  }\n\n  /**\n   * Convert an event type to the name of an icon registered in registerIcons.tsx\n   *\n   * @param eventType\n   * @returns\n   */\n  private readonly resolveIcon = (eventType: MessageEventType): string => {\n    switch (eventType) {\n      case '#microsoft.graph.membersAddedEventMessageDetail':\n        return 'add-friend';\n      case '#microsoft.graph.membersDeletedEventMessageDetail':\n        return 'left-chat';\n      case '#microsoft.graph.chatRenamedEventMessageDetail':\n        return 'edit-svg';\n      default:\n        return 'Unknown';\n    }\n  };\n\n  private async buildSystemContentMessage(message: ChatMessage): Promise<SystemMessage> {\n    const eventDetail = message.eventDetail as ChatMessageEvents;\n    let messageContent = '';\n    const awaits: Promise<IDynamicPerson>[] = [];\n    const initiatorId = eventDetail.initiator?.user?.id;\n    // we're using getUserWithPhoto here because we want to tap into the caching that mgt-person uses to cut down on graph calls\n    if (initiatorId) {\n      awaits.push(getUserWithPhoto(this.graph, initiatorId));\n      const userIds: string[] = [];\n      if (isChatMemberChangeEvent(eventDetail)) {\n        eventDetail.members?.reduce((acc, m) => {\n          if (typeof m.id === 'string') {\n            acc.push(m.id);\n          }\n          return acc;\n        }, userIds);\n      }\n      for (const id of userIds ?? []) {\n        awaits.push(getUserWithPhoto(this.graph, id));\n      }\n      const people = await Promise.all(awaits);\n      const userNames = userIds\n        ?.filter(id => id !== initiatorId)\n        .map(m => this.getUserName(m, people))\n        .join(', ');\n      const initiatorUsername = this.getUserName(initiatorId, people);\n      switch (eventDetail['@odata.type']) {\n        case '#microsoft.graph.membersAddedEventMessageDetail':\n          messageContent = `${initiatorUsername} added ${userNames}`;\n          break;\n        case '#microsoft.graph.membersDeletedEventMessageDetail':\n          messageContent = `${initiatorUsername} removed ${userNames}`;\n          break;\n        case '#microsoft.graph.chatRenamedEventMessageDetail':\n          messageContent = eventDetail.chatDisplayName\n            ? `${initiatorUsername} renamed the chat to ${eventDetail.chatDisplayName}`\n            : `${initiatorUsername} removed the group name for this conversation`;\n          break;\n        // TODO: move this default case to a console.warn before release and emit an empty message\n        // it's here to help us catch messages we have't handled yet\n        default:\n          // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n          warn(`Unknown system message type ${eventDetail['@odata.type']}\n\ndetail: ${JSON.stringify(eventDetail)}`);\n      }\n    }\n\n    const result: ContentSystemMessage = {\n      createdOn: message.createdDateTime ? new Date(message.createdDateTime) : new Date(),\n      messageId: message.id || '',\n      systemMessageType: 'content',\n      messageType: 'system',\n      iconName: this.resolveIcon(eventDetail['@odata.type']),\n      content: messageContent\n    };\n\n    return result;\n  }\n\n  private getUserName(userId: string, people: IDynamicPerson[]) {\n    return people.find(p => p.id === userId)?.displayName || 'unknown user';\n  }\n\n  /**\n   * Async callback to load more messages\n   *\n   * @returns true if there are no more messages to load\n   */\n  private readonly loadMoreMessages = async () => {\n    if (!this._nextLink) {\n      return true;\n    }\n    const messages: MessageCollection = await loadMoreChatMessages(this.graph, this._nextLink);\n    await this._cache.cacheMessages(this._chatId, messages.value, true, messages.nextLink);\n    await this.writeMessagesToState(messages);\n    // return true when there are no more messages to load\n    return !this._nextLink;\n  };\n\n  /**\n   * Send a message to the chat thread\n   *\n   * @param {string} content - the content of the message\n   * @memberof StatefulGraphChatClient\n   */\n  public sendMessage = async (content: string) => {\n    if (!content) return;\n\n    const pendingId = uuid();\n\n    // add a pending message to the state.\n    this.notifyStateChange((draft: GraphChatClient) => {\n      const pendingMessage: Message = {\n        clientMessageId: pendingId,\n        messageId: pendingId,\n        contentType: 'text',\n        messageType: 'chat',\n        content,\n        senderDisplayName: this._userDisplayName,\n        createdOn: new Date(),\n        senderId: this.userId,\n        mine: true,\n        status: 'sending'\n      };\n      draft.messages.push(pendingMessage);\n    });\n    try {\n      // send message\n      const chat: ChatMessage = await sendChatMessage(this.graph, this.chatId, content);\n      // emit new state\n      this.notifyStateChange((draft: GraphChatClient) => {\n        const draftIndex = draft.messages.findIndex(m => m.messageId === pendingId);\n        const message = this.graphChatMessageToAcsChatMessage(chat, this.userId).currentValue;\n        // we only need use the current value of the message\n        // this message can't have a future value as it's not been sent yet\n        if (message) draft.messages.splice(draftIndex, 1, message);\n      });\n    } catch (e) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        const draftMessage = draft.messages.find(m => m.messageId === pendingId);\n        (draftMessage as AcsChatMessage).status = 'failed';\n      });\n      throw new Error('Failed to send message');\n    }\n  };\n\n  /*\n   * Helper method to set the content of a message to show deletion\n   */\n  private readonly setDeletedContent = (message: AcsChatMessage) => {\n    message.content = '<em>This message has been deleted.</em>';\n    message.contentType = 'html';\n  };\n\n  /**\n   * Handler to delete a message\n   *\n   * @param messageId id of the message to be deleted, this is the clientMessageId when triggered by the re-send action on a failed message, or the messageId when triggered by the delete action on a sent message\n   * @returns {Promise<void>}\n   */\n  public deleteMessage = async (messageId: string): Promise<void> => {\n    if (!messageId) return;\n    const message = this._state.messages.find(m => m.messageId === messageId) as AcsChatMessage;\n    // only messages not persisted to graph should have a clientMessageId\n    const uncommitted = this._state.messages.find(\n      m => (m as AcsChatMessage).clientMessageId === messageId\n    ) as AcsChatMessage;\n    if (message?.mine) {\n      try {\n        // uncommitted messages are not persisted to the graph, so don't call graph when deleting them\n        if (!uncommitted) {\n          await deleteChatMessage(this.graph, this.chatId, messageId);\n        }\n        this.notifyStateChange((draft: GraphChatClient) => {\n          const draftMessage = draft.messages.find(m => m.messageId === messageId) as AcsChatMessage;\n          if (draftMessage.clientMessageId) {\n            // just remove messages that were not saved to the graph\n            draft.messages.splice(draft.messages.indexOf(draftMessage), 1);\n          } else {\n            // show deleted messages which have been persisted to the graph as deleted in the UI\n            this.setDeletedContent(draftMessage);\n          }\n        });\n      } catch (e) {\n        // TODO: How do we handle failed deletes?\n      }\n    }\n  };\n\n  /**\n   * Update a message in the thread\n   *\n   * @param {string} messageId Id of the message to be updated\n   * @param {string} content new content of the message\n   * @memberof StatefulGraphChatClient\n   */\n  public updateMessage = async (messageId: string, content: string) => {\n    if (!messageId || !content) return;\n    const message = this._state.messages.find(m => m.messageId === messageId) as AcsChatMessage;\n    if (message?.mine && message.content) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        const updating = draft.messages.find(m => m.messageId === messageId) as AcsChatMessage;\n        if (updating) {\n          updating.content = content;\n          updating.status = 'sending';\n        }\n      });\n      try {\n        await updateChatMessage(this.graph, this.chatId, messageId, content);\n        this.notifyStateChange((draft: GraphChatClient) => {\n          const updated = draft.messages.find(m => m.messageId === messageId) as AcsChatMessage;\n          updated.status = 'delivered';\n        });\n      } catch (e) {\n        this.notifyStateChange((draft: GraphChatClient) => {\n          const updating = draft.messages.find(m => m.messageId === messageId) as AcsChatMessage;\n          updating.status = 'failed';\n        });\n        throw new Error('Failed to update message');\n      }\n    }\n  };\n\n  /*\n   * Event handler to be called when a new message is received by the notification service\n   */\n  private readonly onMessageReceived = async (message: ChatMessage) => {\n    this.updateMentions(message);\n    await this._cache.cacheMessage(this._chatId, message);\n    const messageConversion = this.convertChatMessage(message);\n    const acsMessage = messageConversion.currentValue;\n    this.updateMessages(acsMessage);\n    if (messageConversion.futureValue) {\n      // if we have a future value then we need to wait for it to resolve before we can send the read receipt\n      const futureMessageState = await messageConversion.futureValue;\n      this.updateMessages(futureMessageState);\n    }\n  };\n\n  /**\n   * When you receive a new message, check if there are any mentions and update\n   * the state. This will allow to match users to mentions them during rendering.\n   *\n   * @param newMessage from teams.\n   * @returns\n   */\n  private readonly updateMentions = (newMessage: ChatMessage) => {\n    if (!newMessage) return;\n    this.notifyStateChange((draft: GraphChatClient) => {\n      const mentions = newMessage?.mentions ?? [];\n      draft.mentions = draft.mentions?.concat(\n        ...Array.from(mentions as Iterable<ChatMessageMention>)\n      ) as NullableOption<ChatMessageMention[]>;\n    });\n  };\n\n  /*\n   * Event handler to be called when a message deletion is received by the notification service\n   */\n  private readonly onMessageDeleted = (message: ChatMessage) => {\n    void this._cache.deleteMessage(this.chatId, message);\n    this.notifyStateChange((draft: GraphChatClient) => {\n      const draftMessage = draft.messages.find(m => m.messageId === message.id) as AcsChatMessage;\n      // TODO: confirm if we should show the deleted content message in all cases or only when the message was deleted by the current user\n      if (draftMessage) this.setDeletedContent(draftMessage);\n    });\n  };\n\n  /*\n   * Event handler to be called when a message edit is received by the notification service\n   */\n  private readonly onMessageEdited = async (message: ChatMessage) => {\n    await this._cache.cacheMessage(this._chatId, message);\n    const messageConversion = this.convertChatMessage(message);\n    this.updateMessages(messageConversion.currentValue);\n    if (messageConversion.futureValue) {\n      const eventualState = await messageConversion.futureValue;\n      this.updateMessages(eventualState);\n    }\n  };\n\n  private readonly checkForMissedMessages = async () => {\n    const messages: MessageCollection = await loadChatThread(this.graph, this.chatId, this._messagesPerCall);\n    const messageConversions = messages.value\n      // trying to filter out messages on the graph request causes a 400\n      // deleted messages are returned as messages with no content, which we can't filter on the graph request\n      // so we filter them out here\n      // Violating DLP returns content as empty BUT with policyViolation set\n      .filter(m => m.body?.content || (!m.body?.content && m?.policyViolation))\n      // This gives us both current and eventual values for each message\n      .map(m => this.convertChatMessage(m));\n\n    // update the state with the current values\n    const currentValueMessages: GraphChatMessage[] = [];\n    messageConversions\n      .map(m => m.currentValue)\n      // need to use a reduce here to filter out undefined values in a way that TypeScript understands\n      .reduce((acc, val) => {\n        if (val) acc.push(val);\n        return acc;\n      }, currentValueMessages);\n    currentValueMessages.forEach(m => this.updateMessages(m));\n    const futureMessages = messageConversions.filter(m => m.futureValue).map(m => m.futureValue);\n    // if there are eventual future values, wait for them to resolve and update the state\n    if (futureMessages.length > 0) {\n      (await Promise.all(futureMessages)).forEach(m => {\n        this.updateMessages(m);\n      });\n    }\n    const hasOverlapWithExistingMessages = messages.value.some(m =>\n      this._state.messages.find(sm => sm.messageId === m.id)\n    );\n    if (!hasOverlapWithExistingMessages) {\n      // TODO handle the case where there were a lot of missed messages and we ned to get the next page of messages.\n      // This is not a common case, but we should handle it.\n    }\n    log('checked for missed messages');\n  };\n\n  private readonly onChatNotificationsSubscribed = (resource: string): void => {\n    if (resource.includes(`/${this.chatId}/`) && resource.includes('/messages')) {\n      void this.checkForMissedMessages();\n    } else {\n      // better clean this up as we don't want to be listening to events for other chats\n    }\n  };\n\n  private readonly onChatPropertiesUpdated = (chat: Chat): void => {\n    this._chat = chat;\n    this.notifyStateChange((draft: GraphChatClient) => {\n      draft.chat = chat;\n    });\n  };\n\n  private readonly onParticipantAdded = (added: AadUserConversationMember): void => {\n    this.notifyStateChange((draft: GraphChatClient) => {\n      if (!draft.participants.find(p => p.id === added.id)) {\n        draft.participants.push(added);\n      }\n    });\n  };\n\n  private readonly onParticipantRemoved = (added: AadUserConversationMember): void => {\n    if (added.id) this.removeParticipantFromState(added.id);\n  };\n\n  /**\n   * Update the state with given message either replacing an existing message matching on the id or adding to the list\n   *\n   * @private\n   * @param {(GraphChatMessage)} [message]\n   * @return {*}\n   * @memberof StatefulGraphChatClient\n   */\n  private updateMessages(message?: GraphChatMessage) {\n    if (!message) return;\n    this.notifyStateChange((draft: GraphChatClient) => {\n      const index = draft.messages.findIndex(m => m.messageId === message.messageId);\n      // this message is not already in thread so just add it\n      if (index === -1) {\n        // sort to ensure that messages are in the correct order should we get messages out of order\n        draft.messages = draft.messages.concat(message).sort(MessageCreatedComparator);\n      } else {\n        // replace the existing version of the message with the new one\n        draft.messages.splice(index, 1, message);\n      }\n    });\n  }\n\n  private removeParticipantFromState(membershipId: string): void {\n    this.notifyStateChange((draft: GraphChatClient) => {\n      const index = draft.participants.findIndex(p => p.id === membershipId);\n      if (index !== -1) {\n        draft.participants.splice(index, 1);\n      }\n    });\n  }\n\n  private readonly addChatMembers = async (userIds: string[], history?: Date): Promise<void> => {\n    await addChatMembers(this.graph, this.chatId, userIds, history);\n  };\n\n  /**\n   * Removes the given member from the chat\n   *\n   * @param membershpId {string} id of the user for the chat,\n   * this is the id of the chat member resource in the graph, i.e. member.id, and NOT the user's id\n   * @returns {Promise<void>}\n   */\n  private readonly removeChatMember = async (membershpId: string): Promise<void> => {\n    if (!membershpId) return;\n    const isPresent = this._chat?.members?.findIndex(m => m.id === membershpId) ?? -1;\n    if (isPresent === -1) return;\n    await removeChatMember(this.graph, this.chatId, membershpId);\n    this.removeParticipantFromState(membershpId);\n  };\n\n  private graphImageMatch(messageContent: string): RegExpMatchArray | null {\n    return messageContent.match(graphImageUrlRegex);\n  }\n\n  private processMessageContent(graphMessage: ChatMessage, currentUser: string): MessageConversion {\n    const conversion: MessageConversion = {};\n    // using a record here lets us track which image in the content each request is for\n    const futureImages: Record<number, Promise<string | null>> = {};\n    let messageResult = graphMessage.body?.content ?? '';\n    const messageId = graphMessage.id ?? '';\n    let index = 0;\n    let match = this.graphImageMatch(messageResult);\n    while (match) {\n      // note that the regex to replace the placeholder requires that the id be before and adjacent to the src attribute\n      messageResult = messageResult.replace(\n        graphImageUrlRegex,\n        `$1id=\"${messageId}-${index}\" src=\"${placeholderImageContent}\"`\n      );\n      const graphImageUrl = match[2].replace(/[\"']/g, '');\n      // collect promises for the image requests so that we can update the message content once they are all resolved\n      futureImages[index] = loadChatImage(this.graph, graphImageUrl);\n      index++;\n      match = this.graphImageMatch(messageResult);\n    }\n    let placeholderMessage = this.buildAcsMessage(graphMessage, currentUser, messageId, messageResult);\n    conversion.currentValue = placeholderMessage;\n    // local function to update the message with data from each of the resolved image requests\n    const updateMessage = async () => {\n      await Promise.all(Object.values(futureImages));\n      for (const [imageIndex, futureImage] of Object.entries(futureImages)) {\n        const image = await futureImage;\n        if (image && isChatMessage(placeholderMessage)) {\n          placeholderMessage = {\n            ...placeholderMessage,\n            ...{\n              content: updateMessageContentWithImage(placeholderMessage.content ?? '', imageIndex, messageId, image)\n            }\n          };\n        }\n      }\n      return placeholderMessage;\n    };\n    conversion.futureValue = updateMessage();\n    return conversion;\n  }\n\n  private graphChatMessageToAcsChatMessage(graphMessage: ChatMessage, currentUser: string): MessageConversion {\n    const messageId = graphMessage?.id ?? '';\n    if (!messageId) {\n      throw new Error('Cannot convert graph message to ACS message. No ID found on graph message');\n    }\n    let content = graphMessage.body?.content ?? 'undefined';\n    let result: MessageConversion = {};\n    content = rewriteEmojiContentToHTML(content);\n    // Handle any mentions in the content\n    content = this.updateMentionsContent(content);\n\n    const imageMatch = this.graphImageMatch(content ?? '');\n    if (imageMatch) {\n      // if the message contains an image, we need to fetch the image and replace the placeholder\n      result = this.processMessageContent(graphMessage, currentUser);\n    } else {\n      result.currentValue = this.buildAcsMessage(graphMessage, currentUser, messageId, content);\n    }\n    return result;\n  }\n\n  /**\n   * Teams mentions are in the pattern <at id=\"1\">User</at>. This replacement\n   * changes the mentions pattern to <msft-mention id=\"1\">User</msft-mention>\n   * which will trigger the `mentionOptions` prop to be called in MessageThread.\n   *\n   * @param content is the message with mentions.\n   * @returns string with replaced mention parts.\n   */\n  private updateMentionsContent(content: string): string {\n    const msftMention = `<msft-mention id=\"$1\">$2</msft-mention>`;\n    const atRegex = /<at\\sid=\"(\\d+)\">([a-z0-9_.-\\s]+)<\\/at>/gim;\n    content = content\n      .replace(/&nbsp;<at/gim, '<at')\n      .replace(/at>&nbsp;/gim, 'at>')\n      .replace(atRegex, msftMention);\n    return content;\n  }\n\n  private hasUnsupportedContent(content: string, attachments: ChatMessageAttachment[]): boolean {\n    const unsupportedContentTypes = [\n      'application/vnd.microsoft.card.codesnippet',\n      'application/vnd.microsoft.card.fluid',\n      'application/vnd.microsoft.card.fluidEmbedCard',\n      'reference'\n    ];\n    const isUnsupported: boolean[] = [];\n\n    if (attachments.length) {\n      for (const attachment of attachments) {\n        const contentType = attachment?.contentType ?? '';\n        isUnsupported.push(unsupportedContentTypes.includes(contentType));\n      }\n    } else {\n      // checking content with <attachment> tags\n      const unsupportedContentRegex = /<\\/?attachment>/gim;\n      const contentUnsupported = Boolean(content) && unsupportedContentRegex.test(content);\n      isUnsupported.push(contentUnsupported);\n    }\n    return isUnsupported.every(e => e === true);\n  }\n\n  private buildAcsMessage(\n    graphMessage: ChatMessage,\n    currentUser: string,\n    messageId: string,\n    content: string\n  ): GraphChatMessage {\n    const senderId = graphMessage.from?.user?.id || undefined;\n    const chatId = graphMessage?.chatId ?? '';\n    const id = graphMessage?.id ?? '';\n    const chatUrl = `https://teams.microsoft.com/l/message/${chatId}/${id}?context={\"contextType\":\"chat\"}`;\n    const attachments = graphMessage?.attachments ?? [];\n\n    let messageData: GraphChatMessage = {\n      messageId,\n      contentType: graphMessage.body?.contentType ?? 'text',\n      messageType: 'chat',\n      content,\n      senderDisplayName: graphMessage.from?.user?.displayName ?? undefined,\n      createdOn: new Date(graphMessage.createdDateTime ?? Date.now()),\n      editedOn: graphMessage.lastEditedDateTime ? new Date(graphMessage.lastEditedDateTime) : undefined,\n      senderId,\n      mine: senderId === currentUser,\n      status: 'seen',\n      attached: 'top',\n      hasUnsupportedContent: this.hasUnsupportedContent(content, attachments),\n      rawChatUrl: chatUrl\n    };\n    if (graphMessage?.policyViolation) {\n      messageData = Object.assign(messageData, {\n        messageType: 'blocked',\n        link: 'https://go.microsoft.com/fwlink/?LinkId=2132837'\n      });\n    }\n    return messageData;\n  }\n\n  private readonly renameChat = async (topic: string | null): Promise<void> => {\n    await updateChatTopic(this.graph, this.chatId, topic);\n    this.notifyStateChange(() => void (this._chat = { ...this._chat, ...{ topic } }));\n  };\n\n  /**\n   * Register event listeners for chat events to be triggered from the notification service\n   */\n  private registerEventListeners() {\n    this._eventEmitter.on('chatMessageReceived', (message: ChatMessage) => void this.onMessageReceived(message));\n    this._eventEmitter.on('chatMessageDeleted', this.onMessageDeleted);\n    this._eventEmitter.on('chatMessageEdited', (message: ChatMessage) => void this.onMessageEdited(message));\n    this._eventEmitter.on('notificationsSubscribedForResource', this.onChatNotificationsSubscribed);\n    this._eventEmitter.on('chatThreadPropertiesUpdated', this.onChatPropertiesUpdated);\n    // TODO: add define how to handle chat deletion\n    // this._eventEmitter.on('chatThreadDeleted', this.onChatDeleted);\n    this._eventEmitter.on('participantAdded', this.onParticipantAdded);\n    this._eventEmitter.on('participantRemoved', this.onParticipantRemoved);\n    this._eventEmitter.on('graphNotificationClientError', this.onGraphNotificationClientError);\n  }\n\n  /**\n   * Handles the GraphNotificationClient emitted errors.\n   */\n  private readonly onGraphNotificationClientError = (e: Error) => {\n    this.updateErrorState(e);\n  };\n\n  /**\n   * Emits the error state to the stateful client.\n   */\n  private readonly updateErrorState = (e: Error) => {\n    if (e?.message) {\n      error(e?.message);\n    } else {\n      error('an unknown error occurred', e);\n    }\n    this.notifyStateChange((draft: GraphChatClient) => {\n      draft.status = 'error';\n      draft.activeErrorMessages = [e];\n      draft.chat = { topic: 'Unknown' };\n    });\n  };\n\n  /**\n   * Provided the graph instance for the component with the correct SDK version decoration\n   *\n   * @readonly\n   * @private\n   * @type {IGraph}\n   * @memberof StatefulGraphChatClient\n   */\n  private get graph(): IGraph {\n    return graph('mgt-chat');\n  }\n\n  private readonly _initialState: GraphChatClient = {\n    status: 'initial',\n    userId: '',\n    messages: [],\n    mentions: [],\n    participants: [],\n    get participantCount() {\n      return this.participants?.length || 0;\n    },\n    disableEditing: false,\n    numberOfChatMessagesToReload: this._messagesPerCall,\n    onDeleteMessage: this.deleteMessage,\n    onSendMessage: this.sendMessage,\n    onUpdateMessage: this.updateMessage,\n    onAddChatMembers: this.addChatMembers,\n    onRemoveChatMember: this.removeChatMember,\n    onRenameChat: this.renameChat,\n    activeErrorMessages: [],\n    chat: this._chat\n  };\n  /**\n   * State of the chat client with initial values set\n   *\n   * @private\n   * @type {GraphChatClient}\n   * @memberof StatefulGraphChatClient\n   */\n  private _state: GraphChatClient = { ...this._initialState };\n}\n\nexport { StatefulGraphChatClient };\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\n/**\n * Checks if DOM content has emojis and other HTML content.\n * @param dom the html content parsed into HTMLDocument.\n * @param emojisCount number of emojis in the content.\n * @returns true if only one emoji is in the content without other content, otherwise false.\n */\nconst hasOtherContent = (dom: Document, emojisCount: number): boolean => {\n  const isPtag = dom.body.firstChild?.nodeName === 'P';\n  if (isPtag) {\n    const firstChildNodes = dom.body.firstChild?.childNodes;\n    return firstChildNodes?.length !== emojisCount;\n  }\n  return false;\n};\n\n/**\n * Parses html content string into HTMLDocument, then replaces instances of the\n * emoji tag.\n * @param content the HTML string.\n * @returns HTML string with emoji tags changed to the HTML representation.\n */\nexport const rewriteEmojiContentToHTML = (content: string): string => {\n  const parser = new DOMParser();\n  const dom = parser.parseFromString(content, 'text/html');\n  const emojis = dom.querySelectorAll('emoji');\n  const emojisCount = emojis.length;\n  const size = emojisCount > 1 || hasOtherContent(dom, emojisCount) ? 20 : 50;\n\n  for (const emoji of emojis) {\n    const id = emoji.getAttribute('id') ?? '';\n    const alt = emoji.getAttribute('alt') ?? '';\n    const title = emoji.getAttribute('title') ?? '';\n\n    const span = document.createElement('span');\n    span.setAttribute('contentEditable', 'false');\n    span.setAttribute('title', title);\n    span.setAttribute('type', `(${id})`);\n    span.setAttribute('class', `animated-emoticon-${size}-cool`);\n\n    const img = document.createElement('img');\n    img.setAttribute('itemscope', '');\n    img.setAttribute('itemtype', 'http://schema.skype.com/Emoji');\n    img.setAttribute('itemid', id);\n\n    img.setAttribute(\n      'src',\n      `https://statics.teams.cdn.office.net/evergreen-assets/personal-expressions/v2/assets/emoticons/${id}/default/${size}_f.png`\n    );\n    img.setAttribute('title', title);\n    img.setAttribute('alt', alt);\n    img.setAttribute('style', `width:${size}px;height:${size}px;`);\n\n    span.appendChild(img);\n    emoji.replaceWith(span);\n  }\n  return dom.body.innerHTML;\n};\n\n/**\n * Regex to detect and extract emoji alt text\n *\n * Pattern breakdown:\n * (<emoji[^>]+): Captures the opening emoji tag, including any attributes.\n * alt=[\"'](\\w*[^\"']*)[\"']: Matches and captures the \"alt\" attribute value within single or double quotes. The value can contain word characters but not quotes.\n * (.[^>]): Captures any remaining text within the opening emoji tag, excluding the closing angle bracket.\n * ><\\/emoji>: Matches the remaining part of the tag.\n */\nconst emojiRegex = /(<emoji[^>]+)alt=[\"'](\\w*[^\"']*)[\"'](.[^>]+)><\\/emoji>/;\nconst emojiMatch = (messageContent: string): RegExpMatchArray | null => {\n  return messageContent.match(emojiRegex);\n};\n// iterative repave the emoji custom element with the content of the alt attribute\n// on the emoji element\nconst processEmojiContent = (messageContent: string): string => {\n  let result = messageContent;\n  let match = emojiMatch(result);\n  while (match) {\n    result = result.replace(emojiRegex, '$2');\n    match = emojiMatch(result);\n  }\n  return result;\n};\n\n/**\n * if the content contains an <emoji> tag with an alt attribute the content is replaced by replacing the emoji tags with the content of their alt attribute.\n * @param {string} content\n * @returns {string} the content with any emoji tags replaced by the content of their alt attribute.\n */\nexport const rewriteEmojiContentToText = (content: string): string =>\n  emojiMatch(content) ? processEmojiContent(content) : content;\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { useEffect, useState } from 'react';\nimport { v4 as uuid } from 'uuid';\nimport { StatefulGraphChatClient } from './StatefulGraphChatClient';\nimport { log } from '@microsoft/mgt-element';\n\n/**\n * The key name to use for storing the sessionId in session storage\n */\nconst keyName = 'mgt-chat-session-id';\n\n/**\n * reads a string from session storage, or if there is no string for the keyName, generate a new uuid and place in storage\n */\nconst getOrGenerateSessionId = () => {\n  const value = sessionStorage.getItem(keyName);\n\n  if (value) {\n    return value;\n  } else {\n    const newValue = uuid();\n    sessionStorage.setItem(keyName, newValue);\n    return newValue;\n  }\n};\n\n/**\n * Provides a stable sessionId for the lifetime of the browser tab.\n * @returns a string that is either read from session storage or generated and placed in session storage\n */\nconst useSessionId = (): string => {\n  // when a function is passed to useState, it is only invoked on the first render\n  const [sessionId] = useState<string>(getOrGenerateSessionId);\n\n  return sessionId;\n};\n\n/**\n * Custom hook to abstract the creation of a stateful graph chat client.\n * @param {string} chatId the current chatId to be rendered\n * @returns {StatefulGraphChatClient} a stateful graph chat client that is subscribed to the given chatId\n */\nexport const useGraphChatClient = (chatId: string): StatefulGraphChatClient => {\n  const sessionId = useSessionId();\n  const [chatClient] = useState<StatefulGraphChatClient>(() => new StatefulGraphChatClient());\n\n  // when chatId or sessionId changes this effect subscribes or unsubscribes\n  // the component to/from web socket based notifications for the given chatId\n  useEffect(() => {\n    // we must have both a chatId & sessionId to subscribe.\n    if (chatId && sessionId) chatClient.subscribeToChat(chatId, sessionId);\n    else chatClient.setStatus('no chat id');\n  }, [chatId, sessionId, chatClient]);\n\n  // Returns a cleanup function to call tearDown on the chatClient\n  // This allows us to clean up when the consuming component is being unmounted from the DOM\n  useEffect(() => {\n    return () => {\n      log('invoked clean up effect');\n      void chatClient.tearDown();\n    };\n  }, [chatClient]);\n\n  return chatClient;\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\nimport { makeStyles, shorthands } from '@fluentui/react-components';\nimport React from 'react';\nimport { ArrowSquareUpRight24Regular } from '@fluentui/react-icons';\n\nconst useStyles = makeStyles({\n  container: {\n    backgroundColor: '#ebebeb',\n    display: 'flex',\n    boxShadow: '0px 4px 8px 0px rgba(0, 0, 0, 0.14), 0px 0px 2px 0px rgba(0, 0, 0, 0.12)',\n    textDecorationLine: 'none',\n    color: '#424242',\n    ...shorthands.margin('18px', '0px', '8px', '0px'),\n    ...shorthands.borderRadius('6px'),\n    ...shorthands.padding('16px'),\n    ...shorthands.gap('6px'),\n    ':hover': {\n      backgroundColor: '#fafafa'\n    },\n    ':visited': {\n      color: '#424242'\n    }\n  },\n  cta: {\n    fontFamily: 'Segoe UI',\n    fontSize: '12px',\n    fontStyle: 'normal',\n    fontWeight: '400',\n    lineHeight: '16px',\n    textDecorationLine: 'none'\n  }\n});\n\ninterface UnsupportedContentProps {\n  targetUrl: string;\n}\n\nconst UnsupportedContent = (props: UnsupportedContentProps) => {\n  const styles = useStyles();\n  return (\n    <a className={styles.container} target=\"blank\" href={props.targetUrl}>\n      <ArrowSquareUpRight24Regular />\n      <p className={styles.cta}>View this message in Microsoft Teams.</p>\n    </a>\n  );\n};\n\nexport default UnsupportedContent;\n","import { MessageProps, MessageRenderer } from '@azure/communication-react';\nimport produce from 'immer';\nimport React from 'react';\nimport { renderToString } from 'react-dom/server';\nimport UnsupportedContent from '../components/UnsupportedContent/UnsupportedContent';\nimport { isChatMessage, isGraphChatMessage } from '../utils/types';\n\n/**\n * Renders the preferred content depending on whether it is supported.\n *\n * @param messageProps final message values from the state.\n * @param defaultOnRender default component to render content.\n * @returns\n */\nconst onRenderMessage = (messageProps: MessageProps, defaultOnRender?: MessageRenderer) => {\n  const message = messageProps?.message;\n  if (isGraphChatMessage(message) && message?.hasUnsupportedContent) {\n    const unsupportedContentComponent = <UnsupportedContent targetUrl={message.rawChatUrl} />;\n    messageProps = produce(messageProps, (draft: MessageProps) => {\n      if (isChatMessage(draft.message)) {\n        draft.message.content = renderToString(unsupportedContentComponent);\n      }\n    });\n  }\n\n  return defaultOnRender ? defaultOnRender(messageProps) : <></>;\n};\nexport { onRenderMessage };\n","import React from 'react';\nimport { PersonCardInteraction } from '@microsoft/mgt-components';\nimport { MgtTemplateProps, Person } from '@microsoft/mgt-react';\nimport { ChatMessageMention, User } from '@microsoft/microsoft-graph-types';\nimport { GraphChatClient } from 'src/statefulClient/StatefulGraphChatClient';\nimport { Mention } from '@azure/communication-react';\n\nexport const renderMGTMention = (chatState: GraphChatClient) => {\n  return (mention: Mention, defaultRenderer: (mention: Mention) => JSX.Element): JSX.Element => {\n    let render: JSX.Element = defaultRenderer(mention);\n\n    const mentions = chatState?.mentions ?? [];\n    const flatMentions = mentions.flat();\n    const teamsMention: ChatMessageMention | undefined = flatMentions.find(\n      m => m.id?.toString() === mention?.id && m.mentionText === mention?.displayText\n    );\n\n    const user = teamsMention?.mentioned?.user as User;\n    if (user) {\n      const me = user?.id === chatState.userId;\n      const MgtMeMention = (_props: MgtTemplateProps) => {\n        return defaultRenderer(mention);\n      };\n      const MgtOtherMention = () => {\n        return <p className=\"otherMention\">{mention.displayText}</p>;\n      };\n      const MgtMention = me ? MgtMeMention : MgtOtherMention;\n      render = (\n        <Person userId={user?.id} personCardInteraction={PersonCardInteraction.hover}>\n          <MgtMention />\n        </Person>\n      );\n    }\n    render = <>{render}&nbsp;</>;\n    return render;\n  };\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { mergeStyleSets, mergeStyles } from '@fluentui/react/lib/Styling';\n\nconst classNames = {\n  buttonIcon: 'button-icon',\n  icon: 'icon',\n  iconFilled: 'icon-filled',\n  iconUnfilled: 'icon-unfilled'\n};\n\nconst iconOnlyButtonStyle = mergeStyles({\n  width: '18px',\n  height: '18px'\n});\n\nconst buttonIconStyle = {};\n\nconst colors = {\n  iconRest: '#616161',\n  iconHover: '#5b5fc7'\n};\n\nconst buttonIconStyles = mergeStyleSets({\n  button: [classNames.buttonIcon, buttonIconStyle],\n\n  icon: [\n    classNames.icon,\n    {\n      fill: colors.iconRest,\n      [`.${classNames.buttonIcon}:hover &`]: {\n        fill: colors.iconHover,\n        color: colors.iconHover\n      }\n    }\n  ],\n\n  iconFilled: [\n    classNames.iconFilled,\n    {\n      display: 'none',\n      [`.${classNames.buttonIcon}:hover &`]: {\n        display: 'block'\n      }\n    }\n  ],\n\n  iconUnfilled: [\n    classNames.iconUnfilled,\n    {\n      display: 'block',\n      [`.${classNames.buttonIcon}:hover &`]: {\n        display: 'none'\n      }\n    }\n  ]\n});\n\nexport { buttonIconStyles, buttonIconStyle, iconOnlyButtonStyle };\n","import { makeStyles } from '@fluentui/react-components';\n\nexport const useCommonHeaderStyles = makeStyles({\n  row: {\n    paddingInlineStart: '20px'\n  }\n});\n","import React from 'react';\nimport { AadUserConversationMember, Chat } from '@microsoft/microsoft-graph-types';\nimport { Person, PersonCardInteraction, ViewType } from '@microsoft/mgt-react';\nimport { ChatHeaderProps } from './ChatTitle';\nimport { makeStyles } from '@fluentui/react-components';\n\nconst getOtherParticipantUserId = (chat?: Chat, currentUserId = '') =>\n  (chat?.members as AadUserConversationMember[])?.find(m => m.userId !== currentUserId)?.userId;\n\nconst useStyles = makeStyles({\n  person: {\n    '--person-avatar-size': '32px',\n    '--person-alignment': 'center'\n  }\n});\nexport const OneToOneChatHeader = ({ chat, currentUserId }: ChatHeaderProps) => {\n  const styles = useStyles();\n  const id = getOtherParticipantUserId(chat, currentUserId);\n  return id ? (\n    <Person\n      className={styles.person}\n      userId={id}\n      view={ViewType.oneline}\n      avatarSize=\"small\"\n      personCardInteraction={PersonCardInteraction.hover}\n      showPresence={true}\n    />\n  ) : null;\n};\n","import React, { ReactNode } from 'react';\nimport { makeStyles, shorthands } from '@fluentui/react-components';\n\ninterface CircleProps {\n  height?: string;\n  width?: string;\n  children: ReactNode;\n}\nconst useStyles = makeStyles({\n  container: {\n    ...shorthands.border('1px solid var(--colorBrandBackground2)'),\n    ...shorthands.overflow('hidden'),\n    ...shorthands.borderRadius('50%')\n  },\n  background: {\n    display: 'flex',\n    justifyContent: 'center',\n    alignItems: 'center',\n    backgroundColor: 'var(--colorBrandBackground2)'\n  }\n});\nexport const Circle = ({ height, width, children }: CircleProps): JSX.Element => {\n  const styles = useStyles();\n  const style = { height: height ?? '32px', width: width ?? '32px' };\n  return (\n    <span className={styles.container} style={style}>\n      <span className={styles.background} style={style}>\n        {children}\n      </span>\n    </span>\n  );\n};\n","import React from 'react';\nimport { Chat } from '@microsoft/microsoft-graph-types';\nimport {\n  Calendar16Regular,\n  PeopleTeam16Regular,\n  bundleIcon,\n  Person16Regular,\n  Person16Filled\n} from '@fluentui/react-icons';\nimport { Circle } from '../Circle/Circle';\n\nconst MeetingIcon = bundleIcon(Calendar16Regular, Calendar16Regular);\nconst GroupIcon = bundleIcon(PeopleTeam16Regular, PeopleTeam16Regular);\nconst PersonIcon = bundleIcon(Person16Filled, Person16Regular);\n\nexport const ChatIcon = ({ chatType }: Chat): JSX.Element | null => {\n  const iconColor = 'var(--colorBrandForeground2)';\n\n  switch (chatType) {\n    case 'group':\n      return (\n        <Circle>\n          <GroupIcon color={iconColor} />\n        </Circle>\n      );\n    case 'meeting':\n      return (\n        <Circle>\n          <MeetingIcon color={iconColor} />\n        </Circle>\n      );\n    default:\n      return (\n        <Circle>\n          <PersonIcon color={iconColor} />\n        </Circle>\n      );\n  }\n};\n","import React, { useCallback, useState } from 'react';\nimport { AadUserConversationMember } from '@microsoft/microsoft-graph-types';\nimport { Edit16Filled, Edit16Regular, bundleIcon } from '@fluentui/react-icons';\nimport {\n  Button,\n  Field,\n  Input,\n  InputOnChangeData,\n  OnOpenChangeData,\n  Popover,\n  PopoverSurface,\n  PopoverTrigger,\n  makeStyles,\n  tokens\n} from '@fluentui/react-components';\nimport type { PopoverProps } from '@fluentui/react-components';\nimport { ChatIcon } from '../ChatIcon/ChatIcon';\nimport { ChatHeaderProps } from './ChatTitle';\n\nconst EditIcon = bundleIcon(Edit16Filled, Edit16Regular);\nconst useStyles = makeStyles({\n  chatTitle: {\n    marginInlineStart: '10px'\n  },\n  container: {\n    display: 'flex',\n    flexDirection: 'column',\n    gridRowGap: '16px',\n    minWidth: '300px',\n    backgroundColor: tokens.colorNeutralBackground1\n  },\n  formButtons: {\n    display: 'flex',\n    flexDirection: 'row',\n    justifyContent: 'flex-end',\n    gridColumnGap: '8px'\n  }\n});\nconst reduceToFirstNamesList = (participants: AadUserConversationMember[] = [], userId = '') => {\n  return participants\n    .filter(p => p.userId !== userId)\n    .map(p => {\n      if (p.displayName?.includes(' ')) {\n        return p.displayName.split(' ')[0];\n      }\n      return p.displayName || p.email || p.id;\n    })\n    .join(', ');\n};\nexport const GroupChatHeader = ({ chat, currentUserId, onRenameChat }: ChatHeaderProps) => {\n  const styles = useStyles();\n  const [isPopoverOpen, setIsPopoverOpen] = useState(false);\n  const handleOpenChange = useCallback((_, data: OnOpenChangeData) => setIsPopoverOpen(data.open || false), []);\n  const onCancelClicked = useCallback(() => setIsPopoverOpen(false), []);\n  const [chatName, setChatName] = useState(chat?.topic);\n  const onChatNameChanged = useCallback(\n    (_: React.FormEvent<HTMLInputElement | HTMLTextAreaElement>, data: InputOnChangeData) => {\n      setChatName(data.value);\n    },\n    []\n  );\n  const renameChat = useCallback(() => {\n    void onRenameChat(chatName || null);\n  }, [chatName, onRenameChat]);\n  const chatTitle = chat?.topic\n    ? chat.topic\n    : reduceToFirstNamesList(chat?.members as AadUserConversationMember[], currentUserId);\n  const trapFocus = true;\n  const popoverProps: Partial<PopoverProps> = {\n    trapFocus,\n    inertTrapFocus: trapFocus,\n    inline: true,\n    positioning: 'below-start',\n    open: isPopoverOpen,\n    onOpenChange: handleOpenChange\n  };\n  return (\n    <>\n      <ChatIcon chatType={chat?.chatType} />\n      <span className={styles.chatTitle}>{chatTitle}</span>\n      {chat?.id && (\n        <Popover {...popoverProps}>\n          <PopoverTrigger>\n            <Button appearance=\"transparent\" icon={<EditIcon />} aria-label=\"Name group chat\"></Button>\n          </PopoverTrigger>\n          <PopoverSurface>\n            <div className={styles.container}>\n              <Field label=\"Group name\">\n                <Input placeholder=\"Enter group name\" onChange={onChatNameChanged} value={chatName || ''} />\n              </Field>\n              <div className={styles.formButtons}>\n                <Button appearance=\"secondary\" onClick={onCancelClicked}>\n                  Cancel\n                </Button>\n                <Button appearance=\"primary\" disabled={chatName === chat?.topic} onClick={renameChat}>\n                  Send\n                </Button>\n              </div>\n            </div>\n          </PopoverSurface>\n        </Popover>\n      )}\n    </>\n  );\n};\n","import React, { memo } from 'react';\nimport { Chat } from '@microsoft/microsoft-graph-types';\nimport { makeStyles, mergeClasses } from '@fluentui/react-components';\nimport { useCommonHeaderStyles } from './useCommonHeaderStyles';\nimport { OneToOneChatHeader } from './OneToOneChatHeader';\nimport { GroupChatHeader } from './GroupChatHeader';\n\nexport interface ChatHeaderProps {\n  chat?: Chat;\n  currentUserId?: string;\n  onRenameChat: (newName: string | null) => Promise<void>;\n}\n\nconst useTitleStyles = makeStyles({\n  chatHeader: {\n    display: 'flex',\n    alignItems: 'center',\n    columnGap: '0',\n    lineHeight: '32px',\n    fontSize: '18px',\n    fontWeight: 700,\n    marginBlockStart: '11px',\n    marginBlockEnd: '7px',\n    zIndex: 3\n  }\n});\n\n/**\n * Shows the \"name\" of the chat.\n * For group chats where the topic is set it will show the topic.\n * For group chats with no topic it will show the first names of other participants comma separated.\n * For 1:1 chats it will show the first name of the other participant.\n */\nconst ChatTitle = ({ chat, currentUserId, onRenameChat }: ChatHeaderProps) => {\n  const styles = useTitleStyles();\n  const commonStyles = useCommonHeaderStyles();\n  return (\n    <div className={mergeClasses(styles.chatHeader, commonStyles.row)}>\n      {chat?.chatType !== 'oneOnOne' ? (\n        <GroupChatHeader chat={chat} currentUserId={currentUserId} onRenameChat={onRenameChat} />\n      ) : (\n        <OneToOneChatHeader chat={chat} currentUserId={currentUserId} onRenameChat={onRenameChat} />\n      )}\n    </div>\n  );\n};\n\nexport default memo(ChatTitle);\n","// THIS FILE IS AUTO GENERATED\n// ANY CHANGES WILL BE LOST DURING BUILD\n// MODIFY THE .SCSS FILE INSTEAD\n\nimport { css, CSSResult } from 'lit';\n/**\n * exports lit-element css\n * @export styles\n */\nexport const styles: CSSResult[] = [\n  css`\n:host([hidden]){display:none}:host{display:block;font-family:var(--default-font-family, \"Segoe UI\", \"Segoe UI Web (West European)\", \"Segoe UI\", -apple-system, \"BlinkMacSystemFont\", \"Roboto\", \"Helvetica Neue\", sans-serif);font-size:var(--default-font-size,14px);--theme-primary-color:#0078d7;--theme-dark-color:#005a9e}:focus-visible{outline-color:var(--focus-ring-color,Highlight);outline-color:var(--focus-ring-color,-webkit-focus-ring-color);outline-style:var(--focus-ring-style,auto)}.ms-icon{display:inline-block;font-family:FabricMDL2Icons;font-style:normal;font-weight:400;font-size:16px;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;margin:4px 0}.error{background-color:#fde7e9;padding-block:8px;padding-inline:8px 12px}.ms-icon-chevron-down::before{content:\"\\\\\\e70d\"}.ms-icon-chevron-up::before{content:\"\\\\\\e70e\"}.ms-icon-contact::before{content:\"\\\\\\e77b\"}.ms-icon-add-friend::before{content:\"\\\\\\e8fa\"}.ms-icon-outlook-logo-inverser::before{content:\"\\\\\\eb6d\"}:host{--person-details-wrapper-width:0;width:auto}:host fluent-text-field{width:100%}:host fluent-text-field::part(root){display:flex;flex-wrap:wrap;height:auto;background:padding-box linear-gradient(var(--people-picker-input-background,var(--neutral-fill-input-rest)),var(--people-picker-input-background,var(--neutral-fill-input-rest))),border-box var(--people-picker-input-border-color,var(--neutral-stroke-input-rest))}:host fluent-text-field::part(root):hover{background:padding-box linear-gradient(var(--people-picker-input-hover-background,var(--neutral-fill-input-hover)),var(--people-picker-input-hover-background,var(--neutral-fill-input-hover))),border-box var(--people-picker-input-hover-border-color,var(--neutral-stroke-input-hover))}:host fluent-text-field::part(root):focus,:host fluent-text-field::part(root):focus-within{background:padding-box linear-gradient(var(--people-picker-input-focus-background,var(--neutral-fill-input-focus)),var(--people-picker-input-focus-background,var(--neutral-fill-input-focus))),border-box var(--people-picker-input-focus-border-color,var(--neutral-stroke-input-focus))}:host fluent-text-field::part(start){margin:unset}:host fluent-text-field::part(control){width:min-content;height:calc((var(--base-height-multiplier) + var(--density)) * var(--design-unit) * 1px);word-spacing:inherit;text-indent:inherit;letter-spacing:inherit}:host fluent-text-field::part(control)::placeholder{color:var(--people-picker-input-placeholder-text-color,var(--input-placeholder-rest))}:host fluent-text-field::part(control):hover::placeholder{color:var(--people-picker-input-placeholder-hover-text-color,var(--input-placeholder-hover))}:host fluent-text-field::part(control):focus-within::placeholder,:host fluent-text-field::part(control):focus::placeholder{color:var(--people-picker-input-placeholder-focus-text-color,var(--input-placeholder-filled))}:host fluent-text-field .search-icon{display:flex;padding-top:10px;padding-inline-start:10px}:host fluent-text-field .search-icon svg path{fill:var(--people-picker-search-icon-color,currentColor)}:host .selected-list{display:flex;flex-wrap:wrap;column-gap:5px;padding:unset;margin:0 5px}:host .selected-list-item{display:flex;column-gap:5px;border-radius:100px;margin-top:3px;background-color:var(--people-picker-selected-option-background-color,var(--person-background-color,var(--neutral-layer-3)))}:host .selected-list-item.highlighted{background-color:var(--people-picker-selected-option-highlight-background-color,var(--accent-fill-rest))}:host .selected-list-item-close-icon{display:flex;justify-content:center;align-items:center;padding-inline-end:8px;cursor:pointer}:host .selected-list-item-close-icon svg path{fill:var(--people-picker-remove-selected-close-icon-color,currentColor)}:host .selected-list-item-person{width:max-content}:host fluent-card{margin-top:4px;background-color:var(--people-picker-dropdown-background-color,var(--neutral-layer-card-container))}:host .searched-people-list{list-style:none;padding:4px;margin:auto}:host .searched-people-list-result{padding:4px;border-radius:4px;background:var(--people-picker-dropdown-result-background-color,var(--person-background-color,transparent))}:host .searched-people-list-result:hover{background:var(--people-picker-dropdown-result-hover-background-color,var(--person-background-color,var(--neutral-fill-rest)))}:host .searched-people-list-result:focus,:host .searched-people-list-result:focus-within{background:var(--people-picker-dropdown-result-focus-background-color,var(--person-background-color,var(--neutral-fill-rest)))}:host .message-parent{display:flex;place-content:center;flex-direction:row;padding:10px 15px;column-gap:5px}:host .message-parent .loading-text,:host .message-parent .search-error-text{font-style:normal;font-weight:600;font-size:14px;line-height:19px;text-align:center;color:var(--people-picker-no-results-text-color,var(--neutral-foreground-hint))}\n`];","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nexport const strings = {\n  inputPlaceholderText: 'Search for a name',\n  maxSelectionsPlaceHolder: 'Max contacts added',\n  maxSelectionsAriaLabel: 'Maximum contact selections reached',\n  noResultsFound: \"We didn't find any matches.\",\n  loadingMessage: 'Loading...',\n  selected: 'selected',\n  removeSelectedUser: 'Remove ',\n  selectContact: 'select a contact',\n  suggestionsTitle: 'Suggested contacts'\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { html, TemplateResult } from 'lit';\nimport { property, state } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport {\n  findGroups,\n  getGroupsForGroupIds,\n  GroupType,\n  getGroup,\n  findGroupsFromGroupIds\n} from '../../graph/graph.groups';\nimport { findPeople, getPeople, PersonType, UserType } from '../../graph/graph.people';\nimport {\n  findUsers,\n  findGroupMembers,\n  findUsersFromGroupIds,\n  getUser,\n  getUsersForUserIds,\n  getUsers\n} from '../../graph/graph.user';\nimport { IDynamicPerson, ViewType } from '../../graph/types';\nimport {\n  Providers,\n  ProviderState,\n  MgtTemplatedComponent,\n  arraysAreEqual,\n  IGraph,\n  mgtHtml\n} from '@microsoft/mgt-element';\nimport '../../styles/style-helper';\nimport '../sub-components/mgt-spinner/mgt-spinner';\nimport { debounce, isValidEmail } from '../../utils/Utils';\nimport { MgtPerson, defaultPersonProperties, registerMgtPersonComponent } from '../mgt-person/mgt-person';\nimport { PersonCardInteraction } from '../PersonCardInteraction';\nimport { MgtFlyout, registerMgtFlyoutComponent } from '../sub-components/mgt-flyout/mgt-flyout';\nimport { styles } from './mgt-people-picker-css';\nimport { SvgIcon, getSvg } from '../../utils/SvgHelper';\nimport { fluentTextField, fluentCard } from '@fluentui/web-components';\nimport { registerFluentComponents } from '../../utils/FluentComponents';\nimport { strings } from './strings';\nimport { Person, User } from '@microsoft/microsoft-graph-types';\nimport { registerComponent } from '@microsoft/mgt-element';\nimport { registerMgtSpinnerComponent } from '../sub-components/mgt-spinner/mgt-spinner';\nimport { isGraphError } from '../../graph/isGraphError';\n\nexport { GroupType } from '../../graph/graph.groups';\nexport { PersonType, UserType } from '../../graph/graph.people';\n\nexport const registerMgtPeoplePickerComponent = () => {\n  registerFluentComponents(fluentTextField, fluentCard);\n\n  registerMgtFlyoutComponent();\n  registerMgtPersonComponent();\n  registerMgtSpinnerComponent();\n  registerComponent('people-picker', MgtPeoplePicker);\n};\n\n/**\n * Web component used to search for people from the Microsoft Graph\n *\n * @export\n * @class MgtPicker\n * @extends {MgtTemplatedComponent}\n *\n * @fires {CustomEvent<IDynamicPerson[]>} selectionChanged - Fired when set of selected people changes\n *\n * @cssprop --people-picker-selected-option-background-color - {Color} the background color of the selected person.\n * @cssprop --people-picker-selected-option-highlight-background-color - {Color} the background color of the selected person when you select it for copy/cut.\n * @cssprop --people-picker-dropdown-background-color - {Color} the background color of the dropdown card.\n * @cssprop --people-picker-dropdown-result-background-color - {Color} the background color of the dropdown result.\n * @cssprop --people-picker-dropdown-result-hover-background-color - {Color} the background color of the dropdown result on hover.\n * @cssprop --people-picker-dropdown-result-focus-background-color - {Color} the background color of the dropdown result on focus.\n * @cssprop --people-picker-no-results-text-color - {Color} the no results found text color.\n * @cssprop --people-picker-input-background - {Color} the input background color.\n * @cssprop --people-picker-input-border-color - {Color} the input border color.\n * @cssprop --people-picker-input-hover-background - {Color} the input background color when you hover.\n * @cssprop --people-picker-input-hover-border-color - {Color} the input border color when you hover\n * @cssprop --people-picker-input-focus-background - {Color} the input background color when you focus.\n * @cssprop --people-picker-input-focus-border-color - {Color} the input border color when you focus.\n * @cssprop --people-picker-input-placeholder-focus-text-color - {Color} the placeholder text color when you focus.\n * @cssprop --people-picker-input-placeholder-hover-text-color - {Color} the placeholder text color when you hover.\n * @cssprop --people-picker-input-placeholder-text-color - {Color} the placeholder text color.\n * @cssprop --people-picker-search-icon-color - {Color} the search icon color\n * @cssprop --people-picker-remove-selected-close-icon-color - {Color} the remove selected person close icon color.\n */\nexport class MgtPeoplePicker extends MgtTemplatedComponent {\n  /**\n   * Array of styles to apply to the element. The styles should be defined\n   * user the `css` tag function.\n   */\n  static get styles() {\n    return styles;\n  }\n\n  /**\n   * The strings to be used for localizing the component.\n   *\n   * @readonly\n   * @protected\n   * @memberof MgtPeoplePicker\n   */\n  protected get strings() {\n    return strings;\n  }\n\n  /**\n   * Gets the flyout element\n   *\n   * @protected\n   * @type {MgtFlyout}\n   * @memberof MgtLogin\n   */\n  protected get flyout(): MgtFlyout {\n    return this.renderRoot.querySelector('.flyout');\n  }\n\n  /**\n   * Gets the input element\n   *\n   * @protected\n   * @type {MgtFlyout}\n   * @memberof MgtLogin\n   */\n  protected get input(): HTMLInputElement {\n    return this.renderRoot.querySelector('fluent-text-field');\n  }\n\n  /**\n   * value determining if search is filtered to a group.\n   *\n   * @type {string}\n   */\n  @property({ attribute: 'group-id', converter: value => value.trim() })\n  public get groupId(): string {\n    return this._groupId;\n  }\n  public set groupId(value) {\n    if (this._groupId === value) {\n      return;\n    }\n\n    this._groupId = value;\n    void this.requestStateUpdate(true);\n  }\n\n  /**\n   * array of groups for search to be filtered by.\n   *\n   * @type {string[]}\n   */\n  @property({\n    attribute: 'group-ids',\n    converter: value => {\n      return value.split(',').map(v => v.trim());\n    }\n  })\n  public get groupIds(): string[] {\n    return this._groupIds;\n  }\n  public set groupIds(value) {\n    if (arraysAreEqual(this._groupIds, value)) {\n      return;\n    }\n    this._groupIds = value;\n    void this.requestStateUpdate(true);\n  }\n\n  /**\n   * value determining if search is filtered to a group.\n   *\n   * @type {PersonType}\n   */\n  @property({\n    attribute: 'type',\n    converter: value => {\n      value = value.toLowerCase();\n      if (!value || value.length === 0) {\n        return PersonType.any;\n      }\n\n      if (typeof PersonType[value] === 'undefined') {\n        return PersonType.any;\n      } else {\n        return PersonType[value] as PersonType;\n      }\n    }\n  })\n  public get type(): PersonType {\n    return this._type;\n  }\n  public set type(value) {\n    if (this._type === value) {\n      return;\n    }\n\n    this._type = value;\n    void this.requestStateUpdate(true);\n  }\n\n  /**\n   * type of group to search for - requires personType to be\n   * set to \"Group\" or \"All\"\n   *\n   * @type {GroupType}\n   */\n  @property({\n    attribute: 'group-type',\n    converter: value => {\n      if (!value || value.length === 0) {\n        return GroupType.any;\n      }\n\n      const values = value.split(',');\n      const groupTypes: GroupType[] = [];\n\n      for (let v of values) {\n        v = v.trim();\n        if (typeof GroupType[v] !== 'undefined') {\n          groupTypes.push(GroupType[v] as GroupType);\n        }\n      }\n\n      if (groupTypes.length === 0) {\n        return GroupType.any;\n      }\n\n      // eslint-disable-next-line no-bitwise\n      const gt = groupTypes.reduce((a, c) => a | c);\n      return gt;\n    }\n  })\n  public get groupType(): GroupType {\n    return this._groupType;\n  }\n  public set groupType(value) {\n    if (this._groupType === value) {\n      return;\n    }\n    this._groupType = value;\n    void this.requestStateUpdate(true);\n  }\n\n  /**\n   * The type of user to search for. Default is any.\n   *\n   * @readonly\n   * @type {UserType}\n   * @memberof MgtPeoplePicker\n   */\n  @property({\n    attribute: 'user-type',\n    converter: value => {\n      value = value.toLowerCase();\n\n      return !value || typeof UserType[value] === 'undefined' ? UserType.any : (UserType[value] as UserType);\n    }\n  })\n  public get userType(): UserType {\n    return this._userType;\n  }\n  public set userType(value) {\n    if (this._userType === value) {\n      return;\n    }\n\n    this._userType = value;\n    void this.requestStateUpdate(true);\n  }\n\n  /**\n   * whether the return should contain a flat list of all nested members\n   *\n   * @type {boolean}\n   */\n  @property({\n    attribute: 'transitive-search',\n    type: Boolean\n  })\n  public get transitiveSearch(): boolean {\n    return this._transitiveSearch;\n  }\n  public set transitiveSearch(value: boolean) {\n    if (this.transitiveSearch !== value) {\n      this._transitiveSearch = value;\n      void this.requestStateUpdate(true);\n    }\n  }\n\n  /**\n   * containing object of IDynamicPerson.\n   *\n   * @type {IDynamicPerson[]}\n   */\n  @property({\n    attribute: 'people',\n    type: Object\n  })\n  public get people(): IDynamicPerson[] {\n    return this._people;\n  }\n  public set people(value: IDynamicPerson[]) {\n    if (!arraysAreEqual(this._people, value)) {\n      this._people = value;\n      void this.requestStateUpdate(true);\n    }\n  }\n\n  /**\n   * determining how many people to show in list.\n   *\n   * @type {number}\n   */\n  @property({\n    attribute: 'show-max',\n    type: Number\n  })\n  public get showMax(): number {\n    return this._showMax;\n  }\n  public set showMax(value: number) {\n    if (value !== this._showMax) {\n      this._showMax = value;\n      void this.requestStateUpdate(true);\n    }\n  }\n\n  /**\n   * Sets whether the person image should be fetched\n   * from the Microsoft Graph\n   *\n   * @type {boolean}\n   * @memberof MgtPerson\n   */\n  @property({\n    attribute: 'disable-images',\n    type: Boolean\n  })\n  public disableImages: boolean;\n\n  @property({\n    attribute: 'show-presence',\n    type: Boolean\n  })\n  public showPresence: boolean;\n\n  /**\n   * array of user picked people.\n   *\n   * @type {IDynamicPerson[]}\n   */\n  @property({\n    attribute: 'selected-people',\n    type: Array\n  })\n  public get selectedPeople(): IDynamicPerson[] {\n    return this._selectedPeople;\n  }\n  public set selectedPeople(value: IDynamicPerson[]) {\n    if (!value) value = [];\n    if (!arraysAreEqual(this._selectedPeople, value)) {\n      this._selectedPeople = value;\n      this.fireCustomEvent('selectionChanged', this._selectedPeople);\n      this.requestUpdate();\n    }\n  }\n\n  /**\n   * array of people to be selected upon initialization\n   *\n   * @type {string[]}\n   * @memberof MgtPeoplePicker\n   */\n  @property({\n    attribute: 'default-selected-user-ids',\n    converter: value => {\n      return value.split(',').map(v => v.trim());\n    },\n    type: String\n  })\n  public get defaultSelectedUserIds(): string[] {\n    return this._defaultSelectedUserIds;\n  }\n  public set defaultSelectedUserIds(value) {\n    if (!arraysAreEqual(this._defaultSelectedUserIds, value)) {\n      this._defaultSelectedUserIds = value;\n      void this.requestStateUpdate(true);\n    }\n  }\n\n  /**\n   * array of groups to be selected upon initialization\n   *\n   * @type {string[]}\n   * @memberof MgtPeoplePicker\n   */\n  @property({\n    attribute: 'default-selected-group-ids',\n    converter: value => {\n      return value.split(',').map(v => v.trim());\n    },\n    type: String\n  })\n  public get defaultSelectedGroupIds(): string[] {\n    return this._defaultSelectedGroupIds;\n  }\n  public set defaultSelectedGroupIds(value) {\n    if (!arraysAreEqual(this._defaultSelectedGroupIds, value)) {\n      this._defaultSelectedGroupIds = value;\n      void this.requestStateUpdate(true);\n    }\n  }\n\n  /**\n   * Placeholder text.\n   *\n   * @type {string}\n   * @memberof MgtPeoplePicker\n   */\n  @property({\n    attribute: 'placeholder',\n    type: String\n  })\n  public placeholder: string;\n\n  /**\n   * Determines whether component should be disabled or not\n   *\n   * @type {boolean}\n   * @memberof MgtPeoplePicker\n   */\n  @property({\n    attribute: 'disabled',\n    type: Boolean\n  })\n  public disabled: boolean;\n\n  /**\n   * Determines if a user can enter an email without selecting a person\n   *\n   * @type {boolean}\n   * @memberof MgtPeoplePicker\n   */\n  @property({\n    attribute: 'allow-any-email',\n    type: Boolean\n  })\n  public allowAnyEmail: boolean;\n\n  /**\n   * Determines whether component allows multiple or single selection of people\n   *\n   * @type {string}\n   * @memberof MgtPeoplePicker\n   */\n  @property({\n    attribute: 'selection-mode',\n    type: String\n  })\n  public selectionMode: string;\n\n  /**\n   * Array of the only users to be searched.\n   *\n   * @type {string[]}\n   * @memberof MgtPeoplePicker\n   */\n  @property({\n    attribute: 'user-ids',\n    converter: value => {\n      return value.split(',').map(v => v.trim());\n    },\n    type: String\n  })\n  public get userIds(): string[] {\n    return this._userIds;\n  }\n  public set userIds(value: string[]) {\n    if (arraysAreEqual(this._userIds, value)) {\n      return;\n    }\n    this._userIds = value;\n    void this.requestStateUpdate(true);\n  }\n\n  /**\n   * Filters that can be set on the user properties query.\n   */\n  @property({ attribute: 'user-filters' })\n  public get userFilters(): string {\n    return this._userFilters;\n  }\n\n  public set userFilters(value: string) {\n    this._userFilters = value;\n    void this.requestStateUpdate(true);\n  }\n\n  /**\n   * Filters that can be set on the people query properties.\n   */\n  @property({ attribute: 'people-filters' })\n  public get peopleFilters(): string {\n    return this._peopleFilters;\n  }\n\n  public set peopleFilters(value: string) {\n    this._peopleFilters = value;\n    void this.requestStateUpdate(true);\n  }\n\n  /**\n   * Filters that can be set on the group query properties.\n   */\n  @property({ attribute: 'group-filters' })\n  public get groupFilters(): string {\n    return this._groupFilters;\n  }\n\n  public set groupFilters(value: string) {\n    this._groupFilters = value;\n    void this.requestStateUpdate(true);\n  }\n\n  /**\n   * Label that can be set on the people picker input to provide context to\n   * assistive technologies\n   */\n  @property({\n    attribute: 'aria-label',\n    type: String\n  })\n  public ariaLabel: string;\n\n  /**\n   * Get the scopes required for people picker\n   *\n   * @static\n   * @return {*}  {string[]}\n   * @memberof MgtPeoplePicker\n   */\n  public static get requiredScopes(): string[] {\n    return [\n      ...new Set(['user.read.all', 'people.read', 'group.read.all', 'user.readbasic.all', ...MgtPerson.requiredScopes])\n    ];\n  }\n\n  /**\n   * User input in search.\n   *\n   * @protected\n   * @type {string}\n   * @memberof MgtPeoplePicker\n   */\n  protected userInput: string;\n\n  // if search is still loading don't load \"people not found\" state\n  @state() private _showLoading: boolean;\n\n  private _userIds: string[];\n  private _groupId: string;\n  private _groupIds: string[];\n  private _type: PersonType = PersonType.person;\n  private _groupType: GroupType = GroupType.any;\n  private _userType: UserType = UserType.any;\n  private _userFilters: string;\n  private _groupFilters: string;\n  private _peopleFilters: string;\n  private _defaultSelectedGroupIds: string[];\n  private _defaultSelectedUserIds: string[];\n  private _selectedPeople: IDynamicPerson[] = [];\n  private _showMax: number;\n  private _people: IDynamicPerson[];\n  private _transitiveSearch: boolean;\n\n  private defaultPeople: IDynamicPerson[];\n\n  // tracking of user arrow key input for selection\n  @state() private _arrowSelectionCount = -1;\n  // List of people requested if group property is provided\n  private _groupPeople: IDynamicPerson[];\n  private _debouncedSearch: { (): void; (): void };\n  private defaultSelectedUsers: IDynamicPerson[] = [];\n  private defaultSelectedGroups: IDynamicPerson[] = [];\n  // List of users highlighted for copy/cut-pasting\n  @state() private _highlightedUsers: Element[] = [];\n  // current user index to the left of the highlighted users\n  private _currentHighlightedUserPos = 0;\n\n  /**\n   * Checks if the input is focused.\n   */\n  @state() private _isFocused = false;\n\n  /**\n   * Switch to determine if a typed email can be set.\n   */\n  @state() private _setAnyEmail = false;\n\n  /**\n   * List of people found from the graph calls.\n   */\n  @state() private _foundPeople: IDynamicPerson[];\n\n  constructor() {\n    super();\n    this.clearState();\n    this._showLoading = true;\n    this.showMax = 6;\n    this.disableImages = false;\n\n    this.disabled = false;\n    this.allowAnyEmail = false;\n    this.addEventListener('copy', this.handleCopy);\n    this.addEventListener('cut', this.handleCut);\n    this.addEventListener('paste', this.handlePaste);\n    this.addEventListener('selectionChanged', this.handleSelectionChanged);\n  }\n\n  /**\n   * Disable the inner input of the fluent-text-field.\n   */\n  private disableTextInput() {\n    const inputControl = this.input.shadowRoot.querySelector<HTMLInputElement>('input');\n    if (inputControl) {\n      inputControl.setAttribute('disabled', 'true');\n      inputControl.value = '';\n    }\n  }\n\n  /**\n   * Enable the inner input of the fluent-text-field.\n   */\n  private enableTextInput() {\n    const inputControl = this.input.shadowRoot.querySelector<HTMLInputElement>('input');\n    if (inputControl) {\n      inputControl.removeAttribute('disabled');\n      inputControl.focus();\n    }\n  }\n\n  /**\n   * Clears the disabled property on the people picker when used in single mode.\n   */\n  private readonly handleSelectionChanged = () => {\n    if (this.selectedPeople.length === 0 && !this.disabled) {\n      this.enableTextInput();\n    }\n  };\n\n  private get hasMaxSelections(): boolean {\n    return this.selectionMode === 'single' && this.selectedPeople.length >= 1;\n  }\n\n  /**\n   * Focuses the input element when focus is called\n   *\n   * @param {FocusOptions} [options]\n   * @memberof MgtPeoplePicker\n   */\n  public focus(options?: FocusOptions) {\n    if (!this.input) {\n      return;\n    }\n    this.input.focus(options);\n    this.input.select();\n  }\n\n  /**\n   * Queries the microsoft graph for a user based on the user id and adds them to the selectedPeople array\n   *\n   * @param {readonly string []} an array of user ids to add to selectedPeople\n   * @returns {Promise<void>}\n   * @memberof MgtPeoplePicker\n   */\n  public async selectUsersById(userIds: readonly string[]): Promise<void> {\n    const provider = Providers.globalProvider;\n    const graph = Providers.globalProvider.graph;\n    if (provider && provider.state === ProviderState.SignedIn) {\n      // eslint-disable-next-line guard-for-in, @typescript-eslint/no-for-in-array\n      for (const id in userIds) {\n        const userId = userIds[id];\n        try {\n          const personDetails = await getUser(graph, userId, defaultPersonProperties);\n          this.addPerson(personDetails);\n        } catch (e: unknown) {\n          // This caters for allow-any-email property if it's enabled on the component\n          // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-unsafe-call\n          if (isGraphError(e) && e.message?.includes('does not exist') && this.allowAnyEmail) {\n            if (isValidEmail(userId)) {\n              const anyMailUser = {\n                mail: userId,\n                displayName: userId\n              };\n              this.addPerson(anyMailUser);\n            }\n          }\n        }\n      }\n    }\n  }\n  /**\n   * Queries the microsoft graph for a group of users from a group id, and adds them to the selectedPeople\n   *\n   * @param {readonly string []} an array of group ids to add to selectedPeople\n   * @returns {Promise<void>}\n   * @memberof MgtPeoplePicker\n   */\n  public async selectGroupsById(groupIds: readonly string[]): Promise<void> {\n    const provider = Providers.globalProvider;\n    const graph = Providers.globalProvider.graph;\n    if (provider && provider.state === ProviderState.SignedIn) {\n      // eslint-disable-next-line guard-for-in, @typescript-eslint/no-for-in-array\n      for (const id in groupIds) {\n        try {\n          const groupDetails = await getGroup(graph, groupIds[id]);\n          this.addPerson(groupDetails);\n        } catch (e) {\n          // no-op\n        }\n      }\n    }\n  }\n\n  /**\n   * Invoked on each update to perform rendering tasks. This method must return a lit-html TemplateResult.\n   * Setting properties inside this method will not trigger the element to update.\n   *\n   * @returns {TemplateResult}\n   * @memberof MgtPeoplePicker\n   */\n  public render(): TemplateResult {\n    const defaultTemplate = this.renderTemplate('default', { people: this._foundPeople });\n    if (defaultTemplate) {\n      return defaultTemplate;\n    }\n\n    const selectedPeopleTemplate = this.renderSelectedPeople(this.selectedPeople);\n    const inputTemplate = this.renderInput(selectedPeopleTemplate);\n    const flyoutTemplate = this.renderFlyout(inputTemplate);\n\n    return html`\n      <div>\n        ${flyoutTemplate}\n      </div>\n    `;\n  }\n\n  /**\n   * Clears state of the component\n   *\n   * @protected\n   * @memberof MgtPeoplePicker\n   */\n  protected clearState(): void {\n    this.selectedPeople = [];\n    this.userInput = '';\n    this._highlightedUsers = [];\n    this._currentHighlightedUserPos = 0;\n  }\n\n  /**\n   * Request to reload the state.\n   * Use reload instead of load to ensure loading events are fired.\n   *\n   * @protected\n   * @memberof MgtBaseComponent\n   */\n  protected requestStateUpdate(force?: boolean) {\n    if (force) {\n      this._groupPeople = null;\n      this._foundPeople = null;\n      this.selectedPeople = [];\n      this.defaultPeople = null;\n    }\n\n    return super.requestStateUpdate(force);\n  }\n\n  /**\n   * Render the input text box.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtPeoplePicker\n   */\n  protected renderInput(selectedPeopleTemplate: TemplateResult): TemplateResult {\n    const placeholder = this.disabled ? '' : this.placeholder || this.strings.inputPlaceholderText;\n    const maxSelectionsAriaLabel = this.hasMaxSelections ? this.strings.maxSelectionsAriaLabel : '';\n\n    const searchIcon = html`<span class=\"search-icon\">${getSvg(SvgIcon.Search)}</span>`;\n    const startSlot = this.selectedPeople?.length > 0 ? selectedPeopleTemplate : searchIcon;\n    return html`\n      <fluent-text-field\n        autocomplete=\"off\"\n        appearance=\"outline\"\n        slot=\"anchor\"\n        id=\"people-picker-input\"\n        role=\"combobox\"\n        placeholder=${this.hasMaxSelections ? this.strings.maxSelectionsPlaceHolder : placeholder}\n        aria-label=${this.ariaLabel || maxSelectionsAriaLabel || placeholder || this.strings.selectContact}\n        aria-expanded=${this.flyout?.isOpen ?? false}\n        @click=\"${this.hasMaxSelections ? undefined : this.handleInputClick}\"\n        @focus=\"${this.hasMaxSelections ? undefined : this.gainedFocus}\"\n        @keydown=\"${this.hasMaxSelections ? undefined : this.onUserKeyDown}\"\n        @input=\"${this.hasMaxSelections ? undefined : this.onUserInput}\"\n        @blur=\"${this.lostFocus}\"\n        ?disabled=${this.disabled}\n      >\n        <span slot=\"start\">${startSlot}</span>\n      </fluent-text-field>\n    `;\n  }\n\n  /**\n   * Render the selected people tokens.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtPeoplePicker\n   */\n  protected renderSelectedPeople(selectedPeople?: IDynamicPerson[]): TemplateResult {\n    if (!selectedPeople?.length) {\n      return html``;\n    }\n\n    return html`\n       <ul\n        id=\"selected-list\"\n        aria-label=\"${this.strings.selected}\"\n        class=\"selected-list\">\n          ${repeat(\n            selectedPeople,\n            person => person?.id,\n            person => html`\n            <li class=\"selected-list-item\">\n              ${\n                this.renderTemplate(\n                  'selected-person',\n                  { person },\n                  `selected-${person?.id ? person.id : person.displayName}`\n                ) || this.renderSelectedPerson(person)\n              }\n\n              <div\n                role=\"button\"\n                tabindex=\"0\"\n                class=\"selected-list-item-close-icon\"\n                aria-label=\"${this.strings.removeSelectedUser}${person?.displayName ?? ''}\"\n                @click=\"${(e: UIEvent) => this.removePerson(person, e)}\"\n                @keydown=\"${(e: KeyboardEvent) => this.handleRemovePersonKeyDown(person, e)}\">\n                  ${getSvg(SvgIcon.Close)}\n              </div>\n          </li>`\n          )}\n      </ul>`;\n  }\n  /**\n   * Render the flyout chrome.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtPeoplePicker\n   */\n  protected renderFlyout(anchor: TemplateResult): TemplateResult {\n    return mgtHtml`\n       <mgt-flyout light-dismiss class=\"flyout\">\n         ${anchor}\n         <fluent-card\n          tabindex=\"0\"\n          slot=\"flyout\"\n          class=\"flyout-root\"\n          @wheel=${(e: WheelEvent) => this.handleSectionScroll(e)}\n          @keydown=${(e: KeyboardEvent) => this.onUserKeyDown(e)}\n          class=\"custom\">\n           ${this.renderFlyoutContent()}\n         </fluent-card>\n       </mgt-flyout>\n     `;\n  }\n\n  /**\n   * Render the appropriate state in the results flyout.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtPeoplePicker\n   */\n  protected renderFlyoutContent(): TemplateResult {\n    if (this.isLoadingState || this._showLoading) {\n      return this.renderLoading();\n    }\n\n    const people = this._foundPeople;\n\n    if (!people || people.length === 0 || this.showMax === 0) {\n      return this.renderNoData();\n    } else {\n      return this.renderSearchResults(people);\n    }\n  }\n\n  /**\n   * Render the loading state.\n   *\n   * @protected\n   * @returns\n   * @memberof MgtPeoplePicker\n   */\n  protected renderLoading(): TemplateResult {\n    return (\n      this.renderTemplate('loading', null) ||\n      mgtHtml`\n         <div class=\"message-parent\">\n           <mgt-spinner></mgt-spinner>\n           <div aria-label=\"${this.strings.loadingMessage}\" class=\"loading-text\">\n             ${this.strings.loadingMessage}\n           </div>\n         </div>\n       `\n    );\n  }\n\n  /**\n   * Render the state when no results are found for the search query.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtPeoplePicker\n   */\n  protected renderNoData(): TemplateResult {\n    if (!this._isFocused) {\n      return;\n    }\n    return (\n      this.renderTemplate('error', null) ||\n      this.renderTemplate('no-data', null) ||\n      html`\n         <div class=\"message-parent\">\n           <div aria-label=${this.strings.noResultsFound} class=\"search-error-text\">\n             ${this.strings.noResultsFound}\n           </div>\n         </div>\n       `\n    );\n  }\n\n  /**\n   * Render the list of search results.\n   *\n   * @protected\n   * @param {IDynamicPerson[]} people\n   * @returns\n   * @memberof MgtPeoplePicker\n   */\n  protected renderSearchResults(people: IDynamicPerson[]) {\n    const filteredPeople = people.filter(person => person.id);\n    return html`\n      <ul\n        id=\"suggestions-list\"\n        class=\"searched-people-list\"\n        role=\"listbox\"\n        aria-live=\"polite\"\n        title=${this.strings.suggestionsTitle}\n      >\n         ${repeat(\n           filteredPeople,\n           person => person.id,\n           person => html`\n            <li\n              id=\"${person.id}\"\n              class=\"searched-people-list-result\"\n              role=\"option\"\n              @click=\"${() => this.handleSuggestionClick(person)}\">\n                ${this.renderPersonResult(person)}\n            </li>\n          `\n         )}\n       </ul>\n     `;\n  }\n\n  /**\n   * Render an individual person search result.\n   *\n   * @protected\n   * @param {IDynamicPerson} person\n   * @returns {TemplateResult}\n   * @memberof MgtPeoplePicker\n   */\n  protected renderPersonResult(person: IDynamicPerson): TemplateResult {\n    return (\n      this.renderTemplate('person', { person }, person.id) ||\n      mgtHtml`\n         <mgt-person\n          class=\"person\"\n          ?show-presence=${this.showPresence}\n          view=\"twoLines\"\n          line2-property=\"jobTitle,mail\"\n          .personDetails=${person}\n          .fetchImage=${!this.disableImages}>\n          .personCardInteraction=${PersonCardInteraction.none}\n        </mgt-person>`\n    );\n  }\n\n  /**\n   * Render an individual selected person token.\n   *\n   * @protected\n   * @param {IDynamicPerson} person\n   * @returns {TemplateResult}\n   * @memberof MgtPeoplePicker\n   */\n  protected renderSelectedPerson(person: IDynamicPerson): TemplateResult {\n    return mgtHtml`\n       <mgt-person\n         tabindex=\"-1\"\n         class=\"selected-list-item-person\"\n         .personDetails=${person}\n         .fetchImage=${!this.disableImages}\n         .view=${ViewType.oneline}\n         .personCardInteraction=${PersonCardInteraction.none}>\n        </mgt-person>\n     `;\n  }\n\n  /**\n   * Async query to Graph for members of group if determined by developer.\n   * set's `this.groupPeople` to those members.\n   */\n  protected async loadState(): Promise<void> {\n    let people = this.people;\n    const input = this.userInput.toLowerCase();\n    const provider = Providers.globalProvider;\n\n    if (people) {\n      if (input) {\n        const displayNameMatch = people.filter(person => person?.displayName.toLowerCase().includes(input));\n        people = displayNameMatch;\n      }\n      this._showLoading = false;\n    } else if (!people && provider && provider.state === ProviderState.SignedIn) {\n      const graph = provider.graph.forComponent(this);\n\n      if (!input.length) {\n        if (this.defaultPeople) {\n          people = this.defaultPeople;\n        } else {\n          if (this.groupId || this.groupIds) {\n            if (this._groupPeople === null) {\n              if (this.groupId) {\n                try {\n                  if (this.type === PersonType.group) {\n                    this._groupPeople = await findGroupMembers(\n                      graph,\n                      null,\n                      this.groupId,\n                      this.showMax,\n                      this.type,\n                      this.transitiveSearch\n                    );\n                  } else {\n                    this._groupPeople = await findGroupMembers(\n                      graph,\n                      null,\n                      this.groupId,\n                      this.showMax,\n                      this.type,\n                      this.transitiveSearch,\n                      this.userFilters,\n                      this.peopleFilters\n                    );\n                  }\n                } catch (_) {\n                  this._groupPeople = [];\n                }\n              } else if (this.groupIds) {\n                if (this.type === PersonType.group) {\n                  try {\n                    this._groupPeople = await getGroupsForGroupIds(graph, this.groupIds, this.groupFilters);\n                  } catch (_) {\n                    this._groupPeople = [];\n                  }\n                } else {\n                  try {\n                    const peopleInGroups = await findUsersFromGroupIds(\n                      graph,\n                      '',\n                      this.groupIds,\n                      this.showMax,\n                      this.type,\n                      this.transitiveSearch,\n                      this.userFilters\n                    );\n                    this._groupPeople = peopleInGroups;\n                  } catch (_) {\n                    this._groupPeople = [];\n                  }\n                }\n              }\n            }\n            people = this._groupPeople || [];\n          } else if (this.type === PersonType.person || this.type === PersonType.any) {\n            if (this.userIds) {\n              people = await getUsersForUserIds(graph, this.userIds, '', this.userFilters);\n            } else {\n              const isUserOrContactType = this.userType === UserType.user || this.userType === UserType.contact;\n              if (this._userFilters && isUserOrContactType) {\n                people = await getUsers(graph, this._userFilters, this.showMax);\n              } else {\n                people = await getPeople(graph, this.userType, this._peopleFilters, this.showMax);\n              }\n            }\n          } else if (this.type === PersonType.group) {\n            if (this.groupIds) {\n              try {\n                people = await this.getGroupsForGroupIds(graph, people);\n              } catch (_) {\n                // nop\n              }\n            } else {\n              let groups = (await findGroups(graph, '', this.showMax, this.groupType, this._groupFilters)) || [];\n              // eslint-disable-next-line @typescript-eslint/dot-notation\n              if (groups.length > 0 && groups[0]['value']) {\n                // eslint-disable-next-line @typescript-eslint/dot-notation, @typescript-eslint/no-unsafe-assignment\n                groups = groups[0]['value'];\n              }\n              people = groups;\n            }\n          }\n          this.defaultPeople = people;\n        }\n        if (this._isFocused) {\n          this._showLoading = false;\n        }\n      }\n\n      if (\n        (this.defaultSelectedUserIds?.length > 0 || this.defaultSelectedGroupIds?.length > 0) &&\n        !this.selectedPeople.length &&\n        !this.defaultSelectedUsers.length &&\n        !this.defaultSelectedGroups.length\n      ) {\n        this.defaultSelectedUsers = await getUsersForUserIds(graph, this.defaultSelectedUserIds, '', this.userFilters);\n        this.defaultSelectedGroups = await getGroupsForGroupIds(\n          graph,\n          this.defaultSelectedGroupIds,\n          this.peopleFilters\n        );\n\n        this.defaultSelectedGroups = this.defaultSelectedGroups.filter(group => {\n          return group !== null;\n        });\n\n        this.defaultSelectedUsers = this.defaultSelectedUsers.filter(user => {\n          return user !== null;\n        });\n\n        this.selectedPeople = [...this.defaultSelectedUsers, ...this.defaultSelectedGroups];\n        this.requestUpdate();\n      }\n\n      if (input) {\n        people = [];\n\n        if (this.groupId) {\n          people =\n            (await findGroupMembers(\n              graph,\n              input,\n              this.groupId,\n              this.showMax,\n              this.type,\n              this.transitiveSearch,\n              this.userFilters,\n              this.peopleFilters\n            )) || [];\n        } else {\n          if (this.type === PersonType.person || this.type === PersonType.any) {\n            try {\n              // Default UserType === any\n              if (this.userType === UserType.contact || this.userType === UserType.user) {\n                // we might have a user-filters property set, search for users with it.\n                if (this.userIds?.length) {\n                  // has the user-ids proerty set\n                  people = await getUsersForUserIds(graph, this.userIds, input, this._userFilters);\n                } else {\n                  people = await findUsers(graph, input, this.showMax, this._userFilters);\n                }\n              } else {\n                if (!this.groupIds) {\n                  if (this.userIds?.length) {\n                    // has the user-ids proerty set\n                    people = await getUsersForUserIds(graph, this.userIds, input, this._userFilters);\n                  } else {\n                    people = (await findPeople(graph, input, this.showMax, this.userType, this._peopleFilters)) || [];\n                  }\n                } else {\n                  // Does not work when the PersonType = person.\n                  try {\n                    people = await findUsersFromGroupIds(\n                      graph,\n                      input,\n                      this.groupIds,\n                      this.showMax,\n                      this.type,\n                      this.transitiveSearch,\n                      this.userFilters\n                    );\n                  } catch (_) {\n                    // nop\n                  }\n                }\n              }\n            } catch (e) {\n              // nop\n            }\n\n            // Don't follow this path if a people-filters attribute is set on the component as the\n            // default type === PersonType.person\n            if (\n              people &&\n              people.length < this.showMax &&\n              this.userType !== UserType.contact &&\n              this.type !== PersonType.person\n            ) {\n              try {\n                const users = (await findUsers(graph, input, this.showMax, this._userFilters)) || [];\n\n                // make sure only unique people\n                const peopleIds = new Set(people.map(p => p.id));\n                for (const user of users) {\n                  if (!peopleIds.has(user.id)) {\n                    people.push(user);\n                  }\n                }\n              } catch (e) {\n                // no-op\n              }\n            }\n          }\n\n          if ((this.type === PersonType.group || this.type === PersonType.any) && people.length < this.showMax) {\n            if (this.groupIds) {\n              try {\n                people = await findGroupsFromGroupIds(\n                  graph,\n                  input,\n                  this.groupIds,\n                  this.showMax,\n                  this.groupType,\n                  this.userFilters\n                );\n              } catch (_) {\n                // no-op\n              }\n            } else {\n              let groups = [];\n              try {\n                groups = (await findGroups(graph, input, this.showMax, this.groupType, this._groupFilters)) || [];\n                people = people.concat(groups);\n              } catch (e) {\n                // nop\n              }\n            }\n          }\n        }\n      }\n    }\n    // people = this.getUniquePeople(people);\n    this._foundPeople = this.filterPeople(people);\n  }\n\n  /**\n   * Gets the Groups in a list of group IDs.\n   *\n   * @param graph the graph object\n   * @param people already found groups\n   * @returns groups found\n   */\n  private async getGroupsForGroupIds(graph: IGraph, people: IDynamicPerson[]) {\n    const groups = await getGroupsForGroupIds(graph, this.groupIds, this.groupFilters);\n    for (const group of groups as IDynamicPerson[]) {\n      people = people.concat(group);\n    }\n    people = people.filter(person => person);\n    return people;\n  }\n\n  /**\n   * Hide the results flyout.\n   *\n   * @protected\n   * @memberof MgtPeoplePicker\n   */\n  protected hideFlyout(): void {\n    const flyout = this.flyout;\n    if (flyout) {\n      flyout.close();\n    }\n    if (this.input) {\n      this.input.setAttribute('aria-activedescendant', '');\n    }\n    this._arrowSelectionCount = -1;\n  }\n\n  /**\n   * Show the results flyout.\n   *\n   * @protected\n   * @memberof MgtPeoplePicker\n   */\n  protected showFlyout(): void {\n    const flyout = this.flyout;\n    if (flyout) {\n      flyout.open();\n    }\n    this._arrowSelectionCount = -1;\n  }\n\n  /**\n   * Removes person from selected people\n   *\n   * @param person - person and details pertaining to user selected\n   */\n  protected removePerson(person: IDynamicPerson, e: UIEvent): void {\n    e.stopPropagation();\n    const filteredPersonArr = this.selectedPeople.filter(p => {\n      if (!person.id && p.displayName) {\n        return p.displayName !== person.displayName;\n      }\n      return p.id !== person.id;\n    });\n    if (this.hasMaxSelections) {\n      this.enableTextInput();\n    }\n    this.selectedPeople = filteredPersonArr;\n    void this.loadState();\n  }\n\n  /**\n   * Checks if key pressed is an `Enter` key before removing person\n   *\n   * @param person\n   * @param e\n   */\n  protected handleRemovePersonKeyDown(person: IDynamicPerson, e: KeyboardEvent): void {\n    if (e.key === 'Enter') {\n      this.removePerson(person, e);\n    }\n  }\n\n  /**\n   * Tracks when user selects person from picker\n   *\n   * @param person - contains details pertaining to selected user\n   * @param event - tracks user event\n   */\n  protected addPerson(person: IDynamicPerson): void {\n    if (person) {\n      setTimeout(() => {\n        this.clearInput();\n      }, 50);\n      const duplicatePeople = this.selectedPeople.filter(p => {\n        if (!person.id && p.displayName) {\n          return p.displayName === person.displayName;\n        }\n        return p.id === person.id;\n      });\n\n      if (duplicatePeople.length === 0) {\n        this.selectedPeople = [...this.selectedPeople, person];\n        void this.loadState();\n        this._foundPeople = [];\n        this._arrowSelectionCount = -1;\n      }\n    }\n  }\n\n  private clearInput() {\n    this.clearHighlighted();\n    if (this.selectionMode !== 'single') {\n      this.input.value = '';\n    }\n    this.userInput = '';\n  }\n\n  // handle input click\n  private readonly handleInputClick = () => {\n    if (!this.flyout.isOpen) {\n      this.handleUserSearch();\n    }\n  };\n\n  // handle input focus\n  private readonly gainedFocus = () => {\n    this.clearHighlighted();\n    this._isFocused = true;\n    void this.loadState();\n    this.showFlyout();\n  };\n\n  // handle input blur\n  private readonly lostFocus = () => {\n    this._isFocused = false;\n    if (this.input) {\n      this.input.setAttribute('aria-activedescendant', '');\n    }\n\n    const peopleList = this.renderRoot.querySelector('.people-list');\n\n    if (peopleList) {\n      for (const el of peopleList.children) {\n        el.classList.remove('focused');\n        el.setAttribute('aria-selected', 'false');\n      }\n    }\n\n    this.requestUpdate();\n  };\n\n  /**\n   * Handles input from the key up events on the keyboard.\n   */\n  private readonly onUserKeyUp = (event: KeyboardEvent): void => {\n    const keyName = event.key;\n    const isCmdOrCtrlKey = event.getModifierState('Control') || event.getModifierState('Meta');\n    const isPaste = isCmdOrCtrlKey && keyName === 'v';\n    const isArrowKey = ['ArrowDown', 'ArrowRight', 'ArrowUp', 'ArrowLeft'].includes(keyName);\n\n    if ((!isPaste && isCmdOrCtrlKey) || isArrowKey) {\n      if (isCmdOrCtrlKey || ['ArrowLeft', 'ArrowRight'].includes(keyName)) {\n        // Only hide the flyout when you're doing selections with Left/Right Arrow key\n        this.hideFlyout();\n      }\n\n      if (keyName === 'ArrowDown') {\n        if (!this.flyout.isOpen && this._isFocused) {\n          this.handleUserSearch();\n        }\n      }\n      return;\n    }\n\n    if (['Tab', 'Enter', 'Shift'].includes(keyName)) return;\n\n    if (keyName === 'Escape') {\n      this.clearInput();\n      this._foundPeople = [];\n      this._arrowSelectionCount = -1;\n      return;\n    }\n\n    if (keyName === 'Backspace' && this.userInput.length === 0 && this.selectedPeople.length > 0) {\n      this.clearHighlighted();\n      // remove last person in selected list\n      this.selectedPeople = this.selectedPeople.splice(0, this.selectedPeople.length - 1);\n      void this.loadState();\n      this.hideFlyout();\n      return;\n    }\n\n    if ([';', ','].includes(keyName)) {\n      if (this.allowAnyEmail) {\n        this._setAnyEmail = true;\n        event.preventDefault();\n        event.stopPropagation();\n      }\n      return;\n    }\n  };\n\n  private readonly onUserInput = (event: InputEvent) => {\n    const input = event.target as HTMLInputElement;\n    this.userInput = input.value;\n    if (this.userInput) {\n      const validEmail = isValidEmail(this.userInput);\n      if (validEmail && this.allowAnyEmail) {\n        if (this._setAnyEmail) {\n          this.handleAnyEmail();\n        }\n      } else {\n        this.handleUserSearch();\n      }\n      this._setAnyEmail = false;\n    }\n  };\n\n  private handleAnyEmail() {\n    this._showLoading = false;\n    this._arrowSelectionCount = -1;\n    if (isValidEmail(this.userInput)) {\n      const anyMailUser = {\n        mail: this.userInput,\n        displayName: this.userInput\n      };\n      this.addPerson(anyMailUser);\n    }\n    this.hideFlyout();\n    if (this.input) {\n      this.input.focus();\n      this._isFocused = true;\n    }\n  }\n\n  // handle suggestion list item click\n  private handleSuggestionClick(person: IDynamicPerson): void {\n    this.addPerson(person);\n    if (this.hasMaxSelections) {\n      this.disableTextInput();\n      this.input.value = '';\n    }\n    this.hideFlyout();\n  }\n\n  /**\n   * Tracks event on user input in search\n   *\n   * @param input - input text\n   */\n  private handleUserSearch() {\n    if (!this._debouncedSearch) {\n      this._debouncedSearch = debounce(async () => {\n        const loadingTimeout = setTimeout(() => {\n          this._showLoading = true;\n        }, 50);\n\n        await this.loadState();\n        clearTimeout(loadingTimeout);\n        this._showLoading = false;\n        this._arrowSelectionCount = -1;\n        this.showFlyout();\n      }, 400);\n    }\n\n    this._debouncedSearch();\n  }\n\n  /**\n   * Tracks event on user search (keydown)\n   *\n   * @param event - event tracked on user input (keydown)\n   */\n  private readonly onUserKeyDown = (event: KeyboardEvent): void => {\n    const keyName = event.key;\n    const selectedList = this.renderRoot.querySelector('.selected-list');\n    const isCmdOrCtrlKey = event.getModifierState('Control') || event.getModifierState('Meta');\n    if (isCmdOrCtrlKey && selectedList) {\n      const selectedPeople = selectedList.querySelectorAll('mgt-person.selected-list-item-person');\n      this.hideFlyout();\n      if (isCmdOrCtrlKey && keyName === 'ArrowLeft') {\n        this._currentHighlightedUserPos =\n          (this._currentHighlightedUserPos - 1 + selectedPeople.length) % selectedPeople.length;\n        if (this._currentHighlightedUserPos >= 0 && !Number.isNaN(this._currentHighlightedUserPos)) {\n          this._highlightedUsers.push(selectedPeople[this._currentHighlightedUserPos]);\n        } else {\n          this._currentHighlightedUserPos = 0;\n        }\n      } else if (isCmdOrCtrlKey && keyName === 'ArrowRight') {\n        const person = this._highlightedUsers.pop();\n        if (person) {\n          const personParent = person.parentElement;\n          if (personParent) {\n            this.clearHighlighted(personParent);\n            this._currentHighlightedUserPos++;\n          }\n        }\n      } else if (isCmdOrCtrlKey && keyName === 'a') {\n        this._highlightedUsers = [];\n        selectedPeople.forEach(person => this._highlightedUsers.push(person));\n      }\n      if (this._highlightedUsers) {\n        this.highlightSelectedPeople(this._highlightedUsers);\n      }\n      return;\n    }\n\n    this.clearHighlighted();\n\n    if (!this.flyout.isOpen) {\n      return;\n    }\n\n    if (keyName === 'ArrowUp' || keyName === 'ArrowDown') {\n      this.handleArrowSelection(event);\n      event.preventDefault();\n    }\n\n    if (keyName === 'Enter') {\n      if (!event.shiftKey && this._foundPeople) {\n        event.preventDefault();\n        event.stopPropagation();\n\n        const foundPerson = this._foundPeople[this._arrowSelectionCount];\n        if (foundPerson) {\n          this.addPerson(foundPerson);\n          this.hideFlyout();\n          this.input.value = '';\n          if (this.hasMaxSelections) {\n            this.disableTextInput();\n          }\n        }\n      } else if (this.allowAnyEmail) {\n        this.handleAnyEmail();\n      } else {\n        this.showFlyout();\n      }\n    }\n\n    if (keyName === 'Escape') {\n      event.stopPropagation();\n    }\n\n    if (keyName === 'Tab') {\n      this.hideFlyout();\n    }\n\n    if ([';', ','].includes(keyName)) {\n      if (this.allowAnyEmail) {\n        event.preventDefault();\n        event.stopPropagation();\n        this.userInput = this.input.value;\n        this.handleAnyEmail();\n      }\n    }\n  };\n\n  /**\n   * Gets the text of the highlighed people and writes it to the clipboard\n   */\n  private async writeHighlightedText() {\n    const copyText = [];\n    for (const element of this._highlightedUsers) {\n      // eslint-disable-next-line @typescript-eslint/dot-notation\n      const { id, displayName, mail, userPrincipalName, scoredEmailAddresses } = element['_personDetails'] as Person &\n        User;\n      let emailAddress: string;\n      if (scoredEmailAddresses && scoredEmailAddresses.length > 0) {\n        emailAddress = scoredEmailAddresses.pop().address;\n      } else {\n        emailAddress = userPrincipalName || mail;\n      }\n\n      copyText.push({ id, displayName, email: emailAddress });\n    }\n    let copiedTextStr = '';\n    if (copyText.length > 0) {\n      copiedTextStr = JSON.stringify(copyText);\n    }\n\n    await navigator.clipboard.writeText(copiedTextStr);\n  }\n\n  /**\n   * Handles the cut event when it is fired\n   */\n  private readonly handleCut = () => {\n    this.writeHighlightedText().then(\n      () => {\n        this.removeHighlightedOnCut();\n      },\n      () => {\n        // intentionally left blank\n      }\n    );\n  };\n\n  /**\n   * Handles the copy event when it is fired\n   */\n  private readonly handleCopy = () => {\n    void this.writeHighlightedText();\n  };\n\n  /**\n   * Parses the copied people text and adds them when you paste\n   */\n  private readonly handlePaste = () => {\n    navigator.clipboard.readText().then(\n      copiedText => {\n        if (copiedText) {\n          try {\n            const people: IDynamicPerson[] = JSON.parse(copiedText) as IDynamicPerson[];\n            if (people && people.length > 0) {\n              for (const person of people) {\n                this.addPerson(person);\n              }\n            }\n          } catch (error) {\n            if (error instanceof SyntaxError) {\n              const delimiters = [',', ';'];\n              let listOfUsers: string[];\n              try {\n                for (const delimiter of delimiters) {\n                  listOfUsers = copiedText.split(delimiter);\n                  if (listOfUsers.length > 1) {\n                    this.hideFlyout();\n                    void this.selectUsersById(listOfUsers);\n                    break;\n                  }\n                }\n                // eslint-disable-next-line no-empty\n              } catch (_) {}\n            }\n          }\n        }\n      },\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      error => {\n        // 'navigator.clipboard.readText is not a function' error is thrown in Mozilla\n        // more information here https://developer.mozilla.org/en-US/docs/Web/API/Clipboard/readText#browser_compatibility\n        // Firefox only supports reading the clipboard in browser extensions,\n        // using the \"clipboardRead\" extension permission.\n      }\n    );\n  };\n\n  /**\n   * Removes only the highlighted elements from the peoplePicker during cut operations.\n   */\n  private removeHighlightedOnCut() {\n    this.selectedPeople = this.selectedPeople.splice(0, this.selectedPeople.length - this._highlightedUsers.length);\n    this._highlightedUsers = [];\n    this._currentHighlightedUserPos = 0;\n    void this.loadState();\n    this.hideFlyout();\n  }\n  /**\n   * Changes the color class to show which people are selected for copy/cut-paste\n   *\n   * @param people list of selected people classes\n   */\n  private highlightSelectedPeople(people: Element[]) {\n    for (const person of people) {\n      const parentElement = person?.parentElement;\n      parentElement.classList.add('highlighted');\n    }\n  }\n\n  /**\n   * Defaults the people class back to the normal view\n   */\n  private clearHighlighted(node?: Element) {\n    if (node) {\n      node.classList.remove('highlighted');\n    } else {\n      for (const person of this._highlightedUsers) {\n        const parentElement = person.parentElement;\n        if (parentElement) {\n          parentElement.classList.remove('highlighted');\n        }\n      }\n      this._highlightedUsers = [];\n      this._currentHighlightedUserPos = 0;\n    }\n  }\n\n  /**\n   * Tracks user key selection for arrow key selection of people\n   *\n   * @param event - tracks user key selection\n   */\n  private handleArrowSelection(event?: KeyboardEvent): void {\n    const peopleList = this.renderRoot.querySelector('.searched-people-list');\n\n    if (peopleList?.children?.length) {\n      if (event) {\n        // update arrow count\n        if (event.key === 'ArrowUp') {\n          if (this._arrowSelectionCount === -1) {\n            this._arrowSelectionCount = 0;\n          } else {\n            this._arrowSelectionCount =\n              (this._arrowSelectionCount - 1 + peopleList.children.length) % peopleList.children.length;\n          }\n        }\n        if (event.key === 'ArrowDown') {\n          if (this._arrowSelectionCount === -1) {\n            this._arrowSelectionCount = 0;\n          } else {\n            this._arrowSelectionCount =\n              (this._arrowSelectionCount + 1 + peopleList.children.length) % peopleList.children.length;\n          }\n        }\n      }\n\n      for (const person of peopleList?.children ?? []) {\n        const p = person as HTMLElement;\n        p.setAttribute('aria-selected', 'false');\n        p.blur();\n        p.removeAttribute('tabindex');\n      }\n\n      // set selected background\n      // set aria-selected to true\n      const focusedItem = peopleList.children[this._arrowSelectionCount] as HTMLElement;\n\n      if (focusedItem) {\n        focusedItem.setAttribute('tabindex', '0');\n        focusedItem.focus();\n        focusedItem.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'nearest' });\n        focusedItem.setAttribute('aria-selected', 'true');\n        this.input.setAttribute('aria-activedescendant', focusedItem?.id);\n      }\n    }\n  }\n\n  /**\n   * Filters people searched from already selected people\n   *\n   * @param people - array of people returned from query to Graph\n   */\n  private filterPeople(people: IDynamicPerson[]): IDynamicPerson[] {\n    // check if people need to be updated\n    // ensuring people list is displayed\n    // find ids from selected people\n    const uniquePeople: IDynamicPerson[] = [];\n    if (people && people.length > 0) {\n      people = people.filter(person => person);\n      const idFilter = this.selectedPeople.map(el => {\n        return el.id ? el.id : el.displayName;\n      });\n\n      // filter id's\n      const filtered = people.filter((person: IDynamicPerson) => {\n        if (person?.id) {\n          return idFilter.indexOf(person.id) === -1;\n        } else {\n          return idFilter.indexOf(person?.displayName) === -1;\n        }\n      });\n\n      // remove duplicates\n      const dupsSet = new Set<string>();\n      for (const d of filtered) {\n        const person = JSON.stringify(d);\n        dupsSet.add(person);\n      }\n\n      dupsSet.forEach((person: string) => {\n        const p: IDynamicPerson = JSON.parse(person) as IDynamicPerson;\n        uniquePeople.push(p);\n      });\n    }\n    return uniquePeople;\n  }\n\n  // stop propagating wheel event to flyout so mouse scrolling works\n  private handleSectionScroll(e: WheelEvent) {\n    const target = this.renderRoot.querySelector('.flyout-root');\n    if (target) {\n      if (\n        !(e.deltaY < 0 && target.scrollTop === 0) &&\n        !(e.deltaY > 0 && target.clientHeight + target.scrollTop >= target.scrollHeight - 1)\n      ) {\n        e.stopPropagation();\n      }\n    }\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/consistent-type-definitions */\nimport { PersonType,GroupType,UserType,IDynamicPerson } from '@microsoft/mgt-components/dist/es6/exports';\nimport { registerMgtPeoplePickerComponent } from '@microsoft/mgt-components/dist/es6/components/components';\nimport { TemplateContext,ComponentMediaQuery,TemplateRenderedData } from '@microsoft/mgt-element';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport * as MicrosoftGraph from '@microsoft/microsoft-graph-types';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport * as MicrosoftGraphBeta from '@microsoft/microsoft-graph-types-beta';\nimport {wrapMgt} from '../Mgt';\n\nexport type PeoplePickerProps = {\n\tgroupId?: string;\n\tgroupIds?: string[];\n\ttype?: PersonType;\n\tgroupType?: GroupType;\n\tuserType?: UserType;\n\ttransitiveSearch?: boolean;\n\tpeople?: IDynamicPerson[];\n\tshowMax?: number;\n\tdisableImages?: boolean;\n\tshowPresence?: boolean;\n\tselectedPeople?: IDynamicPerson[];\n\tdefaultSelectedUserIds?: string[];\n\tdefaultSelectedGroupIds?: string[];\n\tplaceholder?: string;\n\tdisabled?: boolean;\n\tallowAnyEmail?: boolean;\n\tselectionMode?: string;\n\tuserIds?: string[];\n\tuserFilters?: string;\n\tpeopleFilters?: string;\n\tgroupFilters?: string;\n\tariaLabel?: string;\n\ttemplateContext?: TemplateContext;\n\tmediaQuery?: ComponentMediaQuery;\n\tselectionChanged?: (e: CustomEvent<IDynamicPerson[]>) => void;\n\ttemplateRendered?: (e: CustomEvent<TemplateRenderedData>) => void;\n}\n\nexport const PeoplePicker = wrapMgt<PeoplePickerProps>('people-picker', registerMgtPeoplePickerComponent);\n\n","import React, { ChangeEvent, useCallback, useState } from 'react';\nimport { ChoiceGroup, IChoiceGroupOption } from '@fluentui/react';\nimport { shorthands, makeStyles, Button, Input, InputOnChangeData } from '@fluentui/react-components';\nimport { IDynamicPerson, PeoplePicker } from '@microsoft/mgt-react';\n\ninterface AddChatMembersProps {\n  closeDialog: () => void;\n  addChatMembers: (userIds: string[], history?: Date) => Promise<void>;\n}\n\nconst useStyles = makeStyles({\n  addMembers: {\n    display: 'flex',\n    flexDirection: 'column',\n    paddingBlockEnd: '18px',\n    ...shorthands.paddingInline('20px')\n  },\n  buttonRow: {\n    display: 'flex',\n    columnGap: '8px',\n    flexDirection: 'row',\n    justifyContent: 'flex-end',\n    paddingBlockStart: '18px'\n  },\n  dialogHeading: {\n    paddingInlineStart: '4px',\n    marginBlockStart: '18px',\n    marginBlockEnd: '10px'\n  },\n  historyInput: { width: '48px' },\n  option: {\n    display: 'flex',\n    alignItems: 'center',\n    columnGap: '4px'\n  },\n  radio: {\n    marginBlockStart: '8px',\n    paddingInlineStart: '2px'\n  }\n});\n\nconst AddChatMembers = ({ addChatMembers, closeDialog }: AddChatMembersProps) => {\n  const styles = useStyles();\n  const [daysOfHistory, setDaysOfHistory] = useState<number>(1);\n  const handleHistoryChanged = useCallback(\n    (_: ChangeEvent<HTMLInputElement>, data: InputOnChangeData) => {\n      if (data.value) {\n        const newNumber = parseInt(data.value, 10);\n        setDaysOfHistory(newNumber);\n      }\n    },\n    [setDaysOfHistory]\n  );\n\n  const [historyOption, setHistoryOption] = useState<string | undefined>('none');\n  const onHistoryOptionChange = React.useCallback(\n    (_, option: IChoiceGroupOption | undefined) => {\n      if (option) setHistoryOption(option.key);\n    },\n    [setHistoryOption]\n  );\n\n  const [selectedPeople, setSelectedPeople] = useState<IDynamicPerson[]>([]);\n  const peopleSelectionChanged = useCallback(\n    (e: CustomEvent<IDynamicPerson[]>) => {\n      setSelectedPeople(e.detail);\n    },\n    [setSelectedPeople]\n  );\n\n  const addToChat = useCallback(() => {\n    let history: Date | undefined;\n    if (historyOption === 'days') {\n      history = new Date(new Date().getTime() - daysOfHistory * 24 * 60 * 60 * 1000);\n    } else if (historyOption === 'all') {\n      history = new Date('0001-01-01T00:00:00Z');\n    }\n    void addChatMembers(\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      selectedPeople.map(p => p.id!),\n      history\n    ).then(closeDialog);\n  }, [selectedPeople, historyOption, daysOfHistory, addChatMembers, closeDialog]);\n\n  const chatHistoryOptions: IChoiceGroupOption[] = [\n    {\n      key: 'none',\n      text: \"Don't include chat history\"\n    },\n    {\n      key: 'days',\n      text: 'Include history from the past number of days: ',\n\n      onRenderField: (props, render) => {\n        return render ? (\n          <div className={styles.option}>\n            {render(props)}\n            <Input\n              type=\"number\"\n              value={daysOfHistory.toString()}\n              onChange={handleHistoryChanged}\n              min={1}\n              className={styles.historyInput}\n            />\n          </div>\n        ) : null;\n      }\n    },\n    { key: 'all', text: 'Include all chat history' }\n  ];\n  return (\n    <div className={styles.addMembers}>\n      <h3 className={styles.dialogHeading}>Add</h3>\n      <PeoplePicker\n        selectedPeople={selectedPeople}\n        selectionChanged={peopleSelectionChanged}\n        disabled={selectedPeople.length >= 20}\n      />\n      <ChoiceGroup\n        className={styles.radio}\n        options={chatHistoryOptions}\n        selectedKey={historyOption}\n        onChange={onHistoryOptionChange}\n      />\n      <div className={styles.buttonRow}>\n        <Button onClick={closeDialog} appearance=\"secondary\">\n          Cancel\n        </Button>\n        <Button onClick={addToChat} appearance=\"primary\" disabled={selectedPeople.length < 1}>\n          Add\n        </Button>\n      </div>\n    </div>\n  );\n};\n\nexport { AddChatMembers };\n","import React, { useCallback, useState } from 'react';\nimport {\n  makeStyles,\n  mergeClasses,\n  shorthands,\n  Button,\n  Dialog,\n  DialogActions,\n  DialogBody,\n  DialogContent,\n  DialogSurface,\n  DialogTitle\n} from '@fluentui/react-components';\nimport { List, ListItem } from '@fluentui/react-northstar';\nimport { Person, PersonViewType } from '@microsoft/mgt-react';\nimport { AadUserConversationMember } from '@microsoft/microsoft-graph-types';\nimport { Dismiss20Filled, bundleIcon, iconFilledClassName, iconRegularClassName } from '@fluentui/react-icons';\n\ninterface ListChatMembersProps {\n  currentUserId: string;\n  members: AadUserConversationMember[];\n  removeChatMember: (membershipId: string) => Promise<void>;\n  closeParentPopover: () => void;\n}\n\nconst RemovePerson = bundleIcon(Dismiss20Filled, () => <></>);\n\nconst useStyles = makeStyles({\n  iconPlaceholder: {\n    display: 'flex',\n    width: '24px'\n  },\n  listItem: {\n    listStyleType: 'none',\n    width: '100%',\n    ':focus-visible': {\n      [`& .${iconFilledClassName}`]: {\n        display: 'inline',\n        color: 'var(--colorNeutralForeground2BrandHover)'\n      },\n      [`& .${iconRegularClassName}`]: {\n        display: 'none'\n      }\n    }\n  },\n  memberList: {\n    fontWeight: 800,\n    gridGap: '8px',\n    ...shorthands.marginBlock('0'),\n    ...shorthands.padding('0')\n  },\n  personRow: {\n    display: 'flex',\n    flexDirection: 'row',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    ...shorthands.paddingBlock('5px'),\n    ...shorthands.paddingInline('16px'),\n    cursor: 'pointer',\n    ':hover': {\n      backgroundColor: 'var(--colorSubtleBackgroundHover)',\n      [`& .${iconFilledClassName}`]: {\n        display: 'inline',\n        color: 'var(--colorNeutralForeground2BrandHover)'\n      },\n      [`& .${iconRegularClassName}`]: {\n        display: 'none'\n      }\n    }\n  },\n  fullWidth: {\n    width: '100%'\n  }\n});\n\nconst ListChatMembers = ({ members, currentUserId, removeChatMember, closeParentPopover }: ListChatMembersProps) => {\n  const styles = useStyles();\n  const [removeDialogOpen, setRemoveDialogOpen] = useState(false);\n  const [removeUser, setRemoveUser] = useState<AadUserConversationMember | undefined>(undefined);\n  const openRemoveDialog = useCallback((user: AadUserConversationMember) => {\n    if (!user) return;\n    setRemoveUser(user);\n    setRemoveDialogOpen(true);\n  }, []);\n\n  const closeDialog = useCallback(() => {\n    setRemoveUser(undefined);\n    setRemoveDialogOpen(false);\n    closeParentPopover();\n  }, [closeParentPopover]);\n\n  const removeMember = useCallback(() => {\n    if (!removeUser?.id) {\n      closeDialog();\n      return;\n    }\n\n    void removeChatMember(removeUser.id).then(closeDialog);\n  }, [removeUser, removeChatMember, closeDialog]);\n\n  return (\n    <>\n      <Dialog open={removeDialogOpen} onOpenChange={(_, data) => setRemoveDialogOpen(data.open)}>\n        <DialogSurface>\n          <DialogBody>\n            <DialogTitle>Remove {removeUser?.displayName || ''} from the conversation?</DialogTitle>\n            <DialogContent>They&apos;ll still have access to the chat history.</DialogContent>\n            <DialogActions>\n              <Button appearance=\"secondary\" onClick={closeDialog}>\n                Close\n              </Button>\n              <Button appearance=\"primary\" onClick={removeMember}>\n                Remove\n              </Button>\n            </DialogActions>\n          </DialogBody>\n        </DialogSurface>\n      </Dialog>\n      <List navigable className={styles.memberList}>\n        {members.map((member, index) => {\n          const isCurrentUser = currentUserId === member.userId;\n          return member?.userId ? (\n            <ListItem\n              key={member.userId}\n              className={styles.listItem}\n              index={index}\n              content={\n                <div className={mergeClasses(styles.personRow, styles.fullWidth)}>\n                  <Person\n                    className={styles.fullWidth}\n                    tabIndex={-1}\n                    userId={member.userId}\n                    view={PersonViewType.oneline}\n                    showPresence\n                  />\n                  <span className={styles.iconPlaceholder}>{!isCurrentUser && <RemovePerson />}</span>\n                </div>\n              }\n              onClick={() => {\n                if (isCurrentUser) {\n                  closeDialog();\n                } else {\n                  openRemoveDialog(member);\n                }\n              }}\n            />\n          ) : null;\n        })}\n      </List>\n    </>\n  );\n};\n\nexport { ListChatMembers };\n","import React, { memo, useCallback, useState } from 'react';\nimport {\n  makeStyles,\n  shorthands,\n  Button,\n  Popover,\n  PopoverSurface,\n  PopoverTrigger,\n  Divider,\n  OnOpenChangeData,\n  Dialog,\n  DialogActions,\n  DialogBody,\n  DialogContent,\n  DialogSurface,\n  DialogTitle,\n  DialogTrigger,\n  PopoverProps\n} from '@fluentui/react-components';\nimport {\n  bundleIcon,\n  PeopleAdd24Regular,\n  PeopleAdd24Filled,\n  DoorArrowLeft24Filled,\n  DoorArrowLeft24Regular\n} from '@fluentui/react-icons';\nimport { AadUserConversationMember } from '@microsoft/microsoft-graph-types';\nimport { AddChatMembers } from './AddChatMembers';\nimport { ListChatMembers } from './ListChatMembers';\n\ninterface ManageChatMembersProps {\n  currentUserId: string;\n  members: AadUserConversationMember[];\n  removeChatMember: (membershipId: string) => Promise<void>;\n  addChatMembers: (userIds: string[], history?: Date) => Promise<void>;\n}\n\nconst AddPeople = bundleIcon(PeopleAdd24Filled, PeopleAdd24Regular);\nconst Leave = bundleIcon(DoorArrowLeft24Filled, DoorArrowLeft24Regular);\n\nconst useStyles = makeStyles({\n  button: {\n    justifyContent: 'flex-start',\n    ...shorthands.paddingInline('16px')\n  },\n  buttonRow: {\n    display: 'flex',\n    flexDirection: 'column'\n  },\n  container: {\n    ...shorthands.paddingBlock('4px')\n  },\n  divider: {\n    ...shorthands.marginBlock('4px')\n  },\n  popover: {\n    ...shorthands.padding('0 !important')\n  },\n  triggerButton: {\n    ...shorthands.marginInline('0px', '8px'),\n    ...shorthands.paddingInline('0'),\n    '--spacingHorizontalSNudge': '2px',\n    minWidth: 'unset !important',\n    width: 'max-content'\n  }\n});\n\nconst ManageChatMembersComponent = ({\n  currentUserId,\n  members,\n  addChatMembers,\n  removeChatMember\n}: ManageChatMembersProps) => {\n  const styles = useStyles();\n  const [isPopoverOpen, setIsPopoverOpen] = useState(false);\n  const [showAddMembers, setShowAddMembers] = useState(false);\n  const openAddMembers = useCallback(() => {\n    setShowAddMembers(true);\n  }, [setShowAddMembers]);\n  const closeCallout = useCallback(() => {\n    setShowAddMembers(false);\n    setIsPopoverOpen(false);\n  }, [setShowAddMembers]);\n  const handleOpenChange = useCallback(\n    (_, data: OnOpenChangeData) => setIsPopoverOpen(data.open || false),\n    [setIsPopoverOpen]\n  );\n\n  const leaveChat = useCallback(() => {\n    const me = members.find(member => member.userId === currentUserId);\n    if (me?.id) {\n      void removeChatMember(me.id).then(closeCallout);\n      return;\n    }\n    closeCallout();\n  }, [removeChatMember, members, currentUserId, closeCallout]);\n  const trapFocus = true;\n  const popoverProps: Partial<PopoverProps> = {\n    trapFocus,\n    inertTrapFocus: trapFocus,\n    inline: true,\n    positioning: 'below-start',\n    open: isPopoverOpen,\n    onOpenChange: handleOpenChange\n  };\n  return (\n    <Popover {...popoverProps}>\n      <PopoverTrigger>\n        <Button className={styles.triggerButton} appearance=\"transparent\" icon={<AddPeople />}>\n          {members.length}\n        </Button>\n      </PopoverTrigger>\n      <PopoverSurface className={styles.popover}>\n        {showAddMembers ? (\n          <AddChatMembers closeDialog={closeCallout} addChatMembers={addChatMembers} />\n        ) : (\n          <div className={styles.container}>\n            <ListChatMembers\n              members={members}\n              removeChatMember={removeChatMember}\n              currentUserId={currentUserId}\n              closeParentPopover={closeCallout}\n            />\n            <Divider className={styles.divider} />\n            <div className={styles.buttonRow}>\n              <Button appearance=\"subtle\" icon={<AddPeople />} onClick={openAddMembers} className={styles.button}>\n                Add people\n              </Button>\n              <Dialog>\n                <DialogTrigger>\n                  <Button appearance=\"subtle\" icon={<Leave />} className={styles.button}>\n                    Leave\n                  </Button>\n                </DialogTrigger>\n                <DialogSurface>\n                  <DialogBody>\n                    <DialogTitle>Leave the conversation?</DialogTitle>\n                    <DialogContent>You&apos;ll still have access to the chat history.</DialogContent>\n                    <DialogActions>\n                      <DialogTrigger disableButtonEnhancement>\n                        <Button appearance=\"secondary\" onClick={closeCallout}>\n                          Cancel\n                        </Button>\n                      </DialogTrigger>\n                      {members.length > 2 && (\n                        <Button appearance=\"primary\" onClick={leaveChat}>\n                          Leave\n                        </Button>\n                      )}\n                    </DialogActions>\n                  </DialogBody>\n                </DialogSurface>\n              </Dialog>\n            </div>\n          </div>\n        )}\n      </PopoverSurface>\n    </Popover>\n  );\n};\n\nconst ManageChatMembers = memo(ManageChatMembersComponent);\n\nexport { ManageChatMembers };\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\nimport {\n  Button,\n  Menu,\n  MenuItemLink,\n  MenuList,\n  MenuPopover,\n  MenuProps,\n  MenuTrigger,\n  makeStyles\n} from '@fluentui/react-components';\nimport { MoreHorizontal24Filled, MoreHorizontal24Regular, bundleIcon } from '@fluentui/react-icons';\nimport { createSvgIcon } from '@fluentui/react-northstar';\nimport React from 'react';\n\nconst TeamsIcon = createSvgIcon({\n  svg: () => (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n      <path\n        d=\"M17.0797 8H14.1797L12.4697 8.82V12.89C12.5119 13.5868 12.8184 14.2412 13.3267 14.7197C13.8349 15.1981 14.5067 15.4645 15.2047 15.4645C15.9028 15.4645 16.5745 15.1981 17.0828 14.7197C17.5911 14.2412 17.8976 13.5868 17.9397 12.89V8.82C17.9399 8.70887 17.9174 8.59886 17.8737 8.49668C17.83 8.39449 17.766 8.30225 17.6856 8.22556C17.6052 8.14887 17.51 8.08933 17.4058 8.05055C17.3017 8.01178 17.1907 7.99458 17.0797 8Z\"\n        fill=\"#115EA3\"\n      />\n      <path\n        d=\"M16 7C17.1046 7 18 6.10457 18 5C18 3.89543 17.1046 3 16 3C14.8954 3 14 3.89543 14 5C14 6.10457 14.8954 7 16 7Z\"\n        fill=\"#115EA3\"\n      />\n      <path\n        d=\"M6.82 8H14.18C14.3975 8 14.606 8.08639 14.7598 8.24017C14.9136 8.39395 15 8.60252 15 8.82V13.5C15 14.6935 14.5259 15.8381 13.682 16.682C12.8381 17.5259 11.6935 18 10.5 18C9.30653 18 8.16193 17.5259 7.31802 16.682C6.47411 15.8381 6 14.6935 6 13.5V8.82C6 8.60252 6.08639 8.39395 6.24017 8.24017C6.39395 8.08639 6.60252 8 6.82 8Z\"\n        fill=\"#B4D6FA\"\n      />\n      <path\n        d=\"M11 8C12.6569 8 14 6.65685 14 5C14 3.34315 12.6569 2 11 2C9.34315 2 8 3.34315 8 5C8 6.65685 9.34315 8 11 8Z\"\n        fill=\"#B4D6FA\"\n      />\n      <path\n        opacity=\"0.5\"\n        d=\"M6.00003 8.82V13.5C5.99696 14.3892 6.25799 15.2593 6.75003 16H10.97C11.5005 16 12.0092 15.7893 12.3842 15.4142C12.7593 15.0391 12.97 14.5304 12.97 14V8H6.75003C6.5449 8.01757 6.35389 8.11166 6.21494 8.26358C6.07599 8.4155 5.99928 8.61412 6.00003 8.82Z\"\n        fill=\"#242424\"\n      />\n      <path\n        opacity=\"0.5\"\n        d=\"M11.9699 6H8.16992C8.3332 6.46135 8.60686 6.87575 8.96704 7.20706C9.32722 7.53837 9.76299 7.77654 10.2363 7.9008C10.7097 8.02505 11.2062 8.03162 11.6827 7.91993C12.1592 7.80823 12.6011 7.58167 12.9699 7.26V7C12.9699 6.73478 12.8646 6.48043 12.677 6.29289C12.4895 6.10536 12.2351 6 11.9699 6Z\"\n        fill=\"#242424\"\n      />\n      <path\n        opacity=\"0.1\"\n        d=\"M6.00003 8.82V13.5C5.99696 14.3892 6.25799 15.2593 6.75003 16H10.97C11.5005 16 12.0092 15.7893 12.3842 15.4142C12.7593 15.0391 12.97 14.5304 12.97 14V8H6.75003C6.5449 8.01757 6.35389 8.11166 6.21494 8.26358C6.07599 8.4155 5.99928 8.61412 6.00003 8.82Z\"\n        fill=\"white\"\n      />\n      <path\n        opacity=\"0.1\"\n        d=\"M11.9699 6H8.16992C8.3332 6.46135 8.60686 6.87575 8.96704 7.20706C9.32722 7.53837 9.76299 7.77654 10.2363 7.9008C10.7097 8.02505 11.2062 8.03162 11.6827 7.91993C12.1592 7.80823 12.6011 7.58167 12.9699 7.26V7C12.9699 6.73478 12.8646 6.48043 12.677 6.29289C12.4895 6.10536 12.2351 6 11.9699 6Z\"\n        fill=\"white\"\n      />\n      <path\n        d=\"M11 5H3C2.44772 5 2 5.44772 2 6V14C2 14.5523 2.44772 15 3 15H11C11.5523 15 12 14.5523 12 14V6C12 5.44772 11.5523 5 11 5Z\"\n        fill=\"#115EA3\"\n      />\n      <path d=\"M10 8H8V13H7V8H5V7H10V8Z\" fill=\"white\" />\n    </svg>\n  ),\n  displayName: 'TeamsIcon'\n});\n\nconst EllipsisIcon = bundleIcon(MoreHorizontal24Filled, MoreHorizontal24Regular);\n\nconst menuProps: Partial<MenuProps> = {\n  inline: true,\n  hasIcons: true,\n  closeOnScroll: true,\n  positioning: 'below-start'\n};\n\nconst ellipsisMenuStyles = makeStyles({\n  menuPopover: {\n    zIndex: 2,\n\n    '& .fui-MenuItemLink__content': {\n      fontFamily: 'Segoe UI',\n      fontSize: '12px',\n      fontStyle: 'normal',\n      fontWeight: '600'\n    }\n  }\n});\ninterface MenuItemsProps {\n  chatWebUrl: string;\n}\n\nconst EllipsisMenu = (props: MenuItemsProps) => {\n  const styles = ellipsisMenuStyles();\n\n  return (\n    <Menu {...menuProps}>\n      <MenuTrigger disableButtonEnhancement>\n        <Button appearance=\"transparent\" icon={<EllipsisIcon />} />\n      </MenuTrigger>\n\n      <MenuPopover className={styles.menuPopover}>\n        <MenuList>\n          <MenuItemLink icon={<TeamsIcon />} target=\"_blank\" href={props.chatWebUrl}>\n            Go to Microsoft Teams\n          </MenuItemLink>\n        </MenuList>\n      </MenuPopover>\n    </Menu>\n  );\n};\n\nexport { EllipsisMenu };\n","import { Divider, makeStyles, mergeClasses } from '@fluentui/react-components';\nimport React from 'react';\nimport { GraphChatClient } from '../../statefulClient/StatefulGraphChatClient';\nimport ChatTitle from './ChatTitle';\nimport { ManageChatMembers } from '../ManageChatMembers/ManageChatMembers';\nimport { useCommonHeaderStyles } from './useCommonHeaderStyles';\nimport { EllipsisMenu } from './EllipsisMenu';\n\nconst useHeaderStyles = makeStyles({\n  chatHeader: {\n    display: 'flex',\n    flexDirection: 'column',\n    rowGap: 0,\n    zIndex: 2\n  },\n  secondRow: {\n    display: 'flex',\n    flexDirection: 'row',\n    justifyContent: 'flex-start',\n    alignItems: 'center',\n    height: '30px'\n  },\n  noGrow: {\n    flexGrow: 0\n  }\n});\ninterface ChatHeaderProps {\n  chatState: GraphChatClient;\n}\nconst ChatHeader = ({ chatState }: ChatHeaderProps) => {\n  const styles = useHeaderStyles();\n  const commonStyles = useCommonHeaderStyles();\n  const chatWebUrl = chatState?.chat?.webUrl ?? 'https://teams.microsoft.com/v2';\n\n  return (\n    <div className={styles.chatHeader}>\n      <ChatTitle chat={chatState.chat} currentUserId={chatState.userId} onRenameChat={chatState.onRenameChat} />\n      <Divider appearance=\"subtle\" />\n      <div className={mergeClasses(styles.secondRow, commonStyles.row)}>\n        {chatState.participants?.length > 0 && chatState.chat?.chatType === 'group' && (\n          <>\n            <ManageChatMembers\n              members={chatState.participants}\n              removeChatMember={chatState.onRemoveChatMember}\n              currentUserId={chatState.userId}\n              addChatMembers={chatState.onAddChatMembers}\n            />\n            <Divider vertical appearance=\"subtle\" inset className={styles.noGrow} />\n          </>\n        )}\n        <EllipsisMenu chatWebUrl={chatWebUrl} />\n      </div>\n      <Divider appearance=\"subtle\" />\n    </div>\n  );\n};\n\nexport { ChatHeader };\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport React from 'react';\n\nexport const GenericErrorIcon = () => {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"68\" height=\"68\" viewBox=\"0 0 68 68\" fill=\"none\">\n      <path\n        d=\"M58.0129 27.6675L43.4354 42.3725C42.5854 43.2225 42.9679 44.71 44.1579 45.0075L64.1754 50.32C65.3654 50.6175 66.4279 49.555 66.1304 48.365L60.6904 28.39C60.3079 27.2 58.8629 26.775 58.0129 27.6675Z\"\n        fill=\"url(#paint0_linear_11292_9370)\"\n      />\n      <path\n        d=\"M15.5978 11.0075L6.92782 29.835C6.41782 30.94 7.31032 32.1725 8.50032 32.0875L29.1128 30.175C30.3453 30.0475 30.9828 28.6875 30.2603 27.6675L18.3178 10.7525C17.5953 9.73251 16.1078 9.90251 15.5978 11.0075Z\"\n        fill=\"url(#paint1_linear_11292_9370)\"\n      />\n      <path\n        d=\"M32.0877 13.6423L7.05516 50.7448C5.56766 52.9123 7.01266 55.8873 9.64766 56.0998L54.3152 59.2448C56.9502 59.4148 58.7777 56.6948 57.6302 54.3148L37.9952 14.0673C36.8477 11.6873 33.5752 11.4748 32.0877 13.6423Z\"\n        fill=\"#FFD590\"\n      />\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M58.8201 35.5298C58.5651 36.4223 59.0751 37.3998 59.9676 37.6548C60.8601 37.9523 61.7951 37.4423 62.0501 36.5498L65.7476 24.3098C66.0026 23.4173 65.4926 22.4398 64.6001 22.1848C63.7076 21.9298 62.7301 22.4398 62.4751 23.3323L58.8201 35.5298ZM60.6902 41.5648C60.6902 42.621 59.834 43.4773 58.7777 43.4773C57.7215 43.4773 56.8652 42.621 56.8652 41.5648C56.8652 40.5085 57.7215 39.6523 58.7777 39.6523C59.834 39.6523 60.6902 40.5085 60.6902 41.5648Z\"\n        fill=\"#3E8EED\"\n      />\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M31.3668 41.9901C31.2818 42.9251 32.0043 43.7326 32.9393 43.8176C33.8743 43.8601 34.6818 43.1801 34.7668 42.2451L35.9993 24.8626C36.0843 23.9276 35.3618 23.1201 34.4268 23.0351C33.4918 22.9501 32.6843 23.6726 32.5993 24.6076L31.3668 41.9901ZM34.5965 47.8551C34.5965 48.9114 33.7402 49.7676 32.684 49.7676C31.6277 49.7676 30.7715 48.9114 30.7715 47.8551C30.7715 46.7989 31.6277 45.9426 32.684 45.9426C33.7402 45.9426 34.5965 46.7989 34.5965 47.8551Z\"\n        fill=\"white\"\n      />\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M11.3473 21.6326C11.6023 22.5676 12.5373 23.0776 13.4298 22.8226C14.3223 22.5676 14.8323 21.6326 14.6198 20.7401L11.1348 8.45757C10.8798 7.52257 9.94479 7.01257 9.05229 7.26757C8.11729 7.52257 7.60729 8.45757 7.86229 9.35007L11.3473 21.6326ZM16.4472 26.7327C16.4472 27.7889 15.5909 28.6452 14.5347 28.6452C13.4784 28.6452 12.6222 27.7889 12.6222 26.7327C12.6222 25.6764 13.4784 24.8202 14.5347 24.8202C15.5909 24.8202 16.4472 25.6764 16.4472 26.7327Z\"\n        fill=\"#28C2D1\"\n      />\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M34.3818 8.75509C34.2118 8.58509 34.1268 8.37259 34.0843 8.16009L33.6593 5.44009C33.5743 4.84509 33.9993 4.33509 34.5518 4.25009C34.8493 4.20759 35.1468 4.29259 35.3593 4.46259C35.5718 4.63259 35.6993 4.88759 35.7418 5.14259L36.1243 7.86259C36.2093 8.45759 35.7843 8.96759 35.2318 9.05259C34.9343 9.09509 34.5943 8.96759 34.3818 8.75509ZM39.2694 9.09522C39.0144 9.52022 39.0994 10.0302 39.4394 10.3702C39.4819 10.4127 39.5669 10.4977 39.6519 10.4977C40.1619 10.7952 40.7994 10.6252 41.0544 10.1577L42.3719 7.94772C42.4994 7.69272 42.5419 7.43772 42.4994 7.14022C42.4569 6.92772 42.3294 6.71522 42.1594 6.58772C42.1382 6.56647 42.1169 6.55584 42.0957 6.54522C42.0744 6.53459 42.0532 6.52397 42.0319 6.50272C41.5219 6.20522 40.8844 6.37522 40.6294 6.84272L39.2694 9.09522ZM43.3069 13.8126C43.3494 13.8976 43.4344 14.0251 43.5194 14.1101C43.8594 14.4076 44.3269 14.4926 44.7094 14.2801L46.9194 13.1751C47.1744 13.0476 47.3444 12.8351 47.4294 12.5801C47.5144 12.3251 47.5144 12.0276 47.3869 11.7726L47.3869 11.7726C47.3019 11.6451 47.2169 11.5176 47.0894 11.4326C47.0244 11.3677 46.9347 11.3276 46.8581 11.2933L46.858 11.2933C46.8344 11.2827 46.8119 11.2727 46.7919 11.2626C46.5369 11.1776 46.2394 11.1776 45.9844 11.3051L43.7744 12.4101C43.5194 12.5376 43.3494 12.7501 43.2644 13.0051C43.1794 13.3026 43.1794 13.5576 43.3069 13.8126Z\"\n        fill=\"#E1DFDD\"\n      />\n      <defs>\n        <linearGradient\n          id=\"paint0_linear_11292_9370\"\n          x1=\"42.1229\"\n          y1=\"42.8716\"\n          x2=\"57.8851\"\n          y2=\"39.5913\"\n          gradientUnits=\"userSpaceOnUse\"\n        >\n          <stop offset=\"0.000984252\" stopColor=\"#72ACF1\" />\n          <stop offset=\"1\" stopColor=\"#A7CBF6\" />\n        </linearGradient>\n        <linearGradient\n          id=\"paint1_linear_11292_9370\"\n          x1=\"28.8553\"\n          y1=\"30.7359\"\n          x2=\"17.0695\"\n          y2=\"23.6816\"\n          gradientUnits=\"userSpaceOnUse\"\n        >\n          <stop offset=\"0.000984252\" stopColor=\"#7BDDEF\" />\n          <stop offset=\"1\" stopColor=\"#C3F2F4\" />\n        </linearGradient>\n      </defs>\n    </svg>\n  );\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport React from 'react';\nimport { makeStyles, shorthands } from '@fluentui/react-components';\nimport { GenericErrorIcon } from './GenericErrorIcon';\n\nconst useStyles = makeStyles({\n  container: {\n    backgroundColor: 'var(--Neutral-Background-2-Rest, #FAFAFA)',\n    display: 'flex',\n    flexWrap: 'wrap',\n    flexDirection: 'column',\n    alignContent: 'center',\n    justifyContent: 'center',\n    width: '100%',\n    height: '100%',\n    fontFamily: 'Segoe UI',\n    ...shorthands.paddingInline('0 16px'),\n    ...shorthands.gap('24px')\n  },\n  icon: {\n    display: 'flex',\n    flexWrap: 'wrap',\n    justifyContent: 'center',\n    alignContent: 'center'\n  },\n  messageContainer: {},\n  message: {\n    color: 'var(--Neutral-Foreground-1-Rest, #242424)',\n    textAlign: 'center',\n    fontSize: '16px',\n    fontStyle: 'normal',\n    fontWeight: '600',\n    lineHeight: '22px'\n  },\n  subheading: {\n    color: 'var(--Neutral-Foreground-2-Rest, #424242)',\n    textAlign: 'center',\n    fontSize: '14px',\n    fontStyle: 'normal',\n    fontWeight: '400',\n    lineHeight: '20px'\n  }\n});\n/**\n * Error message component props\n */\ninterface IMGTErrorProps {\n  icon?: React.FC;\n  message: string;\n  subheading?: React.FC;\n}\n\nconst EmptySubheading = () => {\n  return <p></p>;\n};\n\n/**\n * Renders a full screen error message.\n * @returns\n */\nconst Error = ({ icon = GenericErrorIcon, message, subheading }: IMGTErrorProps): JSX.Element => {\n  const styles = useStyles();\n  const IconTemplate = icon;\n  const SubheadingTemplate = subheading ? subheading : EmptySubheading;\n\n  return (\n    <div className={styles.container}>\n      <div className={styles.icon}>\n        <IconTemplate />\n      </div>\n      <div className={styles.messageContainer}>\n        <div className={styles.message}>{message}</div>\n        {subheading && (\n          <div className={styles.subheading}>\n            <SubheadingTemplate />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport { Error };\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport React from 'react';\nexport const LoadingMessagesErrorIcon = () => {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"91\" height=\"57\" viewBox=\"0 0 91 57\" fill=\"none\">\n      <path\n        d=\"M8.94601 17.9535C13.4725 17.9535 17.142 14.2841 17.142 9.75753C17.142 5.231 13.4725 1.56152 8.94601 1.56152C4.41948 1.56152 0.75 5.231 0.75 9.75753C0.75 14.2841 4.41948 17.9535 8.94601 17.9535Z\"\n        fill=\"#CCE4F6\"\n      />\n      <path\n        d=\"M13.3704 16.8063C13.2065 16.6424 13.0425 16.4785 12.8786 16.4785C12.3869 16.1506 11.8951 15.8228 11.5673 15.6589C11.5673 15.6589 11.4034 15.6589 11.4034 15.4949C10.9116 15.331 10.7477 15.1671 10.5838 15.0032C10.5838 15.0032 10.4198 14.6753 10.4198 14.3475V13.2001C10.7477 13.0361 10.9116 12.8722 11.0755 12.7083C11.0755 12.7083 11.4034 12.3805 11.7312 11.7248C11.8951 11.5609 11.8951 11.233 11.8951 11.233C12.3869 11.233 12.8786 10.7412 12.8786 10.2495C12.8786 10.0856 12.8786 9.92164 12.7147 9.75772C12.8786 9.26596 13.0426 8.61028 13.0426 8.11852C13.0426 6.47932 12.7147 5.00404 11.4034 4.34836C10.5838 2.87308 8.28887 2.54523 6.81359 3.20091C5.3383 3.85659 4.51871 5.33189 4.02695 4.18444C4.02695 4.18444 2.87951 5.33188 3.20735 6.80717C3.37127 7.79069 4.19088 8.28245 5.01048 8.28245C5.01048 8.77421 5.17439 9.26596 5.33831 9.75772C5.33831 9.92164 5.17438 10.0856 5.17438 10.0856C5.17438 10.5773 5.66615 11.0691 6.15792 11.0691C6.15792 11.3969 6.64968 12.3804 7.79712 13.0361V14.1836C7.79712 14.3475 7.79711 14.6753 7.63319 14.8393C7.46927 15.0032 7.30536 15.0032 6.97752 15.331C6.64968 15.4949 6.64967 15.4949 6.48575 15.4949C6.48575 15.4949 6.15791 15.6589 5.66615 15.9867C5.33831 16.1506 5.17439 16.4785 4.84655 16.6424C6.15791 17.2981 7.46928 17.7898 9.10848 17.7898C10.5838 17.9537 12.059 17.6259 13.3704 16.8063Z\"\n        fill=\"#66AEE5\"\n      />\n      <path\n        d=\"M82.4579 52.7043C86.8939 52.7043 90.49 49.1082 90.49 44.6722C90.49 40.2362 86.8939 36.6401 82.4579 36.6401C78.0219 36.6401 74.4258 40.2362 74.4258 44.6722C74.4258 49.1082 78.0219 52.7043 82.4579 52.7043Z\"\n        fill=\"#E7DFF3\"\n      />\n      <path\n        d=\"M86.0634 48.2778L86.2273 47.9499C86.8829 47.1303 87.2108 45.9829 87.2108 44.8354C87.2108 42.0488 85.0798 39.7539 82.621 39.7539C80.1622 39.7539 78.0312 42.0488 78.0312 44.8354C78.0312 45.819 78.1952 46.6386 78.6869 47.4582C78.8509 47.6221 78.8509 47.786 79.0148 47.9499L79.1787 48.2778C79.8344 49.2613 79.5065 50.5726 78.6869 51.2283L78.3591 51.3922C78.3591 51.3922 80.1622 52.7036 82.785 52.7036C85.4077 52.7036 87.2108 51.3922 87.2108 51.3922L86.883 51.2283C85.5716 50.5726 85.4077 49.2613 86.0634 48.2778Z\"\n        fill=\"#CFC0E8\"\n      />\n      <path\n        d=\"M68.6889 53.8517H31.3151C30.4955 53.8517 29.8398 53.196 29.8398 52.3764V38.6071C29.8398 37.7875 30.4955 37.1318 31.3151 37.1318H68.6889C69.5085 37.1318 70.1642 37.7875 70.1642 38.6071V52.3764C70.1642 53.196 69.5085 53.8517 68.6889 53.8517Z\"\n        fill=\"#B6A0DC\"\n      />\n      <path\n        d=\"M62.9519 56.3109C63.2798 56.6387 63.7715 56.4748 64.0994 56.3109L67.3778 53.8521H59.3457L62.9519 56.3109Z\"\n        fill=\"#B6A0DC\"\n      />\n      <path\n        d=\"M22.5586 17.7895H57.4219C58.1543 17.7895 58.7402 17.1338 58.7402 16.3142V1.72528C58.7402 0.905683 58.1543 0.25 57.4219 0.25H22.5586C21.8262 0.25 21.2402 0.905683 21.2402 1.72528V16.3142C21.3867 17.1338 21.9726 17.7895 22.5586 17.7895Z\"\n        fill=\"#0078D4\"\n      />\n      <path\n        d=\"M28.9452 20.4118C28.6174 20.7396 28.1256 20.7396 27.7978 20.4118L24.3555 17.7891H32.7154L28.9452 20.4118Z\"\n        fill=\"#0078D4\"\n      />\n      <path\n        d=\"M59.6739 47.9504C60.8508 47.9504 61.8049 46.9963 61.8049 45.8194C61.8049 44.6425 60.8508 43.6885 59.6739 43.6885C58.497 43.6885 57.543 44.6425 57.543 45.8194C57.543 46.9963 58.497 47.9504 59.6739 47.9504Z\"\n        fill=\"#654994\"\n      />\n      <path\n        d=\"M50.4942 47.9504C51.6711 47.9504 52.6252 46.9963 52.6252 45.8194C52.6252 44.6425 51.6711 43.6885 50.4942 43.6885C49.3174 43.6885 48.3633 44.6425 48.3633 45.8194C48.3633 46.9963 49.3174 47.9504 50.4942 47.9504Z\"\n        fill=\"#654994\"\n      />\n      <path\n        d=\"M41.3146 47.9509C42.4915 47.9509 43.4455 46.9968 43.4455 45.8199C43.4455 44.643 42.4915 43.689 41.3146 43.689C40.1377 43.689 39.1836 44.643 39.1836 45.8199C39.1836 46.9968 40.1377 47.9509 41.3146 47.9509Z\"\n        fill=\"#654994\"\n      />\n    </svg>\n  );\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport React from 'react';\n\nimport { Link, LinkProps } from '@fluentui/react-components';\n\nexport const OpenTeamsLink = (props: LinkProps & { as?: 'a' }) => (\n  <Link href=\"https://teams.microsoft.com\" {...props}>\n    open the Teams app\n  </Link>\n);\n\nexport const OpenTeamsLinkError = () => {\n  return (\n    <p>\n      If the problem continues, <OpenTeamsLink /> to view the issue.\n    </p>\n  );\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport React from 'react';\n\nexport const RequireValidChatId = () => {\n  return <p>A valid chat id is required.</p>;\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport React from 'react';\n\nexport const TypeANewMessage = () => {\n  return <p>Type a new message and send.</p>;\n};\n","import React from 'react';\nimport { DEFAULT_COMPONENT_ICONS } from '@azure/communication-react';\nimport { registerIcons } from '@fluentui/react';\nimport { buttonIconStyles } from './common.styles';\n\nconst registerAppIcons = () => {\n  const icons = Object.assign(DEFAULT_COMPONENT_ICONS, {\n    // TODO: Register the info and errorbadge icons\n    'add-friend': (\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"16\"\n        height=\"16\"\n        viewBox=\"0 0 16 16\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        className={buttonIconStyles.button}\n      >\n        <path\n          className={buttonIconStyles.icon}\n          d=\"M6.22176 13.9567C3.55468 13.653 2 11.8026 2 10V9.5C2 8.67157 2.67157 8 3.5 8H5.59971C5.43777 8.31679 5.30564 8.65136 5.20703 9H3.5C3.22386 9 3 9.22386 3 9.5V10C3 11.1281 3.88187 12.333 5.50235 12.7996C5.69426 13.216 5.93668 13.6043 6.22176 13.9567ZM9.62596 5.06907C9.70657 4.81036 9.75 4.53525 9.75 4.25C9.75 2.73122 8.51878 1.5 7 1.5C5.48122 1.5 4.25 2.73122 4.25 4.25C4.25 5.53662 5.13357 6.61687 6.32704 6.91706C6.64202 6.55055 7.00446 6.226 7.40482 5.95294C7.27488 5.98371 7.13934 6 7 6C6.0335 6 5.25 5.2165 5.25 4.25C5.25 3.2835 6.0335 2.5 7 2.5C7.9665 2.5 8.75 3.2835 8.75 4.25C8.75 4.73141 8.55561 5.16743 8.24104 5.48382C8.67558 5.28783 9.14016 5.14664 9.62596 5.06907ZM10.5 15C12.9853 15 15 12.9853 15 10.5C15 8.01472 12.9853 6 10.5 6C8.01472 6 6 8.01472 6 10.5C6 12.9853 8.01472 15 10.5 15ZM10.5 8C10.7761 8 11 8.22386 11 8.5V10H12.5C12.7761 10 13 10.2239 13 10.5C13 10.7761 12.7761 11 12.5 11H11V12.5C11 12.7761 10.7761 13 10.5 13C10.2239 13 10 12.7761 10 12.5V11H8.5C8.22386 11 8 10.7761 8 10.5C8 10.2239 8.22386 10 8.5 10H10V8.5C10 8.22386 10.2239 8 10.5 8Z\"\n        />\n      </svg>\n    ),\n    'left-chat': (\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"16\"\n        height=\"16\"\n        viewBox=\"0 0 16 16\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        className={buttonIconStyles.button}\n      >\n        <path\n          className={buttonIconStyles.icon}\n          d=\"M6.22176 13.9567C3.55468 13.653 2 11.8026 2 10V9.5C2 8.67157 2.67157 8 3.5 8H5.59971C5.43777 8.31679 5.30564 8.65136 5.20703 9H3.5C3.22386 9 3 9.22386 3 9.5V10C3 11.1281 3.88187 12.333 5.50235 12.7996C5.69426 13.216 5.93668 13.6043 6.22176 13.9567ZM9.62596 5.06907C9.70657 4.81036 9.75 4.53525 9.75 4.25C9.75 2.73122 8.51878 1.5 7 1.5C5.48122 1.5 4.25 2.73122 4.25 4.25C4.25 5.53662 5.13357 6.61687 6.32704 6.91706C6.64202 6.55055 7.00446 6.226 7.40482 5.95294C7.27488 5.98371 7.13934 6 7 6C6.0335 6 5.25 5.2165 5.25 4.25C5.25 3.2835 6.0335 2.5 7 2.5C7.9665 2.5 8.75 3.2835 8.75 4.25C8.75 4.73141 8.55561 5.16743 8.24104 5.48382C8.67558 5.28783 9.14016 5.14664 9.62596 5.06907ZM15 10.5C15 12.9853 12.9853 15 10.5 15C8.01472 15 6 12.9853 6 10.5C6 8.01472 8.01472 6 10.5 6C12.9853 6 15 8.01472 15 10.5ZM8.14684 10.146L8.14433 10.1486C8.09744 10.196 8.06198 10.2505 8.03794 10.3086C8.01385 10.3667 8.0004 10.4303 8.00001 10.497L8 10.5L8.00001 10.503C8.0004 10.5697 8.01385 10.6333 8.03794 10.6914C8.06234 10.7504 8.09851 10.8056 8.14645 10.8536L10.1464 12.8536C10.3417 13.0488 10.6583 13.0488 10.8536 12.8536C11.0488 12.6583 11.0488 12.3417 10.8536 12.1464L9.70711 11H12.5C12.7761 11 13 10.7761 13 10.5C13 10.2239 12.7761 10 12.5 10H9.70711L10.8536 8.85355C11.0488 8.65829 11.0488 8.34171 10.8536 8.14645C10.6583 7.95118 10.3417 7.95118 10.1464 8.14645L8.14684 10.146Z\"\n        />\n      </svg>\n    ),\n    'edit-svg': (\n      <svg\n        viewBox=\"0 0 24 24\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"16\"\n        height=\"16\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        className={buttonIconStyles.button}\n      >\n        <g className={buttonIconStyles.icon}>\n          <path d=\"M20.9519 3.0481C19.5543 1.65058 17.2885 1.65064 15.8911 3.04825L3.94103 14.9997C3.5347 15.4061 3.2491 15.9172 3.116 16.4762L2.02041 21.0777C1.96009 21.3311 2.03552 21.5976 2.21968 21.7817C2.40385 21.9659 2.67037 22.0413 2.92373 21.981L7.52498 20.8855C8.08418 20.7523 8.59546 20.4666 9.00191 20.0601L20.952 8.10861C22.3493 6.71112 22.3493 4.4455 20.9519 3.0481ZM16.9518 4.10884C17.7634 3.29709 19.0795 3.29705 19.8912 4.10876C20.7028 4.9204 20.7029 6.23632 19.8913 7.04801L19 7.93946L16.0606 5.00012L16.9518 4.10884ZM15 6.06084L17.9394 9.00018L7.94119 18.9995C7.73104 19.2097 7.46668 19.3574 7.17755 19.4263L3.76191 20.2395L4.57521 16.8237C4.64402 16.5346 4.79168 16.2704 5.00175 16.0603L15 6.06084Z\" />\n        </g>\n      </svg>\n    ),\n    'leave-svg': (\n      <svg\n        viewBox=\"0 0 24 24\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        className={buttonIconStyles.button}\n      >\n        <g className={buttonIconStyles.icon}>\n          <path\n            className={buttonIconStyles.iconUnfilled}\n            d=\"M6.25 2C5.00736 2 4 3.00736 4 4.25V19.75C4 20.9926 5.00736 22 6.25 22H12.8096C12.3832 21.5557 12.0194 21.051 11.7322 20.5H6.25C5.83579 20.5 5.5 20.1642 5.5 19.75V4.25C5.5 3.83579 5.83579 3.5 6.25 3.5H17.75C18.1642 3.5 18.5 3.83579 18.5 4.25V11.0764C19.0232 11.1572 19.5258 11.3004 20 11.4982V4.25C20 3.00736 18.9926 2 17.75 2H6.25ZM17.5 23C20.5376 23 23 20.5376 23 17.5C23 14.4624 20.5376 12 17.5 12C14.4624 12 12 14.4624 12 17.5C12 20.5376 14.4624 23 17.5 23ZM21 17.5C21 17.7761 20.7761 18 20.5 18H15.7071L17.3536 19.6464C17.5488 19.8417 17.5488 20.1583 17.3536 20.3536C17.1583 20.5488 16.8417 20.5488 16.6464 20.3536L14.1464 17.8536C13.9512 17.6583 13.9512 17.3417 14.1464 17.1464L16.6464 14.6464C16.8417 14.4512 17.1583 14.4512 17.3536 14.6464C17.5488 14.8417 17.5488 15.1583 17.3536 15.3536L15.7071 17H20.5C20.7761 17 21 17.2239 21 17.5ZM8.5 13.25C9.32843 13.25 10 12.5784 10 11.75C10 10.9216 9.32843 10.25 8.5 10.25C7.67157 10.25 7 10.9216 7 11.75C7 12.5784 7.67157 13.25 8.5 13.25Z\"\n          />\n          <path\n            className={buttonIconStyles.iconFilled}\n            d=\"M6.25 2.75C5.42157 2.75 4.75 3.42157 4.75 4.25V19.75C4.75 20.5784 5.42157 21.25 6.25 21.25H12.1902C11.4405 20.1905 11 18.8967 11 17.5C11 13.9101 13.9101 11 17.5 11C18.1063 11 18.6932 11.083 19.25 11.2383V4.25C19.25 3.42157 18.5784 2.75 17.75 2.75H6.25ZM8.5 13.25C7.67157 13.25 7 12.5784 7 11.75C7 10.9216 7.67157 10.25 8.5 10.25C9.32843 10.25 10 10.9216 10 11.75C10 12.5784 9.32843 13.25 8.5 13.25ZM17.5 23C20.5376 23 23 20.5376 23 17.5C23 14.4624 20.5376 12 17.5 12C14.4624 12 12 14.4624 12 17.5C12 20.5376 14.4624 23 17.5 23ZM21 17.5C21 17.7761 20.7761 18 20.5 18H15.7071L17.3536 19.6464C17.5488 19.8417 17.5488 20.1583 17.3536 20.3536C17.1583 20.5488 16.8417 20.5488 16.6464 20.3536L14.1464 17.8536C13.9512 17.6583 13.9512 17.3417 14.1464 17.1464L16.6464 14.6464C16.8417 14.4512 17.1583 14.4512 17.3536 14.6464C17.5488 14.8417 17.5488 15.1583 17.3536 15.3536L15.7071 17H20.5C20.7761 17 21 17.2239 21 17.5Z\"\n          />\n        </g>\n      </svg>\n    ),\n    'people-add-svg': (\n      <svg\n        viewBox=\"0 0 24 24\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        className={buttonIconStyles.button}\n      >\n        <g className={buttonIconStyles.icon}>\n          <path\n            className={buttonIconStyles.iconUnfilled}\n            d=\"M5.5 7C5.5 5.61929 6.61929 4.5 8 4.5C9.38071 4.5 10.5 5.61929 10.5 7C10.5 8.38071 9.38071 9.5 8 9.5C6.61929 9.5 5.5 8.38071 5.5 7ZM8 3C5.79086 3 4 4.79086 4 7C4 9.20914 5.79086 11 8 11C10.2091 11 12 9.20914 12 7C12 4.79086 10.2091 3 8 3ZM15.5 8C15.5 7.17157 16.1716 6.5 17 6.5C17.8284 6.5 18.5 7.17157 18.5 8C18.5 8.82843 17.8284 9.5 17 9.5C16.1716 9.5 15.5 8.82843 15.5 8ZM17 5C15.3431 5 14 6.34315 14 8C14 9.65685 15.3431 11 17 11C18.6569 11 20 9.65685 20 8C20 6.34315 18.6569 5 17 5ZM4.25 13C3.00736 13 2 14.0074 2 15.25V15.5011L2 15.5022L2.00001 15.5048L2.00007 15.5111L2.00035 15.5277C2.00064 15.5406 2.00117 15.5571 2.0021 15.5771C2.00396 15.6169 2.00745 15.6705 2.01398 15.7358C2.02701 15.8661 2.05233 16.045 2.10165 16.2564C2.19995 16.6776 2.39654 17.2404 2.79183 17.8051C3.61066 18.9749 5.17178 20 8 20C9.36897 20 10.4411 19.7598 11.2758 19.3793C11.1268 18.8851 11.035 18.366 11.0082 17.8299C10.3633 18.2108 9.41267 18.5 8 18.5C5.57822 18.5 4.51434 17.6501 4.02067 16.9449C3.75971 16.5721 3.62818 16.1974 3.56241 15.9155C3.5297 15.7753 3.514 15.6612 3.50653 15.5865C3.50281 15.5493 3.50117 15.5222 3.50047 15.5072L3.5 15.4947V15.25C3.5 14.8358 3.83579 14.5 4.25 14.5H11.7322C11.9807 14.0233 12.2865 13.5813 12.6405 13.1831C12.3674 13.0653 12.0663 13 11.75 13H4.25ZM23 17.5C23 14.4624 20.5376 12 17.5 12C14.4624 12 12 14.4624 12 17.5C12 20.5376 14.4624 23 17.5 23C20.5376 23 23 20.5376 23 17.5ZM18.0006 18L18.0011 20.5035C18.0011 20.7797 17.7773 21.0035 17.5011 21.0035C17.225 21.0035 17.0011 20.7797 17.0011 20.5035L17.0006 18H14.4956C14.2197 18 13.9961 17.7762 13.9961 17.5C13.9961 17.2239 14.2197 17 14.4956 17H17.0005L17 14.4993C17 14.2231 17.2239 13.9993 17.5 13.9993C17.7761 13.9993 18 14.2231 18 14.4993L18.0005 17H20.4966C20.7725 17 20.9961 17.2239 20.9961 17.5C20.9961 17.7762 20.7725 18 20.4966 18H18.0006Z\"\n          />\n          <path\n            className={buttonIconStyles.iconFilled}\n            d=\"M8 11C10.2091 11 12 9.20914 12 7C12 4.79086 10.2091 3 8 3C5.79086 3 4 4.79086 4 7C4 9.20914 5.79086 11 8 11ZM17 11C18.6569 11 20 9.65685 20 8C20 6.34315 18.6569 5 17 5C15.3431 5 14 6.34315 14 8C14 9.65685 15.3431 11 17 11ZM4.25 13C3.00736 13 2 14.0074 2 15.25V15.5C2 15.5 2 20 8 20C9.38985 20 10.4578 19.7585 11.2783 19.3875C11.0973 18.7901 11 18.1564 11 17.5C11 15.8431 11.6199 14.3311 12.6405 13.1831C12.3674 13.0653 12.0663 13 11.75 13H4.25ZM23 17.5C23 14.4624 20.5376 12 17.5 12C14.4624 12 12 14.4624 12 17.5C12 20.5376 14.4624 23 17.5 23C20.5376 23 23 20.5376 23 17.5ZM18.0006 18L18.0011 20.5035C18.0011 20.7797 17.7773 21.0035 17.5011 21.0035C17.225 21.0035 17.0011 20.7797 17.0011 20.5035L17.0006 18H14.4956C14.2197 18 13.9961 17.7762 13.9961 17.5C13.9961 17.2239 14.2197 17 14.4956 17H17.0005L17 14.4993C17 14.2231 17.2239 13.9993 17.5 13.9993C17.7761 13.9993 18 14.2231 18 14.4993L18.0005 17H20.4966C20.7725 17 20.9961 17.2239 20.9961 17.5C20.9961 17.7762 20.7725 18 20.4966 18H18.0006Z\"\n          />\n        </g>\n      </svg>\n    )\n  });\n  registerIcons({ icons });\n};\n\nexport { registerAppIcons };\n","import { ErrorBar, FluentThemeProvider, MessageThread, SendBox, MessageThreadStyles } from '@azure/communication-react';\nimport { FluentTheme } from '@fluentui/react';\nimport { FluentProvider, makeStyles, shorthands, webLightTheme } from '@fluentui/react-components';\nimport { Person, PersonCardInteraction, Spinner } from '@microsoft/mgt-react';\nimport React, { useEffect, useState } from 'react';\nimport { StatefulGraphChatClient } from '../../statefulClient/StatefulGraphChatClient';\nimport { useGraphChatClient } from '../../statefulClient/useGraphChatClient';\nimport { onRenderMessage } from '../../utils/chat';\nimport { renderMGTMention } from '../../utils/mentions';\nimport { registerAppIcons } from '../styles/registerIcons';\nimport { ChatHeader } from '../ChatHeader/ChatHeader';\nimport { Error } from '../Error/Error';\nimport { LoadingMessagesErrorIcon } from '../Error/LoadingMessageErrorIcon';\nimport { OpenTeamsLinkError } from '../Error/OpenTeams';\nimport { RequireValidChatId } from '../Error/RequireAValidChatId';\nimport { TypeANewMessage } from '../Error/TypeANewMessage';\n\nregisterAppIcons();\n\ninterface IMgtChatProps {\n  chatId: string;\n}\n\nconst useStyles = makeStyles({\n  chat: {\n    display: 'flex',\n    flexDirection: 'column',\n    height: '100%',\n    ...shorthands.overflow('auto'),\n    paddingBlockEnd: '12px',\n    backgroundColor: 'var(--Neutral-Background-2-Rest, #FAFAFA)'\n  },\n  chatMessages: {\n    height: 'auto',\n    ...shorthands.paddingInline('20px'),\n    ...shorthands.overflow('auto'),\n    '& img': {\n      maxWidth: '100%',\n      height: 'auto'\n    },\n\n    '& ul': {\n      ...shorthands.padding('unset')\n    },\n    '& .ui-chat__item__message': {\n      marginLeft: 'unset',\n      '& ul': {\n        ...shorthands.paddingInline('40px', '0px')\n      }\n    },\n    '& .fui-Chat': {\n      maxWidth: 'unset'\n    }\n  },\n  chatInput: {\n    ...shorthands.paddingInline('16px'),\n    ...shorthands.overflow('unset')\n  },\n  fullHeight: {\n    height: '100%'\n  },\n  spinner: {\n    justifyContent: 'center',\n    display: 'flex',\n    alignItems: 'center',\n    height: '100%'\n  },\n  unsupportedContent: {\n    color: 'red'\n  }\n});\n\n/**\n * Styling for the MessageThread and its components.\n */\nconst messageThreadStyles: MessageThreadStyles = {\n  chatContainer: {\n    '& .ui-box': {\n      zIndex: 'unset',\n      '& div[data-ui-status]': {\n        display: 'inline-flex',\n        justifyContent: 'center'\n      }\n    }\n  },\n  chatMessageContainer: {\n    '& p>mgt-person,msft-mention': {\n      display: 'inline-block',\n      ...shorthands.marginInline('0px')\n    },\n    '& .otherMention': {\n      color: 'var(--accent-base-color)',\n      ...shorthands.margin('0px')\n    }\n  },\n  myChatMessageContainer: {\n    '& p>mgt-person,msft-mention': {\n      display: 'inline-block',\n      ...shorthands.marginInline('0px')\n    },\n    '& .otherMention': {\n      color: 'var(--accent-base-color)',\n      ...shorthands.margin('0px')\n    }\n  }\n};\n\nexport const Chat = ({ chatId }: IMgtChatProps) => {\n  const styles = useStyles();\n  const chatClient: StatefulGraphChatClient = useGraphChatClient(chatId);\n  const [chatState, setChatState] = useState(chatClient.getState());\n  useEffect(() => {\n    chatClient.onStateChange(setChatState);\n    return () => {\n      chatClient.offStateChange(setChatState);\n    };\n  }, [chatClient]);\n\n  const isLoading = ['creating server connections', 'subscribing to notifications', 'loading messages'].includes(\n    chatState.status\n  );\n\n  const disabled = !chatId || !!chatState.activeErrorMessages.length;\n  const placeholderText = disabled ? 'You cannot send a message' : 'Type a message...';\n\n  return (\n    <FluentThemeProvider fluentTheme={FluentTheme}>\n      <FluentProvider id=\"fluentui\" theme={webLightTheme} className={styles.fullHeight}>\n        <div className={styles.chat}>\n          <ChatHeader chatState={chatState} />\n          {chatState.userId && chatId && chatState.messages.length > 0 ? (\n            <>\n              <div className={styles.chatMessages}>\n                <MessageThread\n                  userId={chatState.userId}\n                  messages={chatState.messages}\n                  showMessageDate={true}\n                  disableEditing={chatState.disableEditing}\n                  numberOfChatMessagesToReload={chatState.numberOfChatMessagesToReload}\n                  onLoadPreviousChatMessages={chatState.onLoadPreviousChatMessages}\n                  // TODO: Messages date rendering is behind beta flag, find out how to enable it\n                  // onDisplayDateTimeString={(date: Date) => date.toISOString()}\n\n                  // current behavior for re-send is a delete call with the clientMessageId and the a new send call\n                  onDeleteMessage={chatState.onDeleteMessage}\n                  onSendMessage={chatState.onSendMessage}\n                  onUpdateMessage={chatState.onUpdateMessage}\n                  // render props\n                  onRenderAvatar={(userId?: string) => {\n                    return (\n                      <Person\n                        userId={userId}\n                        avatarSize=\"small\"\n                        personCardInteraction={PersonCardInteraction.hover}\n                        showPresence={true}\n                      />\n                    );\n                  }}\n                  styles={messageThreadStyles}\n                  mentionOptions={{\n                    displayOptions: {\n                      onRenderMention: renderMGTMention(chatState)\n                    }\n                  }}\n                  onRenderMessage={onRenderMessage}\n                />\n              </div>\n              <div className={styles.chatInput}>\n                <SendBox onSendMessage={chatState.onSendMessage} strings={{ placeholderText }} />\n              </div>\n            </>\n          ) : (\n            <>\n              {isLoading && (\n                <div className={styles.spinner}>\n                  <Spinner /> <br />\n                  {chatState.status}\n                </div>\n              )}\n              {chatState.status === 'no messages' && (\n                <Error\n                  icon={LoadingMessagesErrorIcon}\n                  message=\"No messages were found for this chat.\"\n                  subheading={TypeANewMessage}\n                ></Error>\n              )}\n              {chatState.status === 'no chat id' && (\n                <Error message=\"No chat id has been provided.\" subheading={RequireValidChatId}></Error>\n              )}\n              {chatState.status === 'error' && (\n                <Error message=\"We're sorrywe've run into an issue..\" subheading={OpenTeamsLinkError}></Error>\n              )}\n              <div className={styles.chatInput}>\n                <SendBox disabled={disabled} onSendMessage={chatState.onSendMessage} strings={{ placeholderText }} />\n              </div>\n            </>\n          )}\n        </div>\n      </FluentProvider>\n    </FluentThemeProvider>\n  );\n};\n","import React from 'react';\nimport { Chat } from '@microsoft/microsoft-graph-types';\nimport { PeopleTeam24Regular, Person24Regular, bundleIcon } from '@fluentui/react-icons';\nimport { error } from '@microsoft/mgt-element';\nimport { Circle } from '../Circle/Circle';\n\nconst GroupIcon = bundleIcon(PeopleTeam24Regular, PeopleTeam24Regular);\nconst PersonIcon = bundleIcon(Person24Regular, Person24Regular);\nexport const ChatListItemIcon = ({ chatType }: Chat): JSX.Element | null => {\n  if (!chatType) return null;\n\n  const iconColor = 'var(--colorBrandForeground2)';\n\n  switch (chatType) {\n    case 'oneOnOne':\n      return (\n        <Circle>\n          <PersonIcon color={iconColor} />\n        </Circle>\n      );\n    case 'group':\n      return (\n        <Circle>\n          <GroupIcon color={iconColor} />\n        </Circle>\n      );\n    default:\n      error(`Attempted to render an icon for chat of type: ${chatType}`);\n      return null;\n  }\n};\n","import React from 'react';\nimport { makeStyles, shorthands } from '@fluentui/react-components';\nimport { ChatListItemIcon } from '../ChatListItemIcon/ChatListItemIcon';\nimport { MgtTemplateProps } from '@microsoft/mgt-react';\n\nconst useStyles = makeStyles({\n  defaultProfileImage: {\n    ...shorthands.borderRadius('50%'),\n    objectFit: 'cover',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center'\n  }\n});\n\nexport const DefaultProfileIcon = (_: MgtTemplateProps) => {\n  const styles = useStyles();\n  const oneOnOneProfilePicture = <ChatListItemIcon chatType=\"oneOnOne\" />;\n  return <div className={styles.defaultProfileImage}>{oneOnOneProfilePicture}</div>;\n};\n","import React, { useState, useEffect, useRef } from 'react';\nimport { makeStyles, mergeClasses, shorthands } from '@fluentui/react-components';\nimport {\n  Chat,\n  ConversationMember,\n  AadUserConversationMember,\n  NullableOption,\n  TeamworkApplicationIdentity,\n  TeamsAppInstallation\n} from '@microsoft/microsoft-graph-types';\nimport { Person, PersonCardInteraction } from '@microsoft/mgt-react';\nimport { ProviderState, Providers, error } from '@microsoft/mgt-element';\nimport { ChatListItemIcon } from '../ChatListItemIcon/ChatListItemIcon';\nimport { rewriteEmojiContentToText } from '../../utils/rewriteEmojiContent';\nimport { convert } from 'html-to-text';\nimport { loadChatWithPreview, loadAppsInChat } from '../../statefulClient/graph.chat';\nimport { DefaultProfileIcon } from './DefaultProfileIcon';\n\ninterface IMgtChatListItemProps {\n  chat: Chat;\n  myId: string | undefined;\n  isSelected: boolean;\n  isRead: boolean;\n}\n\ninterface EventMessageDetailWithType {\n  '@odata.type': string;\n}\n\nconst ignoreBotsWithName = ['Updates'];\n\nconst useStyles = makeStyles({\n  // highlight selection\n  isSelected: {\n    backgroundColor: '#e6f7ff'\n  },\n\n  isUnSelected: {\n    backgroundColor: '#ffffff'\n  },\n\n  // highlight text\n  isBold: {\n    fontWeight: 'bold'\n  },\n\n  isNormal: {\n    fontWeight: 'normal'\n  },\n\n  chatListItem: {\n    display: 'flex',\n    alignItems: 'center',\n    width: '100%',\n    paddingRight: '10px',\n    paddingLeft: '10px'\n  },\n\n  profileImage: {\n    ...shorthands.flex(0, 0, 'auto'),\n    marginRight: '10px',\n    objectFit: 'cover',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center'\n  },\n\n  defaultProfileImage: {\n    ...shorthands.borderRadius('50%'),\n    objectFit: 'cover',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center'\n  },\n\n  chatInfo: {\n    flexGrow: 1,\n    flexShrink: 1,\n    minWidth: 0,\n    ...shorthands.padding('5px')\n  },\n\n  chatTitle: {\n    textAlign: 'left',\n    ...shorthands.margin('0'),\n    fontSize: '1em',\n    color: '#333',\n    textOverflow: 'ellipsis',\n    ...shorthands.overflow('hidden'),\n    whiteSpace: 'nowrap',\n    width: 'auto'\n  },\n\n  chatMessage: {\n    fontSize: '0.9em',\n    color: '#666',\n    textAlign: 'left',\n    ...shorthands.margin('0'),\n    textOverflow: 'ellipsis',\n    ...shorthands.overflow('hidden'),\n    whiteSpace: 'nowrap',\n    width: 'auto'\n  },\n\n  chatTimestamp: {\n    flexShrink: 0,\n    textAlign: 'right',\n    alignSelf: 'start',\n    marginLeft: 'auto',\n    paddingLeft: '10px',\n    fontSize: '0.8em',\n    color: '#999',\n    whiteSpace: 'nowrap'\n  },\n\n  person: {\n    '--person-avatar-size': '32px',\n    '--person-alignment': 'center'\n  }\n});\n\n// regex to match different tags\nconst imageTagRegex = /(<img[^>]+)/;\nconst attachmentTagRegex = /(<attachment[^>]+)/;\nconst systemEventTagRegex = /(<systemEventMessage[^>]+)/;\n\nexport const ChatListItem = ({ chat, myId, isSelected, isRead }: IMgtChatListItemProps) => {\n  const styles = useStyles();\n\n  // manage the internal state of the chat\n  const [chatInternal, setChatInternal] = useState(chat);\n  const [apps, setApps] = useState<TeamsAppInstallation[]>();\n  const isAppsLoadingOrLoaded = useRef(false);\n\n  // if chat changes, update the internal state to match\n  useEffect(() => {\n    if (chatInternal.id !== chat.id) {\n      setApps(undefined);\n      isAppsLoadingOrLoaded.current = false;\n    }\n\n    setChatInternal(chat);\n  }, [chat]);\n\n  // enrich the chat if necessary\n  useEffect(() => {\n    if (isLoaded()) {\n      const provider = Providers.globalProvider;\n      if (provider && provider.state === ProviderState.SignedIn) {\n        const graph = provider.graph.forComponent('ChatListItem');\n        const load = (id: string): Promise<Chat> => {\n          return loadChatWithPreview(graph, id);\n        };\n        load(chatInternal.id!).then(\n          c => {\n            setChatInternal(c);\n          },\n          e => error(e)\n        );\n      }\n    }\n  }, [chatInternal]);\n\n  const startLoadingAppsInChat = async (chatId: string) => {\n    // ensure this is only called once\n    if (isAppsLoadingOrLoaded.current) {\n      return;\n    }\n\n    // make sure there is a logged in graph provider\n    const provider = Providers.globalProvider;\n    if (!provider || provider.state !== ProviderState.SignedIn) {\n      return;\n    }\n\n    // set to loading\n    isAppsLoadingOrLoaded.current = true;\n\n    // load the apps\n    const graph = provider.graph.forComponent('ChatListItem');\n    try {\n      const appsResponse = await loadAppsInChat(graph, chatId);\n      setApps(appsResponse.value);\n    } catch (e) {\n      error(e);\n      setApps([]);\n    }\n  };\n\n  const isLoaded = () => {\n    return chatInternal.id && (!chatInternal.chatType || !chatInternal.members);\n  };\n\n  // shortcut if no valid user\n  if (!myId) {\n    return <></>;\n  }\n\n  const getMemberName = (member: ConversationMember): string => {\n    return member?.displayName || (member as AadUserConversationMember)?.email || member?.id || 'Unknown';\n  };\n\n  const getTitleFromNames = (names: string[], useFirstNamesIfAppropriate: boolean) => {\n    names = names.sort();\n    if (names.length === 1) {\n      return names[0];\n    }\n\n    if (names.length === 2 && useFirstNamesIfAppropriate) {\n      const firstNames = names.map(n => n.split(' ')[0]);\n      return firstNames.join(' and ');\n    }\n\n    if (names.length === 2) {\n      return names.join(' and ');\n    }\n\n    if (names.length === 3 && useFirstNamesIfAppropriate) {\n      const firstNames = names.map(n => n.split(' ')[0]);\n      return firstNames.join(', ');\n    }\n\n    if (names.length === 3) {\n      return names.join(', ');\n    }\n\n    if (names.length > 3 && useFirstNamesIfAppropriate) {\n      const firstNames = names.map(n => n.split(' ')[0]);\n      const firstThree = firstNames.slice(0, 3);\n      const remainingCount = names.length - 3 + 1; // +1 for the current user\n      return firstThree.join(', ') + ' +' + remainingCount;\n    }\n\n    if (names.length > 3) {\n      const firstThree = names.slice(0, 3);\n      const remainingCount = names.length - 3 + 1; // +1 for the current user\n      return firstThree.join(', ') + ' +' + remainingCount;\n    }\n  };\n\n  // Copied and modified from the sample ChatItem.tsx\n  // Determines the title in the case of 1:1 and self chats\n  // Self Chats are not possible, however, 1:1 chats with a bot will show no other members other than self.\n  const getTitleFromChat = (c: Chat) => {\n    // use the topic if available\n    if (c.topic) {\n      return c.topic;\n    }\n\n    const others = (c.members || []).filter(m => (m as AadUserConversationMember).userId !== myId);\n\n    // when there are no other people, and we have bot information to make the most informed decision\n    if (others.length === 0 && apps) {\n      const names = apps\n        .filter(\n          a =>\n            a.teamsAppDefinition?.bot?.id &&\n            a.teamsAppDefinition?.displayName &&\n            ignoreBotsWithName.indexOf(a.teamsAppDefinition?.displayName) === -1\n        )\n        .map(a => a.teamsAppDefinition!.displayName!);\n      if (names.length > 0) {\n        const unique = names.filter((n, i) => names.indexOf(n) === i);\n        return getTitleFromNames(unique, false);\n      }\n      const me = c.members?.find(m => (m as AadUserConversationMember).userId === myId);\n      return me ? getMemberName(me) : 'Me';\n    }\n\n    const application = c.lastMessagePreview?.from?.application as TeamworkApplicationIdentity;\n\n    // when there are no people, and we don't have any bot information but we do have application information\n    if (others.length === 0 && application) {\n      startLoadingAppsInChat(c.id!);\n      return application.displayName ? application.displayName : application.id;\n    }\n\n    // when there are no people, and we don't have any bot or application information\n    if (others.length === 0) {\n      startLoadingAppsInChat(c.id!);\n      return c.id;\n    }\n\n    // when there are people, use them\n    if (others.length > 0) {\n      const names = others.map(o => getMemberName(o));\n      return getTitleFromNames(names, true);\n    }\n\n    return c.id;\n  };\n\n  // Derives the timestamp to display\n  const extractTimestamp = (timestamp: NullableOption<string>): string => {\n    if (!timestamp) return '';\n    const currentDate = new Date();\n    const date = new Date(timestamp);\n\n    const [month, day, year] = [date.getMonth(), date.getDate(), date.getFullYear()];\n    const [currentMonth, currentDay, currentYear] = [\n      currentDate.getMonth(),\n      currentDate.getDate(),\n      currentDate.getFullYear()\n    ];\n\n    // if the message was sent today, return the time\n    if (currentDay === day && currentMonth === month && currentYear === year) {\n      return date.toLocaleTimeString(navigator.language, { hour: 'numeric', minute: '2-digit' });\n    }\n\n    // if the message was sent in a previous year, include the year\n    if (currentYear !== year) {\n      return date.toLocaleDateString(navigator.language, { month: 'numeric', day: 'numeric', year: 'numeric' });\n    }\n\n    // otherwise, return the month and day\n    return date.toLocaleDateString(navigator.language, { month: 'numeric', day: 'numeric' });\n  };\n\n  // Chooses the correct timestamp to display\n  const determineCorrectTimestamp = (c: Chat) => {\n    let timestamp: NullableOption<string>;\n\n    // lastMessageTime is the time of the last message sent in the chat\n    // lastUpdatedTime is Date and time at which the chat was renamed or list of members were last changed.\n    const lastMessageTime = c.lastMessagePreview?.createdDateTime\n      ? new Date(c.lastMessagePreview.createdDateTime)\n      : null;\n    const lastUpdatedTime = c.lastUpdatedDateTime ? new Date(c.lastUpdatedDateTime) : null;\n\n    if (lastMessageTime && lastUpdatedTime && lastMessageTime > lastUpdatedTime) {\n      timestamp = String(lastMessageTime);\n    } else if (lastMessageTime && lastUpdatedTime && lastUpdatedTime > lastMessageTime) {\n      timestamp = String(lastUpdatedTime);\n    } else if (lastMessageTime) {\n      timestamp = String(lastMessageTime);\n    } else if (lastUpdatedTime) {\n      timestamp = String(lastUpdatedTime);\n    } else {\n      timestamp = null;\n    }\n\n    return timestamp;\n  };\n\n  const getDefaultProfileImage = (c: Chat) => {\n    // define the JSX for FluentUI Icons + Styling\n    const oneOnOneProfilePicture = <ChatListItemIcon chatType=\"oneOnOne\" />;\n    const GroupProfilePicture = <ChatListItemIcon chatType=\"group\" />;\n\n    const other = c.members?.find(m => (m as AadUserConversationMember).userId !== myId);\n    const otherAad = other as AadUserConversationMember;\n\n    switch (true) {\n      case c.chatType === 'oneOnOne':\n        return (\n          <Person\n            className={styles.person}\n            userId={otherAad?.userId ?? undefined}\n            avatarSize=\"small\"\n            showPresence={true}\n            personCardInteraction={PersonCardInteraction.hover}\n          >\n            <DefaultProfileIcon template=\"no-data\" />\n          </Person>\n        );\n      case c.chatType === 'group':\n        return GroupProfilePicture;\n      default:\n        return oneOnOneProfilePicture;\n    }\n  };\n\n  const getLastMessagePreviewPrefix = (c: Chat) => {\n    // if the last message was sent by the current user, display 'You: '\n    if (c.lastMessagePreview?.from?.user?.id === myId) {\n      return 'You: ';\n    }\n\n    // if you are only chatting with one other person, don't display their name\n    if (c.chatType === 'oneOnOne') {\n      return '';\n    }\n\n    // if the last message was sent from a user, use their display name\n    if (c.lastMessagePreview?.from?.user?.displayName) {\n      return `${c.lastMessagePreview.from.user.displayName}: `;\n    }\n\n    // if the last message is from a bot and we have all the app info, use the app name\n    if (c.lastMessagePreview?.from?.application?.id && apps) {\n      const app = apps.find(a => a.teamsAppDefinition?.bot?.id === c.lastMessagePreview?.from?.application?.id);\n      if (app && app.teamsAppDefinition?.displayName) {\n        return `${app.teamsAppDefinition.displayName}: `;\n      }\n    }\n\n    // if the last message is from a bot and we don't have all the app info, load it\n    if (c.lastMessagePreview?.from?.application?.displayName) {\n      startLoadingAppsInChat(c.id!);\n      return `${c.lastMessagePreview.from.application.displayName}: `;\n    }\n\n    return '';\n  };\n\n  const enrichPreviewMessage = (c: Chat) => {\n    const prefix = getLastMessagePreviewPrefix(c);\n    let content = c.lastMessagePreview?.body?.content;\n\n    // handle null or undefined content\n    if (!content) {\n      if (c.lastMessagePreview?.isDeleted) {\n        return 'This message was deleted';\n      } else if (c.lastMessagePreview) {\n        return `${prefix}Sent a message`;\n      } else {\n        return '';\n      }\n    }\n\n    // handle HTML\n    if (c.lastMessagePreview?.body?.contentType === 'html') {\n      // handle images\n      const imageMatch = content.match(imageTagRegex);\n      if (imageMatch) {\n        return `${prefix}Sent an image`;\n      }\n\n      /* handle attachments\n       *\n       * NOTE: There is a discrepency between what the Graph API returns and what the Graph subscription\n       * notification sends in the case of attachments. The Graph API returns an empty content string so\n       * the preview will be 'Sent a message' whereas the Graph subscription notification returns HTML\n       * content with an attachment and will display 'Sent a file'. To make this consistent, we could\n       * change the below to 'Sent a message', however, the Teams client uses 'Sent a file'.\n       */\n      const attachmentMatch = content.match(attachmentTagRegex);\n      if (attachmentMatch) {\n        return `${prefix}Sent a file`;\n      }\n\n      /* handle system events\n       *\n       * NOTE: While Graph subscription notifications send events for both users being added and removed,\n       * the Graph API only returns a message for users being added.\n       */\n      const systemEventMessage = content.match(systemEventTagRegex);\n      if (systemEventMessage) {\n        const type = (c.lastMessagePreview?.eventDetail as EventMessageDetailWithType)?.['@odata.type'];\n        switch (type) {\n          case '#microsoft.graph.membersAddedEventMessageDetail':\n            return `${prefix}User added`;\n        }\n      }\n\n      // convert html to text\n      content = rewriteEmojiContentToText(content);\n      content = convert(content);\n    }\n\n    // handle general chats from people and bots\n    return `${prefix}${content}`;\n  };\n\n  const container = mergeClasses(\n    styles.chatListItem,\n    isSelected ? styles.isSelected : styles.isUnSelected,\n    isRead ? styles.isNormal : styles.isBold\n  );\n\n  // short cut if the id is not defined\n  if (!myId) {\n    return <></>;\n  }\n  return (\n    <div className={container}>\n      <div className={styles.profileImage}>{getDefaultProfileImage(chatInternal)}</div>\n      <div className={styles.chatInfo}>\n        <p className={styles.chatTitle}>{getTitleFromChat(chatInternal)}</p>\n        <p className={styles.chatMessage}>{enrichPreviewMessage(chatInternal)}</p>\n      </div>\n      <div className={styles.chatTimestamp}>{extractTimestamp(determineCorrectTimestamp(chatInternal))}</div>\n    </div>\n  );\n};\n","import { BetaGraph, IGraph, Providers, createFromProvider, error, log } from '@microsoft/mgt-element';\nimport {\n  HubConnection,\n  HubConnectionBuilder,\n  IHttpConnectionOptions,\n  LogLevel,\n  RetryContext\n} from '@microsoft/signalr';\nimport { ThreadEventEmitter } from './ThreadEventEmitter';\nimport type {\n  Entity,\n  Subscription,\n  ChatMessage,\n  Chat,\n  AadUserConversationMember\n} from '@microsoft/microsoft-graph-types';\nimport { GraphConfig } from './GraphConfig';\nimport { SubscriptionsCache, ComponentType } from './Caching/SubscriptionCache';\nimport { Timer } from '../utils/Timer';\n\nexport const appSettings = {\n  defaultSubscriptionLifetimeInMinutes: 10,\n  renewalThreshold: 75, // The number of seconds before subscription expires it will be renewed\n  renewalTimerInterval: 10, // The number of seconds between executions of the renewal timer\n  useCanary: GraphConfig.useCanary\n};\n\ntype ChangeTypes = 'created' | 'updated' | 'deleted';\n\ninterface Notification<T extends Entity> {\n  subscriptionId: string;\n  changeType: ChangeTypes;\n  resource: string;\n  resourceData: T & {\n    id: string;\n    '@odata.type': string;\n    '@odata.id': string;\n  };\n  EncryptedContent: string;\n}\n\ntype ReceivedNotification = Notification<Chat> | Notification<ChatMessage> | Notification<AadUserConversationMember>;\n\nconst isMessageNotification = (o: Notification<Entity>): o is Notification<ChatMessage> =>\n  o.resource.includes('/messages(');\nconst isMembershipNotification = (o: Notification<Entity>): o is Notification<AadUserConversationMember> =>\n  o.resource.includes('/members');\n\nexport class GraphNotificationUserClient {\n  private connection?: HubConnection = undefined;\n  private renewalInterval?: string;\n  private renewalCount = 0;\n  private isRewnewalInProgress = false;\n  private userId = '';\n  private currentUserId = '';\n  private get sessionId() {\n    return 'default';\n  }\n  private readonly subscriptionCache: SubscriptionsCache = new SubscriptionsCache();\n  private readonly timer = new Timer();\n  private get graph() {\n    return this._graph;\n  }\n  private get beta() {\n    return BetaGraph.fromGraph(this._graph);\n  }\n  private get subscriptionGraph() {\n    return GraphConfig.useCanary\n      ? createFromProvider(Providers.globalProvider, GraphConfig.canarySubscriptionVersion, 'mgt-chat')\n      : this.beta;\n  }\n\n  /**\n   *\n   */\n  constructor(\n    private readonly emitter: ThreadEventEmitter,\n    private readonly _graph: IGraph\n  ) {}\n\n  /**\n   * Removes any active timers that may exist to prevent memory leaks and perf issues.\n   * Call this method when the component that depends an instance of this class is being removed from the DOM\n   * i.e\n   */\n  public tearDown() {\n    log('cleaning up user graph notification resources');\n    if (this.renewalInterval) this.timer.clearInterval(this.renewalInterval);\n    this.timer.close();\n  }\n\n  private readonly getToken = async () => {\n    const token = await Providers.globalProvider.getAccessToken();\n    if (!token) throw new Error('Could not retrieve token for user');\n    return token;\n  };\n\n  // TODO: understand if this is needed under the native model\n  private readonly onReconnect = (connectionId: string | undefined) => {\n    log(`Reconnected. ConnectionId: ${connectionId || 'undefined'}`);\n    const emitter: ThreadEventEmitter | undefined = this.emitter;\n    emitter?.connected();\n  };\n\n  private readonly receiveNotificationMessage = (message: string) => {\n    if (typeof message !== 'string') throw new Error('Expected string from receivenotificationmessageasync');\n\n    const notification: ReceivedNotification = JSON.parse(message) as ReceivedNotification;\n    log('received user notification message', notification);\n    const emitter: ThreadEventEmitter | undefined = this.emitter;\n    if (!notification.resourceData) throw new Error('Message did not contain resourceData');\n    if (isMessageNotification(notification)) {\n      this.processMessageNotification(notification, emitter);\n    } else if (isMembershipNotification(notification)) {\n      this.processMembershipNotification(notification, emitter);\n    } else {\n      this.processChatPropertiesNotification(notification, emitter);\n    }\n    // Need to return a status code string of 200 so that graph knows the message was received and doesn't re-send the notification\n    const ackMessage: unknown = { StatusCode: '200' };\n    return GraphConfig.ackAsString ? JSON.stringify(ackMessage) : ackMessage;\n  };\n\n  private processMessageNotification(notification: Notification<ChatMessage>, emitter: ThreadEventEmitter | undefined) {\n    const message = notification.resourceData;\n\n    switch (notification.changeType) {\n      case 'created':\n        emitter?.chatMessageReceived(message);\n        return;\n      case 'updated':\n        emitter?.chatMessageEdited(message);\n        return;\n      case 'deleted':\n        emitter?.chatMessageDeleted(message);\n        return;\n      default:\n        throw new Error('Unknown change type');\n    }\n  }\n\n  private processMembershipNotification(\n    notification: Notification<AadUserConversationMember>,\n    emitter: ThreadEventEmitter | undefined\n  ) {\n    const member = notification.resourceData;\n    switch (notification.changeType) {\n      case 'created':\n        emitter?.participantAdded(member);\n        return;\n      case 'deleted':\n        emitter?.participantRemoved(member);\n        return;\n      default:\n        throw new Error('Unknown change type');\n    }\n  }\n\n  private processChatPropertiesNotification(notification: Notification<Chat>, emitter: ThreadEventEmitter | undefined) {\n    const chat = notification.resourceData;\n    switch (notification.changeType) {\n      case 'updated':\n        emitter?.chatThreadPropertiesUpdated(chat);\n        return;\n      case 'deleted':\n        emitter?.chatThreadDeleted(chat);\n        return;\n      default:\n        throw new Error('Unknown change type');\n    }\n  }\n\n  private readonly cacheSubscription = async (userId: string, subscriptionRecord: Subscription): Promise<void> => {\n    log(subscriptionRecord);\n    await this.subscriptionCache.cacheSubscription(userId, ComponentType.User, this.sessionId, subscriptionRecord);\n  };\n\n  private async subscribeToResource(userId: string, resourcePath: string, changeTypes: ChangeTypes[]) {\n    // build subscription request\n    const expirationDateTime = new Date(\n      new Date().getTime() + appSettings.defaultSubscriptionLifetimeInMinutes * 60 * 1000\n    ).toISOString();\n    const subscriptionDefinition: Subscription = {\n      changeType: changeTypes.join(','),\n      notificationUrl: `${GraphConfig.webSocketsPrefix}?groupId=${userId}&sessionId=${this.sessionId}`,\n      resource: resourcePath,\n      expirationDateTime,\n      includeResourceData: true,\n      clientState: 'wsssecret'\n    };\n\n    log('subscribing to changes for ' + resourcePath);\n    const subscriptionEndpoint = GraphConfig.subscriptionEndpoint;\n    // send subscription POST to Graph\n    const subscription: Subscription = (await this.subscriptionGraph\n      .api(subscriptionEndpoint)\n      .post(subscriptionDefinition)) as Subscription;\n    if (!subscription?.notificationUrl) throw new Error('Subscription not created');\n    log(subscription);\n\n    await this.cacheSubscription(userId, subscription);\n\n    // create a connection to the web socket if one does not exist\n    if (!this.connection) await this.createSignalRConnection(subscription.notificationUrl);\n\n    log('Invoked CreateSubscription');\n  }\n\n  private readonly renewalSync = () => {\n    void this.renewal();\n  };\n\n  private readonly renewal = async () => {\n    if (this.isRewnewalInProgress) {\n      log('Renewal already in progress');\n      return;\n    }\n\n    this.isRewnewalInProgress = true;\n\n    this.currentUserId = this.userId;\n\n    try {\n      const subscriptions =\n        (await this.subscriptionCache.loadSubscriptions(this.currentUserId, this.sessionId))?.subscriptions || [];\n      if (subscriptions.length === 0) {\n        log('No subscriptions found in session state. Creating a new subscription.');\n\n        await this.subscribeToResource(this.currentUserId, `/users/${this.currentUserId}/chats/getAllmessages`, [\n          'created',\n          'updated',\n          'deleted'\n        ]);\n      } else {\n        for (const subscription of subscriptions) {\n          if (!subscription.expirationDateTime || !subscription.id || !subscription.notificationUrl) continue;\n\n          const expirationTime = new Date(subscription.expirationDateTime);\n          const now = new Date();\n          const diff = Math.round((expirationTime.getTime() - now.getTime()) / 1000);\n\n          if (diff <= appSettings.renewalThreshold) {\n            this.renewalCount++;\n            log(`Renewing Graph subscription. RenewalCount: ${this.renewalCount}.`);\n\n            const newExpirationTime = new Date(\n              new Date().getTime() + appSettings.defaultSubscriptionLifetimeInMinutes * 60 * 1000\n            );\n\n            try {\n              await this.renewSubscription(this.currentUserId, subscription.id, newExpirationTime.toISOString());\n            } catch (e) {\n              error(e);\n              // this error indicates we are not able to successfully renew the subscription, so we should create a new one.\n              if ((e as { statusCode?: number }).statusCode === 404) {\n                log('Removing subscription from cache', subscription.id);\n                await this.subscriptionCache.deleteCachedSubscriptions(this.currentUserId, this.sessionId);\n                await this.subscribeToUserNotifications(this.currentUserId);\n\n                const emitter: ThreadEventEmitter | undefined = this.emitter;\n                emitter?.reconnected();\n              }\n            }\n          } else {\n            // create a connection to the web socket if one does not exist\n            if (!this.connection) await this.createSignalRConnection(subscription.notificationUrl);\n          }\n\n          // Expecting only one subscription per user\n          break;\n        }\n      }\n    } catch (e) {\n      error(e);\n    }\n\n    this.isRewnewalInProgress = false;\n    this.renewalInterval = this.timer.setTimeout(this.renewalSync, appSettings.renewalTimerInterval * 1000);\n  };\n\n  private readonly renewSubscription = async (\n    userId: string,\n    subscriptionId: string,\n    expirationDateTime: string\n  ): Promise<void> => {\n    // PATCH /subscriptions/{id}\n    const renewedSubscription = (await this.graph.api(`${GraphConfig.subscriptionEndpoint}/${subscriptionId}`).patch({\n      expirationDateTime\n    })) as Subscription;\n    return this.cacheSubscription(userId, renewedSubscription);\n  };\n\n  private async createSignalRConnection(notificationUrl: string) {\n    log('Creating SignalR connection');\n\n    const connectionOptions: IHttpConnectionOptions = {\n      accessTokenFactory: this.getToken,\n      withCredentials: false\n    };\n\n    // retry with the following intervals, the last interval will take precedence if there are more retries than intervals\n    const retryTimes = [0, 2000, 10000, 30000, 45000, 60000, 90000, 120000, 180000, 240000];\n    const retryPolicy = {\n      nextRetryDelayInMilliseconds: (context: RetryContext) => {\n        const index =\n          context.previousRetryCount < retryTimes.length ? context.previousRetryCount : retryTimes.length - 1;\n        return retryTimes[index];\n      }\n    };\n\n    const connection = new HubConnectionBuilder()\n      .withUrl(GraphConfig.adjustNotificationUrl(notificationUrl), connectionOptions)\n      .withAutomaticReconnect(retryPolicy)\n      .configureLogging(LogLevel.Information)\n      .build();\n\n    const emitter: ThreadEventEmitter | undefined = this.emitter;\n    connection.onclose((err?: Error) => {\n      if (err) {\n        log('Connection closed with error', err);\n      }\n\n      emitter?.disconnected();\n    });\n\n    connection.onreconnected(this.onReconnect);\n\n    connection.onreconnecting(() => {\n      emitter?.disconnected();\n    });\n\n    connection.on('receivenotificationmessageasync', this.receiveNotificationMessage);\n\n    connection.on('EchoMessage', log);\n\n    this.connection = connection;\n    try {\n      await connection.start();\n      log(connection);\n      emitter?.connected();\n    } catch (e) {\n      error('An error occurred connecting to the notification web socket', e);\n    }\n  }\n\n  private async deleteSubscription(id: string) {\n    try {\n      await this.graph.api(`${GraphConfig.subscriptionEndpoint}/${id}`).delete();\n      log(`Deleted subscription with id: ${id}`);\n    } catch (e) {\n      error(e);\n    }\n  }\n\n  private async removeSubscriptions(subscriptions: Subscription[]): Promise<unknown[]> {\n    const tasks: Promise<unknown>[] = [];\n    for (const s of subscriptions) {\n      // if there is no id or the subscription is expired, skip\n      if (!s.id || (s.expirationDateTime && new Date(s.expirationDateTime) <= new Date())) continue;\n      tasks.push(this.deleteSubscription(s.id));\n    }\n    return Promise.all(tasks);\n  }\n\n  public async closeSignalRConnection() {\n    // stop the connection and set it to undefined so it will reconnect when next subscription is created.\n    await this.connection?.stop();\n    this.connection = undefined;\n  }\n\n  public async unsubscribeFromUserNotifications(userId: string) {\n    if (this.renewalInterval) {\n      this.timer.clearTimeout(this.renewalInterval);\n    }\n\n    await this.closeSignalRConnection();\n    const cacheData = await this.subscriptionCache.loadSubscriptions(userId, this.sessionId);\n    if (cacheData) {\n      await Promise.all([\n        this.removeSubscriptions(cacheData.subscriptions),\n        this.subscriptionCache.deleteCachedSubscriptions(userId, this.sessionId)\n      ]);\n    }\n  }\n\n  public async subscribeToUserNotifications(userId: string) {\n    log(`User subscription with id: ${userId}`);\n    this.userId = userId;\n    await this.renewal();\n  }\n}\n","import {\n  Button,\n  Menu,\n  MenuItem,\n  MenuList,\n  MenuPopover,\n  MenuProps,\n  MenuTrigger,\n  makeStyles\n} from '@fluentui/react-components';\nimport { MoreHorizontal24Filled, MoreHorizontal24Regular, bundleIcon } from '@fluentui/react-icons';\nimport React from 'react';\nimport { ChatListMenuItem } from './ChatListMenuItem';\n\nconst EllipsisIcon = bundleIcon(MoreHorizontal24Filled, MoreHorizontal24Regular);\n\nconst menuProps: Partial<MenuProps> = {\n  inline: true,\n  hasIcons: false,\n  closeOnScroll: true,\n  positioning: 'below-start'\n};\n\nconst ellipsisMenuStyles = makeStyles({\n  menuPopover: {\n    zIndex: 10,\n    '& .fui-MenuItemLink__content': {\n      fontFamily: 'Segoe UI',\n      fontSize: '12px',\n      fontStyle: 'normal',\n      fontWeight: '600'\n    }\n  }\n});\nexport interface IChatListMenuItemsProps {\n  menuItems?: ChatListMenuItem[];\n}\n\nconst EllipsisMenu = (props: IChatListMenuItemsProps) => {\n  const styles = ellipsisMenuStyles();\n\n  const menuItems: ChatListMenuItem[] = props.menuItems === undefined ? [] : props.menuItems;\n\n  return (\n    <Menu {...menuProps}>\n      <MenuTrigger disableButtonEnhancement>\n        <Button appearance=\"transparent\" icon={<EllipsisIcon />} />\n      </MenuTrigger>\n      <MenuPopover className={styles.menuPopover}>\n        <MenuList>\n          {menuItems.map((menuItem, index) => (\n            <MenuItem key={index} content={menuItem.displayText} onClick={menuItem.onClick} />\n          ))}\n        </MenuList>\n      </MenuPopover>\n    </Menu>\n  );\n};\n\nexport { EllipsisMenu };\n","import React from 'react';\nimport { MgtTemplateProps } from '@microsoft/mgt-react';\nimport { makeStyles, shorthands, Button } from '@fluentui/react-components';\nimport { EllipsisMenu, IChatListMenuItemsProps } from './EllipsisMenu';\nimport { ChatListButtonItem } from './ChatListButtonItem';\nimport { Circle } from '../Circle/Circle';\n\nconst useStyles = makeStyles({\n  headerContainer: {\n    width: '100%'\n  },\n  controlsContainer: {\n    display: 'flex',\n    flexDirection: 'row',\n    justifyContent: 'space-between', // This distributes the space evenly\n    alignItems: 'center'\n  },\n  buttonIcon: {\n    flexGrow: 0,\n    flexShrink: 0,\n    flexBasis: '35px',\n    ...shorthands.borderRadius('50%'), // This will make it round\n    marginRight: '10px',\n    objectFit: 'cover', // This ensures the image covers the area without stretching\n    display: 'flex',\n    alignItems: 'center', // This will vertically center the image\n    justifyContent: 'center' // This will horizontally center the image\n  },\n  button: {\n    ...shorthands.border('none'),\n    ...shorthands.padding(0), // Remove padding\n    minWidth: 0, // Allow the button to shrink to the size of its content\n    '&:hover': {\n      backgroundColor: 'transparent'\n    }\n  },\n  bannerClassName: {\n    backgroundColor: '#FFE1A7',\n    textAlign: 'center',\n    fontWeight: 'bold',\n    fontStyle: 'italic',\n    paddingTop: '5px',\n    paddingBottom: '5px',\n    marginBottom: '5px'\n  }\n});\n\n// this is a stub to move the logic here that should end up here.\nexport const ChatListHeader = (\n  props: MgtTemplateProps &\n    IChatListMenuItemsProps & {\n      buttonItems?: ChatListButtonItem[];\n      bannerMessage: string;\n    }\n) => {\n  const classes = useStyles();\n\n  const buttonItems: ChatListButtonItem[] = props.buttonItems === undefined ? [] : props.buttonItems;\n  return (\n    <div className={classes.headerContainer}>\n      {props.bannerMessage !== '' && <div className={classes.bannerClassName}>{props.bannerMessage}</div>}\n      <div className={classes.controlsContainer}>\n        <div>\n          {buttonItems.map((buttonItem, index) => (\n            <Button key={index} className={classes.button} onClick={buttonItem.onClick}>\n              <div className={classes.buttonIcon}>\n                <Circle>{buttonItem.renderIcon()}</Circle>\n              </div>\n            </Button>\n          ))}\n        </div>\n        <div>\n          <EllipsisMenu menuItems={props.menuItems} />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ChatListHeader;\n","import React, { useEffect, useState } from 'react';\nimport { ChatListItem } from '../ChatListItem/ChatListItem';\nimport { MgtTemplateProps, ProviderState, Providers, log } from '@microsoft/mgt-react';\nimport { makeStyles, Button, Link, FluentProvider, shorthands, webLightTheme } from '@fluentui/react-components';\nimport { FluentThemeProvider } from '@azure/communication-react';\nimport { FluentTheme } from '@fluentui/react';\nimport { Chat as GraphChat, ChatMessage } from '@microsoft/microsoft-graph-types';\nimport {\n  StatefulGraphChatListClient,\n  GraphChatListClient,\n  ChatListEvent\n} from '../../statefulClient/StatefulGraphChatListClient';\nimport { ChatListHeader } from '../ChatListHeader/ChatListHeader';\nimport { IChatListMenuItemsProps } from '../ChatListHeader/EllipsisMenu';\nimport { ChatListButtonItem } from '../ChatListHeader/ChatListButtonItem';\n\nexport interface IChatListItemProps {\n  onSelected: (e: GraphChat) => void;\n  onUnselected?: (e: GraphChat) => void;\n  onLoaded?: () => void;\n  onAllMessagesRead: (e: string[]) => void;\n  buttonItems?: ChatListButtonItem[];\n  chatThreadsPerPage: number;\n  lastReadTimeInterval?: number;\n  selectedChatId?: string;\n  onMessageReceived?: (msg: ChatMessage) => void;\n}\n\nconst useStyles = makeStyles({\n  headerContainer: {\n    display: 'flex',\n    justifyContent: 'center',\n    width: '100%',\n    ...shorthands.padding('10px')\n  },\n  linkContainer: {\n    display: 'flex',\n    justifyContent: 'center',\n    width: '100%',\n    ...shorthands.padding('10px')\n  },\n  loadMore: {\n    textDecorationLine: 'none',\n    fontSize: '1.2em',\n    fontWeight: 'bold',\n    '&:hover': {\n      textDecorationLine: 'none' // This removes the underline when hovering\n    }\n  },\n  button: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    width: '100%',\n    ...shorthands.padding('0px'),\n    ...shorthands.border('none')\n  }\n});\n\n// this is a stub to move the logic here that should end up here.\nexport const ChatList = ({\n  lastReadTimeInterval = 30000, // default to 30 seconds\n  selectedChatId,\n  onMessageReceived,\n  onAllMessagesRead,\n  onLoaded,\n  chatThreadsPerPage,\n  ...props\n}: MgtTemplateProps & IChatListItemProps & IChatListMenuItemsProps) => {\n  const styles = useStyles();\n  const [headerBannerMessage, setHeaderBannerMessage] = useState<string>('');\n  const [chatListClient, setChatListClient] = useState<StatefulGraphChatListClient | undefined>();\n  const [chatListState, setChatListState] = useState<GraphChatListClient | undefined>();\n  const [internalSelectedChatId, setInternalSelectedChatId] = useState<string | undefined>();\n\n  // wait for provider to be ready before setting client and state\n  useEffect(() => {\n    const provider = Providers.globalProvider;\n    provider.onStateChanged(evt => {\n      if (evt.detail === ProviderState.SignedIn) {\n        const client = new StatefulGraphChatListClient(chatThreadsPerPage);\n        setChatListClient(client);\n        setChatListState(client.getState());\n      }\n    });\n  }, [chatThreadsPerPage]);\n\n  // if selected chat id is changed, update the internal state\n  // NOTE: Decoupling this ensures that the app can change the selection but the chat\n  // list can also change the selection without a full re - render.\n  useEffect(() => {\n    setInternalSelectedChatId(selectedChatId);\n  }, [selectedChatId]);\n\n  // Store last read time in cache so that when the user comes back to the chat list,\n  // we know what messages they are likely to have not read. This is not perfect because\n  // the user could have read messages in another client (for instance, the Teams client).\n  useEffect(() => {\n    const timer = setInterval(() => {\n      if (internalSelectedChatId) {\n        log(`caching the last-read timestamp of now to chat ID '${internalSelectedChatId}'...`);\n        chatListClient?.cacheLastReadTime([internalSelectedChatId]);\n      }\n    }, lastReadTimeInterval);\n\n    return () => {\n      clearInterval(timer);\n    };\n  }, [chatListClient, internalSelectedChatId, lastReadTimeInterval]);\n\n  useEffect(() => {\n    // shortcut if we don't have a chat list client\n    if (!chatListClient) {\n      return;\n    }\n\n    // handle events emitted from the chat list client\n    const handleChatListEvent = (event: ChatListEvent) => {\n      if (event.type === 'chatMessageReceived') {\n        if (onMessageReceived) {\n          onMessageReceived(event.message);\n        }\n      }\n    };\n\n    // handle state changes\n    chatListClient.onStateChange(setChatListState);\n    chatListClient.onStateChange(state => {\n      if (state.status === 'chat threads loaded' && onLoaded) {\n        onLoaded();\n      }\n\n      if (state.status === 'server connection established') {\n        setHeaderBannerMessage(''); // reset\n      }\n\n      if (state.status === 'creating server connections') {\n        setHeaderBannerMessage('Connecting...');\n      }\n\n      if (state.status === 'server connection lost') {\n        // this happens when we lost connection to the server and we will try to reconnect\n        setHeaderBannerMessage('We ran into a problem. Reconnecting...');\n      }\n    });\n\n    // handle chat list events\n    chatListClient.onChatListEvent(handleChatListEvent);\n\n    // tear down\n    return () => {\n      // log state of chatlistclient for debugging purposes\n      log(chatListClient.getState());\n      chatListClient.offStateChange(setChatListState);\n      chatListClient.offChatListEvent(handleChatListEvent);\n      chatListClient.tearDown();\n      setHeaderBannerMessage('We ran into a problem. Please close or refresh.');\n    };\n  }, [chatListClient, onMessageReceived, onLoaded]);\n\n  const markThreadAsRead = (chatThread: string) => {\n    const markedChatThreads = chatListClient?.markChatThreadsAsRead([chatThread]);\n    if (markedChatThreads) {\n      chatListClient?.cacheLastReadTime(markedChatThreads);\n    }\n  };\n\n  const onClickChatListItem = (chatListItem: GraphChat) => {\n    // set selected state only once per click event\n    if (chatListItem.id !== internalSelectedChatId) {\n      // trigger an unselect event for the previously selected item\n      if (internalSelectedChatId && props.onUnselected) {\n        const previouslySelectedChatListItem = chatListState?.chatThreads.filter(c => c.id === internalSelectedChatId);\n        if (previouslySelectedChatListItem?.length === 1) {\n          props.onUnselected(previouslySelectedChatListItem[0]);\n        }\n      }\n\n      // select a new item\n      markThreadAsRead(chatListItem.id!);\n      setInternalSelectedChatId(chatListItem.id);\n      props.onSelected(chatListItem);\n    }\n  };\n\n  const chatListButtonItems = props.buttonItems === undefined ? [] : props.buttonItems;\n\n  // We need to have a function for \"this\" to work within the loadMoreChatThreads function, otherwise we get a undefined error.\n  const loadMore = () => {\n    chatListClient?.loadMoreChatThreads();\n  };\n\n  const markAllThreadsAsRead = (chatThreads: GraphChat[] | undefined) => {\n    if (!chatThreads) {\n      return;\n    }\n    const readChatThreads = chatThreads.map(c => c.id!);\n    const markedChatThreads = chatListClient?.markChatThreadsAsRead(readChatThreads);\n    if (markedChatThreads) {\n      chatListClient?.cacheLastReadTime(markedChatThreads);\n      onAllMessagesRead(markedChatThreads);\n    }\n  };\n  const markAllAsRead = {\n    displayText: 'Mark all as read',\n    onClick: () => markAllThreadsAsRead(chatListState?.chatThreads)\n  };\n\n  return (\n    // This is a temporary approach to render the chatlist items. This should be replaced.\n    <FluentThemeProvider fluentTheme={FluentTheme}>\n      <FluentProvider theme={webLightTheme}>\n        <div>\n          {Providers.globalProvider.state === ProviderState.SignedIn && (\n            <div className={styles.headerContainer}>\n              <ChatListHeader\n                bannerMessage={headerBannerMessage}\n                buttonItems={chatListButtonItems}\n                menuItems={[markAllAsRead, ...(props.menuItems ?? [])]}\n              />\n            </div>\n          )}\n          <div>\n            {chatListState?.chatThreads.map(c => (\n              <Button className={styles.button} key={c.id} onClick={() => onClickChatListItem(c)}>\n                <ChatListItem\n                  key={c.id}\n                  chat={c}\n                  myId={chatListState.userId}\n                  isSelected={c.id === internalSelectedChatId}\n                  isRead={c.id === internalSelectedChatId || c.isRead}\n                />\n              </Button>\n            ))}\n            {chatListState?.moreChatThreadsToLoad === true && (\n              <div className={styles.linkContainer}>\n                <Link onClick={loadMore} href=\"#\" className={styles.loadMore}>\n                  load more\n                </Link>\n              </div>\n            )}\n          </div>\n        </div>\n      </FluentProvider>\n    </FluentThemeProvider>\n  );\n};\n","import React, { FC, useCallback, useState } from 'react';\nimport { IDynamicPerson } from '@microsoft/mgt-components';\nimport { Chat } from '@microsoft/microsoft-graph-types';\nimport { IGraph, PeoplePicker, Spinner } from '@microsoft/mgt-react';\nimport {\n  Button,\n  Field,\n  FluentProvider,\n  Input,\n  InputOnChangeData,\n  Textarea,\n  TextareaOnChangeData,\n  makeStyles,\n  typographyStyles,\n  shorthands,\n  webLightTheme\n} from '@fluentui/react-components';\nimport { createChatThread } from '../../statefulClient/graph.chat';\nimport { graph } from '../../utils/graph';\nimport { currentUserId } from '../../utils/currentUser';\n\ninterface NewChatProps {\n  mode?: 'oneOnOne' | 'group' | 'auto';\n  onChatCreated: (chat: Chat) => void;\n  onCancelClicked: () => void;\n}\n\nconst useStyles = makeStyles({\n  title: {\n    ...typographyStyles.subtitle2,\n    ...shorthands.marginInline('32px')\n  },\n  form: {\n    display: 'flex',\n    flexDirection: 'column',\n    gridRowGap: '16px',\n    minWidth: '300px',\n    '& textarea': {\n      fontSize: 'var(--type-ramp-base-font-size)',\n      '::placeholder': {\n        fontSize: 'var(--type-ramp-base-font-size)'\n      }\n    }\n  },\n  formButtons: {\n    display: 'flex',\n    flexDirection: 'row',\n    justifyContent: 'flex-end',\n    gridColumnGap: '8px'\n  }\n});\n\nconst NewChat: FC<NewChatProps> = ({ mode = 'auto', onChatCreated, onCancelClicked }: NewChatProps) => {\n  const styles = useStyles();\n  type NewChatState = 'initial';\n\n  const [isGroup, setIsGroup] = useState<boolean>(mode === 'group');\n\n  const [state, setState] = useState<NewChatState | 'creating chat' | 'done'>('initial');\n  // chat member data control\n  const [selectedPeople, setSelectedPeople] = useState<IDynamicPerson[]>([]);\n  const onSelectedPeopleChange = useCallback(\n    (event: CustomEvent<IDynamicPerson[]>) => {\n      if (event.detail) {\n        setSelectedPeople(event.detail);\n        if (mode === 'auto') {\n          setIsGroup(event.detail.length > 1);\n        }\n      }\n    },\n    [mode]\n  );\n  // chat name data control\n  const [chatName, setChatName] = useState<string>('');\n  const onChatNameChanged = useCallback((_: React.FormEvent<HTMLInputElement>, data: InputOnChangeData) => {\n    setChatName(data.value);\n  }, []);\n\n  // initial message data control\n  const [initialMessage, setInitialMessage] = useState<string>('');\n  const onInitialMessageChange = useCallback((_: React.FormEvent<HTMLTextAreaElement>, data: TextareaOnChangeData) => {\n    setInitialMessage(data.value);\n  }, []);\n  const createChat = useCallback(() => {\n    const graphClient: IGraph = graph('mgt-new-chat');\n    setState('creating chat');\n    const chatMembers = [currentUserId()];\n    selectedPeople.reduce((acc, person) => {\n      if (person.id) acc.push(person.id);\n      return acc;\n    }, chatMembers);\n    void createChatThread(graphClient, chatMembers, isGroup, initialMessage, chatName).then(chat => {\n      setState('done');\n      onChatCreated(chat);\n    });\n  }, [onChatCreated, selectedPeople, initialMessage, chatName, isGroup]);\n\n  return (\n    <FluentProvider theme={webLightTheme}>\n      {state === 'initial' ? (\n        <div className={styles.form}>\n          <Field label=\"To\">\n            <PeoplePicker\n              disabled={(mode === 'oneOnOne' && selectedPeople?.length > 0) || selectedPeople?.length > 19}\n              ariaLabel=\"Select people to chat with\"\n              selectedPeople={selectedPeople}\n              selectionChanged={onSelectedPeopleChange}\n            />\n          </Field>\n\n          {isGroup && (\n            <Field label=\"Group name\">\n              <Input placeholder=\"Chat name\" onChange={onChatNameChanged} value={chatName} />\n            </Field>\n          )}\n          <Textarea\n            placeholder=\"Type your first message\"\n            size=\"large\"\n            resize=\"vertical\"\n            value={initialMessage}\n            onChange={onInitialMessageChange}\n          />\n          <div className={styles.formButtons}>\n            <Button appearance=\"secondary\" onClick={onCancelClicked}>\n              Cancel\n            </Button>\n            <Button appearance=\"primary\" onClick={createChat}>\n              Send\n            </Button>\n          </div>\n        </div>\n      ) : (\n        <>\n          {state}\n          {state !== 'done' && <Spinner />}\n        </>\n      )}\n    </FluentProvider>\n  );\n};\n\nexport { NewChat };\n","import { Persona, makeStyles, mergeClasses, shorthands } from '@fluentui/react-components';\nimport { MgtTemplateProps, Person, ViewType } from '@microsoft/mgt-react';\nimport { Chat, AadUserConversationMember } from '@microsoft/microsoft-graph-types';\nimport React, { useCallback, useState } from 'react';\nimport { PeopleTeam16Regular, Calendar16Regular } from '@fluentui/react-icons';\n\nconst useStyles = makeStyles({\n  chat: {\n    paddingLeft: '5px',\n    paddingRight: '5px',\n    display: 'flex',\n    alignItems: 'center',\n    height: '50px',\n    cursor: 'pointer',\n    ':hover': {\n      backgroundColor: 'var(--colorNeutralBackground1Hover)'\n    }\n  },\n  active: {\n    backgroundColor: 'var(--colorNeutralBackground1Selected)'\n  },\n  person: {\n    userSelect: 'none',\n    '--person-line1-font-weight': 'var(--fontWeightRegular)',\n    '--person-avatar-size-small': '40px',\n    '--person-avatar-size': '40px',\n    '--person-line2-font-size': 'var(--fontSizeBase200)',\n    '--person-line2-text-color': 'var(--colorNeutralForeground4)',\n    '& .fui-Persona__primaryText': {\n      fontSize: 'var(--fontSizeBase300)',\n      fontWeight: 'var(--fontWeightRegular)'\n    },\n    '& .fui-Persona__secondaryText': {\n      whiteSpace: 'nowrap',\n      textOverflow: 'ellipsis',\n      width: '200px',\n      display: 'inline-block',\n      fontSize: 'var(--fontSizeBase200);',\n      color: 'var(--colorNeutralForeground4)',\n      ...shorthands.overflow('hidden')\n    }\n  },\n  group: {\n    paddingTop: '5px'\n  },\n  messagePreview: {\n    whiteSpace: 'nowrap',\n    textOverflow: 'ellipsis',\n    width: '200px',\n    display: 'inline-block',\n    ...shorthands.overflow('hidden')\n  }\n});\n\ninterface ChatItemProps {\n  chat: Chat;\n  userId?: string;\n}\n\ninterface MessagePreviewProps {\n  messagePreview?: string;\n}\n\nconst getMessagePreview = (chat: Chat, userId?: string): string | undefined => {\n  let preview = '';\n  if (chat?.lastMessagePreview?.from?.user && chat?.lastMessagePreview?.from?.user.id !== userId) {\n    preview += chat?.lastMessagePreview?.from?.user.displayName?.split(' ')[0]!;\n    preview += ': ';\n  } else {\n    preview += 'You: ';\n  }\n\n  if (chat?.lastMessagePreview?.body?.contentType === 'text') {\n    preview += chat?.lastMessagePreview?.body?.content;\n  } else if (chat?.lastMessagePreview?.body?.contentType === 'html') {\n    const html = chat?.lastMessagePreview?.body?.content!;\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(html, 'text/html');\n\n    const images = doc.querySelectorAll('img');\n    const card = doc.querySelector('attachment');\n    const systemCard = doc.querySelector('span[itemId]');\n    const systemEventMessage = doc.querySelector('systemEventMessage');\n\n    if (systemEventMessage || systemCard) return undefined;\n\n    preview += doc.body.textContent || doc.body.innerText || '';\n\n    if (images) {\n      if (Array.from(images.values()).find(i => i.src.includes('.gif'))) {\n        preview += '  GIF';\n      } else {\n        preview += ' Sent an image';\n      }\n    }\n\n    if (card) {\n      preview = 'Sent a card';\n    }\n  }\n\n  // Remove all new lines, tabs, and carriage returns\n  // Replace all multiple spaces with a single space\n  return preview\n    ?.trim()\n    .replace(/[\\n\\t\\r]/g, '')\n    .replace(/\\s+/g, ' ');\n};\n\nconst ChatItemComponent = ({ chat, userId }: ChatItemProps) => {\n  const styles = useStyles();\n  const [messagePreview, setMessagePreview] = useState<string | undefined>('');\n\n  const getOtherParticipantId = useCallback(\n    (chat: Chat) => {\n      const member = chat.members?.find(m => (m as AadUserConversationMember).userId !== userId);\n\n      if (member) {\n        return (member as AadUserConversationMember).userId as string;\n      } else if (chat.members?.length === 1 && (chat.members[0] as AadUserConversationMember).userId === userId) {\n        return userId;\n      }\n\n      return undefined;\n    },\n    [userId]\n  );\n\n  const getGroupTitle = useCallback(\n    (chat: Chat) => {\n      const lf = new Intl.ListFormat('en');\n      let groupMembers: string[] = [];\n\n      if (chat.topic) {\n        return chat.topic;\n      } else {\n        chat.members\n          ?.filter(member => member['userId'] !== userId)\n          ?.forEach(member => {\n            groupMembers.push(member.displayName?.split(' ')[0]!);\n          });\n\n        return lf.format(groupMembers);\n      }\n    },\n    [userId]\n  );\n\n  React.useEffect(() => {\n    setMessagePreview(getMessagePreview(chat, userId));\n  }, [chat, userId]);\n\n  return (\n    <>\n      {userId && (\n        <div className={styles.chat}>\n          {chat.chatType === 'oneOnOne' && (\n            <Person\n              userId={getOtherParticipantId(chat)}\n              view={messagePreview ? ViewType.twolines : ViewType.oneline}\n              avatarSize=\"auto\"\n              showPresence={true}\n              className={styles.person}\n            >\n              {messagePreview && (\n                <MessagePreview template=\"line2\" chat={chat} userId={userId} messagePreview={messagePreview} />\n              )}\n            </Person>\n          )}\n          {chat.chatType === 'group' && (\n            <div>\n              <Persona\n                textAlignment=\"center\"\n                size=\"extra-large\"\n                name={getGroupTitle(chat)}\n                secondaryText={messagePreview}\n                avatar={{ icon: <PeopleTeam16Regular />, initials: null }}\n                className={mergeClasses(styles.person, styles.group)}\n              />\n              <span></span>\n            </div>\n          )}\n          {chat.chatType === 'meeting' && (\n            <div>\n              <Persona\n                textAlignment=\"center\"\n                size=\"extra-large\"\n                className={mergeClasses(styles.person, styles.group)}\n                avatar={{ icon: <Calendar16Regular />, initials: null }}\n                name={getGroupTitle(chat)}\n                secondaryText={messagePreview}\n              />\n            </div>\n          )}\n        </div>\n      )}\n    </>\n  );\n};\n\nconst MessagePreview = (props: MgtTemplateProps & ChatItemProps & MessagePreviewProps) => {\n  const styles = useStyles();\n\n  return <>{props.messagePreview && <span className={styles.messagePreview}>{props.messagePreview}</span>}</>;\n};\n\nexport const ChatItem = React.memo(ChatItemComponent);\n","import React, { useState } from 'react';\nimport { MgtTemplateProps, Providers } from '@microsoft/mgt-react';\nimport { Chat } from '@microsoft/microsoft-graph-types';\nimport { ChatItem } from './ChatItem';\nimport { Chat as GraphChat } from '@microsoft/microsoft-graph-types';\nimport { List, ListItem } from '@fluentui/react-northstar';\nimport { makeStyles, shorthands } from '@fluentui/react-components';\nimport { iconFilledClassName, iconRegularClassName } from '@fluentui/react-icons';\n\nconst useStyles = makeStyles({\n  listItem: {\n    listStyleType: 'none',\n    width: '100%',\n    ':focus-visible': {\n      [`& .${iconFilledClassName}`]: {\n        display: 'inline',\n        color: 'var(--colorNeutralForeground2BrandHover)'\n      },\n      [`& .${iconRegularClassName}`]: {\n        display: 'none'\n      }\n    }\n  },\n  selected: {\n    backgroundColor: 'var(--colorNeutralBackground1Selected)'\n  },\n  list: {\n    fontWeight: 800,\n    gridGap: '8px',\n    ...shorthands.marginBlock('0'),\n    ...shorthands.padding('0')\n  }\n});\n\nexport interface ChatInteractionProps {\n  onChatSelected: (selected: Chat) => void;\n}\n\nconst ChatListTemplate = (props: MgtTemplateProps & ChatInteractionProps) => {\n  const styles = useStyles();\n  const { value } = props.dataContext;\n  const [chats] = useState<Chat[]>((value as Chat[]).filter(c => c.members?.length! > 1));\n  const [userId, setUserId] = useState<string>();\n  const [selectedChat, setSelectedChat] = useState<GraphChat | undefined>(chats.length > 0 ? chats[0] : undefined);\n\n  const onChatSelected = (e: GraphChat) => {\n    setSelectedChat(e);\n  }\n\n  // Set the selected chat to the first chat in the list\n  // Fires only the first time the component is rendered\n  React.useEffect(() => {\n    if (selectedChat) {\n      props.onChatSelected(selectedChat);\n    }\n  }, [props, selectedChat]);\n\n  React.useEffect(() => {\n    const getMyId = async () => {\n      const me = await Providers.me();\n      setUserId(me.id);\n    };\n    if (!userId) {\n      void getMyId();\n    }\n  });\n\n  const isChatActive = (chat: Chat) => {\n    if (selectedChat) {\n      return selectedChat && chat.id === selectedChat?.id;\n    }\n\n    return false;\n  };\n\n  return (\n    <List navigable className={styles.list}>\n      {chats.map((c, index) => (\n        <ListItem\n          key={c.id}\n          index={index}\n          className={styles.listItem}\n          content={\n            <div className={(!selectedChat && index === 0) || isChatActive(c) ? styles.selected : ''}>\n              <ChatItem\n                key={c.id}\n                chat={c}\n                userId={userId}\n              />\n            </div>\n          }\n          onClick={() => onChatSelected(c)}>\n        </ListItem>\n      ))}\n    </List>\n  );\n};\n\nexport default ChatListTemplate;\n","import * as React from 'react';\nimport { PageHeader } from '../components/PageHeader';\nimport { Get } from '@microsoft/mgt-react';\nimport { Loading } from '../components/Loading';\nimport {\n  shorthands,\n  makeStyles,\n  mergeClasses,\n  Button,\n  Dialog,\n  DialogTrigger,\n  DialogSurface,\n  DialogBody,\n  DialogTitle\n} from '@fluentui/react-components';\nimport { Chat as GraphChat } from '@microsoft/microsoft-graph-types';\nimport { Chat, NewChat } from '@microsoft/mgt-chat';\nimport ChatListTemplate from './Chats/ChatListTemplate';\n\nconst useStyles = makeStyles({\n  container: {\n    display: 'flex',\n    flexDirection: 'row'\n  },\n  panels: {\n    ...shorthands.padding('10px')\n  },\n  main: {\n    display: 'flex',\n    flexDirection: 'column',\n    flexWrap: 'nowrap',\n    width: '300px',\n    minWidth: '300px',\n    ...shorthands.overflow('auto'),\n    maxHeight: '80vh',\n    borderRightColor: 'var(--neutral-stroke-rest)',\n    borderRightStyle: 'solid',\n    borderRightWidth: '1px'\n  },\n  side: {\n    display: 'flex',\n    flexDirection: 'column',\n    flexWrap: 'nowrap',\n    width: '80%',\n    ...shorthands.overflow('auto'),\n    maxHeight: '80vh',\n    height: '100%'\n  },\n  newChat: {\n    paddingBottom: '10px',\n    marginRight: '0px',\n    marginLeft: 'auto'\n  },\n  dialog: {\n    display: 'block'\n  },\n  dialogSurface: {\n    contain: 'unset'\n  }\n});\n\nconst getPreviousDate = (months: number) => {\n  const date = new Date();\n  date.setMonth(date.getMonth() - months);\n  return date.toISOString();\n};\n\nconst nextResourceUrl = () =>\n  `me/chats?$expand=members,lastMessagePreview&$orderBy=lastMessagePreview/createdDateTime desc&$filter=viewpoint/lastMessageReadDateTime ge ${getPreviousDate(\n    9\n  )}`;\n\nconst ChatPage: React.FunctionComponent = () => {\n  const styles = useStyles();\n\n  const [resourceUrl, setResourceUrl] = React.useState(nextResourceUrl);\n\n  const [selectedChat, setSelectedChat] = React.useState<GraphChat>();\n  const [isNewChatOpen, setIsNewChatOpen] = React.useState(false);\n\n  const onChatCreated = (e: GraphChat) => {\n    if (e.id !== selectedChat?.id && isNewChatOpen) {\n      setIsNewChatOpen(false);\n      setResourceUrl(nextResourceUrl);\n    }\n    setSelectedChat(e);\n  };\n\n  return (\n    <>\n      <PageHeader\n        title={'Chats'}\n        description={'Stay in touch with your teammates and navigate your chats'}\n      ></PageHeader>\n\n      <div className={styles.container}>\n        <div className={mergeClasses(styles.panels, styles.main)}>\n          <div className={styles.newChat}>\n            <Dialog open={isNewChatOpen}>\n              <DialogTrigger disableButtonEnhancement>\n                <Button appearance=\"primary\" onClick={() => setIsNewChatOpen(true)}>\n                  New Chat\n                </Button>\n              </DialogTrigger>\n              <DialogSurface className={styles.dialogSurface}>\n                <DialogBody className={styles.dialog}>\n                  <DialogTitle>New Chat</DialogTitle>\n                  <NewChat\n                    onChatCreated={onChatCreated}\n                    onCancelClicked={() => {\n                      setIsNewChatOpen(false);\n                    }}\n                  ></NewChat>\n                </DialogBody>\n              </DialogSurface>\n            </Dialog>\n          </div>\n          <ChatList onChatSelected={setSelectedChat} resourceUrl={resourceUrl}></ChatList>\n        </div>\n        <div className={styles.side}>{selectedChat && <Chat chatId={selectedChat.id!}></Chat>}</div>\n      </div>\n    </>\n  );\n};\n\ninterface ChatListProps {\n  onChatSelected: (e: GraphChat) => void;\n  resourceUrl: string;\n}\n\nconst ChatList = React.memo((props: ChatListProps) => {\n  return (\n    <Get resource={props.resourceUrl} scopes={['chat.read']}>\n      <ChatListTemplate template=\"default\" onChatSelected={props.onChatSelected}></ChatListTemplate>\n      <Loading template=\"loading\" message={'Loading your chats...'}></Loading>\n    </Get>\n  );\n});\n\nexport default ChatPage;\n","import { MgtPersonCardConfig } from './MgtPersonCardConfig';\n\n/**\n * Scopes used to fetch data for the mgt-person-card component\n *\n * @static\n * @return {*}  {string[]}\n * @memberof MgtPersonCard\n */\n\nexport const getMgtPersonCardScopes = (): string[] => {\n  const scopes: string[] = [];\n\n  if (MgtPersonCardConfig.sections.files) {\n    scopes.push('Sites.Read.All');\n  }\n\n  if (MgtPersonCardConfig.sections.mailMessages) {\n    scopes.push('Mail.Read');\n    scopes.push('Mail.ReadBasic');\n  }\n\n  if (MgtPersonCardConfig.sections.organization) {\n    scopes.push('User.Read.All');\n\n    if (MgtPersonCardConfig.sections.organization.showWorksWith) {\n      scopes.push('People.Read.All');\n    }\n  }\n\n  if (MgtPersonCardConfig.sections.profile) {\n    scopes.push('User.Read.All');\n  }\n\n  if (MgtPersonCardConfig.useContactApis) {\n    scopes.push('Contacts.Read');\n  }\n\n  if (scopes.indexOf('User.Read.All') < 0) {\n    // at minimum, we need these scopes\n    scopes.push('User.ReadBasic.All');\n    scopes.push('User.Read');\n  }\n\n  if (scopes.indexOf('People.Read.All') < 0) {\n    // at minimum, we need these scopes\n    scopes.push('People.Read');\n  }\n\n  if (MgtPersonCardConfig.isSendMessageVisible) {\n    // Chat.ReadWrite can create a chat and send a message, so just request one scope instead of two\n    scopes.push('Chat.ReadWrite');\n  }\n\n  // return unique\n  return [...new Set(scopes)];\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { IGraph } from './IGraph';\nimport { Client } from '@microsoft/microsoft-graph-client';\nimport { Graph } from './Graph';\n\n/**\n * The version of the Graph to use for making requests.\n */\nconst GRAPH_VERSION = 'beta';\n\n/**\n * BetaGraph\n *\n * @export\n * @class BetaGraph\n * @extends {BetaGraph}\n */\nexport class BetaGraph extends Graph {\n  /**\n   * get a BetaGraph instance based on an existing IGraph implementation.\n   *\n   * @static\n   * @param {Graph} graph\n   * @returns {BetaGraph}\n   * @memberof BetaGraph\n   */\n  public static fromGraph(graph: IGraph): BetaGraph {\n    const betaGraph = new BetaGraph(graph.client);\n    betaGraph.setComponent(graph.componentName);\n    return betaGraph;\n  }\n\n  constructor(client: Client, version: string = GRAPH_VERSION) {\n    super(client, version);\n  }\n\n  /**\n   * Returns a new instance of the Graph using the same\n   * client within the context of the provider.\n   *\n   * @param {Element} component\n   * @returns {BetaGraph}\n   * @memberof BetaGraph\n   */\n  public forComponent(component: Element | string): BetaGraph {\n    const graph = new BetaGraph(this.client);\n    this.setComponent(component);\n    return graph;\n  }\n}\n"],"names":["chatOperationScopes","Array","from","concat","Object","values","loadPresence","searchUsers","searchPeople","getMgtPersonCardScopes","reduce","acc","scopes","forEach","s","add","Set","GraphConfig","_classCallCheck","_createClass","key","get","useCanary","graphEndpoint","this","canarySubscriptionVersion","baseCanaryUrl","value","url","replace","webSocketsPrefix","_defineProperty","ComponentType","isConversationCacheEnabled","CacheService","config","conversation","isEnabled","GroupType","buildCacheKey","componentEntityId","sessionId","SubscriptionsCache","schemas","getCache","stores","subscriptions","_loadSubscriptions","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","cacheKey","data","wrap","_context2","prev","next","cache","transaction","_ref","_callee","store","_context","sent","lastAccessDateTime","Date","toISOString","put","stop","_x3","apply","arguments","abrupt","undefined","_x","_x2","_cacheSubscription","_callee4","componentType","subscriptionRecord","_context4","_ref2","_callee3","cacheEntry","subIndex","_context3","log","findIndex","resource","push","_x8","_x4","_x5","_x6","_x7","delete","inactivityThreshold","queryDb","IDBKeyRange","upperBound","then","filter","d","catch","err","Timer","_this","Map","event","intervalWork","type","work","has","id","worker","SharedWorker","URL","port","onmessage","onMessage","callback","delay","timeoutWork","uuid","set","postMessage","close","appSettings","GraphNotificationClient","emitter","_graph","token","Providers","globalProvider","getAccessToken","Error","connectionId","message","notification","JSON","parse","resourceData","includes","processMessageNotification","o","isMembershipNotification","processChatPropertiesNotification","processMembershipNotification","ackMessage","StatusCode","ackAsString","stringify","subscriptionCache","cacheSubscription","chatId","Chat","renewalTimeout","startRenewalTimer","timer","clearTimeout","setTimeout","syncRenewalTimerWrapper","renewalTimer","_yield$_this$subscrip","_iterator","_step","subscription","expirationTime","now","loadSubscriptions","t2","t1","t3","t0","length","_createForOfIteratorHelper","n","done","expirationDateTime","Math","round","getTime","renewalCount","renewChatSubscriptions","t4","e","f","finish","awaits","_iterator2","_step2","renewSubscription","Promise","all","_ref5","_callee5","subscriptionId","renewedSubscription","_context5","graph","api","subscriptionEndpoint","patch","cleanupTimer","_callee6","offset","threshold","inactiveSubs","tasks","_iterator3","_step3","inactive","_iterator4","_step4","_inactive","_context6","min","loadInactiveSubscriptions","removeSubscriptions","deleteCachedSubscriptions","startCleanupTimer","BetaGraph","fromGraph","createFromProvider","beta","_tearDown","_callee7","_context7","cleanupTimeout","unsubscribeFromChatNotifications","changeType","chatMessageReceived","chatMessageEdited","chatMessageDeleted","member","participantAdded","participantRemoved","chat","chatThreadPropertiesUpdated","chatThreadDeleted","_subscribeToResource","_callee8","resourcePath","changeTypes","subscriptionDefinition","_context8","join","notificationUrl","includeResourceData","clientState","subscriptionGraph","post","connection","createSignalRConnection","_createSignalRConnection","_callee9","connectionOptions","_context9","accessTokenFactory","getToken","withCredentials","HubConnectionBuilder","withUrl","adjustNotificationUrl","withAutomaticReconnect","configureLogging","LogLevel","Information","build","onreconnected","onReconnect","on","receiveNotificationMessage","start","error","_deleteSubscription","_callee10","_context10","_removeSubscriptions","_callee11","_iterator5","_step5","_context11","deleteSubscription","cleanupTimerSync","_closeSignalRConnection","_callee12","_this$connection","_context12","_unsubscribeFromChatNotifications","_callee13","cacheData","_context13","closeSignalRConnection","_x9","_x10","_subscribeToChatNotifications","_callee14","_cacheData$subscripti","someExpired","webSocketUrl","promises","_this2","_context14","some","find","subscribeToResource","graphNotificationClientError","_x11","_x12","getCurrentUser","_Providers$globalProv","_Providers$globalProv2","state","ProviderState","SignedIn","getActiveAccount","call","currentUserId","_getCurrentUser","split","component","version","forComponent","cacheEntryIsValid","timeCached","invalidationPeriod","defaultInvalidationPeriod","MessageCache","chats","_loadMessages","getValue","_cacheMessages","messages","updateNextLink","nextLink","cachedData","maxLastModifiedDateTime","_args2","curr","lastModifiedDateTime","putValue","m","addMessageToCacheData","_cacheMessage","_cachedData$lastModif","spliceIndex","splice","_deleteMessage","ThreadEventEmitter","EventEmitter","listener","off","emit","resouce","loadChat","middlewareOptions","prepScopes","_toConsumableArray","loadChatThread","_ref3","messageCount","_response$OdataNext","response","orderby","top","loadChatThreadDelta","_ref4","lastModified","_response$OdataNext2","loadMoreChatMessages","_response$OdataNext3","_x13","sendChatMessage","_ref7","content","body","_x16","_x17","_x18","updateChatMessage","_ref8","messageId","_x19","_x20","_x21","_x22","deleteChatMessage","_ref9","_x23","_x24","_x25","removeChatMember","_ref10","membershipId","_x26","_x27","_x28","addChatMembers","_ref11","userIds","visibleHistoryStartDateTime","requests","map","userId","index","addRequestBody","roles","method","headers","_x29","_x30","_x31","_x32","loadChatImage","_ref12","cachedPhoto","_cachedPhoto","eTag","blob","photos","teams","photo","getPhotoInvalidationTime","responseType","ResponseType","RAW","status","ok","blobToBase64","storePhotoInCache","_x33","_x34","createChatThread","_ref13","memberIds","isGroupChat","chatMessage","chatName","chatType","members","topic","_x35","_x36","_x37","_x38","_x39","updateChatTopic","_ref14","_x40","_x41","_x42","updateMessageContentWithImage","image","imageId","regex","RegExp","replacement","isChatMessage","msg","isChatMemberChangeEvent","eventDetail","MessageCreatedComparator","a","b","createdOn","ChatMessageCreatedComparator","createdDateTime","graphImageUrlRegex","StatefulGraphChatClient","detail","updateUserInfo","updateGraphNotificationClient","updateFollowedChat","SignedOut","Loading","_e$detail","handleAccountChange","_this$_notificationCl","clearCurrentUserMessages","_notificationClient","eventType","_nextLink","_cache","cacheMessages","_chatId","writeMessagesToState","pendingId","notifyStateChange","draft","pendingMessage","clientMessageId","contentType","messageType","senderDisplayName","_userDisplayName","senderId","mine","draftIndex","graphChatMessageToAcsChatMessage","currentValue","uncommitted","_state","draftMessage","indexOf","setDeletedContent","updating","_ref6","messageConversion","acsMessage","futureMessageState","updateMentions","cacheMessage","convertChatMessage","updateMessages","futureValue","newMessage","_newMessage$mentions","_draft$mentions","mentions","deleteMessage","eventualState","messageConversions","currentValueMessages","futureMessages","_messagesPerCall","_m$body","_m$body2","policyViolation","val","sm","checkForMissedMessages","_chat","added","participants","p","removeParticipantFromState","history","membershpId","_this$_chat$members$f","_this$_chat","_objectSpread","updateErrorState","activeErrorMessages","participantCount","_this$participants","disableEditing","numberOfChatMessagesToReload","onDeleteMessage","onSendMessage","sendMessage","onUpdateMessage","updateMessage","onAddChatMembers","onRemoveChatMember","onRenameChat","renameChat","_initialState","onStateChanged","onLoginStateChanged","onActiveAccountChanged","_eventEmitter","registerEventListeners","_this$_notificationCl2","tearDown","handler","_subscribers","recipe","produce","updateCurrentUserId","updateCurrentUserName","_getCurrentUser2","name","currentUserName","_userId","_sessionId","_updateFollowedChat","loadChatData","subscribeToChatNotifications","_loadChatData","cachedMessages","deltaMessages","updatedState","reject","loadMessages","loadDeltaData","_loadDeltaData","_callee15","result","_context15","sort","_writeMessagesToState","_callee16","_this3","_context16","_m$body3","_this3$_chat","_draft$mentions2","onLoadPreviousChatMessages","loadMoreMessages","_message$messageType","buildSystemContentMessage","toString","_buildSystemContentMessage","_callee17","_eventDetail$initiato","messageContent","initiatorId","_eventDetail$members","_i","_arr","people","userNames","initiatorUsername","_this4","_context17","initiator","user","getUserWithPhoto","getUserName","chatDisplayName","warn","systemMessageType","iconName","resolveIcon","_x14","_people$find","displayName","match","graphMessage","currentUser","_graphMessage$body$co","_graphMessage$body","_graphMessage$id","conversion","futureImages","messageResult","graphImageMatch","graphImageUrl","placeholderMessage","buildAcsMessage","_callee18","_i2","_Object$entries","_Object$entries$_i","imageIndex","futureImage","_placeholderMessage$c","_context18","entries","_slicedToArray","_graphMessage$id2","_graphMessage$body$co2","_graphMessage$body2","_content","dom","DOMParser","parseFromString","emojis","querySelectorAll","emojisCount","size","_dom$body$firstChild","firstChild","nodeName","_dom$body$firstChild2","firstChildNodes","childNodes","hasOtherContent","_emoji$getAttribute","_emoji$getAttribute2","_emoji$getAttribute3","emoji","getAttribute","alt","title","span","document","createElement","setAttribute","img","appendChild","replaceWith","innerHTML","rewriteEmojiContentToHTML","updateMentionsContent","processMessageContent","attachments","unsupportedContentTypes","isUnsupported","_attachment$contentTy","attachment","contentUnsupported","Boolean","test","every","_graphMessage$from","_graphMessage$chatId","_graphMessage$id3","_graphMessage$attachm","_graphMessage$body$co3","_graphMessage$body3","_graphMessage$from$us","_graphMessage$from2","_graphMessage$created","chatUrl","messageData","editedOn","lastEditedDateTime","attached","hasUnsupportedContent","rawChatUrl","assign","link","_this5","onMessageReceived","onMessageDeleted","onMessageEdited","onChatNotificationsSubscribed","onChatPropertiesUpdated","onParticipantAdded","onParticipantRemoved","onGraphNotificationClientError","keyName","getOrGenerateSessionId","sessionStorage","getItem","newValue","setItem","useGraphChatClient","_useState","useState","useSessionId","_useState3","chatClient","useEffect","subscribeToChat","setStatus","useStyles","makeStyles","container","backgroundColor","display","boxShadow","textDecorationLine","color","shorthands","margin","borderRadius","padding","gap","cta","fontFamily","fontSize","fontStyle","fontWeight","lineHeight","props","styles","React","className","target","href","targetUrl","ArrowSquareUpRight24Regular","onRenderMessage","messageProps","defaultOnRender","_messageProps","unsupportedContentComponent","UnsupportedContent","renderToString","renderMGTMention","chatState","mention","defaultRenderer","_chatState$mentions","_teamsMention$mention","render","teamsMention","flat","_m$id","mentionText","displayText","mentioned","MgtMention","_props","Person","personCardInteraction","PersonCardInteraction","hover","classNames","colors","mergeStyles","width","height","buttonIconStyles","mergeStyleSets","button","icon","fill","iconFilled","iconUnfilled","useCommonHeaderStyles","row","paddingInlineStart","person","OneToOneChatHeader","_chat$members","getOtherParticipantUserId","view","ViewType","oneline","avatarSize","showPresence","border","overflow","background","justifyContent","alignItems","Circle","children","style","MeetingIcon","bundleIcon","Calendar16Regular","GroupIcon","PeopleTeam16Regular","PersonIcon","Person16Filled","Person16Regular","ChatIcon","iconColor","EditIcon","Edit16Filled","Edit16Regular","chatTitle","marginInlineStart","flexDirection","gridRowGap","minWidth","tokens","colorNeutralBackground1","formButtons","gridColumnGap","GroupChatHeader","_useState2","isPopoverOpen","setIsPopoverOpen","handleOpenChange","useCallback","_","open","onCancelClicked","_useState4","setChatName","onChatNameChanged","_p$displayName","email","reduceToFirstNamesList","popoverProps","trapFocus","inertTrapFocus","inline","positioning","onOpenChange","Popover","PopoverTrigger","Button","appearance","PopoverSurface","Field","label","Input","placeholder","onChange","onClick","disabled","useTitleStyles","chatHeader","columnGap","marginBlockStart","marginBlockEnd","zIndex","memo","commonStyles","mergeClasses","getGroupsInvalidationTime","groups","getIsGroupsCacheEnabled","findGroups","query","groupTypes","any","groupFilters","__awaiter","cacheGroupQuery","filterQuery","responses","batchedResult","batch","filterGroups","_filterGroups","_filterGroups2","filterGroup","_loop","queries","_filter","groupsQuery","x","slice","createBatch","unified","security","mailenabledsecurity","distribution","executeAll","group","batchedGroup","delegateYield","count","header","getGroup","requestedProps","uniqueProps","apiString","prop","keys","getGroupsForGroupIds","groupIds","filters","groupDict","notInCache","_id","apiUrl","t5","findGroupsFromGroupIds","foundGroups","graphGroups","css","_templateObject","_taggedTemplateLiteral","strings","inputPlaceholderText","maxSelectionsPlaceHolder","maxSelectionsAriaLabel","noResultsFound","loadingMessage","selected","removeSelectedUser","selectContact","suggestionsTitle","MgtPeoplePicker","_MgtTemplatedComponen","_inherits","_super","_createSuper","_type","PersonType","_groupType","_userType","UserType","_selectedPeople","_arrowSelectionCount","defaultSelectedUsers","defaultSelectedGroups","_highlightedUsers","_currentHighlightedUserPos","_isFocused","_setAnyEmail","handleSelectionChanged","selectedPeople","enableTextInput","handleInputClick","flyout","isOpen","handleUserSearch","gainedFocus","clearHighlighted","loadState","showFlyout","lostFocus","input","peopleList","renderRoot","querySelector","el","classList","remove","requestUpdate","onUserKeyUp","isCmdOrCtrlKey","getModifierState","isPaste","isArrowKey","hideFlyout","clearInput","_foundPeople","userInput","allowAnyEmail","preventDefault","stopPropagation","onUserInput","isValidEmail","handleAnyEmail","onUserKeyDown","selectedList","Number","isNaN","pop","personParent","parentElement","highlightSelectedPeople","handleArrowSelection","shiftKey","foundPerson","addPerson","hasMaxSelections","disableTextInput","handleCut","writeHighlightedText","removeHighlightedOnCut","handleCopy","handlePaste","navigator","clipboard","readText","copiedText","SyntaxError","listOfUsers","_delimiters","delimiter","selectUsersById","clearState","_showLoading","showMax","disableImages","addEventListener","_groupId","requestStateUpdate","_groupIds","arraysAreEqual","_transitiveSearch","transitiveSearch","_people","_showMax","fireCustomEvent","_defaultSelectedUserIds","_defaultSelectedGroupIds","_userIds","_userFilters","_peopleFilters","_groupFilters","inputControl","shadowRoot","removeAttribute","focus","selectionMode","options","select","provider","getUser","defaultPersonProperties","personDetails","isGraphError","_a","anyMailUser","mail","groupDetails","defaultTemplate","renderTemplate","selectedPeopleTemplate","renderSelectedPeople","inputTemplate","renderInput","flyoutTemplate","renderFlyout","html","force","_groupPeople","defaultPeople","_get","_getPrototypeOf","prototype","searchIcon","_templateObject2","getSvg","SvgIcon","Search","startSlot","_templateObject3","ariaLabel","_c","_b","_templateObject5","repeat","_templateObject6","renderSelectedPerson","removePerson","handleRemovePersonKeyDown","Close","_templateObject4","anchor","mgtHtml","_templateObject7","handleSectionScroll","renderFlyoutContent","isLoadingState","renderLoading","renderSearchResults","renderNoData","_templateObject8","_templateObject9","filteredPeople","_templateObject10","_templateObject11","handleSuggestionClick","renderPersonResult","_templateObject12","none","_templateObject13","toLowerCase","displayNameMatch","groupId","findGroupMembers","userFilters","peopleFilters","findUsersFromGroupIds","peopleInGroups","getUsersForUserIds","isUserOrContactType","userType","contact","getUsers","getPeople","groupType","defaultSelectedUserIds","defaultSelectedGroupIds","findUsers","_d","findPeople","t6","t7","t8","t9","users","peopleIds","t10","t11","t12","t13","filterPeople","filteredPersonArr","_this6","_debouncedSearch","debounce","loadingTimeout","_this7","copyText","element","_element$_personDetai","userPrincipalName","scoredEmailAddresses","emailAddress","address","copiedTextStr","writeText","_step6","_iterator6","node","_step7","_iterator7","_step8","_iterator8","blur","focusedItem","scrollIntoView","behavior","block","uniquePeople","_step9","idFilter","filtered","dupsSet","_iterator9","deltaY","scrollTop","clientHeight","scrollHeight","MgtPerson","requiredScopes","MgtTemplatedComponent","__decorate","property","attribute","converter","trim","v","_step10","_iterator10","c","String","PeoplePicker","wrapMgt","registerFluentComponents","fluentTextField","fluentCard","registerMgtFlyoutComponent","registerMgtPersonComponent","registerMgtSpinnerComponent","registerComponent","addMembers","paddingBlockEnd","paddingInline","buttonRow","paddingBlockStart","dialogHeading","historyInput","option","radio","AddChatMembers","closeDialog","daysOfHistory","setDaysOfHistory","handleHistoryChanged","newNumber","parseInt","historyOption","setHistoryOption","onHistoryOptionChange","_useState5","_useState6","setSelectedPeople","peopleSelectionChanged","addToChat","chatHistoryOptions","text","onRenderField","selectionChanged","ChoiceGroup","selectedKey","RemovePerson","Dismiss20Filled","iconPlaceholder","listItem","listStyleType","_focusVisible","iconFilledClassName","iconRegularClassName","memberList","gridGap","marginBlock","personRow","paddingBlock","cursor","_hover","fullWidth","ListChatMembers","closeParentPopover","removeDialogOpen","setRemoveDialogOpen","removeUser","setRemoveUser","openRemoveDialog","removeMember","Dialog","DialogSurface","DialogBody","DialogTitle","DialogContent","DialogActions","List","navigable","isCurrentUser","ListItem","tabIndex","PersonViewType","AddPeople","PeopleAdd24Filled","PeopleAdd24Regular","Leave","DoorArrowLeft24Filled","DoorArrowLeft24Regular","divider","popover","triggerButton","marginInline","ManageChatMembers","showAddMembers","setShowAddMembers","openAddMembers","closeCallout","leaveChat","me","Divider","DialogTrigger","disableButtonEnhancement","TeamsIcon","createSvgIcon","svg","xmlns","viewBox","opacity","EllipsisIcon","MoreHorizontal24Filled","MoreHorizontal24Regular","menuProps","hasIcons","closeOnScroll","ellipsisMenuStyles","menuPopover","EllipsisMenu","Menu","MenuTrigger","MenuPopover","MenuList","MenuItemLink","chatWebUrl","useHeaderStyles","rowGap","secondRow","noGrow","flexGrow","ChatHeader","_chatState$chat$webUr","_chatState$chat","_chatState$participan","_chatState$chat2","webUrl","ChatTitle","vertical","inset","GenericErrorIcon","fillRule","clipRule","x1","y1","x2","y2","gradientUnits","stopColor","flexWrap","alignContent","messageContainer","textAlign","subheading","EmptySubheading","_ref$icon","IconTemplate","SubheadingTemplate","LoadingMessagesErrorIcon","OpenTeamsLink","Link","OpenTeamsLinkError","RequireValidChatId","TypeANewMessage","icons","DEFAULT_COMPONENT_ICONS","focusable","registerIcons","registerAppIcons","chatMessages","maxWidth","marginLeft","chatInput","fullHeight","spinner","unsupportedContent","messageThreadStyles","chatContainer","chatMessageContainer","myChatMessageContainer","getState","setChatState","onStateChange","offStateChange","isLoading","placeholderText","FluentThemeProvider","fluentTheme","FluentTheme","FluentProvider","theme","webLightTheme","MessageThread","showMessageDate","onRenderAvatar","mentionOptions","displayOptions","onRenderMention","SendBox","Spinner","PeopleTeam24Regular","Person24Regular","defaultProfileImage","objectFit","isSelected","isUnSelected","isBold","isNormal","chatListItem","paddingRight","paddingLeft","profileImage","flex","marginRight","chatInfo","flexShrink","textOverflow","whiteSpace","chatTimestamp","alignSelf","headerContainer","controlsContainer","buttonIcon","flexBasis","bannerClassName","paddingTop","paddingBottom","marginBottom","linkContainer","loadMore","typographyStyles","subtitle2","form","NewChat","_ref$mode","mode","onChatCreated","isGroup","setIsGroup","setState","onSelectedPeopleChange","_useState7","_useState8","_useState9","_useState10","initialMessage","setInitialMessage","onInitialMessageChange","createChat","graphClient","chatMembers","Textarea","resize","active","userSelect","messagePreview","ChatItemComponent","setMessagePreview","getOtherParticipantId","_chat$members2","getGroupTitle","_chat$members3","_chat$members3$filter","lf","Intl","ListFormat","groupMembers","_member$displayName","format","_chat$lastMessagePrev","_chat$lastMessagePrev2","_chat$lastMessagePrev3","_chat$lastMessagePrev4","_chat$lastMessagePrev8","_chat$lastMessagePrev9","_chat$lastMessagePrev12","_chat$lastMessagePrev13","_preview","_chat$lastMessagePrev5","_chat$lastMessagePrev6","_chat$lastMessagePrev7","_chat$lastMessagePrev10","_chat$lastMessagePrev11","preview","lastMessagePreview","_chat$lastMessagePrev14","_chat$lastMessagePrev15","doc","images","card","systemCard","textContent","innerText","i","src","getMessagePreview","_jsx","_Fragment","_jsxs","twolines","MessagePreview","template","Persona","textAlignment","secondaryText","avatar","initials","ChatItem","list","dataContext","_c$members","setUserId","selectedChat","setSelectedChat","onChatSelected","getMyId","panels","main","maxHeight","borderRightColor","borderRightStyle","borderRightWidth","side","newChat","dialog","dialogSurface","contain","nextResourceUrl","months","date","setMonth","getMonth","getPreviousDate","ChatList","Get","resourceUrl","ChatListTemplate","_React$useState","_React$useState2","setResourceUrl","_React$useState3","_React$useState4","_React$useState5","_React$useState6","isNewChatOpen","setIsNewChatOpen","PageHeader","description","MgtPersonCardConfig","sections","files","mailMessages","organization","showWorksWith","profile","useContactApis","isSendMessageVisible","_Graph","client","setComponent","betaGraph","componentName","Graph"],"sourceRoot":""}